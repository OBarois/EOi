/*! For license information please see main.bc2c0b19.chunk.js.LICENSE.txt */
(this.webpackJsonpeoi=this.webpackJsonpeoi||[]).push([[0],{26:function(e,t,r){},30:function(e,t,r){},54:function(e,t,r){},56:function(e,t,r){},61:function(e,t,r){},62:function(e,t,r){},64:function(e,t,r){},65:function(e,t,r){},66:function(e,t,r){},67:function(e,t,r){},68:function(e,t,r){},69:function(e,t,r){},70:function(e,t,r){},72:function(e,t,r){},73:function(e,t,r){},74:function(e,t,r){},76:function(e,t,r){},77:function(e,t,r){},78:function(e,t,r){},79:function(e,t,r){},83:function(e,t,r){},84:function(e,t,r){},85:function(e,t,r){},86:function(e,t,r){},87:function(e,t,r){"use strict";r.r(t);var n=r(0),i=r.n(n),a=r(20),s=r.n(a);r(54);const o=[{code:"SciHub/S1",satellites:["s1a","s1b"],cycle:10368e5,templateUrl:'https://scihub.copernicus.eu/dhus/search?q=( footprint:"Intersects({polygon})" AND beginposition:[{start} TO {end}] AND platformname:Sentinel-1  AND filename:*{freetext}*)&start={startindex}&rows=100&orderby=beginposition desc&format=json',name:"SciHub/S1",logo:"./images/s1_black.png",type:"DHUS",startIndexOrigin:0,dateOff:" beginposition:[{start} TO {end}] AND",areaOff:' footprint:"Intersects({polygon})" AND',windowSize:648e5,defaultFreetext:"GRD"},{code:"SciHub/S2",satellites:["s2a","s2b"],cycle:864e6,templateUrl:'https://scihub.copernicus.eu/dhus/search?q=( footprint:"Intersects({polygon})" AND beginposition:[{start} TO {end}] AND platformname:Sentinel-2 AND filename:*{freetext}*)&start={startindex}&rows=100&orderby=beginposition desc&format=json',name:"SciHub/S2",logo:"./images/s2_black.png",type:"DHUS",startIndexOrigin:0,dateOff:" beginposition:[{start} TO {end}] AND",areaOff:' footprint:"Intersects({polygon})" AND',windowSize:108e5,defaultFreetext:"S2A_MSIL1C"},{code:"SciHub/S3",satellites:["s3a","s3b"],cycle:23328e5,templateUrl:'https://scihub.copernicus.eu/dhus/search?q=( footprint:"Intersects({polygon})" AND beginposition:[{start} TO {end}] AND platformname:Sentinel-3 AND (producttype:OL_1_LFR___ OR producttype:SL_1_RBT___ OR producttype:SR_1_SRA___))&start={startindex}&rows=100&orderby=beginposition desc&format=json',name:"SciHub/S3 OL_1_LFR/SL_1_RBT/SR_1_SRA",logo:"./images/s3_black.png",type:"DHUS/S3/OLCI/SLSTR/SRAL",startIndexOrigin:0,dateOff:" beginposition:[{start} TO {end}] AND",areaOff:' footprint:"Intersects({polygon})" AND',windowSize:864e5,defaultFreetext:"Not in use"},{code:"SciHub/S3A/OLCI/LFR",satellites:["s3a"],cycle:23328e5,templateUrl:'https://scihub.copernicus.eu/dhus/search?q=( footprint:"Intersects({polygon})" AND beginposition:[{start} TO {end}] AND platformname:Sentinel-3 AND filename:S3A_*  AND (producttype:OL_2_LFR___))&start={startindex}&rows=100&orderby=beginposition desc&format=json',name:"SciHub/S3A/OL2_LFR",logo:"./images/s3_black.png",type:"DHUS",startIndexOrigin:0,dateOff:" beginposition:[{start} TO {end}] AND",areaOff:' footprint:"Intersects({polygon})" AND',windowSize:864e5,defaultFreetext:"Not in use"},{code:"SciHub2/S3",templateUrl:'https://scihub.copernicus.eu/dhus/search?q=( footprint:"Intersects({polygon})" AND beginposition:[{start} TO {end}] AND platformname:Sentinel-3 AND (producttype:{freetext}))&start={startindex}&rows=100&orderby=beginposition desc&format=json',satellites:["s3a","s3b"],cycle:23328e5,name:"DHUS/OpenSearch/S3",logo:"./images/s3_black.png",type:"DHUS",startIndexOrigin:0,dateOff:" beginposition:[{start} TO {end}] AND",areaOff:' footprint:"Intersects({polygon})" AND',windowSize:864e5,defaultFreetext:"SR_1_SRA___"},{code:"SciHub/S5P",satellites:["s5p"],cycle:13824e5,templateUrl:'https://scihub.copernicus.eu/dhus/search?q=( footprint:"Intersects({polygon})" AND beginposition:[{start} TO {end}] AND platformname:Sentinel-5 precursor AND producttype:{freetext}))&start={startindex}&rows=100&orderby=beginposition desc&format=json',name:"DHUS/OpenSearch/S5P",logo:"./images/s5p_black.png",type:"DHUS",startIndexOrigin:0,dateOff:" beginposition:[{start} TO {end}] AND",areaOff:' footprint:"Intersects({polygon})" AND',windowSize:864e5,defaultFreetext:"L1B_RA_BD1"},{code:"EODC-DHR/Envisat",satellites:["env"],cycle:3024e6,templateUrl:'https://dhr.datahub.eodc.eu/search?q=( footprint:"Intersects({polygon})" AND beginposition:[{start} TO {end}] AND platformname:Envisat AND producttype:{freetext}) &start={startindex}&rows=100&orderby=beginposition desc&format=json',name:"EODC-DHR/Envisat",logo:"./images/s5p_black.png",type:"DHUS/OpenSearch/Envisat",startIndexOrigin:0,dateOff:" beginposition:[{start} TO {end}] AND",areaOff:' footprint:"Intersects({polygon})" AND',windowSize:864e5,defaultFreetext:"MER_FRS_2P"},{code:"EOCAT Meris",satellites:["env"],templateUrl:"https://eocat.esa.int/api/catalogue/EOCAT-{freetext}/search?start={start}&stop={end}&geom={polygon}&format=json&count=50&startIndex={startindex}",startIndexOrigin:1,name:"EOCAT-MER_FRS_2P",logo:"./images/s5p_black.png",type:"EOCAT",dateOff:"start={start}&stop={end}&",areaOff:"&geom={polygon}",windowSize:2592e5,defaultFreetext:"MER_FRS_2P"},{code:"EOCAT ASA",satellites:["env"],templateUrl:"https://eocat.esa.int/api/catalogue/EOCAT-{freetext}/search?start={start}&stop={end}&geom={polygon}&format=json&count=50&startIndex={startindex}",startIndexOrigin:1,name:"EOCAT-ENVISAT.ASA.IMP_1P",logo:"./images/s5p_black.png",type:"EOCAT",dateOff:"start={start}&stop={end}&",areaOff:"&geom={polygon}",windowSize:2592e5,defaultFreetext:"ENVISAT.ASA.IMP_1P"},{code:"RefSys1/S1/S2/S3",satellites:["s1a"],cycle:10368e5,templateUrl:"https://processing.platform.ops-csc.com/ddip/odata/v1/Products?$format=json&$count=true&$top=100&$skip={startindex}&$filter=contains(Name,%27{freetext}%27)%20and%20OData.CSC.Intersects(area=geography%27SRID=4326;{polygon}%27)%20and%20ContentDate/Start%20gt%20{start}%20and%20ContentDate/Start%20lt%20{end}&$orderby=%20ContentDate/Start%20desc",tokenEndpoint:"https://iam.platform.ops-csc.com/auth/realms/RS/protocol/openid-connect/token",grantType:"client_credentials",startIndexOrigin:0,name:"RefSys/PRIP",logo:"./images/s1_black.png",type:"PRIP",dateOff:"%20and%20ContentDate/Start%20gt%20{start}%20and%20ContentDate/Start%20lt%20{end}",areaOff:"%20and%20OData.CSC.Intersects(area=geography%27SRID=4326;{polygon}%27)",windowSize:864e7,defaultFreetext:"S1A_IW_RAW__0SDV"},{code:"RefSys2/S1/S2/S3",satellites:["s1a"],cycle:10368e5,templateUrl:"https://processing.platform.ops-csc.com/ddip/odata/v1/Products?$format=json&$count=true&$top=100&$skip={startindex}&$filter=contains(Name,%27{freetext}%27)%20and%20OData.CSC.Intersects(area=geography%27SRID=4326;{polygon}%27)%20and%20ContentDate/Start%20gt%20{start}%20and%20ContentDate/Start%20lt%20{end}&$orderby=%20ContentDate/Start%20desc",tokenEndpoint:"https://iam.platform.ops-csc.com/auth/realms/RS/protocol/openid-connect/token",grantType:"client_credentials",startIndexOrigin:0,name:"RefSys/PRIP",logo:"./images/s1_black.png",type:"PRIP",dateOff:"%20and%20ContentDate/Start%20gt%20{start}%20and%20ContentDate/Start%20lt%20{end}",areaOff:"%20and%20OData.CSC.Intersects(area=geography%27SRID=4326;{polygon}%27)",windowSize:864e7,defaultFreetext:"EW_RAW__0N"},{code:"RefSys3",satellites:["s3a","s3b"],cycle:23328e5,templateUrl:"https://processing.platform.ops-csc.com/ddip/odata/v1/Products?$format=json&$count=true&$top=100&$skip={startindex}&$filter=contains(Name,%27{freetext}%27)%20and%20OData.CSC.Intersects(area=geography%27SRID=4326;{polygon}%27)%20and%20ContentDate/Start%20gt%20{start}%20and%20ContentDate/Start%20lt%20{end}&$orderby=%20ContentDate/Start%20desc",tokenEndpoint:"https://iam.platform.ops-csc.com/auth/realms/RS/protocol/openid-connect/token",grantType:"client_credentials",startIndexOrigin:0,name:"RefSys/PRIP",logo:"./images/s5p_black.png",type:"PRIP",dateOff:"%20and%20ContentDate/Start%20gt%20{start}%20and%20ContentDate/Start%20lt%20{end}",areaOff:"%20and%20OData.CSC.Intersects(area=geography%27SRID=4326;{polygon}%27)",windowSize:6048e5,defaultFreetext:"S3A_SR_0_SRA"},{code:"RefSys4",satellites:["s2a","s2b"],cycle:864e6,templateUrl:"https://processing.platform.ops-csc.com/ddip/odata/v1/Products?$format=json&$count=true&$top=100&$skip={startindex}&$filter=contains(Name,%27{freetext}%27)%20and%20OData.CSC.Intersects(area=geography%27SRID=4326;{polygon}%27)%20and%20ContentDate/Start%20gt%20{start}%20and%20ContentDate/Start%20lt%20{end}&$orderby=%20ContentDate/Start%20desc",tokenEndpoint:"https://iam.platform.ops-csc.com/auth/realms/RS/protocol/openid-connect/token",grantType:"client_credentials",startIndexOrigin:0,name:"RefSys/PRIP",logo:"./images/s2_black.png",type:"PRIP",dateOff:"%20and%20ContentDate/Start%20gt%20{start}%20and%20ContentDate/Start%20lt%20{end}",areaOff:"%20and%20OData.CSC.Intersects(area=geography%27SRID=4326;{polygon}%27)",windowSize:6048e5,defaultFreetext:"MSI_L1C_TL"},{code:"RefSys5",satellites:["s2a","s2b"],cycle:864e6,templateUrl:"https://processing.platform.ops-csc.com/ddip/odata/v1/Products?$format=json&$count=true&$top=100&$skip={startindex}&$filter=contains(Name,%27{freetext}%27)%20and%20OData.CSC.Intersects(area=geography%27SRID=4326;{polygon}%27)%20and%20ContentDate/Start%20gt%20{start}%20and%20ContentDate/Start%20lt%20{end}&$orderby=%20ContentDate/Start%20desc",tokenEndpoint:"https://iam.platform.ops-csc.com/auth/realms/RS/protocol/openid-connect/token",grantType:"client_credentials",startIndexOrigin:0,name:"RefSys/PRIP",logo:"./images/s2_black.png",type:"PRIP",dateOff:"%20and%20ContentDate/Start%20gt%20{start}%20and%20ContentDate/Start%20lt%20{end}",areaOff:"%20and%20OData.CSC.Intersects(area=geography%27SRID=4326;{polygon}%27)",windowSize:6048e5,defaultFreetext:"MSI_L2A_DS"},{code:"RefSys6",satellites:["s1a"],cycle:864e6,templateUrl:"https://processing.platform.ops-csc.com/ddip/odata/v1/Products?$format=json&$count=true&$top=100&$skip={startindex}&$filter=contains(Name,%27{freetext}%27)%20and%20OData.CSC.Intersects(area=geography%27SRID=4326;{polygon}%27)%20and%20ContentDate/Start%20gt%20{start}%20and%20ContentDate/Start%20lt%20{end}&$orderby=%20ContentDate/Start%20desc",tokenEndpoint:"https://iam.platform.ops-csc.com/auth/realms/RS/protocol/openid-connect/token",grantType:"client_credentials",startIndexOrigin:0,name:"RefSys/PRIP",logo:"./images/s2_black.png",type:"PRIP",dateOff:"%20and%20ContentDate/Start%20gt%20{start}%20and%20ContentDate/Start%20lt%20{end}",areaOff:"%20and%20OData.CSC.Intersects(area=geography%27SRID=4326;{polygon}%27)",windowSize:6048e5,defaultFreetext:"S1__AUX_WAV"},{code:"LTA",satellites:["s1a","s1b","s2a","s2b","s3a","s3b"],cycle:864e6,templateUrl:"https://lta.acri.copernicus.eu/odata/v1/Products?$count=true&$top=100&$skip={startindex}&$filter=contains(Name,%27{freetext}%27)%20and%20OData.CSC.Intersects(area=geography%27SRID=4326;{polygon}%27)%20and%20ContentDate/Start%20gt%20{start}%20and%20ContentDate/Start%20lt%20{end}",startIndexOrigin:0,name:"LTA Acri",logo:"./images/s2_black.png",type:"LTA",dateOff:"%20and%20ContentDate/Start%20gt%20{start}%20and%20ContentDate/Start%20lt%20{end}",areaOff:"%20and%20OData.CSC.Intersects(area=geography%27SRID=4326;{polygon}%27)",windowSize:864e5,defaultFreetext:"EW_RAW__0N"},{code:"CDSE",satellites:["s1a","s1b","s2a","s2b","s3a","s3b"],cycle:864e6,templateUrl:"https://catalogue.dataspace.copernicus.eu/odata/v1/Products?$count=true&$top=100&$skip={startindex}&$filter=contains(Name,%27{freetext}%27)%20and%20OData.CSC.Intersects(area=geography%27SRID=4326;{polygon}%27)%20and%20ContentDate/Start%20gt%20{start}%20and%20ContentDate/Start%20lt%20{end}&$expand=Assets",tokenEndpoint:"https://identity.dataspace.copernicus.eu/auth/realms/CDSE/protocol/openid-connect/token",grantType:"password",startIndexOrigin:0,name:"CDSE Odata",logo:"./images/s2_black.png",type:"CDSEOdata",dateOff:"%20and%20ContentDate/Start%20gt%20{start}%20and%20ContentDate/Start%20lt%20{end}",areaOff:"%20and%20OData.CSC.Intersects(area=geography%27SRID=4326;{polygon}%27)",windowSize:864e5,defaultFreetext:"GRD"},{code:"CDSE2",satellites:["s1a","s1b","s2a","s2b","s3a","s3b"],cycle:864e6,templateUrl:"https://catalogue.dataspace.copernicus.eu/stac/search?&datetime={start}/{end}&sortby=-start_datetime&limit=100&page={page}",tokenEndpoint:"https://identity.dataspace.copernicus.eu/auth/realms/CDSE/protocol/openid-connect/token",grantType:"password",startIndexOrigin:1,name:"CDSE STAC",logo:"./images/s2_black.png",type:"CDSEStac",dateOff:"&datetime={start}/{end}",areaOff:"%20and%20OData.CSC.Intersects(area=geography%27SRID=4326;{polygon}%27)",windowSize:864e5,defaultFreetext:"not in use"},{code:"CDSE3",satellites:["s1a","s1b","s2a","s2b","s3a","s3b"],cycle:864e6,templateUrl:"https://catalogue.dataspace.copernicus.eu/stac/collections/{freetext}/items?&datetime={start}/{end}&sortby=-start_datetime&limit=100&page={page}",tokenEndpoint:"https://identity.dataspace.copernicus.eu/auth/realms/CDSE/protocol/openid-connect/token",grantType:"password",startIndexOrigin:1,name:"CDSE STAC",logo:"./images/s2_black.png",type:"CDSEStac",dateOff:"&datetime={start}/{end}",areaOff:"%20and%20OData.CSC.Intersects(area=geography%27SRID=4326;{polygon}%27)",windowSize:864e5,defaultFreetext:"SENTINEL-1"}],l=(e,t)=>{switch(t.type){case"toggle_names":return console.log("togglename!"),{...e,mapSettings:{...e.mapSettings,names:!e.mapSettings.names}};case"toggle_starfield":return console.log("toggle starfield!"),{...e,mapSettings:{...e.mapSettings,starfield:!e.mapSettings.starfield}};case"toggle_atmosphere":return console.log("toggle atmosphere!"),{...e,mapSettings:{...e.mapSettings,atmosphere:!e.mapSettings.atmosphere}};case"north_up":return console.log("North Up!"),{...e,mapSettings:{...e.mapSettings,northup:e.northup+1}};case"toggle_background":return console.log("toggle background !"),{...e,mapSettings:{...e.mapSettings,background:e.mapSettings.background+1}};case"toggle_overlay":return console.log("toggle overlay!"),{...e,mapSettings:{...e.mapSettings,overlay:e.mapSettings.overlay+1}};case"toggle_projection":return console.log("toggleprojection!"),{...e,mapSettings:{...e.mapSettings,projection:e.mapSettings.projection+1}};case"set_dataset":return console.log("set dataset!"),console.log(t.value[4]),{...e,dataset:t.value[0],cycle:t.value[2],freetext:t.value[3],searchWindow:t.value[4],mapSettings:{...e.mapSettings,satelliteList:t.value[1],datasetSatelliteList:t.value[1]}};case"set_dem":return{...e,mapSettings:{...e.mapSettings,dem:t.value}};case"set_constellation":return console.log("set constellation!"),{...e,mapSettings:{...e.mapSettings,satelliteList:t.value[1]?t.value[0]:e.mapSettings.datasetSatelliteList,constellation:t.value[1],satellites:!!t.value[1]||e.mapSettings.satellites}};case"toggle_satellites":return console.log("toggle_satellites!: "+t.value),{...e,mapSettings:{...e.mapSettings,satellites:null!=t.value?t.value:!e.mapSettings.satellites,constellation:!!t.value&&e.mapSettings.constellation}};case"toggle_quicklooks":return{...e,mapSettings:{...e.mapSettings,quicklooks:!e.mapSettings.quicklooks}};case"set_altitude":return{...e,altitude:t.value,productOn:t.value>e.pointSearchMaxAltitude||e.productOn,searchMode:t.value>e.pointSearchMaxAltitude?"global":"point"};case"freetextsearch":return{...e,freetext:t.value,searchtrigger:Math.random()};case"onResultPage":return{...e,resultDesc:t.value.resultdesc,geojson:t.value.results};case"clearResult":return console.log("clear result"),{...e,clearResultsTrigger:Math.random(),resultDesc:{totalResults:0,totalLoaded:0},closestItem:null,filter:[],browseMode:e.searchMode,searching:!1};case"onSearchStart":return console.log("onSearchStart"),{...e,clearResultsTrigger:Math.random(),resultDesc:{totalResults:0,totalLoaded:0},closestItem:null,filter:[],browseMode:e.searchMode,searching:!0};case"onSearchComplete":return e.altitude,e.pointSearchMaxAltitude,{...e,resultDesc:t.value,searching:!1};case"set_searchWindow":return console.log("set_searchWindow: "),console.log(t.value),{...e,searchWindow:t.value.win,searchWinStart:t.value.wins,searchWinEnd:t.value.wine};case"set_selectedProduct":return console.log("set_selectedProduct:"),console.log(t.value),null!=e.selectedProduct&&t.value===e.selectedProduct?{...e,selectedProduct:t.value,goToDate:t.value?t.value.timeRange[0].getTime():null,productOn:!1,addQuicklookWMSTrigger:Math.random()}:{...e,selectedProduct:t.value,goToDate:t.value?t.value.timeRange[0].getTime():null};case"set_closestitem":return t.value?{...e,closestItem:t.value}:e;case"set_tics":return{...e,tics:t.value};case"set_filter":if(console.log("toggle_filter"),console.log(e.filter),console.log(e.closestItem),null===e.closestItem)return e;let r=[],n=e.closestItem.closest.userProperties;return 0!==e.filter.length&&e.filter?(console.log("no filter"),r=[]):(n.name.indexOf("S1")>=0&&(r=[{attribute:"relativePassNumber",value:n.earthObservation.acquisitionInformation[0].acquisitionParameter.relativePassNumber}]),n.name.indexOf("S2")>=0&&(r=[{attribute:"relativePassNumber",value:n.earthObservation.acquisitionInformation[0].acquisitionParameter.relativePassNumber},{attribute:"cloudCoverPercentage",value:20}])),{...e,filter:r};case"gotoclosestitem":return null==e.closestItem?e:{...e,goToDate:e.closestItem.closest.timeRange[0].getTime(),goToPos:{lat:null==e.closestItem.closest._sector?0:e.closestItem.closest._sector.centroidLatitude(),lon:null==e.closestItem.closest._sector?0:e.closestItem.closest._sector.centroidLongitude(),alt:e.altitude}};case"gotonextitem":return null==e.closestItem?e:null!=e.closestItem.next.sector?{...e,goToDate:e.closestItem.next.timeRange[0].getTime(),goToPos:{lat:e.closestItem.next.sector.centroidLatitude(),lon:e.closestItem.next.sector.centroidLongitude(),alt:e.altitude}}:{...e,goToDate:e.closestItem.next.timeRange[0].getTime()};case"gotopreviousitem":return null==e.closestItem?e:null!=e.closestItem.previous.sector?{...e,goToDate:e.closestItem.previous.timeRange[0].getTime(),goToPos:{lat:e.closestItem.previous.sector.centroidLatitude(),lon:e.closestItem.previous.sector.centroidLongitude(),alt:e.altitude}}:{...e,goToDate:e.closestItem.previous.timeRange[0].getTime()};case"set_searchDate":console.log("set_searchDate");let i=864e5,a=Math.floor(e.searchWindow/i)*i,s=Math.floor(t.value.getTime()/a)*a,o=s+a;return{...e,searchDate:t.value.getTime(),searchWinStart:s,searchWinEnd:o,goToDate:t.value.getTime()};case"set_animated":return console.log("set_animated"),{...e,animated:t.value};case"set_color":return console.log("set_color: "+t.value),{...e,appColor:t.value};case"set_viewDate":return{...e,viewDate:t.value.getTime(),productOn:!0};case"set_searchPoint":return{...e,searchPoint:t.value};case"set_zoomscale":return{...e,zoomScale:t.value};case"set_position":return{...e,position:{clon:t.value.lon,clat:t.value.lat}};case"set_token":return console.log("set token: "),console.log(t.value),{...e,token:t.value};case"set_credentials":{console.log(t.value);let r,n=e.credentials,i=!1;for(r=0;r<e.credentials.length;r++)e.credentials[r].key&&e.credentials[r].key==t.value.key&&(n[r]=t.value,i=!0);return i||n.push(t.value),{...e,credentials:n}}case"reset_credentials":return console.log("reset credentials"),{...e,credentials:{user:"",pass:""}};case"toggle_lefthanded":return{...e,leftHanded:!e.leftHanded};default:return e}};let c=new Date;c.getTime(),c.getTime();var u=r(17);let d=new Date;const h={active:!1,searching:!1,dataset:"CDSE",altitude:"5000000",appColor:"#d1b849",position:{clon:"0.5",clat:"45"},viewDate:d.getTime(),goToDate:d.getTime(),goToPos:{lat:0,lon:0},zoomScale:6461494,searchDate:null,credentials:[{key:"",user:"",pass:""}],resetStartDateTrigger:null,pointSearchMaxAltitude:3e6,selectedProduct:null,searchPoint:"POINT(40 0)",searchMode:"global",browseMode:"global",geojson:null,filter:[],closestItem:null,tics:[],addQuicklookWMSTrigger:null,moveToClosestItemTrigger:null,resultDesc:{firstItemDate:null,lastItemDate:null,totalResults:0,totalLoaded:0},animated:!1,cycle:10368e5,searchWindow:864e5,searchWinStart:0,searchWinEnd:0,clearResultsTrigger:null,mapSettings:{atmosphere:!1,starfield:!1,names:!1,background:0,overlay:1,dem:!1,satellites:!1,satelliteList:["s1a"],datasetSatelliteList:["s1a"],constellation:!1,quicklooks:!0,projection:0},collections:o,leftHanded:!1};function g(e,t){const[r,i]=Object(n.useState)(e);return Object(n.useEffect)((()=>{const r=setTimeout((()=>{i(e)}),t);return()=>{clearTimeout(r)}}),[e,t]),r}var p=r(2);const m=i.a.createContext(null),f=(e=>{try{let e=JSON.parse(window.localStorage.getItem("eoi_state")),t=window.location.href.indexOf("?s="),r=window.location.href.substring(t+3);window.history.replaceState(null,document.title,window.location.href.split("?")[0]);let n={};t>=0&&(n=JSON.parse(u.a.uncrush(decodeURIComponent(r))),console.log(n));let i={...h.mapSettings,...e.mapSettings,...n.mapSettings},a={...h,...e,...n,mapSettings:i};return console.log(a),a}catch{return console.log("init with default state"),console.log(h),h}})(),_=e=>{let{children:t}=e;const[r,a]=i.a.useReducer(l,f),s=g(r,1e3);return Object(n.useEffect)((()=>{window.localStorage.setItem("eoi_state",JSON.stringify((e=>({dataset:e.dataset,cycle:e.cycle,altitude:e.altitude,appColor:e.appColor,position:e.position,zoomScale:e.zoomScale,animated:e.animated,mapSettings:e.mapSettings,viewDate:e.viewDate,searchDate:e.searchDate,goToDate:e.goToDate,credentials:e.credentials,leftHanded:e.leftHanded,searchWindow:e.searchWindow,searchMode:e.searchMode,searchPoint:e.searchPoint,searchWinStart:e.searchWinStart,searchWinEnd:e.searchWinEnd}))(s)))}),[s]),Object(p.jsx)(m.Provider,{value:[r,a],children:t})};r(56),r(26);var b=r(3),E=r.n(b);const{AbstractError:S,Angle:y,Location:v,Logger:x,NotYetImplementedError:w,PickedObject:T,PolygonSplitter:R,Renderable:C,Sector:O,ShapeAttributes:D,Vec3:L,MemoryCache:A,BoundingBox:N}=E.a,P=function(e){C.call(this),this._displayName="Surface Shape",this._attributes=e||new D(null),this._highlightAttributes=e.highlightAttributes?e.highlightAttributes:null,this._highlighted=!1,this._enabled=!0,this._pathType=E.a.GREAT_CIRCLE,this._maximumNumEdgeIntervals=P.DEFAULT_NUM_EDGE_INTERVALS,this._polarThrottle=P.DEFAULT_POLAR_THROTTLE,this._sector=null,this.pickDelegate=null,this._sectors=[],this._locations=null,this._boundaries=null,this._interiorGeometry=null,this._outlineGeometry=null,this._isInteriorInhibited=!1,this.stateKeyInvalid=!0,this._attributesStateKey=null,this.boundariesArePrepared=!1,this.layer=null,this.pickColor=null,this.contours=[],this.containsPole=!1,this.crossesAntiMeridian=!1,this.expirationInterval=2e3,this.shapeDataCache=new A(3,2),this.currentData=null};P.prototype=Object.create(C.prototype),Object.defineProperties(P.prototype,{stateKey:{get:function(){if(this._attributesStateKey){var e=null;this._highlighted?this._highlightAttributes&&(e=this._highlightAttributes.stateKey):this._attributes&&(e=this._attributes.stateKey),e!=this._attributesStateKey&&(this._attributesStateKey=e,this.stateKeyInvalid=!0)}else this._highlighted?this._highlightAttributes&&(this._attributesStateKey=this._highlightAttributes.stateKey):this._attributes&&(this._attributesStateKey=this._attributes.stateKey),this._attributesStateKey&&(this.stateKeyInvalid=!0);return this.stateKeyInvalid&&(this._stateKey=this.computeStateKey()),this._stateKey}},displayName:{get:function(){return this._displayName},set:function(e){this.stateKeyInvalid=!0,this._displayName=e}},attributes:{get:function(){return this._attributes},set:function(e){this.stateKeyInvalid=!0,this._attributes=e,this._attributesStateKey=e.stateKey}},highlightAttributes:{get:function(){return this._highlightAttributes},set:function(e){this.stateKeyInvalid=!0,this._highlightAttributes=e}},highlighted:{get:function(){return this._highlighted},set:function(e){this.stateKeyInvalid=!0,this._highlighted=e}},enabled:{get:function(){return this._enabled},set:function(e){this.stateKeyInvalid=!0,this._enabled=e}},pathType:{get:function(){return this._pathType},set:function(e){this.stateKeyInvalid=!0,this.resetBoundaries(),this._pathType=e}},maximumNumEdgeIntervals:{get:function(){return this._maximumNumEdgeIntervals},set:function(e){this.stateKeyInvalid=!0,this.resetBoundaries(),this._maximumNumEdgeIntervals=e}},polarThrottle:{get:function(){return this._polarThrottle},set:function(e){this.stateKeyInvalid=!0,this.resetBoundaries(),this._polarThrottle=e}},sector:{get:function(){return this._sector}}}),P.staticStateKey=function(e){return e.stateKeyInvalid=!1,e.highlighted&&e._highlightAttributes?e._attributesStateKey=e._highlightAttributes.stateKey:e._attributes?e._attributesStateKey=e._attributes.stateKey:e._attributesStateKey=null,"dn "+e.displayName+" at "+(e._attributesStateKey?e._attributesStateKey:"null")+" hi "+e.highlighted+" en "+e.enabled+" pt "+e.pathType+" ne "+e.maximumNumEdgeIntervals+" po "+e.polarThrottle+" se ["+e.sector.minLatitude+","+e.sector.maxLatitude+","+e.sector.minLongitude+","+e.sector.maxLongitude+"]"},P.prototype.computeStateKey=function(){return P.staticStateKey(this)},P.prototype.area=function(e,t){throw new w(x.logMessage(x.LEVEL_SEVERE,"SurfaceShape","area","notYetImplemented"))},P.prototype.computeBoundaries=function(e){throw new S(x.logMessage(x.LEVEL_SEVERE,"SurfaceShape","computeBoundaries","abstractInvocation"))},P.prototype.intersectsFrustum=function(e){return!this.currentData||!this.currentData.extent||(e.pickingMode?this.currentData.extent.intersectsFrustum(e.pickFrustum):this.currentData.extent.intersectsFrustum(e.frustumInModelCoordinates))},P.prototype.isShapeDataCurrent=function(e,t){return t.verticalExaggeration===e.verticalExaggeration&&t.expiryTime>Date.now()},P.prototype.createShapeDataObject=function(){return{}},P.prototype.resetExpiration=function(e){e.expiryTime=Date.now()+this.expirationInterval+1e3*Math.random()},P.prototype.establishCurrentData=function(e){this.currentData=this.shapeDataCache.entryForKey(e.globeStateKey),this.currentData||(this.currentData=this.createShapeDataObject(),this.resetExpiration(this.currentData),this.shapeDataCache.putEntry(e.globeStateKey,this.currentData,1)),this.currentData.isExpired=!this.isShapeDataCurrent(e,this.currentData)},P.prototype.render=function(e){this.enabled&&(this.layer=e.currentLayer,this.prepareBoundaries(e),this.establishCurrentData(e),!this.currentData.isExpired&&this.currentData.extent||(this.computeExtent(e),this.currentData.verticalExaggeration=e.verticalExaggeration,this.resetExpiration(this.currentData)),this.currentData&&this.currentData.extent&&!this.intersectsFrustum(e)||e.surfaceShapeTileBuilder.insertSurfaceShape(this))},P.prototype.interpolateLocations=function(e){var t,r,n,i=e[0],a=i,s=!0,o=!0,l=0,c=!0;for(this._locations=[i],r=1,n=e.length;r<n;r+=1)t=a,o=s,c=!0,((s=(a=e[r]).latitude==i.latitude&&a.longitude==i.longitude)||o)&&(l+=1)>2&&(c=!1),c&&this.interpolateEdge(t,a,this._locations),this._locations.push(a),t=a;this._isInteriorInhibited||t.latitude==i.latitude&&t.longitude==i.longitude||(this.interpolateEdge(t,i,this._locations),this._locations.push(i))},P.prototype.interpolateEdge=function(e,t,r){var n,i,a=v.greatCircleDistance(e,t),s=Math.round(this._maximumNumEdgeIntervals*a/Math.PI);if(s>0){n=1/s,i=e;for(var o=this.throttledStep(n,i);o<1;o+=this.throttledStep(n,i))i=new v(0,0),v.interpolateAlongPath(this._pathType,o,e,t,i),180===e.longitude&&180===t.longitude?i.longitude=180:-180===e.longitude&&-180===t.longitude&&(i.longitude=-180),r.push(i)}},P.prototype.throttledStep=function(e,t){var r=Math.cos(t.latitude*y.DEGREES_TO_RADIANS);r*=r;var n=this._polarThrottle/(1+this._polarThrottle);return e*(1-n+n*r)},P.prototype.prepareBoundaries=function(e){if(!this.boundariesArePrepared){this._boundaries||this.computeBoundaries(e);var t=this.formatBoundaries();this.normalizeAngles(t),t=this.interpolateBoundaries(t);var r=[],n=R.splitContours(t,r);this.contours=r,this.crossesAntiMeridian=n,this.prepareGeometry(e,r),this.prepareSectors(),this.boundariesArePrepared=!0}},P.prototype.resetBoundaries=function(){this.boundariesArePrepared=!1,this.shapeDataCache.clear(!1)},P.prototype.formatBoundaries=function(){var e=[];return this._boundaries.length?(null!=this._boundaries[0].latitude?e.push(this._boundaries):e=this._boundaries,e):e},P.prototype.normalizeAngles=function(e){for(var t=0,r=e.length;t<r;t++)for(var n=e[t],i=0,a=n.length;i<a;i++){var s=n[i];(s.longitude<-180||s.longitude>180)&&(s.longitude=y.normalizedDegreesLongitude(s.longitude)),(s.latitude<-90||s.latitude>90)&&(s.latitude=y.normalizedDegreesLatitude(s.latitude))}},P.prototype.interpolateBoundaries=function(e){for(var t=[],r=0,n=e.length;r<n;r++){var i=e[r];this.interpolateLocations(i),t.push(this._locations.slice()),this._locations.length=0}return t},P.prototype.computeSectors=function(e){return this._sectors&&this._sectors.length>0||this.prepareBoundaries(e),this._sectors},P.prototype.computeExtent=function(e){if(!this._sectors||0===this._sectors.length)return null;if(!this.currentData)return null;var t;if(this.currentData.extent||(this.currentData.extent=new N),1===this._sectors.length)t=this._sectors[0].computeBoundingPoints(e.globe,e.verticalExaggeration),this.currentData.extent.setToVec3Points(t);else{for(var r=[],n=0;n<this._sectors.length;n++){t=this._sectors[n].computeBoundingPoints(e.globe,e.verticalExaggeration);var i=new N;i.setToVec3Points(t);for(var a=i.getCorners(),s=0;s<a.length;s++)r.push(a[s])}this.currentData.extent.setToVec3Points(r)}return this.currentData.extent},P.prototype.computeShiftedLocations=function(e,t,r,n){var i=[],a=new L(0,0,0),s=new E.a.Position(0,0,0),o=e.computePointFromLocation(t.latitude,t.longitude,new L(0,0,0)),l=e.computePointFromLocation(r.latitude,r.longitude,new L(0,0,0));if(e.is2D())for(var c=l.subtract(o),u=0,d=n.length;u<d;u++)e.computePointFromLocation(n[u].latitude,n[u].longitude,a),a.add(c),e.computePositionFromPoint(a[0],a[1],a[2],s),i.push(new v(s.latitude,s.longitude));else{var h=r.latitude-t.latitude,g=r.longitude-t.longitude,p=-90,m=90;for(u=0,d=n.length;u<d;u++){var f=n[u].latitude+h,_=n[u].longitude+g;f>90?(f=180-f,_+=180):f<-90&&(f=-180-f,_+=180),_<-180?_+=360:_>180&&(_-=360),f>p&&(p=f),f<m&&(m=f),i.push(new v(f,_))}if(p>90)for(c=p-90,u=0,d=i.length;u<d;u++)i[u].latitude-=c}return i},P.prototype.prepareSectors=function(){this.determineSectors(),this.crossesAntiMeridian?this.sectorsOverAntiMeridian():this.sectorsNotOverAntiMeridian()},P.prototype.determineSectors=function(){for(var e=0,t=this.contours.length;e<t;e++){var r=this.contours[e],n=r.polygons;r.sectors=[];for(var i=0,a=n.length;i<a;i++){var s=n[i],o=new O(0,0,0,0);if(o.setToBoundingSector(s),this._pathType===E.a.GREAT_CIRCLE){var l=v.greatCircleArcExtremeLocations(s),c=Math.min(o.minLatitude,l[0].latitude),u=Math.max(o.maxLatitude,l[1].latitude);o.minLatitude=c,o.maxLatitude=u}r.sectors.push(o)}}},P.prototype.sectorsOverAntiMeridian=function(){for(var e=new O(90,-90,180,-180),t=new O(90,-90,180,-180),r=0,n=this.contours.length;r<n;r++)for(var i=this.contours[r].sectors,a=0,s=i.length;a<s;a++){var o=i[a];o.minLongitude<0&&o.maxLongitude>0?(t.union(o),e.union(o)):o.minLongitude<0?t.union(o):e.union(o)}var l=Math.min(e.minLatitude,t.minLatitude),c=Math.max(e.maxLatitude,e.maxLatitude);this._sector=new O(l,c,-180,180),this._sectors=[e,t]},P.prototype.sectorsNotOverAntiMeridian=function(){this._sector=new O(90,-90,180,-180);for(var e=0,t=this.contours.length;e<t;e++)for(var r=this.contours[e].sectors,n=0,i=r.length;n<i;n++)this._sector.union(r[n]);this._sectors=[this._sector]},P.prototype.prepareGeometry=function(e,t){for(var r=[],n=[],i=0,a=t.length;i<a;i++)for(var s=t[i],o=s.poleIndex,l=0,c=s.polygons.length;l<c;l++){var u=s.polygons[l],d=s.iMap[l];r.push(u),s.pole!==v.poles.NONE&&c>1?l===o?this.outlineForPole(u,d,n):this.outlineForSplit(u,d,n):s.pole!==v.poles.NONE&&1===c?this.outlineForPole(u,d,n):s.pole===v.poles.NONE&&c>1?this.outlineForSplit(u,d,n):s.pole===v.poles.NONE&&1===c&&n.push(u)}this._interiorGeometry=r,this._outlineGeometry=n},P.prototype.outlineForPole=function(e,t,r){this.containsPole=!0;for(var n=[],i=0,a=0,s=e.length;a<s;a++){var o=e[a],l=t.get(a);l&&l.forPole&&++i%2===1&&(n.push(o),r.push(n),n=[]),i%2===0&&n.push(o)}n.length&&r.push(n)},P.prototype.outlineForSplit=function(e,t,r){for(var n=[],i=0,a=0,s=e.length;a<s;a++){var o=e[a],l=t.get(a);l&&!l.forPole&&++i%2===0&&(n.push(o),r.push(n),n=[]),i%2===1&&n.push(o)}},P.prototype.resetPickColor=function(){this.pickColor=null},P.prototype.renderToTexture=function(e,t,r,n,i,a){var s=this._highlighted&&this._highlightAttributes||this._attributes,o=!this._isInteriorInhibited&&s.drawInterior,l=s.drawOutline&&s.outlineWidth>0;if(o||l){if(e.pickingMode&&!this.pickColor&&(this.pickColor=e.uniquePickColor()),e.pickingMode)var c=this.pickColor.toHexString();if(this.crossesAntiMeridian||this.containsPole?(o&&(this.draw(this._interiorGeometry,t,r,n,i,a),t.fillStyle=e.pickingMode?c:s.interiorColor.toRGBAString(),t.fill()),l&&(this.draw(this._outlineGeometry,t,r,n,i,a),t.lineWidth=4*s.outlineWidth,t.strokeStyle=e.pickingMode?c:s.outlineColor.toRGBAString(),t.stroke())):(this.draw(this._interiorGeometry,t,r,n,i,a),o&&(t.fillStyle=e.pickingMode?c:s.interiorColor.toRGBAString(),t.fill()),l&&(t.lineWidth=4*s.outlineWidth,t.strokeStyle=e.pickingMode?c:s.outlineColor.toRGBAString(),t.stroke())),e.pickingMode){var u=new T(this.pickColor.clone(),this.pickDelegate?this.pickDelegate:this,null,this.layer,!1);e.resolvePick(u)}}},P.prototype.draw=function(e,t,r,n,i,a){t.beginPath();for(var s=0,o=e.length;s<o;s++){var l=e[s],c=l[0],u=c.longitude*r+i,d=c.latitude*n+a;t.moveTo(u,d);for(var h=1,g=l.length;h<g;h++)u=(c=l[h]).longitude*r+i,d=c.latitude*n+a,t.lineTo(u,d)}},P.DEFAULT_NUM_EDGE_INTERVALS=128,P.DEFAULT_POLAR_THROTTLE=10,E.a.SurfaceShape=P;var I=P;const{DrawContext:M}=E.a;M.prototype.resolvePick=function(e){if(e.userObject instanceof I||!this.deepPicking||this.regionPicking)this.addPickedObject(e);else{var t=this.readPickColor(this.pickPoint);if(!t)return null;e.color.equals(t)&&this.addPickedObject(e)}};class k{constructor(e,t,r){this.textureId=e||null,this.imageWidth=t,this.imageHeight=r,this.size=t*r*4,this.originalImageWidth=t,this.originalImageHeight=r,this.creationTime=new Date}bind(e){return e.currentGlContext.bindTexture(e.currentGlContext.TEXTURE_2D,this.textureId),e.frameStatistics.incrementTextureLoadCount(1),!0}dispose(e){e.deleteTexture(this.textureId),delete this.textureId}}class j{constructor(){this.framebufferId=null,this.textureId=null,this.width=0,this.height=0,this.texture=null}attachTexture(e,t,r){return this.textureId=this.createTexture(e,t,r),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.textureId,0),this.texture=new k(this.textureId,t,r),!0}bind(e,t,r){this.framebufferId||(this.framebufferId=e.createFramebuffer()),this.width=t,this.height=r,e.bindFramebuffer(e.FRAMEBUFFER,this.framebufferId),e.viewport(0,0,t,r)}bind_or(e,t,r){return this.framebufferId||(this.framebufferId=e.createFramebuffer()),this.width=t,this.height=r,e.bindFramebuffer(e.FRAMEBUFFER,this.framebufferId),e.viewport(0,0,t,r),this.textureId=this.createTexture(e,t,r),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.textureId,0),this.texture=new k(this.textureId,t,r),!0}clear(e){e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT)}unbind(e,t){t?(e.bindFramebuffer(e.FRAMEBUFFER,t.framebufferId),e.viewport(0,0,t.width,t.height)):(e.bindFramebuffer(e.FRAMEBUFFER,null),e.viewport(0,0,e.canvas.width,e.canvas.height))}createTexture(e,t,r){256!==t&&console.log("width",t),256!==r&&console.log("width",r);const n=e.createTexture();return e.bindTexture(e.TEXTURE_2D,n),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,t,r,0,e.RGBA,e.UNSIGNED_BYTE,null),n}}const{ArgumentError:F,Logger:U,SurfaceShapeTileBuilder:G,SurfaceShape:B,PickedObject:V}=E.a,W="SurfaceShapeFBO";G.prototype.buildTiles=function(e){if(!e)throw new F(U.logMessage(U.LEVEL_SEVERE,"SurfaceShapeTileBuilder","buildTiles","missingDc"));if(this.surfaceShapes&&!(this.surfaceShapes.length<1)){if(this.assembleTiles(e),G.__fboBound__){G.getFbo(e).unbind(e.currentGlContext,e.currentFramebuffer),G.__fboBound__=!1}this.surfaceShapes.splice(0,this.surfaceShapes.length);for(var t=0,r=this.surfaceShapeTiles.length;t<r;t+=1){this.surfaceShapeTiles[t].clearShapes()}}},G.prototype.addTile=function(e,t){if(e.pickingMode&&(t.pickSequence=G.pickSequence),t.needsUpdate(e)){const r=G.getFbo(e);G.__fboBound__||(r.bind(e.currentGlContext,this.tileWidth,this.tileHeight),G.__fboBound__=!0),t.updateTexture(e)}this.surfaceShapeTiles.push(t)},G.prototype.doRender=function(e){if(e.pickingMode){for(var t=0,r=this.surfaceShapes.length;t<r;t+=1)this.surfaceShapes[t].resetPickColor();G.pickSequence+=1;var n=this.surfaceShapeTiles,i=this.topLevelTiles;this.surfaceShapeTiles=[],this.topLevelTiles=[],this.buildTiles(e),e.deepPicking?this.doDeepPickingRender(e):e.surfaceTileRenderer.renderTiles(e,this.surfaceShapeTiles,1),this.surfaceShapeTiles=n,this.topLevelTiles=i}else this.buildTiles(e),e.surfaceTileRenderer.renderTiles(e,this.surfaceShapeTiles,1)},G.prototype.doDeepPickingRender=function(e){var t,r,n,i,a,s,o,l,c,u=[];for(a=0,s=e.objectsAtPickPoint.objects.length;a<s;a+=1)(o=e.objectsAtPickPoint.objects[a]).userObject instanceof B&&(l=o.userObject,u.indexOf(l)<0&&(u.push(l),e.objectsAtPickPoint.objects.splice(a,1),a-=1,s-=1));if(!(u.length<=0)){var d=[];for(n=0,i=u.length;n<i;n+=1){l=u[n];const i=G.getFbo(e);for(G.__fboBound__||(i.bind(e.currentGlContext,this.tileWidth,this.tileHeight),G.__fboBound__=!0),t=0,r=this.surfaceShapeTiles.length;t<r;t+=1)(c=this.surfaceShapeTiles[t]).setShapes([l]),c.updateTexture(e);if(G.__fboBound__){G.getFbo(e).unbind(e.currentGlContext,e.currentFramebuffer),G.__fboBound__=!1}e.surfaceTileRenderer.renderTiles(e,this.surfaceShapeTiles,1);var h=e.readPickColor(e.pickPoint);h&&l.pickColor.equals(h)&&(o=new V(l.pickColor.clone(),l.pickDelegate?l.pickDelegate:l,null,l.layer,!1),d.push(o))}for(a=0,s=e.objectsAtPickPoint.objects.length;a<s;a+=1)(o=e.objectsAtPickPoint.objects[a]).userObject instanceof B&&(e.objectsAtPickPoint.objects.splice(a,1),a-=1,s-=1);for(a=0,s=d.length;a<s;a+=1)o=d[a],e.objectsAtPickPoint.objects.push(o)}},G.getFbo=function(e){let t=e.gpuResourceCache.resourceForKey(W);return t||(t=new j,e.gpuResourceCache.putResource(W,t,1)),t},G.__frameStart__=!1,G.__fboBound__=!1;const{SurfaceShapeTile:z}=E.a;z.prototype.updateTexture=function(e){var t=e.currentGlContext,r=this.tileWidth/this.sector.deltaLongitude(),n=-this.tileHeight/this.sector.deltaLatitude(),i=-this.sector.minLongitude*r,a=-this.sector.maxLatitude*n;this.asRenderedSurfaceShapeStateKeys=[];var s=e.gpuResourceCache.resourceForKey("SurfaceShapeFBO");s.attachTexture(t,this.tileWidth,this.tileHeight),s.clear(t);for(var o=0,l=this.surfaceShapes.length;o<l;o+=1){var c=this.surfaceShapes[o];this.asRenderedSurfaceShapeStateKeys.push(this.surfaceShapeStateKeys[o]),c.renderToTexture(e,s,r,n,i,a)}this.gpuCacheKey=this.getCacheKey();var u=e.gpuResourceCache,d=s.texture;return u.putResource(this.gpuCacheKey,d,d.size),d};const{TiledImageLayer:H}=E.a;H.prototype.retrieveTileImage=function(e,t,r){this.pendingRequests||(this.pendingRequests=[]),this.MAX_REQUESTS||(this.MAX_REQUESTS=16);if(this.currentRetrievals.indexOf(t.imagePath)>=0)return;if(this.pendingRequests.some((e=>e.imagePath===t.imagePath)))return;if(this.absentResourceList.isResourceAbsent(t.imagePath))return;this.resourceUrlForTile(t,this.retrievalImageFormat)?(20===this.pendingRequests.length&&this.pendingRequests.shift(),this.pendingRequests.push(t),this.currentRetrievals.length<=this.MAX_REQUESTS&&this.fetchMoreImages(e,this)):this.currentTilesInvalid=!0},H.prototype.fetchMoreImages=function(e,t){const r=t.pendingRequests.length;if(t.pendingRequests=t.pendingRequests.filter((r=>t.isTileVisible(e,r))),!t.pendingRequests.length)return;t.pendingRequests.length;var n=t.pendingRequests.shift(),i=n.imagePath,a=t.resourceUrlForTile(n,t.retrievalImageFormat);if(!i||!a)return;const s=e.gpuResourceCache;t.fetchImage(a,(function(r,n){if(r)return t.removeFromCurrentRetrievals(i),t.absentResourceList.markResourceAbsent(i),void(t.currentRetrievals.length<=t.MAX_REQUESTS&&t.fetchMoreImages(e,t));var a=t.createTexture(e,null,n);if(t.removeFromCurrentRetrievals(i),a){s.putResource(i,a,a.size),t.currentTilesInvalid=!0,t.absentResourceList.unmarkResourceAbsent(i);var o=document.createEvent("Event");o.initEvent(E.a.REDRAW_EVENT_TYPE,!0,!0),window.dispatchEvent(o)}t.currentRetrievals.length<=t.MAX_REQUESTS&&t.fetchMoreImages(e,t)})),t.currentRetrievals.push(i)},H.prototype.fetchImage=function(e,t){const r=new Image;r.onload=function(){t(null,r)},r.onerror=function(){t(new Error("Image retrieval failed"),null)},r.crossOrigin="anonymous",window.webkit||!window.webkit&&window.AndroidApp,r.src=e},H.prototype.doRender_=function(e){e.terrain&&(!this.currentTilesInvalid&&this.lasTtMVP&&e.navigatorState.modelviewProjection.equals(this.lasTtMVP)&&e.globeStateKey===this.lastGlobeStateKey||(this.currentTilesInvalid=!1,this.assembleTiles(e)),this.lasTtMVP=e.navigatorState.modelviewProjection,this.lastGlobeStateKey=e.globeStateKey,this.currentTiles.length>0&&(e.surfaceTileRenderer.renderTiles(e,this.currentTiles,this.opacity,e.surfaceOpacity>=1),e.frameStatistics.incrementImageTileCount(this.currentTiles.length),this.inCurrentFrame=!0))},H.prototype.cleanCache=function(){};var q={DEBUG:!1,assert:function(e,t){if(q.DEBUG&&!e)throw new Error("Assertion failed"+(t?": "+t:""))},GLU_TESS_MAX_COORD:1e150,TRUE_PROJECT:!1,TESS_MAX_CACHE:100,GLU_TESS_DEFAULT_TOLERANCE:0,windingRule:{GLU_TESS_WINDING_ODD:100130,GLU_TESS_WINDING_NONZERO:100131,GLU_TESS_WINDING_POSITIVE:100132,GLU_TESS_WINDING_NEGATIVE:100133,GLU_TESS_WINDING_ABS_GEQ_TWO:100134},primitiveType:{GL_LINE_LOOP:2,GL_TRIANGLES:4,GL_TRIANGLE_STRIP:5,GL_TRIANGLE_FAN:6},errorType:{GLU_TESS_MISSING_BEGIN_POLYGON:100151,GLU_TESS_MISSING_END_POLYGON:100153,GLU_TESS_MISSING_BEGIN_CONTOUR:100152,GLU_TESS_MISSING_END_CONTOUR:100154,GLU_TESS_COORD_TOO_LARGE:100155,GLU_TESS_NEED_COMBINE_CALLBACK:100156},gluEnum:{GLU_TESS_BEGIN:100100,GLU_TESS_VERTEX:100101,GLU_TESS_END:100102,GLU_TESS_ERROR:100103,GLU_TESS_EDGE_FLAG:100104,GLU_TESS_COMBINE:100105,GLU_TESS_BEGIN_DATA:100106,GLU_TESS_VERTEX_DATA:100107,GLU_TESS_END_DATA:100108,GLU_TESS_ERROR_DATA:100109,GLU_TESS_EDGE_FLAG_DATA:100110,GLU_TESS_COMBINE_DATA:100111,GLU_TESS_MESH:100112,GLU_TESS_TOLERANCE:100142,GLU_TESS_WINDING_RULE:100140,GLU_TESS_BOUNDARY_ONLY:100141,GLU_INVALID_ENUM:100900,GLU_INVALID_VALUE:100901},geom:{}};q.geom.vertEq=function(e,t){return e.s===t.s&&e.t===t.t},q.geom.vertLeq=function(e,t){return e.s<t.s||e.s===t.s&&e.t<=t.t},q.geom.edgeEval=function(e,t,r){var n=t.s-e.s,i=r.s-t.s;return n+i>0?n<i?t.t-e.t+(e.t-r.t)*(n/(n+i)):t.t-r.t+(r.t-e.t)*(i/(n+i)):0},q.geom.edgeSign=function(e,t,r){var n=t.s-e.s,i=r.s-t.s;return n+i>0?(t.t-r.t)*n+(t.t-e.t)*i:0},q.geom.transLeq=function(e,t){return e.t<t.t||e.t===t.t&&e.s<=t.s},q.geom.transEval=function(e,t,r){var n=t.t-e.t,i=r.t-t.t;return n+i>0?n<i?t.s-e.s+(e.s-r.s)*(n/(n+i)):t.s-r.s+(r.s-e.s)*(i/(n+i)):0},q.geom.transSign=function(e,t,r){var n=t.t-e.t,i=r.t-t.t;return n+i>0?(t.s-r.s)*n+(t.s-e.s)*i:0},q.geom.edgeGoesLeft=function(e){return q.geom.vertLeq(e.dst(),e.org)},q.geom.edgeGoesRight=function(e){return q.geom.vertLeq(e.org,e.dst())},q.geom.vertL1dist=function(e,t){return Math.abs(e.s-t.s)+Math.abs(e.t-t.t)},q.geom.vertCCW=function(e,t,r){return e.s*(t.t-r.t)+t.s*(r.t-e.t)+r.s*(e.t-t.t)>=0},q.geom.interpolate_=function(e,t,r,n){return(e=e<0?0:e)<=(r=r<0?0:r)?0===r?(t+n)/2:t+e/(e+r)*(n-t):n+r/(e+r)*(t-n)},q.geom.edgeIntersect=function(e,t,r,n,i){var a,s,o;q.geom.vertLeq(e,t)||(o=e,e=t,t=o),q.geom.vertLeq(r,n)||(o=r,r=n,n=o),q.geom.vertLeq(e,r)||(o=e,e=r,r=o,o=t,t=n,n=o),q.geom.vertLeq(r,t)?q.geom.vertLeq(t,n)?((a=q.geom.edgeEval(e,r,t))+(s=q.geom.edgeEval(r,t,n))<0&&(a=-a,s=-s),i.s=q.geom.interpolate_(a,r.s,s,t.s)):((a=q.geom.edgeSign(e,r,t))+(s=-q.geom.edgeSign(e,n,t))<0&&(a=-a,s=-s),i.s=q.geom.interpolate_(a,r.s,s,n.s)):i.s=(r.s+t.s)/2,q.geom.transLeq(e,t)||(o=e,e=t,t=o),q.geom.transLeq(r,n)||(o=r,r=n,n=o),q.geom.transLeq(e,r)||(o=e,e=r,r=o,o=t,t=n,n=o),q.geom.transLeq(r,t)?q.geom.transLeq(t,n)?((a=q.geom.transEval(e,r,t))+(s=q.geom.transEval(r,t,n))<0&&(a=-a,s=-s),i.t=q.geom.interpolate_(a,r.t,s,t.t)):((a=q.geom.transSign(e,r,t))+(s=-q.geom.transSign(e,n,t))<0&&(a=-a,s=-s),i.t=q.geom.interpolate_(a,r.t,s,n.t)):i.t=(r.t+t.t)/2},q.mesh={},q.mesh.makeEdge=function(e){var t=q.mesh.makeEdgePair_(e.eHead);return q.mesh.makeVertex_(t,e.vHead),q.mesh.makeVertex_(t.sym,e.vHead),q.mesh.makeFace_(t,e.fHead),t},q.mesh.meshSplice=function(e,t){var r=!1,n=!1;e!==t&&(t.org!==e.org&&(n=!0,q.mesh.killVertex_(t.org,e.org)),t.lFace!==e.lFace&&(r=!0,q.mesh.killFace_(t.lFace,e.lFace)),q.mesh.splice_(t,e),n||(q.mesh.makeVertex_(t,e.org),e.org.anEdge=e),r||(q.mesh.makeFace_(t,e.lFace),e.lFace.anEdge=e))},q.mesh.deleteEdge=function(e){var t=e.sym,r=!1;e.lFace!==e.rFace()&&(r=!0,q.mesh.killFace_(e.lFace,e.rFace())),e.oNext===e?q.mesh.killVertex_(e.org,null):(e.rFace().anEdge=e.oPrev(),e.org.anEdge=e.oNext,q.mesh.splice_(e,e.oPrev()),r||q.mesh.makeFace_(e,e.lFace)),t.oNext===t?(q.mesh.killVertex_(t.org,null),q.mesh.killFace_(t.lFace,null)):(e.lFace.anEdge=t.oPrev(),t.org.anEdge=t.oNext,q.mesh.splice_(t,t.oPrev())),q.mesh.killEdge_(e)},q.mesh.addEdgeVertex=function(e){var t=q.mesh.makeEdgePair_(e),r=t.sym;return q.mesh.splice_(t,e.lNext),t.org=e.dst(),q.mesh.makeVertex_(r,t.org),t.lFace=r.lFace=e.lFace,t},q.mesh.splitEdge=function(e){var t=q.mesh.addEdgeVertex(e).sym;return q.mesh.splice_(e.sym,e.sym.oPrev()),q.mesh.splice_(e.sym,t),e.sym.org=t.org,t.dst().anEdge=t.sym,t.sym.lFace=e.rFace(),t.winding=e.winding,t.sym.winding=e.sym.winding,t},q.mesh.connect=function(e,t){var r=!1,n=q.mesh.makeEdgePair_(e),i=n.sym;return t.lFace!==e.lFace&&(r=!0,q.mesh.killFace_(t.lFace,e.lFace)),q.mesh.splice_(n,e.lNext),q.mesh.splice_(i,t),n.org=e.dst(),i.org=t.org,n.lFace=i.lFace=e.lFace,e.lFace.anEdge=i,r||q.mesh.makeFace_(n,e.lFace),n},q.mesh.zapFace=function(e){var t,r=e.anEdge,n=r.lNext;do{if(n=(t=n).lNext,t.lFace=null,null===t.rFace()){t.oNext===t?q.mesh.killVertex_(t.org,null):(t.org.anEdge=t.oNext,q.mesh.splice_(t,t.oPrev()));var i=t.sym;i.oNext===i?q.mesh.killVertex_(i.org,null):(i.org.anEdge=i.oNext,q.mesh.splice_(i,i.oPrev())),q.mesh.killEdge_(t)}}while(t!==r);var a=e.prev,s=e.next;s.prev=a,a.next=s},q.mesh.meshUnion=function(e,t){var r=e.fHead,n=e.vHead,i=e.eHead,a=t.fHead,s=t.vHead,o=t.eHead;return a.next!==a&&(r.prev.next=a.next,a.next.prev=r.prev,a.prev.next=r,r.prev=a.prev),s.next!==s&&(n.prev.next=s.next,s.next.prev=n.prev,s.prev.next=n,n.prev=s.prev),o.next!==o&&(i.sym.next.sym.next=o.next,o.next.sym.next=i.sym.next,o.sym.next.sym.next=i,i.sym.next=o.sym.next),e},q.mesh.deleteMesh=function(e){},q.mesh.makeEdgePair_=function(e){var t=new q.GluHalfEdge,r=new q.GluHalfEdge,n=e.sym.next;return r.next=n,n.sym.next=t,t.next=e,e.sym.next=r,t.sym=r,t.oNext=t,t.lNext=r,r.sym=t,r.oNext=r,r.lNext=t,t},q.mesh.splice_=function(e,t){var r=e.oNext,n=t.oNext;r.sym.lNext=t,n.sym.lNext=e,e.oNext=n,t.oNext=r},q.mesh.makeVertex_=function(e,t){var r=t.prev,n=new q.GluVertex(t,r);r.next=n,t.prev=n,n.anEdge=e;var i=e;do{i.org=n,i=i.oNext}while(i!==e)},q.mesh.makeFace_=function(e,t){var r=t.prev,n=new q.GluFace(t,r);r.next=n,t.prev=n,n.anEdge=e,n.inside=t.inside;var i=e;do{i.lFace=n,i=i.lNext}while(i!==e)},q.mesh.killEdge_=function(e){var t=e.next,r=e.sym.next;t.sym.next=r,r.sym.next=t},q.mesh.killVertex_=function(e,t){var r=e.anEdge,n=r;do{n.org=t,n=n.oNext}while(n!==r);var i=e.prev,a=e.next;a.prev=i,i.next=a},q.mesh.killFace_=function(e,t){var r=e.anEdge,n=r;do{n.lFace=t,n=n.lNext}while(n!==r);var i=e.prev,a=e.next;a.prev=i,i.next=a},q.normal={},q.normal.S_UNIT_X_=1,q.normal.S_UNIT_Y_=0,q.normal.projectPolygon=function(e){var t=!1,r=[e.normal[0],e.normal[1],e.normal[2]];0===r[0]&&0===r[1]&&0===r[2]&&(q.normal.computeNormal_(e,r),t=!0);var n=e.sUnit,i=e.tUnit,a=q.normal.longAxis_(r);if(q.TRUE_PROJECT){q.normal.normalize_(r),n[a]=0,n[(a+1)%3]=q.normal.S_UNIT_X_,n[(a+2)%3]=q.normal.S_UNIT_Y_;var s=q.normal.dot_(n,r);n[0]-=s*r[0],n[1]-=s*r[1],n[2]-=s*r[2],q.normal.normalize_(n),i[0]=r[1]*n[2]-r[2]*n[1],i[1]=r[2]*n[0]-r[0]*n[2],i[2]=r[0]*n[1]-r[1]*n[0],q.normal.normalize_(i)}else n[a]=0,n[(a+1)%3]=q.normal.S_UNIT_X_,n[(a+2)%3]=q.normal.S_UNIT_Y_,i[a]=0,i[(a+1)%3]=r[a]>0?-q.normal.S_UNIT_Y_:q.normal.S_UNIT_Y_,i[(a+2)%3]=r[a]>0?q.normal.S_UNIT_X_:-q.normal.S_UNIT_X_;for(var o=e.mesh.vHead,l=o.next;l!==o;l=l.next)l.s=q.normal.dot_(l.coords,n),l.t=q.normal.dot_(l.coords,i);t&&q.normal.checkOrientation_(e)},q.normal.dot_=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},q.normal.normalize_=function(e){var t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];t=Math.sqrt(t),e[0]/=t,e[1]/=t,e[2]/=t},q.normal.longAxis_=function(e){var t=0;return Math.abs(e[1])>Math.abs(e[0])&&(t=1),Math.abs(e[2])>Math.abs(e[t])&&(t=2),t},q.normal.computeNormal_=function(e,t){var r,n=[-2*q.GLU_TESS_MAX_COORD,-2*q.GLU_TESS_MAX_COORD,-2*q.GLU_TESS_MAX_COORD],i=[2*q.GLU_TESS_MAX_COORD,2*q.GLU_TESS_MAX_COORD,2*q.GLU_TESS_MAX_COORD],a=[],s=[],o=e.mesh.vHead;for(r=o.next;r!==o;r=r.next)for(var l=0;l<3;++l){var c=r.coords[l];c<i[l]&&(i[l]=c,s[l]=r),c>n[l]&&(n[l]=c,a[l]=r)}var u=0;if(n[1]-i[1]>n[0]-i[0]&&(u=1),n[2]-i[2]>n[u]-i[u]&&(u=2),i[u]>=n[u])return t[0]=0,t[1]=0,void(t[2]=1);var d=0,h=s[u],g=a[u],p=[0,0,0],m=[h.coords[0]-g.coords[0],h.coords[1]-g.coords[1],h.coords[2]-g.coords[2]],f=[0,0,0];for(r=o.next;r!==o;r=r.next){f[0]=r.coords[0]-g.coords[0],f[1]=r.coords[1]-g.coords[1],f[2]=r.coords[2]-g.coords[2],p[0]=m[1]*f[2]-m[2]*f[1],p[1]=m[2]*f[0]-m[0]*f[2],p[2]=m[0]*f[1]-m[1]*f[0];var _=p[0]*p[0]+p[1]*p[1]+p[2]*p[2];_>d&&(d=_,t[0]=p[0],t[1]=p[1],t[2]=p[2])}d<=0&&(t[0]=t[1]=t[2]=0,t[q.normal.longAxis_(m)]=1)},q.normal.checkOrientation_=function(e){for(var t=0,r=e.mesh.fHead,n=r.next;n!==r;n=n.next){var i=n.anEdge;if(!(i.winding<=0))do{t+=(i.org.s-i.dst().s)*(i.org.t+i.dst().t),i=i.lNext}while(i!==n.anEdge)}if(t<0){for(var a=e.mesh.vHead,s=a.next;s!==a;s=s.next)s.t=-s.t;e.tUnit[0]=-e.tUnit[0],e.tUnit[1]=-e.tUnit[1],e.tUnit[2]=-e.tUnit[2]}},q.render={},q.render.renderMesh=function(e,t,r){for(var n=!1,i=-1,a=t.fHead.prev;a!==t.fHead;a=a.prev)if(a.inside){n||(e.callBeginOrBeginData(q.primitiveType.GL_TRIANGLES),n=!0);var s=a.anEdge;do{if(r){var o=s.rFace().inside?0:1;i!==o&&(i=o,e.callEdgeFlagOrEdgeFlagData(!!i))}e.callVertexOrVertexData(s.org.data),s=s.lNext}while(s!==a.anEdge)}n&&e.callEndOrEndData()},q.render.renderBoundary=function(e,t){for(var r=t.fHead.next;r!==t.fHead;r=r.next)if(r.inside){e.callBeginOrBeginData(q.primitiveType.GL_LINE_LOOP);var n=r.anEdge;do{e.callVertexOrVertexData(n.org.data),n=n.lNext}while(n!==r.anEdge);e.callEndOrEndData()}},q.sweep={},q.sweep.SENTINEL_COORD_=4*q.GLU_TESS_MAX_COORD,q.sweep.TOLERANCE_NONZERO_=!1,q.sweep.computeInterior=function(e){var t;for(e.fatalError=!1,q.sweep.removeDegenerateEdges_(e),q.sweep.initPriorityQ_(e),q.sweep.initEdgeDict_(e);null!==(t=e.pq.extractMin());){for(;;){var r=e.pq.minimum();if(null===r||!q.geom.vertEq(r,t))break;r=e.pq.extractMin(),q.sweep.spliceMergeVertices_(e,t.anEdge,r.anEdge)}q.sweep.sweepEvent_(e,t)}var n=e.dict.getMin().getKey();e.event=n.eUp.org,q.sweep.doneEdgeDict_(e),q.sweep.donePriorityQ_(e),q.sweep.removeDegenerateFaces_(e.mesh),e.mesh.checkMesh()},q.sweep.addWinding_=function(e,t){e.winding+=t.winding,e.sym.winding+=t.sym.winding},q.sweep.edgeLeq_=function(e,t,r){var n=e.event,i=t.eUp,a=r.eUp;return i.dst()===n?a.dst()===n?q.geom.vertLeq(i.org,a.org)?q.geom.edgeSign(a.dst(),i.org,a.org)<=0:q.geom.edgeSign(i.dst(),a.org,i.org)>=0:q.geom.edgeSign(a.dst(),n,a.org)<=0:a.dst()===n?q.geom.edgeSign(i.dst(),n,i.org)>=0:q.geom.edgeEval(i.dst(),n,i.org)>=q.geom.edgeEval(a.dst(),n,a.org)},q.sweep.deleteRegion_=function(e,t){t.fixUpperEdge,t.eUp.activeRegion=null,e.dict.deleteNode(t.nodeUp),t.nodeUp=null},q.sweep.fixUpperEdge_=function(e,t){q.mesh.deleteEdge(e.eUp),e.fixUpperEdge=!1,e.eUp=t,t.activeRegion=e},q.sweep.topLeftRegion_=function(e){var t=e.eUp.org;do{e=e.regionAbove()}while(e.eUp.org===t);if(e.fixUpperEdge){var r=q.mesh.connect(e.regionBelow().eUp.sym,e.eUp.lNext);q.sweep.fixUpperEdge_(e,r),e=e.regionAbove()}return e},q.sweep.topRightRegion_=function(e){var t=e.eUp.dst();do{e=e.regionAbove()}while(e.eUp.dst()===t);return e},q.sweep.addRegionBelow_=function(e,t,r){var n=new q.ActiveRegion;return n.eUp=r,n.nodeUp=e.dict.insertBefore(t.nodeUp,n),r.activeRegion=n,n},q.sweep.isWindingInside_=function(e,t){switch(e.windingRule){case q.windingRule.GLU_TESS_WINDING_ODD:return 0!==(1&t);case q.windingRule.GLU_TESS_WINDING_NONZERO:return 0!==t;case q.windingRule.GLU_TESS_WINDING_POSITIVE:return t>0;case q.windingRule.GLU_TESS_WINDING_NEGATIVE:return t<0;case q.windingRule.GLU_TESS_WINDING_ABS_GEQ_TWO:return t>=2||t<=-2}return!1},q.sweep.computeWinding_=function(e,t){t.windingNumber=t.regionAbove().windingNumber+t.eUp.winding,t.inside=q.sweep.isWindingInside_(e,t.windingNumber)},q.sweep.finishRegion_=function(e,t){var r=t.eUp,n=r.lFace;n.inside=t.inside,n.anEdge=r,q.sweep.deleteRegion_(e,t)},q.sweep.finishLeftRegions_=function(e,t,r){for(var n=t,i=t.eUp;n!==r;){n.fixUpperEdge=!1;var a=n.regionBelow(),s=a.eUp;if(s.org!==i.org){if(!a.fixUpperEdge){q.sweep.finishRegion_(e,n);break}s=q.mesh.connect(i.lPrev(),s.sym),q.sweep.fixUpperEdge_(a,s)}i.oNext!==s&&(q.mesh.meshSplice(s.oPrev(),s),q.mesh.meshSplice(i,s)),q.sweep.finishRegion_(e,n),i=a.eUp,n=a}return i},q.sweep.addRightEdges_=function(e,t,r,n,i,a){var s=!0,o=r;do{q.sweep.addRegionBelow_(e,t,o.sym),o=o.oNext}while(o!==n);null===i&&(i=t.regionBelow().eUp.rPrev());for(var l,c=t,u=i;(o=(l=c.regionBelow()).eUp.sym).org===u.org;)o.oNext!==u&&(q.mesh.meshSplice(o.oPrev(),o),q.mesh.meshSplice(u.oPrev(),o)),l.windingNumber=c.windingNumber-o.winding,l.inside=q.sweep.isWindingInside_(e,l.windingNumber),c.dirty=!0,!s&&q.sweep.checkForRightSplice_(e,c)&&(q.sweep.addWinding_(o,u),q.sweep.deleteRegion_(e,c),q.mesh.deleteEdge(u)),s=!1,c=l,u=o;c.dirty=!0,a&&q.sweep.walkDirtyRegions_(e,c)},q.sweep.callCombine_=function(e,t,r,n,i){var a=[t.coords[0],t.coords[1],t.coords[2]];t.data=null,t.data=e.callCombineOrCombineData(a,r,n),null===t.data&&(i?e.fatalError||(e.callErrorOrErrorData(q.errorType.GLU_TESS_NEED_COMBINE_CALLBACK),e.fatalError=!0):t.data=r[0])},q.sweep.spliceMergeVertices_=function(e,t,r){var n=[null,null,null,null];n[0]=t.org.data,n[1]=r.org.data,q.sweep.callCombine_(e,t.org,n,[.5,.5,0,0],!1),q.mesh.meshSplice(t,r)},q.sweep.vertexWeights_=function(e,t,r,n,i){var a=q.geom.vertL1dist(t,e),s=q.geom.vertL1dist(r,e),o=i,l=i+1;n[o]=.5*s/(a+s),n[l]=.5*a/(a+s),e.coords[0]+=n[o]*t.coords[0]+n[l]*r.coords[0],e.coords[1]+=n[o]*t.coords[1]+n[l]*r.coords[1],e.coords[2]+=n[o]*t.coords[2]+n[l]*r.coords[2]},q.sweep.getIntersectData_=function(e,t,r,n,i,a){var s=[0,0,0,0],o=[r.data,n.data,i.data,a.data];t.coords[0]=t.coords[1]=t.coords[2]=0,q.sweep.vertexWeights_(t,r,n,s,0),q.sweep.vertexWeights_(t,i,a,s,2),q.sweep.callCombine_(e,t,o,s,!0)},q.sweep.checkForRightSplice_=function(e,t){var r=t.regionBelow(),n=t.eUp,i=r.eUp;if(q.geom.vertLeq(n.org,i.org)){if(q.geom.edgeSign(i.dst(),n.org,i.org)>0)return!1;q.geom.vertEq(n.org,i.org)?n.org!==i.org&&(e.pq.remove(n.org.pqHandle),q.sweep.spliceMergeVertices_(e,i.oPrev(),n)):(q.mesh.splitEdge(i.sym),q.mesh.meshSplice(n,i.oPrev()),t.dirty=r.dirty=!0)}else{if(q.geom.edgeSign(n.dst(),i.org,n.org)<0)return!1;t.regionAbove().dirty=t.dirty=!0,q.mesh.splitEdge(n.sym),q.mesh.meshSplice(i.oPrev(),n)}return!0},q.sweep.checkForLeftSplice_=function(e,t){var r,n=t.regionBelow(),i=t.eUp,a=n.eUp;if(q.geom.vertLeq(i.dst(),a.dst())){if(q.geom.edgeSign(i.dst(),a.dst(),i.org)<0)return!1;t.regionAbove().dirty=t.dirty=!0,r=q.mesh.splitEdge(i),q.mesh.meshSplice(a.sym,r),r.lFace.inside=t.inside}else{if(q.geom.edgeSign(a.dst(),i.dst(),a.org)>0)return!1;t.dirty=n.dirty=!0,r=q.mesh.splitEdge(a),q.mesh.meshSplice(i.lNext,a.sym),r.rFace().inside=t.inside}return!0},q.sweep.checkForIntersect_=function(e,t){var r=t.regionBelow(),n=t.eUp,i=r.eUp,a=n.org,s=i.org,o=n.dst(),l=i.dst(),c=new q.GluVertex;if(a===s)return!1;if(Math.min(a.t,o.t)>Math.max(s.t,l.t))return!1;if(q.geom.vertLeq(a,s)){if(q.geom.edgeSign(l,a,s)>0)return!1}else if(q.geom.edgeSign(o,s,a)<0)return!1;q.geom.edgeIntersect(o,a,l,s,c),q.geom.vertLeq(c,e.event)&&(c.s=e.event.s,c.t=e.event.t);var u=q.geom.vertLeq(a,s)?a:s;if(q.geom.vertLeq(u,c)&&(c.s=u.s,c.t=u.t),q.geom.vertEq(c,a)||q.geom.vertEq(c,s))return q.sweep.checkForRightSplice_(e,t),!1;if(!q.geom.vertEq(o,e.event)&&q.geom.edgeSign(o,e.event,c)>=0||!q.geom.vertEq(l,e.event)&&q.geom.edgeSign(l,e.event,c)<=0){if(l===e.event)return q.mesh.splitEdge(n.sym),q.mesh.meshSplice(i.sym,n),n=(t=q.sweep.topLeftRegion_(t)).regionBelow().eUp,q.sweep.finishLeftRegions_(e,t.regionBelow(),r),q.sweep.addRightEdges_(e,t,n.oPrev(),n,n,!0),!0;if(o===e.event){q.mesh.splitEdge(i.sym),q.mesh.meshSplice(n.lNext,i.oPrev()),r=t;var d=(t=q.sweep.topRightRegion_(t)).regionBelow().eUp.rPrev();return r.eUp=i.oPrev(),i=q.sweep.finishLeftRegions_(e,r,null),q.sweep.addRightEdges_(e,t,i.oNext,n.rPrev(),d,!0),!0}return q.geom.edgeSign(o,e.event,c)>=0&&(t.regionAbove().dirty=t.dirty=!0,q.mesh.splitEdge(n.sym),n.org.s=e.event.s,n.org.t=e.event.t),q.geom.edgeSign(l,e.event,c)<=0&&(t.dirty=r.dirty=!0,q.mesh.splitEdge(i.sym),i.org.s=e.event.s,i.org.t=e.event.t),!1}return q.mesh.splitEdge(n.sym),q.mesh.splitEdge(i.sym),q.mesh.meshSplice(i.oPrev(),n),n.org.s=c.s,n.org.t=c.t,n.org.pqHandle=e.pq.insert(n.org),q.sweep.getIntersectData_(e,n.org,a,o,s,l),t.regionAbove().dirty=t.dirty=r.dirty=!0,!1},q.sweep.walkDirtyRegions_=function(e,t){for(var r=t.regionBelow();;){for(;r.dirty;)t=r,r=r.regionBelow();if(!t.dirty&&(r=t,null===(t=t.regionAbove())||!t.dirty))return;t.dirty=!1;var n=t.eUp,i=r.eUp;if(n.dst()!==i.dst()&&q.sweep.checkForLeftSplice_(e,t)&&(r.fixUpperEdge?(q.sweep.deleteRegion_(e,r),q.mesh.deleteEdge(i),i=(r=t.regionBelow()).eUp):t.fixUpperEdge&&(q.sweep.deleteRegion_(e,t),q.mesh.deleteEdge(n),n=(t=r.regionAbove()).eUp)),n.org!==i.org)if(n.dst()===i.dst()||t.fixUpperEdge||r.fixUpperEdge||n.dst()!==e.event&&i.dst()!==e.event)q.sweep.checkForRightSplice_(e,t);else if(q.sweep.checkForIntersect_(e,t))return;n.org===i.org&&n.dst()===i.dst()&&(q.sweep.addWinding_(i,n),q.sweep.deleteRegion_(e,t),q.mesh.deleteEdge(n),t=r.regionAbove())}},q.sweep.connectRightVertex_=function(e,t,r){var n,i=r.oNext,a=t.regionBelow(),s=t.eUp,o=a.eUp,l=!1;(s.dst()!==o.dst()&&q.sweep.checkForIntersect_(e,t),q.geom.vertEq(s.org,e.event)&&(q.mesh.meshSplice(i.oPrev(),s),i=(t=q.sweep.topLeftRegion_(t)).regionBelow().eUp,q.sweep.finishLeftRegions_(e,t.regionBelow(),a),l=!0),q.geom.vertEq(o.org,e.event)&&(q.mesh.meshSplice(r,o.oPrev()),r=q.sweep.finishLeftRegions_(e,a,null),l=!0),l)?q.sweep.addRightEdges_(e,t,r.oNext,i,i,!0):(n=q.geom.vertLeq(o.org,s.org)?o.oPrev():s,n=q.mesh.connect(r.lPrev(),n),q.sweep.addRightEdges_(e,t,n,n.oNext,n.oNext,!1),n.sym.activeRegion.fixUpperEdge=!0,q.sweep.walkDirtyRegions_(e,t))},q.sweep.connectLeftDegenerate_=function(e,t,r){var n=t.eUp;if(q.geom.vertEq(n.org,r))q.sweep.TOLERANCE_NONZERO_&&q.sweep.spliceMergeVertices_(e,n,r.anEdge);else{if(!q.geom.vertEq(n.dst(),r))return q.mesh.splitEdge(n.sym),t.fixUpperEdge&&(q.mesh.deleteEdge(n.oNext),t.fixUpperEdge=!1),q.mesh.meshSplice(r.anEdge,n),void q.sweep.sweepEvent_(e,r);if(q.sweep.TOLERANCE_NONZERO_){var i=(t=q.sweep.topRightRegion_(t)).regionBelow(),a=i.eUp.sym,s=a.oNext,o=s;i.fixUpperEdge&&(q.sweep.deleteRegion_(e,i),q.mesh.deleteEdge(a),a=s.oPrev()),q.mesh.meshSplice(r.anEdge,a),q.geom.edgeGoesLeft(s)||(s=null),q.sweep.addRightEdges_(e,t,a.oNext,o,s,!0)}}},q.sweep.connectLeftVertex_=function(e,t){var r=new q.ActiveRegion;r.eUp=t.anEdge.sym;var n=e.dict.search(r).getKey(),i=n.regionBelow(),a=n.eUp,s=i.eUp;if(0!==q.geom.edgeSign(a.dst(),t,a.org)){var o,l=q.geom.vertLeq(s.dst(),a.dst())?n:i;if(n.inside||l.fixUpperEdge){if(l===n)o=q.mesh.connect(t.anEdge.sym,a.lNext);else o=q.mesh.connect(s.dNext(),t.anEdge).sym;l.fixUpperEdge?q.sweep.fixUpperEdge_(l,o):q.sweep.computeWinding_(e,q.sweep.addRegionBelow_(e,n,o)),q.sweep.sweepEvent_(e,t)}else q.sweep.addRightEdges_(e,n,t.anEdge,t.anEdge,null,!0)}else q.sweep.connectLeftDegenerate_(e,n,t)},q.sweep.sweepEvent_=function(e,t){e.event=t;for(var r=t.anEdge;null===r.activeRegion;)if((r=r.oNext)===t.anEdge)return void q.sweep.connectLeftVertex_(e,t);var n=q.sweep.topLeftRegion_(r.activeRegion),i=n.regionBelow(),a=i.eUp,s=q.sweep.finishLeftRegions_(e,i,null);s.oNext===a?q.sweep.connectRightVertex_(e,n,s):q.sweep.addRightEdges_(e,n,s.oNext,a,a,!0)},q.sweep.addSentinel_=function(e,t){var r=new q.ActiveRegion,n=q.mesh.makeEdge(e.mesh);n.org.s=q.sweep.SENTINEL_COORD_,n.org.t=t,n.dst().s=-q.sweep.SENTINEL_COORD_,n.dst().t=t,e.event=n.dst(),r.eUp=n,r.windingNumber=0,r.inside=!1,r.fixUpperEdge=!1,r.sentinel=!0,r.dirty=!1,r.nodeUp=e.dict.insert(r)},q.sweep.initEdgeDict_=function(e){e.dict=new q.Dict(e,q.sweep.edgeLeq_),q.sweep.addSentinel_(e,-q.sweep.SENTINEL_COORD_),q.sweep.addSentinel_(e,q.sweep.SENTINEL_COORD_)},q.sweep.doneEdgeDict_=function(e){for(var t;null!==(t=e.dict.getMin().getKey());)t.sentinel,q.sweep.deleteRegion_(e,t);e.dict=null},q.sweep.removeDegenerateEdges_=function(e){for(var t,r=e.mesh.eHead,n=r.next;n!==r;n=t){t=n.next;var i=n.lNext;q.geom.vertEq(n.org,n.dst())&&n.lNext.lNext!==n&&(q.sweep.spliceMergeVertices_(e,i,n),q.mesh.deleteEdge(n),i=(n=i).lNext),i.lNext===n&&(i!==n&&(i!==t&&i!==t.sym||(t=t.next),q.mesh.deleteEdge(i)),n!==t&&n!==t.sym||(t=t.next),q.mesh.deleteEdge(n))}},q.sweep.initPriorityQ_=function(e){var t=new q.PriorityQ(q.geom.vertLeq);e.pq=t;var r,n=e.mesh.vHead;for(r=n.next;r!==n;r=r.next)r.pqHandle=t.insert(r);t.init()},q.sweep.donePriorityQ_=function(e){e.pq.deleteQ(),e.pq=null},q.sweep.removeDegenerateFaces_=function(e){for(var t,r=e.fHead.next;r!==e.fHead;r=t){t=r.next;var n=r.anEdge;n.lNext.lNext===n&&(q.sweep.addWinding_(n.oNext,n),q.mesh.deleteEdge(n))}},q.tessmono={},q.tessmono.tessellateMonoRegion_=function(e){for(var t=e.anEdge;q.geom.vertLeq(t.dst(),t.org);t=t.lPrev());for(;q.geom.vertLeq(t.org,t.dst());t=t.lNext);for(var r,n=t.lPrev();t.lNext!==n;)if(q.geom.vertLeq(t.dst(),n.org)){for(;n.lNext!==t&&(q.geom.edgeGoesLeft(n.lNext)||q.geom.edgeSign(n.org,n.dst(),n.lNext.dst())<=0);)n=(r=q.mesh.connect(n.lNext,n)).sym;n=n.lPrev()}else{for(;n.lNext!==t&&(q.geom.edgeGoesRight(t.lPrev())||q.geom.edgeSign(t.dst(),t.org,t.lPrev().org)>=0);)r=q.mesh.connect(t,t.lPrev()),t=r.sym;t=t.lNext}for(;n.lNext.lNext!==t;)n=(r=q.mesh.connect(n.lNext,n)).sym},q.tessmono.tessellateInterior=function(e){for(var t,r=e.fHead.next;r!==e.fHead;r=t)t=r.next,r.inside&&q.tessmono.tessellateMonoRegion_(r)},q.tessmono.discardExterior=function(e){for(var t,r=e.fHead.next;r!==e.fHead;r=t)t=r.next,r.inside||q.mesh.zapFace(r)},q.tessmono.setWindingNumber=function(e,t,r){for(var n,i=e.eHead.next;i!==e.eHead;i=n)n=i.next,i.rFace().inside!==i.lFace.inside?i.winding=i.lFace.inside?t:-t:r?q.mesh.deleteEdge(i):i.winding=0},q.Dict=function(e,t){this.head_=new q.DictNode,this.frame_=e,this.leq_=t},q.Dict.prototype.deleteDict_=function(){},q.Dict.prototype.insertBefore=function(e,t){do{e=e.prev}while(null!==e.key&&!this.leq_(this.frame_,e.key,t));var r=new q.DictNode(t,e.next,e);return e.next.prev=r,e.next=r,r},q.Dict.prototype.insert=function(e){return this.insertBefore(this.head_,e)},q.Dict.prototype.deleteNode=function(e){e.next.prev=e.prev,e.prev.next=e.next},q.Dict.prototype.search=function(e){var t=this.head_;do{t=t.next}while(null!==t.key&&!this.leq_(this.frame_,e,t.key));return t},q.Dict.prototype.getMin=function(){return this.head_.next},q.Dict.prototype.getMax=function(){return this.head_.prev},q.DictNode=function(e,t,r){this.key=e||null,this.next=t||this,this.prev=r||this},q.DictNode.prototype.getKey=function(){return this.key},q.DictNode.prototype.getSuccessor=function(){return this.next},q.DictNode.prototype.getPredecessor=function(){return this.prev},q.CachedVertex=function(){this.coords=[0,0,0],this.data=null},q.GluTesselator=function(){this.state=q.GluTesselator.tessState_.T_DORMANT,this.lastEdge_=null,this.mesh=null,this.callError_=null,this.normal=[0,0,0],this.sUnit=[0,0,0],this.tUnit=[0,0,0],this.relTolerance=q.GLU_TESS_DEFAULT_TOLERANCE,this.windingRule=q.windingRule.GLU_TESS_WINDING_ODD,this.fatalError=!1,this.dict=null,this.pq=null,this.event=null,this.callCombine_=null,this.boundaryOnly=!1,this.callBegin_=null,this.callEdgeFlag_=null,this.callVertex_=null,this.callEnd_=null,this.callMesh_=null,this.callBeginData_=null,this.callEdgeFlagData_=null,this.callVertexData_=null,this.callEndData_=null,this.callErrorData_=null,this.callCombineData_=null,this.polygonData_=null,this.emptyCache=!1,this.cacheCount=0,this.cache=new Array(q.TESS_MAX_CACHE);for(var e=0;e<q.TESS_MAX_CACHE;e++)this.cache[e]=new q.CachedVertex},q.GluTesselator.tessState_={T_DORMANT:0,T_IN_POLYGON:1,T_IN_CONTOUR:2},q.GluTesselator.prototype.gluDeleteTess=function(){this.requireState_(q.GluTesselator.tessState_.T_DORMANT)},q.GluTesselator.prototype.gluTessProperty=function(e,t){switch(e){case q.gluEnum.GLU_TESS_TOLERANCE:if(t<0||t>1)break;return void(this.relTolerance=t);case q.gluEnum.GLU_TESS_WINDING_RULE:var r=t;switch(r){case q.windingRule.GLU_TESS_WINDING_ODD:case q.windingRule.GLU_TESS_WINDING_NONZERO:case q.windingRule.GLU_TESS_WINDING_POSITIVE:case q.windingRule.GLU_TESS_WINDING_NEGATIVE:case q.windingRule.GLU_TESS_WINDING_ABS_GEQ_TWO:return void(this.windingRule=r)}break;case q.gluEnum.GLU_TESS_BOUNDARY_ONLY:return void(this.boundaryOnly=!!t);default:return void this.callErrorOrErrorData(q.gluEnum.GLU_INVALID_ENUM)}this.callErrorOrErrorData(q.gluEnum.GLU_INVALID_VALUE)},q.GluTesselator.prototype.gluGetTessProperty=function(e){switch(e){case q.gluEnum.GLU_TESS_TOLERANCE:return this.relTolerance;case q.gluEnum.GLU_TESS_WINDING_RULE:return this.windingRule;case q.gluEnum.GLU_TESS_BOUNDARY_ONLY:return this.boundaryOnly;default:this.callErrorOrErrorData(q.gluEnum.GLU_INVALID_ENUM)}return!1},q.GluTesselator.prototype.gluTessNormal=function(e,t,r){this.normal[0]=e,this.normal[1]=t,this.normal[2]=r},q.GluTesselator.prototype.gluTessCallback=function(e,t){var r=t||null;switch(e){case q.gluEnum.GLU_TESS_BEGIN:return void(this.callBegin_=r);case q.gluEnum.GLU_TESS_BEGIN_DATA:return void(this.callBeginData_=r);case q.gluEnum.GLU_TESS_EDGE_FLAG:return void(this.callEdgeFlag_=r);case q.gluEnum.GLU_TESS_EDGE_FLAG_DATA:return void(this.callEdgeFlagData_=r);case q.gluEnum.GLU_TESS_VERTEX:return void(this.callVertex_=r);case q.gluEnum.GLU_TESS_VERTEX_DATA:return void(this.callVertexData_=r);case q.gluEnum.GLU_TESS_END:return void(this.callEnd_=r);case q.gluEnum.GLU_TESS_END_DATA:return void(this.callEndData_=r);case q.gluEnum.GLU_TESS_ERROR:return void(this.callError_=r);case q.gluEnum.GLU_TESS_ERROR_DATA:return void(this.callErrorData_=r);case q.gluEnum.GLU_TESS_COMBINE:return void(this.callCombine_=r);case q.gluEnum.GLU_TESS_COMBINE_DATA:return void(this.callCombineData_=r);case q.gluEnum.GLU_TESS_MESH:return void(this.callMesh_=r);default:return void this.callErrorOrErrorData(q.gluEnum.GLU_INVALID_ENUM)}},q.GluTesselator.prototype.gluTessVertex=function(e,t){var r=!1,n=[0,0,0];this.requireState_(q.GluTesselator.tessState_.T_IN_CONTOUR),this.emptyCache&&(this.emptyCache_(),this.lastEdge_=null);for(var i=0;i<3;++i){var a=e[i];a<-q.GLU_TESS_MAX_COORD&&(a=-q.GLU_TESS_MAX_COORD,r=!0),a>q.GLU_TESS_MAX_COORD&&(a=q.GLU_TESS_MAX_COORD,r=!0),n[i]=a}if(r&&this.callErrorOrErrorData(q.errorType.GLU_TESS_COORD_TOO_LARGE),null===this.mesh){if(this.cacheCount<q.TESS_MAX_CACHE)return void this.cacheVertex_(n,t);this.emptyCache_()}this.addVertex_(n,t)},q.GluTesselator.prototype.gluTessBeginPolygon=function(e){this.requireState_(q.GluTesselator.tessState_.T_DORMANT),this.state=q.GluTesselator.tessState_.T_IN_POLYGON,this.cacheCount=0,this.emptyCache=!1,this.mesh=null,this.polygonData_=e},q.GluTesselator.prototype.gluTessBeginContour=function(){this.requireState_(q.GluTesselator.tessState_.T_IN_POLYGON),this.state=q.GluTesselator.tessState_.T_IN_CONTOUR,this.lastEdge_=null,this.cacheCount>0&&(this.emptyCache=!0)},q.GluTesselator.prototype.gluTessEndContour=function(){this.requireState_(q.GluTesselator.tessState_.T_IN_CONTOUR),this.state=q.GluTesselator.tessState_.T_IN_POLYGON},q.GluTesselator.prototype.gluTessEndPolygon=function(){if(this.requireState_(q.GluTesselator.tessState_.T_IN_POLYGON),this.state=q.GluTesselator.tessState_.T_DORMANT,null===this.mesh&&this.emptyCache_(),q.normal.projectPolygon(this),q.sweep.computeInterior(this),!this.fatalError){var e=this.mesh;if(this.boundaryOnly?q.tessmono.setWindingNumber(e,1,!0):q.tessmono.tessellateInterior(e),this.mesh.checkMesh(),this.callBegin_||this.callEnd_||this.callVertex_||this.callEdgeFlag_||this.callBeginData_||this.callEndData_||this.callVertexData_||this.callEdgeFlagData_)if(this.boundaryOnly)q.render.renderBoundary(this,this.mesh);else{var t=!(!this.callEdgeFlag_&&!this.callEdgeFlagData_);q.render.renderMesh(this,this.mesh,t)}if(this.callMesh_)return q.tessmono.discardExterior(this.mesh),this.callMesh_(this.mesh),this.mesh=null,void(this.polygonData_=null)}q.mesh.deleteMesh(this.mesh),this.polygonData_=null,this.mesh=null},q.GluTesselator.prototype.makeDormant_=function(){this.mesh&&q.mesh.deleteMesh(this.mesh),this.state=q.GluTesselator.tessState_.T_DORMANT,this.lastEdge_=null,this.mesh=null},q.GluTesselator.prototype.requireState_=function(e){this.state!==e&&this.gotoState_(e)},q.GluTesselator.prototype.gotoState_=function(e){for(;this.state!==e;)if(this.state<e)switch(this.state){case q.GluTesselator.tessState_.T_DORMANT:this.callErrorOrErrorData(q.errorType.GLU_TESS_MISSING_BEGIN_POLYGON),this.gluTessBeginPolygon(null);break;case q.GluTesselator.tessState_.T_IN_POLYGON:this.callErrorOrErrorData(q.errorType.GLU_TESS_MISSING_BEGIN_CONTOUR),this.gluTessBeginContour()}else switch(this.state){case q.GluTesselator.tessState_.T_IN_CONTOUR:this.callErrorOrErrorData(q.errorType.GLU_TESS_MISSING_END_CONTOUR),this.gluTessEndContour();break;case q.GluTesselator.tessState_.T_IN_POLYGON:this.callErrorOrErrorData(q.errorType.GLU_TESS_MISSING_END_POLYGON),this.makeDormant_()}},q.GluTesselator.prototype.addVertex_=function(e,t){var r=this.lastEdge_;null===r?(r=q.mesh.makeEdge(this.mesh),q.mesh.meshSplice(r,r.sym)):(q.mesh.splitEdge(r),r=r.lNext),r.org.data=t,r.org.coords[0]=e[0],r.org.coords[1]=e[1],r.org.coords[2]=e[2],r.winding=1,r.sym.winding=-1,this.lastEdge_=r},q.GluTesselator.prototype.cacheVertex_=function(e,t){var r=this.cache[this.cacheCount];r.data=t,r.coords[0]=e[0],r.coords[1]=e[1],r.coords[2]=e[2],++this.cacheCount},q.GluTesselator.prototype.emptyCache_=function(){this.mesh=new q.GluMesh;for(var e=0;e<this.cacheCount;e++){var t=this.cache[e];this.addVertex_(t.coords,t.data)}this.cacheCount=0,this.emptyCache=!1},q.GluTesselator.prototype.callBeginOrBeginData=function(e){this.callBeginData_?this.callBeginData_(e,this.polygonData_):this.callBegin_&&this.callBegin_(e)},q.GluTesselator.prototype.callVertexOrVertexData=function(e){this.callVertexData_?this.callVertexData_(e,this.polygonData_):this.callVertex_&&this.callVertex_(e)},q.GluTesselator.prototype.callEdgeFlagOrEdgeFlagData=function(e){this.callEdgeFlagData_?this.callEdgeFlagData_(e,this.polygonData_):this.callEdgeFlag_&&this.callEdgeFlag_(e)},q.GluTesselator.prototype.callEndOrEndData=function(){this.callEndData_?this.callEndData_(this.polygonData_):this.callEnd_&&this.callEnd_()},q.GluTesselator.prototype.callCombineOrCombineData=function(e,t,r){var n;return this.callCombineData_?n=this.callCombineData_(e,t,r,this.polygonData_):this.callCombine_&&(n=this.callCombine_(e,t,r)),void 0===n&&(n=null),n},q.GluTesselator.prototype.callErrorOrErrorData=function(e){this.callErrorData_?this.callErrorData_(e,this.polygonData_):this.callError_&&this.callError_(e)},q.GluFace=function(e,t){this.next=e||this,this.prev=t||this,this.anEdge=null,this.data=null,this.inside=!1},q.GluHalfEdge=function(e){this.next=e||this,this.sym=null,this.oNext=null,this.lNext=null,this.org=null,this.lFace=null,this.activeRegion=null,this.winding=0},q.GluHalfEdge.prototype.rFace=function(){return this.sym.lFace},q.GluHalfEdge.prototype.dst=function(){return this.sym.org},q.GluHalfEdge.prototype.oPrev=function(){return this.sym.lNext},q.GluHalfEdge.prototype.lPrev=function(){return this.oNext.sym},q.GluHalfEdge.prototype.dPrev=function(){return this.lNext.sym},q.GluHalfEdge.prototype.rPrev=function(){return this.sym.oNext},q.GluHalfEdge.prototype.dNext=function(){return this.rPrev().sym},q.GluHalfEdge.prototype.rNext=function(){return this.oPrev().sym},q.GluMesh=function(){this.vHead=new q.GluVertex,this.fHead=new q.GluFace,this.eHead=new q.GluHalfEdge,this.eHeadSym=new q.GluHalfEdge,this.eHead.sym=this.eHeadSym,this.eHeadSym.sym=this.eHead},q.GluMesh.prototype.checkMesh=function(){if(q.DEBUG){var e,t,r,n=this.fHead,i=this.vHead,a=this.eHead,s=n;for(s=n;(t=s.next)!==n;s=t){e=t.anEdge;do{e=e.lNext}while(e!==t.anEdge)}var o=i;for(o=i;(r=o.next)!==i;o=r){e=r.anEdge;do{e=e.oNext}while(e!==r.anEdge)}var l=a;for(l=a;(e=l.next)!==a;l=e);}},q.GluVertex=function(e,t){this.next=e||this,this.prev=t||this,this.anEdge=null,this.data=null,this.coords=[0,0,0],this.s=0,this.t=0,this.pqHandle=null},q.PQHandleElem=function(){this.key=null,this.node=0},q.PQHandleElem.realloc=function(e,t){var r=new Array(t),n=0;if(null!==e)for(;n<e.length;n++)r[n]=e[n];for(;n<t;n++)r[n]=new q.PQHandleElem;return r},q.PQNode=function(){this.handle=0},q.PQNode.realloc=function(e,t){var r=new Array(t),n=0;if(null!==e)for(;n<e.length;n++)r[n]=e[n];for(;n<t;n++)r[n]=new q.PQNode;return r},q.PriorityQ=function(e){this.keys_=q.PriorityQ.prototype.PQKeyRealloc_(null,q.PriorityQ.INIT_SIZE_),this.order_=null,this.size_=0,this.max_=q.PriorityQ.INIT_SIZE_,this.initialized_=!1,this.leq_=e,this.heap_=new q.PriorityQHeap(this.leq_)},q.PriorityQ.INIT_SIZE_=32,q.PriorityQ.prototype.deleteQ=function(){this.heap_.deleteHeap(),this.heap_=null,this.order_=null,this.keys_=null},q.PriorityQ.prototype.init=function(){this.order_=[];for(var e=0;e<this.size_;e++)this.order_[e]=e;var t,r,n=(t=this.keys_,r=this.leq_,function(e,n){return r(t[e],t[n])?1:-1});if(this.order_.sort(n),this.max_=this.size_,this.initialized_=!0,this.heap_.init(),q.DEBUG){var i=0+this.size_-1;for(e=0;e<i;++e);}},q.PriorityQ.prototype.insert=function(e){if(this.initialized_)return this.heap_.insert(e);var t=this.size_;return++this.size_>=this.max_&&(this.max_*=2,this.keys_=q.PriorityQ.prototype.PQKeyRealloc_(this.keys_,this.max_)),this.keys_[t]=e,-(t+1)},q.PriorityQ.prototype.PQKeyRealloc_=function(e,t){var r=new Array(t),n=0;if(null!==e)for(;n<e.length;n++)r[n]=e[n];for(;n<t;n++)r[n]=null;return r},q.PriorityQ.prototype.keyLessThan_=function(e,t){var r=this.keys_[e],n=this.keys_[t];return!this.leq_(n,r)},q.PriorityQ.prototype.keyGreaterThan_=function(e,t){var r=this.keys_[e],n=this.keys_[t];return!this.leq_(r,n)},q.PriorityQ.prototype.extractMin=function(){if(0===this.size_)return this.heap_.extractMin();var e=this.keys_[this.order_[this.size_-1]];if(!this.heap_.isEmpty()){var t=this.heap_.minimum();if(this.leq_(t,e))return this.heap_.extractMin()}do{--this.size_}while(this.size_>0&&null===this.keys_[this.order_[this.size_-1]]);return e},q.PriorityQ.prototype.minimum=function(){if(0===this.size_)return this.heap_.minimum();var e=this.keys_[this.order_[this.size_-1]];if(!this.heap_.isEmpty()){var t=this.heap_.minimum();if(this.leq_(t,e))return t}return e},q.PriorityQ.prototype.isEmpty_=function(){return 0===this.size_&&this.heap_.isEmpty()},q.PriorityQ.prototype.remove=function(e){if(e>=0)this.heap_.remove(e);else for(e=-(e+1),this.keys_[e]=null;this.size_>0&&null===this.keys_[this.order_[this.size_-1]];)--this.size_},q.PriorityQHeap=function(e){this.nodes_=q.PQNode.realloc(null,q.PriorityQHeap.INIT_SIZE_+1),this.handles_=q.PQHandleElem.realloc(null,q.PriorityQHeap.INIT_SIZE_+1),this.size_=0,this.max_=q.PriorityQHeap.INIT_SIZE_,this.freeList_=0,this.initialized_=!1,this.leq_=e,this.nodes_[1].handle=1},q.PriorityQHeap.INIT_SIZE_=32,q.PriorityQHeap.prototype.deleteHeap=function(){this.handles_=null,this.nodes_=null},q.PriorityQHeap.prototype.init=function(){for(var e=this.size_;e>=1;--e)this.floatDown_(e);this.initialized_=!0},q.PriorityQHeap.prototype.insert=function(e){var t,r=++this.size_;return 2*r>this.max_&&(this.max_*=2,this.nodes_=q.PQNode.realloc(this.nodes_,this.max_+1),this.handles_=q.PQHandleElem.realloc(this.handles_,this.max_+1)),0===this.freeList_?t=r:(t=this.freeList_,this.freeList_=this.handles_[t].node),this.nodes_[r].handle=t,this.handles_[t].node=r,this.handles_[t].key=e,this.initialized_&&this.floatUp_(r),t},q.PriorityQHeap.prototype.isEmpty=function(){return 0===this.size_},q.PriorityQHeap.prototype.minimum=function(){return this.handles_[this.nodes_[1].handle].key},q.PriorityQHeap.prototype.extractMin=function(){var e=this.nodes_,t=this.handles_,r=e[1].handle,n=t[r].key;return this.size_>0&&(e[1].handle=e[this.size_].handle,t[e[1].handle].node=1,t[r].key=null,t[r].node=this.freeList_,this.freeList_=r,--this.size_>0&&this.floatDown_(1)),n},q.PriorityQHeap.prototype.remove=function(e){var t=this.nodes_,r=this.handles_,n=r[e].node;t[n].handle=t[this.size_].handle,r[t[n].handle].node=n,n<=--this.size_&&(n<=1||this.leq_(r[t[n>>1].handle].key,r[t[n].handle].key)?this.floatDown_(n):this.floatUp_(n)),r[e].key=null,r[e].node=this.freeList_,this.freeList_=e},q.PriorityQHeap.prototype.floatDown_=function(e){for(var t=this.nodes_,r=this.handles_,n=t[e].handle;;){var i=e<<1;i<this.size_&&this.leq_(r[t[i+1].handle].key,r[t[i].handle].key)&&++i;var a=t[i].handle;if(i>this.size_||this.leq_(r[n].key,r[a].key)){t[e].handle=n,r[n].node=e;break}t[e].handle=a,r[a].node=e,e=i}},q.PriorityQHeap.prototype.floatUp_=function(e){for(var t=this.nodes_,r=this.handles_,n=t[e].handle;;){var i=e>>1,a=t[i].handle;if(0===i||this.leq_(r[a].key,r[n].key)){t[e].handle=n,r[n].node=e;break}t[e].handle=a,r[a].node=e,e=i}},q.ActiveRegion=function(){this.eUp=null,this.nodeUp=null,this.windingNumber=0,this.inside=!1,this.sentinel=!1,this.dirty=!1,this.fixUpperEdge=!1},q.ActiveRegion.prototype.regionBelow=function(){return this.nodeUp.getPredecessor().getKey()},q.ActiveRegion.prototype.regionAbove=function(){return this.nodeUp.getSuccessor().getKey()};var K=q;const{GpuProgram:Y}=E.a;class Q extends Y{constructor(e){super(e,"attribute vec3 a_position;\nuniform vec2 u_resolution;\nvoid main() {\n   vec2 zeroToOne = a_position.xy / u_resolution;\n   vec2 zeroToTwo = zeroToOne * 2.0;\n   vec2 clipSpace = zeroToTwo - 1.0;\n   gl_Position = vec4(clipSpace, 0, 1);\n}","precision mediump float;\nuniform vec4 color;\nvoid main() {\n   gl_FragColor = color;\n}",["a_position"]),this.resolutionLocation=this.uniformLocation(e,"u_resolution"),this.colorLocation=this.uniformLocation(e,"color"),this.localCache={resolution:{width:null,height:null},color:{r:null,g:null,b:null,a:null}}}loadResolution(e,t,r){this.localCache.resolution.width===t&&this.localCache.resolution.height===r||(e.uniform2f(this.resolutionLocation,t,r),this.localCache.resolution.width=t,this.localCache.resolution.height=r)}loadColor(e,t){const r=this.localCache.color;if(r.r===t.red&&r.g===t.green&&r.b===t.blue&&r.a===t.alpha)return;const n=t.alpha;e.uniform4f(this.colorLocation,t.red*n,t.green*n,t.blue*n,t.alpha),r.r=t.red,r.g=t.green,r.b=t.blue,r.a=t.alpha}}Q.key="WorldWindGpuScreenColorProgram";const{GpuProgram:X}=E.a;class Z extends X{constructor(e){super(e,"attribute vec3 a_position;\nattribute vec2 vertexTexCoord;\nuniform vec2 u_resolution;\nvarying vec2 texCoord;\nvoid main() {\n   vec2 zeroToOne = a_position.xy / u_resolution;\n   vec2 zeroToTwo = zeroToOne * 2.0;\n   vec2 clipSpace = zeroToTwo - 1.0;\n   gl_Position = vec4(clipSpace, 0, 1);\n   gl_PointSize = 3.0;\n   texCoord = vertexTexCoord;\n}","precision mediump float;\nuniform sampler2D textureSampler;\nvarying vec2 texCoord;\nvoid main() {\n   gl_FragColor = texture2D(textureSampler, texCoord);\n}",["a_position","vertexTexCoord"]),this.resolutionLocation=this.uniformLocation(e,"u_resolution"),this.texUnitLocation=this.uniformLocation(e,"textureSampler"),this.localCache={resolution:{width:null,height:null},textureUnit:null}}loadResolution(e,t,r){this.localCache.resolution.width===t&&this.localCache.resolution.height===r||(e.uniform2f(this.resolutionLocation,t,r),this.localCache.resolution.width=t,this.localCache.resolution.height=r)}loadTextureUnit(e,t){this.localCache.textureUnit!==t&&(e.uniform1i(this.texUnitLocation,t-e.TEXTURE0),this.localCache.textureUnit=t)}}Z.key="WorldWindGpuScreenTextureProgram";const{Angle:$,SurfaceShape:J,PickedObject:ee,Texture:te,Location:re}=E.a,ne=6378137;class ie extends J{static tesselator(){return ie.tess||(ie.tess=new K.GluTesselator),ie.tess}static nextId(){return ie._nextId||(ie._nextId=0),ie._nextId++}static staticStateKey(e){return e.stateKeyInvalid=!1,e.highlighted&&e._highlightAttributes?e._attributesStateKey=e._highlightAttributes.stateKey:e._attributes?e._attributesStateKey=e._attributes.stateKey:e._attributesStateKey=null,"dn "+e.displayName+" id "+e._id+" at "+(e._attributesStateKey?e._attributesStateKey:"null")+" hi "+e.highlighted+" en "+e.enabled+" pt "+e.pathType+" ne "+e.maximumNumEdgeIntervals+" po "+e.polarThrottle+" img "+!!e.image+" se ["+e.sector.minLatitude+","+e.sector.maxLatitude+","+e.sector.minLongitude+","+e.sector.maxLongitude+"]"}constructor(e){super(e),this._image=null,this._imageUUID="",this._interiorVboCacheKey="",this._outlineVboCacheKey="",this._contoursPrepered=!1,this._contoursInfo=[],this._id=ie.nextId()}get image(){return this._image}set image(e){this._image=e,this.stateKeyInvalid=!0}get imageUUID(){return this._imageUUID}set imageUUID(e){this._imageUUID=e}renderToTexture(e,t,r,n,i,a){const s=this._highlighted&&this._highlightAttributes||this._attributes,o=!this._isInteriorInhibited&&s.drawInterior,l=s.drawOutline&&s.outlineWidth>0;if(!o&&!l)return;e.pickingMode&&!this.pickColor&&(this.pickColor=e.uniquePickColor());var c;const u=this.mapGeometry(this._interiorGeometry,r,n,i,a);for(c=0;c<u.length;c++){if(!this._contoursPrepered){var d=this.windingOrder_all(u[c]);this._contoursInfo.push({wo:d})}var h=u[c];h[0]===h[h.length-2]&&h[1]===h[h.length-1]&&(h.pop(),h.pop())}if(!this._image||e.pickingMode||this.crossesAntiMeridian||this.containsPole)this.renderColor(e,{tileWidth:256,tileHeight:256,xScale:r,yScale:n,dx:i,dy:a,drawInterior:o,interiorColor:s.interiorColor,drawOutline:l,outlineColor:s.outlineColor}),this._contoursPrepered=!0;else{if(!this._contoursPrepered&&1===u.length){const{anglesMap:e,topLeftIndex:t}=this.getCorners(u[0],this._contoursInfo[0].wo),r=this.computeUvs(this._contoursInfo[0].wo,e,t,this._interiorGeometry[0]);this._contoursInfo[0].anglesMap=e,this._contoursInfo[0].topLeftIndex=t,this._contoursInfo[0].uvs=r;var g=this.tessellate_p1(u[0],r),p=[];for(c=0;c<g.length;c+=5)for(var m=g[c],f=g[c+1],_=0;_<u[0].length;_+=2){var b=u[0][_],E=u[0][_+1];if(b===m&&E===f){p.push(_/2);break}}this._contoursInfo[0].iboData=new Uint16Array(p);var S=5*Math.floor(u[0].length/2);this._contoursInfo[0].vboData=new Float32Array(S);var y=this._contoursInfo[0].vboData,v=0;for(c=0;c<y.length;c+=5)y[c]=u[v],y[c+1]=u[v+1],y[c+2]=0,y[c+3]=r[v],y[c+4]=r[v+1],v+=2;this._contoursPrepered=!0}this.renderTexture(e,{points:u[0],tileWidth:256,tileHeight:256,xScale:r,yScale:n,dx:i,dy:a})}if(e.pickingMode){var x=new ee(this.pickColor.clone(),this.pickDelegate?this.pickDelegate:this,null,this.layer,!1);e.resolvePick(x)}}renderColor(e,t){let{tileWidth:r,tileHeight:n,xScale:i,yScale:a,dx:s,dy:o,drawInterior:l,interiorColor:c,drawOutline:u,outlineColor:d}=t;if(this.tessGeom||(this.tessGeom=this.tessellate(this._interiorGeometry),this.tessTris=new Float32Array(this.tessGeom.length)),!this.wo){const e=this.mapGeometry(this._interiorGeometry,i,a,s,o);this.wo=this.windingOrder_all(e[0])}const h=e.currentGlContext,g=e.findAndBindProgram(Q);if(g.loadResolution(h,r,n),h.enableVertexAttribArray(0),l){g.loadColor(h,e.pickingMode?this.pickColor:c);for(var p=0;p<this.tessGeom.length;p+=3){var m=this.tessGeom[p],f=this.tessGeom[p+1];this.tessTris[p]=m*$.RADIANS_TO_DEGREES*i+s,this.tessTris[p+1]=f*$.RADIANS_TO_DEGREES*a+o,this.tessTris[p+2]=0}this.bindInteriorVbo(e,this.tessTris,null),h.vertexAttribPointer(0,3,h.FLOAT,!1,0,0),"CW"===this.wo&&h.frontFace(h.CW),h.drawArrays(h.TRIANGLES,0,Math.floor(this.tessTris.length/3)),"CW"===this.wo&&h.frontFace(h.CCW)}}renderTexture(e,t){let{points:r,tileWidth:n,tileHeight:i,xScale:a,yScale:s,dx:o,dy:l,anglesMap:c,topLeftIndex:u}=t;for(var d=this._contoursInfo[0].vboData,h=0,g=0;g<d.length;g+=5)d[g]=r[h],d[g+1]=r[h+1],h+=2;const p=e.currentGlContext,m=e.findAndBindProgram(Z);m.loadResolution(p,n,i),p.enableVertexAttribArray(0),p.enableVertexAttribArray(1),m.loadTextureUnit(p,p.TEXTURE0);const f=this._imageUUID||this._image.src;f||console.error("TexturedSurfaceShape, no uuid for image. Use shape.imageUUID to set a unique id");let _=e.gpuResourceCache.resourceForKey(f);_||(_=new te(p,this._image,null,!0),e.gpuResourceCache.putResource(f,_,_.size)),_.bind(e),this.bindInteriorVbo(e,d,null),this.bindInteriorIbo(e,this._contoursInfo[0].iboData,null);p.vertexAttribPointer(0,3,p.FLOAT,!1,20,0),p.vertexAttribPointer(1,2,p.FLOAT,!1,20,12),"CW"===this._contoursInfo[0].wo&&p.frontFace(p.CW),p.drawElements(p.TRIANGLES,this._contoursInfo[0].iboData.length,p.UNSIGNED_SHORT,0),"CW"===this._contoursInfo[0].wo&&p.frontFace(p.CCW),p.disableVertexAttribArray(1)}computeUvs(e,t,r,n){const i=n.slice();i.pop();for(var a=new Float32Array(2*i.length),s="",o=r;o<i.length+r;o++){var l=o%i.length,c={s:-1,t:-1};if(t[l]){s=this.nextSide(s,e);for(var u=i[l],d=null,h=o+1;h<i.length+r;h++){var g=h%i.length;if(null!=t[g]){d=i[g];break}}d||(d=i[r]);var p=re.greatCircleDistance(u,d)*ne}var m=re.greatCircleDistance(u,i[l])*ne;"CW"===e?"top"===s?(c.s=m/p,c.t=0):"right"===s?(c.s=1,c.t=m/p):"bottom"===s?(c.s=1-m/p,c.t=1):"left"===s&&(c.s=0,c.t=1-m/p):"left"===s?(c.s=0,c.t=m/p):"bottom"===s?(c.s=m/p,c.t=1):"right"===s?(c.s=1,c.t=1-m/p):"top"===s&&(c.s=1-m/p,c.t=0),a[2*l]=c.s,a[2*l+1]=c.t}return a}nextSide(e,t){var r="";return"CW"===t?(r="top","top"===e?r="right":"right"===e?r="bottom":"bottom"===e?r="left":"left"===e&&(r="top")):(r="left","left"===e?r="bottom":"bottom"===e?r="right":"right"===e?r="top":"top"===e&&(r="left")),r}mapGeometry(e,t,r,n,i){return e.map((e=>e.reduce(((e,a)=>{const s=a.longitude*t+n,o=a.latitude*r+i;return e.push(s,o),e}),[])))}bindInteriorVbo(e,t,r){r=r||e.currentGlContext.STATIC_DRAW,this._interiorVboCacheKey||(this._interiorVboCacheKey=e.gpuResourceCache.generateCacheKey()),this.bindVbo(e,t,r,this._interiorVboCacheKey)}bindOutlineVbo(e,t,r){r=r||e.currentGlContext.STATIC_DRAW,this._outlineVboCacheKey||(this._outlineVboCacheKey=e.gpuResourceCache.generateCacheKey()),this.bindVbo(e,t,r,this._outlineVboCacheKey)}bindVbo(e,t,r,n){const i=e.currentGlContext;let a=e.gpuResourceCache.resourceForKey(n);const s=e.gpuResourceCache.entries.entries[n];let o=0;s&&(o=s.size),!a||o<t.length*t.BYTES_PER_ELEMENT?(a=i.createBuffer(),i.bindBuffer(i.ARRAY_BUFFER,a),i.bufferData(i.ARRAY_BUFFER,t,r),e.gpuResourceCache.putResource(n,a,t.length*t.BYTES_PER_ELEMENT)):(i.bindBuffer(i.ARRAY_BUFFER,a),i.bufferSubData(i.ARRAY_BUFFER,0,t))}bindInteriorIbo(e,t,r){r=r||e.currentGlContext.STATIC_DRAW,this._interiorIboCacheKey||(this._interiorIboCacheKey=e.gpuResourceCache.generateCacheKey()),this.bindIbo(e,t,r,this._interiorIboCacheKey)}bindIbo(e,t,r,n){const i=e.currentGlContext;let a=e.gpuResourceCache.resourceForKey(n);const s=e.gpuResourceCache.entries.entries[n];let o=0;s&&(o=s.size),!a||o<t.length*t.BYTES_PER_ELEMENT?(a=i.createBuffer(),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,a),i.bufferData(i.ELEMENT_ARRAY_BUFFER,t,r),e.gpuResourceCache.putResource(n,a,t.length*t.BYTES_PER_ELEMENT)):i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,a)}tessellate_p(e,t){var r=ie.tesselator(),n=[];r.gluTessCallback(K.gluEnum.GLU_TESS_BEGIN,(function(e){e!==K.primitiveType.GL_TRIANGLES&&console.error("Tessellation error, primitive is not TRIANGLES.")})),r.gluTessCallback(K.gluEnum.GLU_TESS_COMBINE,(function(e,r,n){var i=[e[0],e[1],e[2]];if(t&&t.length)for(var a=3;a<=4;a++){for(var s=0,o=0;o<4;o++)n[o]>0&&(s+=n[o]*r[o][a]);i[a]=s}return i})),r.gluTessCallback(K.gluEnum.GLU_TESS_EDGE_FLAG,(function(){})),r.gluTessCallback(K.gluEnum.GLU_TESS_VERTEX_DATA,(function(e,r){r.push(e[0]),r.push(e[1]),r.push(e[2]),t&&t.length&&(r.push(e[3]),r.push(e[4]))})),r.gluTessCallback(K.gluEnum.GLU_TESS_ERROR,(function(e){console.error("tess err",e)})),r.gluTessBeginPolygon(n),r.gluTessBeginContour();for(var i=0,a=0;a<e.length;a++){var s=[e[a].x,e[a].y,0];t&&t.length&&(s.push(t[i],t[i+1]),i+=2),r.gluTessVertex(s,s)}return r.gluTessEndContour(),r.gluTessEndPolygon(),n}tessellate_p1(e,t){var r=ie.tesselator(),n=[];r.gluTessCallback(K.gluEnum.GLU_TESS_BEGIN,(function(e){e!==K.primitiveType.GL_TRIANGLES&&console.error("Tessellation error, primitive is not TRIANGLES.")})),r.gluTessCallback(K.gluEnum.GLU_TESS_COMBINE,(function(e,r,n){var i=[e[0],e[1],e[2]];if(t&&t.length)for(var a=3;a<=4;a++){for(var s=0,o=0;o<4;o++)n[o]>0&&(s+=n[o]*r[o][a]);i[a]=s}return i})),r.gluTessCallback(K.gluEnum.GLU_TESS_EDGE_FLAG,(function(){})),r.gluTessCallback(K.gluEnum.GLU_TESS_VERTEX_DATA,(function(e,r){r.push(e[0]),r.push(e[1]),r.push(e[2]),t&&t.length&&(r.push(e[3]),r.push(e[4]))})),r.gluTessCallback(K.gluEnum.GLU_TESS_ERROR,(function(e){console.error("tess err",e)})),r.gluTessBeginPolygon(n),r.gluTessBeginContour();for(var i=0,a=0;a<e.length;a+=2){var s=[e[a],e[a+1],0];t&&t.length&&(s.push(t[i],t[i+1]),i+=2),r.gluTessVertex(s,s)}return r.gluTessEndContour(),r.gluTessEndPolygon(),n}tessellate(e,t){var r=ie.tesselator(),n=[];r.gluTessCallback(K.gluEnum.GLU_TESS_BEGIN,(function(e){e!==K.primitiveType.GL_TRIANGLES&&console.error("Tessellation error, primitive is not TRIANGLES.")})),r.gluTessCallback(K.gluEnum.GLU_TESS_COMBINE,(function(e,r,n){var i=[e[0],e[1],e[2]];if(t&&t.length)for(var a=3;a<=4;a++){for(var s=0,o=0;o<4;o++)n[o]>0&&(s+=n[o]*r[o][a]);i[a]=s}return i})),r.gluTessCallback(K.gluEnum.GLU_TESS_EDGE_FLAG,(function(){})),r.gluTessCallback(K.gluEnum.GLU_TESS_VERTEX_DATA,(function(e,r){r.push(e[0]),r.push(e[1]),r.push(e[2]),t&&t.length&&(r.push(e[3]),r.push(e[4]))})),r.gluTessCallback(K.gluEnum.GLU_TESS_ERROR,(function(e){console.error("tess err",e)})),r.gluTessBeginPolygon(n);for(var i=0,a=0;a<e.length;a++){r.gluTessBeginContour();for(var s=e[a],o=0;o<s.length;o+=1){var l=s[o],c=[l.longitude*$.DEGREES_TO_RADIANS,l.latitude*$.DEGREES_TO_RADIANS,0];t&&t.length&&(c.push(t[i],t[i+1]),i+=2),r.gluTessVertex(c,c)}r.gluTessEndContour()}return r.gluTessEndPolygon(),n}getBbox(e){const t={minX:Number.MAX_SAFE_INTEGER,maxX:Number.MIN_SAFE_INTEGER,minY:Number.MAX_SAFE_INTEGER,maxY:Number.MIN_SAFE_INTEGER,width:0,height:0};for(var r=0;r<e.length;r++){var n=e[r];t.minX=Math.min(t.minX,n.x),t.maxX=Math.max(t.maxX,n.x),t.minY=Math.min(t.minY,n.y),t.maxY=Math.max(t.maxY,n.y)}return t.width=Math.abs(t.maxX-t.minX),t.height=Math.abs(t.maxY-t.minY),t}getCorners(e,t){e.length;for(var r=[],n=0;n<e.length;n+=2){var i,a,s,o,l,c;0===n?(i=e[e.length-2],a=e[e.length-1]):(i=e[n-2],a=e[n-1]),s=e[n],o=e[n+1],n===e.length-2?(l=e[0],c=e[1]):(l=e[n+2],c=e[n+3]);var u=Math.atan2(c-o,l-s)-Math.atan2(a-o,i-s);r.push({index:n/2,angle:Math.abs(u)*$.RADIANS_TO_DEGREES})}var d={x:e[2*(r=r.filter((e=>e.angle<170||e.angle>190)))[0].index],y:e[2*r[0].index+1],index:r[0].index},h={x:e[2*r[1].index],y:e[2*r[1].index+1],index:r[1].index},g={x:e[2*r[2].index],y:e[2*r[2].index+1],index:r[2].index},p={x:e[2*r[3].index],y:e[2*r[3].index+1],index:r[3].index};const m=this.findWhichCorners([d,h,g,p]),f=m[0].index;var _=r.reduce(((e,r)=>{var n="",i=m.findIndex((e=>e.index===r.index));return"CW"===t?0===i?n="tl":1===i?n="tr":2===i?n="br":3===i&&(n="bl"):0===i?n="tl":1===i?n="bl":2===i?n="br":3===i&&(n="tr"),e[r.index]=n,e}),Object.create(null));return{anglesMap:_,topLeftIndex:f}}findWhichCorners(e){const t=this.userProperties;if(t&&t.identifier){var r=t.identifier;if(0===r.indexOf("S3")&&-1!==r.indexOf("OL_1_ERR___")){var n=this._interiorGeometry[0],i=e.map((e=>{var t=n[e.index];return{latitude:t.latitude,longitude:t.longitude,index:e.index}}));i.sort(((e,t)=>e.latitude-t.latitude)),i.length=2;var a=i[0],s=i[1];a.longitude<0&&s.longitude>0||a.longitude>0&&s.longitude<0?i.sort(((e,t)=>Math.abs(t.longitude)-Math.abs(e.longitude))):i.sort(((e,t)=>Math.abs(e.longitude)-Math.abs(t.longitude)));var o,l=e.findIndex((e=>e.index===i[0].index));if(l>0){o=[];for(var c=l;c<e.length+l;c++)o.push(e[c%e.length])}return o||e}}return this.reindexCorners(e)}getCorners_old(e,t){if(this.isEqualPoints(e[0],e[e.length-1])&&e.pop(),4===e.length)return this.reindexCorners(e);t=t||this.getBbox(e);for(var r=[],n=0;n<e.length-1;n++){var i=e[n];i.x===t.minX||i.x===t.maxX?r.push(i):i.y!==t.minY&&i.y!==t.maxY||r.push(i)}return r.length<4?r:this.reindexCorners(r)}reindexCorners(e){var t,r,n=e.slice();if(n.sort(((e,t)=>t.y-e.y)),n.length=2,n.sort(((e,t)=>e.x-t.x)),n[0].index,(t=e.findIndex((e=>e.index===n[0].index)))>0){r=[];for(var i=t;i<e.length+t;i++)r.push(e[i%e.length])}return r||e}reindexCorners_old(e){var t,r=-1;if(this.getSlope(e[0],e[2])>0&&(r=e[0].y<e[2].y?0:2),this.getSlope(e[1],e[3])>0&&(e[1].y<e[3].y?(-1!==r&&console.error("slope method is not ok 1"),r=1):(-1!==r&&console.error("slope method is not ok 2"),r=3)),-1===r&&console.error("slope method could not determine topLeft"),r>0){t=[];for(var n=r;n<e.length+r;n++)t.push(e[n%e.length])}return t||e}isEqualPoints(e,t){return e.x===t.x&&e.y===t.y}windingOrder(e){return(e[1].x-e[0].x)*(e[1].y+e[0].y)+(e[2].x-e[1].x)*(e[2].y+e[1].y)+(e[3].x-e[2].x)*(e[3].y+e[2].y)+(e[0].x-e[3].x)*(e[0].y+e[3].y)<0?"CCW":"CW"}windingOrder_all(e){let t=0;for(let r=0;r<e.length-2;r+=2){let n=(r+2)%e.length,i=r%e.length,a=e[n],s=e[n+1];t+=(a-e[i])*(s+e[i+1])}return t<0?"CCW":"CW"}getSlope(e,t){return(e.y-t.y)/(e.x-t.x)}distance2D(e,t){var r=t.x-e.x,n=t.y-e.y;return Math.sqrt(r*r+n*n)}}class ae extends ie{static staticStateKey(e){return ie.staticStateKey(e)}constructor(e,t){if(super(t),!Array.isArray(e))throw new Error("TexturedSurfacePolygon - constructor - The specified boundary is not an array.");this._boundaries=this.removeDuplicateLocations(e)}get boundaries(){return this._boundaries}set boundaries(e){if(!Array.isArray(e))throw new Error("TexturedSurfacePolygon - set boundaries - The specified boundary is not an array.");this._boundaries=this.removeDuplicateLocations(e),this.isPrepared=!1,this.stateKeyInvalid=!0}removeDuplicateLocations(e){if(Array.isArray(e[0])){const n=[];for(var t=0;t<e.length;t++){var r=this.removeDuplicateLocationsFromContour(e[t]);n.push(r)}return n}return this.removeDuplicateLocationsFromContour(e)}removeDuplicateLocationsFromContour(e){const t=[];for(var r=0;r<e.length;r++){var n=e[r];t.push(n);for(var i=r+1;i<e.length;i++){var a=e[i];if(n.latitude!==a.latitude||n.longitude!==a.longitude)break;r++}}return t}computeStateKey(){return ae.staticStateKey(this)}}const{ArgumentError:se,GeoJSONConstants:oe,GeoJSONParser:le,Location:ce,Logger:ue,RenderableLayer:de,SurfacePolyline:he}=E.a;le.prototype.addRenderablesForPolygon=function(e,t,r){if(!e)throw new se(ue.logMessage(ue.LEVEL_SEVERE,"GeoJSON","addRenderablesForPolygon","missingLayer"));if(!t)throw new se(ue.logMessage(ue.LEVEL_SEVERE,"GeoJSON","addRenderablesForPolygon","missingGeometry"));var n=this.shapeConfigurationCallback(t,r);if(!this.crs||this.crs.isCRSSupported()){for(var i,a=[],s=0,o=t.coordinates;s<o.length;s++){for(var l=[],c=0,u=o[s];c<u.length;c++){var d=u[c][0],h=u[c][1],g=this.getReprojectedIfRequired(h,d,this.crs),p=new ce(g[1],g[0]);l.push(p)}a.push(l)}i=new ae(a,n&&n.attributes?n.attributes:null),n.highlightAttributes&&(i.highlightAttributes=n.highlightAttributes),n&&n.name&&(i.displayName=n.name),n&&n.pickDelegate&&(i.pickDelegate=n.pickDelegate),n&&n.userProperties&&(i.userProperties=n.userProperties),n&&n.timeRange&&(i.timeRange=n.timeRange),i.highlighted=!0,i.enabled=!0,e.addRenderable(i)}},le.prototype.load=function(e,t,r){e&&(this._parserCompletionCallback=e),t&&(this._shapeConfigurationCallback=t),this._layer=r||new de;var n=typeof this.dataSource;if("string"===n){var i=le.tryParseJSONString(this.dataSource);null!==i?this.handle(i):this.requestUrl(this.dataSource)}else"object"===n?this.handle(this.dataSource):ue.logMessage(ue.LEVEL_SEVERE,"GeoJSON","load","Unsupported data source type: "+n)},le.prototype.addRenderablesForMultiPolygon=function(e,t,r){if(!e)throw new se(ue.logMessage(ue.LEVEL_SEVERE,"GeoJSON","addRenderablesForMultiPolygon","missingLayer"));if(!t)throw new se(ue.logMessage(ue.LEVEL_SEVERE,"GeoJSON","addRenderablesForMultiPolygon","missingGeometry"));var n=this.shapeConfigurationCallback(t,r);if(!this.crs||this.crs.isCRSSupported())for(var i=0,a=t.coordinates;i<a.length;i++){for(var s,o=[],l=0;l<a[i].length;l++){for(var c=[],u=0,d=a[i][l];u<d.length;u++){var h=d[u][0],g=d[u][1],p=this.getReprojectedIfRequired(g,h,this.crs),m=new ce(p[1],p[0]);c.push(m)}o.push(c)}s=new ae(o,n&&n.attributes?n.attributes:null),n.highlightAttributes&&(s.highlightAttributes=n.highlightAttributes),n&&n.name&&(s.displayName=n.name),n&&n.pickDelegate&&(s.pickDelegate=n.pickDelegate),n&&n.userProperties&&(s.userProperties=n.userProperties),n&&n.timeRange&&(s.timeRange=n.timeRange),e.addRenderable(s)}},le.prototype.addRenderablesForLineString=function(e,t,r){if(!e)throw new se(ue.logMessage(ue.LEVEL_SEVERE,"GeoJSON","addRenderablesForLineString","missingLayer"));if(!t)throw new se(ue.logMessage(ue.LEVEL_SEVERE,"GeoJSON","addRenderablesForLineString","missingGeometry"));var n=this.shapeConfigurationCallback(t,r);if(!this.crs||this.crs.isCRSSupported()){for(var i,a=[],s=0,o=t.coordinates;s<o.length;s++){var l=o[s][0],c=o[s][1],u=this.getReprojectedIfRequired(c,l,this.crs),d=new ce(u[1],u[0]);a.push(d)}console.log("polyline!!"),i=new he(a,n&&n.attributes?n.attributes:null),console.log("polyline2!!"),n.highlightAttributes&&(i.highlightAttributes=n.highlightAttributes),n&&n.pickDelegate&&(i.pickDelegate=n.pickDelegate),n&&n.userProperties&&(i.userProperties=n.userProperties),console.log(i),e.addRenderable(i)}};const{ArcBallCamera:ge,ArgumentError:pe,BasicWorldWindowController:me,DrawContext:fe,EarthElevationModel:_e,FrameStatistics:be,Frustum:Ee,Globe:Se,Globe2D:ye,GoToAnimator:ve,GpuResourceCache:xe,Line:we,Logger:Te,LookAtNavigator:Re,Matrix:Ce,Navigator:Oe,PickedObjectList:De,Position:Le,Rectangle:Ae,Sector:Ne,SurfaceShape:Pe,SurfaceShapeTileBuilder:Ie,Terrain:Me,Vec2:ke,Vec3:je,WWMath:Fe}=E.a;var Ue=class{constructor(e,t,r,n){if(console.log("constructing worlwindow"),!window.WebGLRenderingContext)throw new pe(Te.logMessage(Te.LEVEL_SEVERE,"WorldWindow","constructor","webglNotSupported"));var i;if(e instanceof HTMLCanvasElement)i=e;else if(!(i=document.getElementById(e)))throw new pe(Te.logMessage(Te.LEVEL_SEVERE,"WorldWindow","constructor","The specified canvas ID is not in the document."));var a=this.createContext(i);if(!a)throw new pe(Te.logMessage(Te.LEVEL_SEVERE,"WorldWindow","constructor","webglNotSupported"));function s(e){e.preventDefault()}this.drawContext=new fe(a),this.eventListeners={},this.redrawRequested=!0,this.redrawRequestId=null,this.scratchModelview=Ce.fromIdentity(),this.scratchProjection=Ce.fromIdentity(),this.hasStencilBuffer=a.getContextAttributes().stencil,this.canvas=i,this.depthBits=a.getParameter(a.DEPTH_BITS),this.viewport=new Ae(0,0,a.drawingBufferWidth,a.drawingBufferHeight),this.globe=new Se(t||new _e),this.layers=[],this.navigator=new Oe(n&&new n(this)||new ge(this)),this.verticalExaggeration=1,this.deepPicking=!1,this.subsurfaceMode=!1,this.surfaceOpacity=1,this.frameStatistics=new be,this.goToAnimator=new ve(this),this._redrawCallbacks=[],this._orderedRenderingFilters=[function(e){o.declutter(e,1)},function(e){o.declutter(e,2)}],this.pixelScale=1,this.addEventListener("mousedown",s),this.addEventListener("touchstart",s),this.addEventListener("contextmenu",s),this.addEventListener("wheel",s);var o=this;function l(e){o.handleRedrawEvent(e)}this.canvas.addEventListener("webglcontextlost",(function(e){o.handleContextLost(e)}),!1),this.canvas.addEventListener("webglcontextrestored",(function(e){o.handleContextRestored(e)}),!1),this.canvas.addEventListener(E.a.REDRAW_EVENT_TYPE,l,!1),window.addEventListener(E.a.REDRAW_EVENT_TYPE,l,!1),this.animationFrameLoop()}orderedRenderingFilters(){return this._orderedRenderingFilters}redrawCallbacks(){return this._redrawCallbacks}canvasCoordinates(e,t){var r=this.canvas.getBoundingClientRect(),n=e-(r.left+this.canvas.clientLeft),i=t-(r.top+this.canvas.clientTop);return new ke(n,i)}addEventListener(e,t){if(!e)throw new pe(Te.logMessage(Te.LEVEL_SEVERE,"WorldWindow","addEventListener","missingType"));if(!t)throw new pe(Te.logMessage(Te.LEVEL_SEVERE,"WorldWindow","addEventListener","missingListener"));var r=this,n=this.eventListeners[e];n||(n={listeners:[],callback:function(e){e.worldWindow=r;for(var t=0,i=n.listeners.length;t<i;t++)n.listeners[t](e)}},this.eventListeners[e]=n),-1==n.listeners.indexOf(t)&&(n.listeners.splice(0,0,t),1==n.listeners.length&&this.canvas.addEventListener(e,n.callback,!1))}removeEventListener(e,t){if(!e)throw new pe(Te.logMessage(Te.LEVEL_SEVERE,"WorldWindow","removeEventListener","missingType"));if(!t)throw new pe(Te.logMessage(Te.LEVEL_SEVERE,"WorldWindow","removeEventListener","missingListener"));var r=this.eventListeners[e];if(r){var n=r.listeners.indexOf(t);-1!=n&&(r.listeners.splice(n,1),0==r.listeners.length&&this.canvas.removeEventListener(e,r.callback,!1))}}redraw(){this.redrawRequested=!0}pick(e){if(!e)throw new pe(Te.logMessage(Te.LEVEL_SEVERE,"WorldWindow","pick","missingPoint"));return this.drawContext.currentGlContext.isContextLost()?new De:(this.resize(),this.resetDrawContext(),this.drawContext.pickingMode=!0,this.drawContext.pickPoint=e,this.drawContext.pickRay=this.rayThroughScreenPoint(e),this.drawFrame(),this.drawContext.objectsAtPickPoint)}pickTerrain(e){if(!e)throw new pe(Te.logMessage(Te.LEVEL_SEVERE,"WorldWindow","pickTerrain","missingPoint"));return this.drawContext.currentGlContext.isContextLost()?new De:(this.resize(),this.resetDrawContext(),this.drawContext.pickingMode=!0,this.drawContext.pickTerrainOnly=!0,this.drawContext.pickPoint=e,this.drawContext.pickRay=this.rayThroughScreenPoint(e),this.drawFrame(),this.drawContext.objectsAtPickPoint)}pickShapesInRegion(e){if(!e)throw new pe(Te.logMessage(Te.LEVEL_SEVERE,"WorldWindow","pickShapesInRegion","missingRectangle"));return this.drawContext.currentGlContext.isContextLost()?new De:(this.resize(),this.resetDrawContext(),this.drawContext.pickingMode=!0,this.drawContext.regionPicking=!0,this.drawContext.pickRectangle=new Ae(e.x,this.canvas.height-e.y,e.width,e.height),this.drawFrame(),this.drawContext.objectsAtPickPoint)}createContext(e){var t={antialias:!1,stencil:!0},r=e.getContext("webgl",t);return r||(r=e.getContext("experimental-webgl",t)),r}handleContextLost(e){Te.log(Te.LEVEL_INFO,"WebGL context event: "+e.statusMessage),e.preventDefault(),this.drawContext.contextLost(),window.cancelAnimationFrame(this.redrawRequestId)}handleContextRestored(e){Te.log(Te.LEVEL_INFO,"WebGL context event: "+e.statusMessage),this.drawContext.contextRestored(),this.redraw(),this.animationFrameLoop()}handleRedrawEvent(e){this.redraw()}animationFrameLoop(){this.redrawIfNeeded();var e=this;this.redrawRequestId=window.requestAnimationFrame((function(){e.animationFrameLoop()}))}redrawIfNeeded(){if(this.resize(),this.redrawRequested)try{this.redrawRequested=!1,this.drawContext.previousRedrawTimestamp=this.drawContext.timestamp,this.callRedrawCallbacks(E.a.BEFORE_REDRAW),this.resetDrawContext(),this.drawFrame()}catch(e){Te.logMessage(Te.LEVEL_SEVERE,"WorldWindow","redrawIfNeeded","Exception occurred during redrawing.\n"+e.toString())}finally{this.callRedrawCallbacks(E.a.AFTER_REDRAW),this.drawContext.redrawRequested&&(this.redrawRequested=!0)}}resize(){var e=this.drawContext.currentGlContext,t=e.canvas.clientWidth*this.pixelScale,r=e.canvas.clientHeight*this.pixelScale;e.canvas.width==t&&e.canvas.height==r||(e.canvas.width=t,e.canvas.height=r,e.viewport(0,0,e.drawingBufferWidth,e.drawingBufferHeight),this.viewport=new Ae(0,0,e.drawingBufferWidth,e.drawingBufferHeight),this.redrawRequested=!0)}computeViewingTransform(e,t){if(!t)throw new pe(Te.logMessage(Te.LEVEL_SEVERE,"WorldWindow","computeViewingTransform","missingModelview"));var r=this.globe;if(this.navigator.camera.createViewMatrix(t),e){e.setToIdentity();var n=Fe.max(r.equatorialRadius,r.polarRadius),i=t.extractEyePoint(new je(0,0,0)),a=r.computePositionFromPoint(i[0],i[1],i[2],new Le(0,0,0)),s=Fe.horizonDistanceForGlobeRadius(n,a.altitude),o=Fe.horizonDistanceForGlobeRadius(n,16e4),l=this.viewport,c=s+o;c<1e3&&(c=1e3);var u=Fe.perspectiveNearDistanceForFarDistance(c,10,this.depthBits),d=a.altitude-r.elevationAtLocation(a.latitude,a.longitude);if(d>0){var h=Fe.perspectiveNearDistance(l.width,l.height,d);u>h&&(u=h)}u<1&&(u=1),e.setToPerspectiveProjection(l.width,l.height,u,c)}}computePixelMetrics(e){var t=Ce.fromIdentity();t.invertMatrix(e);var r=new je(-1,-1,-1),n=new je(1,1,-1),i=new je(-1,-1,1),a=new je(1,1,1);r.multiplyByMatrix(t),n.multiplyByMatrix(t),i.multiplyByMatrix(t),a.multiplyByMatrix(t);var s=Fe.fabs(n[0]-r[0]),o=Fe.fabs(a[0]-i[0]),l=-r[2],c=(o-s)/(-i[2]-l),u=s-c*l;return{pixelSizeFactor:c/this.viewport.width,pixelSizeOffset:u/this.viewport.height}}pixelSizeAtDistance(e){this.computeViewingTransform(this.scratchProjection,this.scratchModelview);var t=this.computePixelMetrics(this.scratchProjection);return t.pixelSizeFactor*e+t.pixelSizeOffset}computeDrawContext(){var e=this.drawContext;this.computeViewingTransform(e.projection,e.modelview),e.viewport=this.viewport,e.eyePoint=e.modelview.extractEyePoint(new je(0,0,0)),e.modelviewProjection.setToIdentity(),e.modelviewProjection.setToMultiply(e.projection,e.modelview);var t=this.computePixelMetrics(e.projection);e.pixelSizeFactor=t.pixelSizeFactor,e.pixelSizeOffset=t.pixelSizeOffset;var r=Ce.fromIdentity();r.invertOrthonormalMatrix(e.modelview),e.modelviewNormalTransform=Ce.fromIdentity().setToTransposeOfMatrix(r.upper3By3());var n=Ce.fromIdentity();n.setToTransposeOfMatrix(e.modelview),e.frustumInModelCoordinates=Ee.fromProjectionMatrix(e.projection),e.frustumInModelCoordinates.transformByMatrix(n),e.frustumInModelCoordinates.normalize()}resetDrawContext(){this.globe.offset=0;var e=this.drawContext;e.reset(),e.globe=this.globe,e.navigator=this.navigator,e.layers=this.layers.slice(),e.layers.push(e.screenCreditController),this.computeDrawContext(),e.verticalExaggeration=this.verticalExaggeration,e.surfaceOpacity=this.surfaceOpacity,e.deepPicking=this.deepPicking,e.frameStatistics=this.frameStatistics,e.pixelScale=this.pixelScale,e.update()}drawFrame(){try{this.drawContext.frameStatistics.beginFrame(),this.beginFrame(),this.drawContext.globe.is2D()&&this.drawContext.globe.continuous?this.do2DContiguousRepaint():this.doNormalRepaint()}finally{this.endFrame(),this.drawContext.frameStatistics.endFrame()}}doNormalRepaint(){this.createTerrain(),this.clearFrame(),this.deferOrderedRendering=!1,this.drawContext.pickingMode?this.drawContext.makePickFrustum()&&(this.doPick(),this.resolvePick()):(this.doDraw(),this.subsurfaceMode&&this.hasStencilBuffer&&(this.redrawSurface(),this.drawScreenRenderables()))}do2DContiguousRepaint(){this.createTerrain2DContiguous(),this.clearFrame(),this.drawContext.pickingMode?this.drawContext.makePickFrustum()&&(this.pick2DContiguous(),this.resolvePick()):this.draw2DContiguous()}resolvePick(){this.drawContext.pickTerrainOnly?this.resolveTerrainPick():this.drawContext.regionPicking?this.resolveRegionPick():this.resolveTopPick()}beginFrame(){var e=this.drawContext.currentGlContext;e.enable(e.BLEND),e.enable(e.CULL_FACE),e.enable(e.DEPTH_TEST),e.blendFunc(e.ONE,e.ONE_MINUS_SRC_ALPHA),e.depthFunc(e.LEQUAL),this.drawContext.pickingMode&&(this.drawContext.makePickFramebuffer(),this.drawContext.bindFramebuffer(this.drawContext.pickFramebuffer))}endFrame(){var e=this.drawContext.currentGlContext;e.disable(e.BLEND),e.disable(e.CULL_FACE),e.disable(e.DEPTH_TEST),e.blendFunc(e.ONE,e.ZERO),e.depthFunc(e.LESS),e.clearColor(0,0,0,1),this.drawContext.bindFramebuffer(null),this.drawContext.bindProgram(null)}clearFrame(){var e=this.drawContext,t=e.currentGlContext;t.clearColor(e.clearColor.red,e.clearColor.green,e.clearColor.blue,e.clearColor.alpha),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)}doDraw(){this.drawContext.renderShapes=!0,this.subsurfaceMode&&this.hasStencilBuffer?(this.drawContext.currentGlContext.disable(this.drawContext.currentGlContext.STENCIL_TEST),this.drawContext.surfaceShapeTileBuilder.clear(),this.drawLayers(!0),this.drawSurfaceRenderables(),this.drawContext.surfaceShapeTileBuilder.doRender(this.drawContext),this.deferOrderedRendering||(this.drawContext.currentGlContext.clear(this.drawContext.currentGlContext.DEPTH_BUFFER_BIT|this.drawContext.currentGlContext.STENCIL_BUFFER_BIT),this.drawContext.currentGlContext.enable(this.drawContext.currentGlContext.STENCIL_TEST),this.drawContext.currentGlContext.stencilFunc(this.drawContext.currentGlContext.ALWAYS,1,1),this.drawContext.currentGlContext.stencilOp(this.drawContext.currentGlContext.REPLACE,this.drawContext.currentGlContext.REPLACE,this.drawContext.currentGlContext.REPLACE),this.drawOrderedRenderables())):(this.drawContext.surfaceShapeTileBuilder.clear(),this.drawLayers(!0),this.drawSurfaceRenderables(),this.drawContext.surfaceShapeTileBuilder.doRender(this.drawContext),this.deferOrderedRendering||(this.drawOrderedRenderables(),this.drawScreenRenderables()))}redrawSurface(){this.drawContext.currentGlContext.enable(this.drawContext.currentGlContext.STENCIL_TEST),this.drawContext.currentGlContext.stencilFunc(this.drawContext.currentGlContext.EQUAL,1,1),this.drawContext.currentGlContext.stencilOp(this.drawContext.currentGlContext.KEEP,this.drawContext.currentGlContext.KEEP,this.drawContext.currentGlContext.KEEP),this.drawContext.surfaceShapeTileBuilder.clear(),this.drawLayers(!1),this.drawSurfaceRenderables(),this.drawContext.surfaceShapeTileBuilder.doRender(this.drawContext),this.drawContext.currentGlContext.disable(this.drawContext.currentGlContext.STENCIL_TEST)}doPick(){this.drawContext.terrain&&this.drawContext.terrain.pick(this.drawContext),this.drawContext.pickTerrainOnly||(this.subsurfaceMode&&this.hasStencilBuffer?(this.drawContext.currentGlContext.disable(this.drawContext.currentGlContext.STENCIL_TEST),this.drawContext.surfaceShapeTileBuilder.clear(),this.drawLayers(!0),this.drawSurfaceRenderables(),this.drawContext.surfaceShapeTileBuilder.doRender(this.drawContext),this.deferOrderedRendering||(this.drawContext.currentGlContext.clear(this.drawContext.currentGlContext.DEPTH_BUFFER_BIT|this.drawContext.currentGlContext.STENCIL_BUFFER_BIT),this.drawContext.currentGlContext.enable(this.drawContext.currentGlContext.STENCIL_TEST),this.drawContext.currentGlContext.stencilFunc(this.drawContext.currentGlContext.ALWAYS,1,1),this.drawContext.currentGlContext.stencilOp(this.drawContext.currentGlContext.REPLACE,this.drawContext.currentGlContext.REPLACE,this.drawContext.currentGlContext.REPLACE),this.drawOrderedRenderables(),this.drawContext.terrain.pick(this.drawContext),this.drawScreenRenderables())):(this.drawContext.surfaceShapeTileBuilder.clear(),this.drawLayers(!0),this.drawSurfaceRenderables(),this.drawContext.surfaceShapeTileBuilder.doRender(this.drawContext),this.deferOrderedRendering||(this.drawOrderedRenderables(),this.drawScreenRenderables())))}createTerrain(){var e=this.drawContext;e.terrain=this.globe.tessellator.tessellate(e),e.frameStatistics.setTerrainTileCount(e.terrain?e.terrain.surfaceGeometry.length:0)}makeCurrent(e){var t=this.drawContext;switch(t.globe.offset=e,t.globeStateKey=t.globe.stateKey,e){case-1:t.terrain=this.terrainLeft;break;case 0:t.terrain=this.terrainCenter;break;case 1:t.terrain=this.terrainRight}}createTerrain2DContiguous(){var e=this.drawContext;this.terrainCenter=null,e.globe.offset=0,e.globeStateKey=e.globe.stateKey,e.globe.intersectsFrustum(e.frustumInModelCoordinates)&&(this.terrainCenter=e.globe.tessellator.tessellate(e)),this.terrainRight=null,e.globe.offset=1,e.globeStateKey=e.globe.stateKey,e.globe.intersectsFrustum(e.frustumInModelCoordinates)&&(this.terrainRight=e.globe.tessellator.tessellate(e)),this.terrainLeft=null,e.globe.offset=-1,e.globeStateKey=e.globe.stateKey,e.globe.intersectsFrustum(e.frustumInModelCoordinates)&&(this.terrainLeft=e.globe.tessellator.tessellate(e))}draw2DContiguous(){this.terrainCenter&&(" 0 ",this.makeCurrent(0),this.deferOrderedRendering=this.terrainLeft||this.terrainRight,this.doDraw()),this.terrainRight&&(" 1 ",this.makeCurrent(1),this.deferOrderedRendering=this.terrainLeft||this.terrainLeft,this.doDraw()),this.deferOrderedRendering=!1,this.terrainLeft&&(" -1 ",this.makeCurrent(-1),this.doDraw()),this.subsurfaceMode&&this.hasStencilBuffer&&(this.deferOrderedRendering=!0,this.terrainCenter&&(" 0 ",this.makeCurrent(0),this.redrawSurface()),this.terrainRight&&(" 1 ",this.makeCurrent(1),this.redrawSurface()),this.terrainLeft&&(" -1 ",this.makeCurrent(-1),this.redrawSurface())),this.drawScreenRenderables()}pick2DContiguous(){this.terrainCenter&&(this.makeCurrent(0),this.deferOrderedRendering=this.terrainLeft||this.terrainRight,this.doPick()),this.terrainRight&&(this.makeCurrent(1),this.deferOrderedRendering=this.terrainLeft||this.terrainLeft,this.doPick()),this.deferOrderedRendering=!1,this.terrainLeft&&(this.makeCurrent(-1),this.doPick())}drawLayers(e){var t,r=Date.now(),n=this.drawContext,i=n.layers;n.accumulateOrderedRenderables=e;for(var a=0,s=i.length;a<s;a++)if(t=i[a]){n.currentLayer=t;try{t.render(n)}catch(l){Te.log(Te.LEVEL_SEVERE,"Error while rendering layer "+t.displayName+".\n"+l.toString())}}n.currentLayer=null;var o=Date.now();n.frameStatistics.layerRenderingTime=o-r}addLayer(e){e&&this.layers.push(e)}removeLayer(e){var t=this.indexOfLayer(e);t>=0&&this.layers.splice(t,1)}insertLayer(e,t){t&&this.layers.splice(e,0,t)}indexOfLayer(e){return this.layers.indexOf(e)}drawSurfaceRenderables(){var e,t=this.drawContext;for(t.reverseSurfaceRenderables();e=t.popSurfaceRenderable();)try{e.renderSurface(t)}catch(r){Te.logMessage(Te.LEVEL_WARNING,"WorldWindow","drawSurfaceRenderables","Error while rendering a surface renderable.\n"+r.message)}}drawOrderedRenderables(){var e,t=Date.now(),r=this.drawContext;if(r.sortOrderedRenderables(),this._orderedRenderingFilters)for(var n=0;n<this._orderedRenderingFilters.length;n++)this._orderedRenderingFilters[n](this.drawContext);for(r.orderedRenderingMode=!0;e=r.popOrderedRenderable();)try{e.renderOrdered(r)}catch(i){Te.logMessage(Te.LEVEL_WARNING,"WorldWindow","drawOrderedRenderables","Error while rendering an ordered renderable.\n"+i.message)}r.orderedRenderingMode=!1,r.frameStatistics.orderedRenderingTime=Date.now()-t}drawScreenRenderables(){for(var e,t=this.drawContext;e=t.nextScreenRenderable();)try{e.renderOrdered(t)}catch(r){Te.logMessage(Te.LEVEL_WARNING,"WorldWindow","drawOrderedRenderables","Error while rendering a screen renderable.\n"+r.message)}}resolveTopPick(){if(0!=this.drawContext.objectsAtPickPoint.objects.length){var e=this.drawContext.objectsAtPickPoint,t=this.drawContext.readPickColor(this.drawContext.pickPoint),r=null,n=null;if(t){for(var i=0,a=e.objects.length;i<a;i++){var s=e.objects[i];if(s.isTerrain&&(n=s),s.color.equals(t)&&(s.isOnTop=!0,r=s,n))break}this.drawContext.deepPicking||(e.clear(),r&&e.add(r),n&&n!=r&&e.add(n))}else e.clear()}}resolveTerrainPick(){for(var e,t=this.drawContext.objectsAtPickPoint,r=0,n=t.objects.length;r<n;r++)if((e=t.objects[r]).isTerrain){e.isOnTop=!0;break}}resolveRegionPick(){if(0!=this.drawContext.objectsAtPickPoint.objects.length)for(var e,t=this.drawContext.objectsAtPickPoint,r=this.drawContext.readPickColors(this.drawContext.pickRectangle),n=0,i=t.objects.length;n<i;n++){if(e=t.objects[n])r[e.color.toByteString()]?e.isOnTop=!0:e.userObject instanceof Pe&&(t.objects.splice(n,1),n-=1)}}callRedrawCallbacks(e){for(var t=0,r=this._redrawCallbacks.length;t<r;t++)try{this._redrawCallbacks[t](this,e)}catch(n){Te.log(Te.LEVEL_SEVERE,"Exception calling redraw callback.\n"+n.toString())}}goTo(e,t){this.goToAnimator.goTo(e,t)}declutter(e,t){if(!t)throw new pe(Te.logMessage(Te.LEVEL_SEVERE,"WorldWindow","declutter","Group ID is null, undefined or 0."));for(var r=[],n=0;n<e.orderedRenderables.length;n++){var i=e.orderedRenderables[n].orderedRenderable;i.declutterGroup===t&&r.push(i)}for(var a=[],s=0;s<r.length;s++){var o=r[s],l=o.screenBounds;l&&l.intersectsRectangles(a)?o.targetVisibility=0:(o.targetVisibility=1,l&&a.push(l))}}rayThroughScreenPoint(e){if(!e)throw new pe(Te.logMessage(Te.LEVEL_SEVERE,"WorldWindow","rayThroughScreenPoint","missingPoint"));var t=new je(e[0],this.viewport.height-e[1],0),r=new je(0,0,0),n=new je(0,0,0);this.computeViewingTransform(this.scratchProjection,this.scratchModelview);var i=Ce.fromIdentity();i.setToMultiply(this.scratchProjection,this.scratchModelview);var a=Ce.fromIdentity();if(a.invertMatrix(i),!a.unProject(t,this.viewport,r))return null;if(t[2]=1,!a.unProject(t,this.viewport,n))return null;var s=this.scratchModelview.extractEyePoint(new je(0,0,0)),o=new je(s[0],s[1],s[2]),l=new je(n[0],n[1],n[2]);return l.subtract(r),l.normalize(),new we(o,l)}};const{Angle:Ge,ArgumentError:Be,Logger:Ve}=E.a;var We={getAsGeographicLocation:function(e){if(e instanceof Date===!1)throw new Be(Ve.logMessage(Ve.LEVEL_SEVERE,"SunPosition","getAsGeographicLocation","missingDate"));let t=this.getAsCelestialLocation(e);return this.celestialToGeographic(t,e)},getAsCelestialLocation:function(e){if(e instanceof Date===!1)throw new Be(Ve.logMessage(Ve.LEVEL_SEVERE,"SunPosition","getAsCelestialLocation","missingDate"));let t=this.computeJulianDate(e)-2451545,r=this.normalizeAngle360(280.46+.9856474*t),n=this.normalizeAngle360(357.528+.9856003*t)*Ge.DEGREES_TO_RADIANS,i=r+1.915*Math.sin(n)+.02*Math.sin(2*n),a=i*Ge.DEGREES_TO_RADIANS,s=(23.439-4e-7*t)*Ge.DEGREES_TO_RADIANS,o=Math.asin(Math.sin(s)*Math.sin(a))*Ge.RADIANS_TO_DEGREES,l=Math.atan(Math.cos(s)*Math.tan(a))*Ge.RADIANS_TO_DEGREES;return i>=90&&i<270&&(l+=180),l=this.normalizeAngle360(l),{declination:o,rightAscension:l}},celestialToGeographic:function(e,t){if(!e)throw new Be(Ve.logMessage(Ve.LEVEL_SEVERE,"SunPosition","celestialToGeographic","missingCelestialLocation"));if(t instanceof Date===!1)throw new Be(Ve.logMessage(Ve.LEVEL_SEVERE,"SunPosition","celestialToGeographic","missingDate"));let r=this.computeJulianDate(t)-2451545,n=this.normalizeAngle360(280.46061837+360.98564736629*r),i=this.normalizeAngle360(n-e.rightAscension),a=Ge.normalizedDegreesLongitude(-i);return{latitude:e.declination,longitude:a}},computeJulianDate:function(e){if(e instanceof Date===!1)throw new Be(Ve.logMessage(Ve.LEVEL_SEVERE,"SunPosition","computeJulianDate","missingDate"));let t=e.getUTCFullYear(),r=e.getUTCMonth()+1,n=e.getUTCDate(),i=(e.getUTCHours()+e.getUTCMinutes()/60+e.getUTCSeconds()/3600)/24;r<=2&&(t-=1,r+=12);let a=Math.trunc(t/100),s=2-a+Math.trunc(a/4);return Math.trunc(365.25*(t+4716))+Math.trunc(30.6001*(r+1))+n+s-1524.5+i},normalizeAngle360:function(e){let t=e%360;return t>=0?t:t<0?360+t:360-t}};const{Angle:ze}=E.a;var He={SUN:0,MERCURY:1,VENUS:2,MARS:4,JUPITER:5,SATURN:6,URANUS:7,NEPTUNE:8,getCelestialLocation(e,t){let r;let n=We.computeJulianDate(t)-2451543.5;switch(e){case this.SUN:r=this.computeSun(n);break;case this.MERCURY:r=this.computeMercury(n);break;case this.VENUS:r=this.computeVenus(n);break;case this.MARS:r=this.computeMars(n);break;case this.JUPITER:r=this.computeJupiter(n);break;case this.SATURN:r=this.computeSaturn(n);break;case this.URANUS:r=this.computeUranus(n);break;case this.NEPTUNE:r=this.computeNeptune(n)}return this.computePosition(n,r)},computeMercury:e=>({N:48.3313+324587e-10*e,i:7.0047+5e-8*e,w:29.1241+101444e-10*e,a:.387098,e:.205635+5.59e-10*e,M:168.6562+4.0923344368*e}),computeVenus:e=>({N:76.6799+24659e-9*e,i:3.3946+2.75e-8*e,w:54.891+138374e-10*e,a:.72333,e:.006773-1.302e-9*e,M:48.0052+1.6021302244*e}),computeMars:e=>({N:49.5574+211081e-10*e,i:1.8497-1.78e-8*e,w:286.5016+292961e-10*e,a:1.523688,e:.093405+2.516e-9*e,M:18.6021+.5240207766*e}),computeJupiter:e=>({N:100.4542+276854e-10*e,i:1.303-1.557e-7*e,w:273.8777+164505e-10*e,a:5.20256,e:.048498+4.469e-9*e,M:19.895+.0830853001*e}),computeSaturn:e=>({N:113.6634+23898e-9*e,i:2.4886-1.081e-7*e,w:339.3939+297661e-10*e,a:9.55475,e:.055546-9.499e-9*e,M:316.967+.0334442282*e}),computeUranus:e=>({N:74.0005+13978e-9*e,i:.7733+19e-9*e,w:96.6612+30565e-9*e,a:19.18171-1.55e-8*e,e:.047318+7.45e-9*e,M:142.5905+.011725806*e}),computeNeptune:e=>({N:131.7806+30173e-9*e,i:1.77-255e-9*e,w:272.8461-6027e-9*e,a:30.05826+3.313e-8*e,e:.008606+2.15e-9*e,M:260.2471+.005995147*e}),computeSun:e=>({N:0,i:0,w:282.9404+470935e-10*e,a:1,e:.016709-1.151e-9*e,M:356.047+.9856002585*e}),computePosition(e,t){let{N:r,i:n,w:i,a:a,e:s,M:o}=t;r=We.normalizeAngle360(r)*ze.DEGREES_TO_RADIANS,n=We.normalizeAngle360(n)*ze.DEGREES_TO_RADIANS,i=We.normalizeAngle360(i)*ze.DEGREES_TO_RADIANS,o=We.normalizeAngle360(o)*ze.DEGREES_TO_RADIANS;let l=o+s*Math.sin(o)*(1+s*Math.cos(o));if(s>=.06)for(var c=0;c<10;c++){var u=l-(l-s*Math.sin(l)-o)/(1-s*Math.cos(l));if(Math.abs(u-l)<.001){l=u;break}l=u}const d=a*(Math.cos(l)-s),h=a*(Math.sqrt(1-s*s)*Math.sin(l)),g=Math.atan2(h,d),p=Math.sqrt(d*d+h*h);let m=p*(Math.cos(r)*Math.cos(g+i)-Math.sin(r)*Math.sin(g+i)*Math.cos(n)),f=p*(Math.sin(r)*Math.cos(g+i)+Math.cos(r)*Math.sin(g+i)*Math.cos(n)),_=p*(Math.sin(g+i)*Math.sin(n));const b=382394e-10*(0-e)*ze.DEGREES_TO_RADIANS,E=Math.atan2(f,m)+b,S=Math.atan2(_,Math.sqrt(m*m+f*f));m=p*Math.cos(E)*Math.cos(S),f=p*Math.sin(E)*Math.cos(S),_=p*Math.sin(S);let{lonsun:y,rsun:v}=this.getLonSun(e,this.computeSun(e));y*=ze.RADIANS_TO_DEGREES,y=We.normalizeAngle360(y)*ze.DEGREES_TO_RADIANS;const x=m+v*Math.cos(y),w=f+v*Math.sin(y),T=_,R=We.normalizeAngle360(23.4393-3.563e-7*e)*ze.DEGREES_TO_RADIANS,C=x,O=w*Math.cos(R)-T*Math.sin(R),D=w*Math.sin(R)+T*Math.cos(R);return{ra:We.normalizeAngle360(Math.atan2(O,C)*ze.RADIANS_TO_DEGREES),dec:Math.atan2(D,Math.sqrt(C*C+O*O))*ze.RADIANS_TO_DEGREES}},getLonSun(e,t){let{w:r,e:n,M:i}=t;r=We.normalizeAngle360(r)*ze.DEGREES_TO_RADIANS,i=We.normalizeAngle360(i)*ze.DEGREES_TO_RADIANS;const a=i+n*Math.sin(i)*(1+n*Math.cos(i)),s=Math.cos(a)-n,o=Math.sqrt(1-n*n)*Math.sin(a);return{lonsun:Math.atan2(o,s)+r,rsun:Math.sqrt(s*s+o*o)}}};const{ArgumentError:qe,GpuProgram:Ke,Logger:Ye,Matrix:Qe,Color:Xe}=E.a;class Ze extends Ke{constructor(e){super(e,"attribute vec4 vertexPoint;\nuniform mat4 mvpMatrix;\nuniform float numDays;\nuniform vec2 magnitudeRange;\nvarying float magnitudeWeight;\nfloat normalizeAngle(float angle) {\n   float angleDivisions = angle / 360.0;\n   return 360.0 * (angleDivisions - floor(angleDivisions));\n}\nvec3 computePosition(float dec, float ra) {\n   float GMST = normalizeAngle(280.46061837 + 360.98564736629 * numDays);\n   float GHA = normalizeAngle(GMST - ra);\n   float lon = -GHA + 360.0 * step(180.0, GHA);\n   float latRad = radians(dec);\n   float lonRad = radians(lon);\n   float radCosLat = cos(latRad);\n   return vec3(radCosLat * sin(lonRad), sin(latRad), radCosLat * cos(lonRad));\n}\nfloat normalizeScalar(float value, float minValue, float maxValue){\n   return (value - minValue) / (maxValue - minValue);\n}\nvoid main() {\n   vec3 vertexPosition = computePosition(vertexPoint.x, vertexPoint.y);\n   gl_Position = mvpMatrix * vec4(vertexPosition.xyz, 1.0);\n   gl_Position.z = gl_Position.w - 0.00001;\n   gl_PointSize = vertexPoint.z;\n   magnitudeWeight = normalizeScalar(vertexPoint.w, magnitudeRange.x, magnitudeRange.y);\n}","precision mediump float;\nuniform sampler2D textureSampler;\nuniform int fragMode;\nuniform vec4 color;\nvarying float magnitudeWeight;\nconst vec4 white = vec4(1.0, 1.0, 1.0, 1.0);\nconst vec4 grey = vec4(0.5, 0.5, 0.5, 1.0);\nvoid main() {\n   if (fragMode == 1) {\n       gl_FragColor = texture2D(textureSampler, gl_PointCoord);\n   }\n   else if (fragMode == 0) {\n       gl_FragColor = mix(white, grey, magnitudeWeight);\n   }\n   else if (fragMode == 2) {\n       gl_FragColor = color;\n   }\n}",["vertexPoint"]),this.FRAG_MODE_MIX_COLOR=0,this.FRAG_MODE_TEXTURE=1,this.FRAG_MODE_COLOR=2,this.vertexPointLocation=this.attributeLocation(e,"vertexPoint"),this.mvpMatrixLocation=this.uniformLocation(e,"mvpMatrix"),this.numDaysLocation=this.uniformLocation(e,"numDays"),this.magnitudeRangeLocation=this.uniformLocation(e,"magnitudeRange"),this.textureUnitLocation=this.uniformLocation(e,"textureSampler"),this.fragModeLocation=this.uniformLocation(e,"fragMode"),this.colorLocation=this.uniformLocation(e,"color"),this.localState={mvpMatrix:null,numDays:null,magnitudeRange:null,textureUnit:null,fragMode:null,color:null}}loadModelviewProjection(e,t){if(!t)throw new qe(Ye.logMessage(Ye.LEVEL_SEVERE,"StarFieldProgram","loadModelviewProjection","missingMatrix"));let r=!1;null===this.localState.mvpMatrix&&(r=!0,this.localState.mvpMatrix=Qe.fromIdentity()),!r&&this.localState.mvpMatrix.equals(t)||(this.loadUniformMatrix(e,t,this.mvpMatrixLocation),this.localState.mvpMatrix.copy(t))}loadNumDays(e,t){if(null==t)throw new qe(Ye.logMessage(Ye.LEVEL_SEVERE,"StarFieldProgram","loadNumDays","missingNumDays"));this.localState.numDays!==t&&(e.uniform1f(this.numDaysLocation,t),this.localState.numDays=t)}loadMagnitudeRange(e,t,r){if(null==t)throw new qe(Ye.logMessage(Ye.LEVEL_SEVERE,"StarFieldProgram","loadMagRange","missingMinMag"));if(null==r)throw new qe(Ye.logMessage(Ye.LEVEL_SEVERE,"StarFieldProgram","loadMagRange","missingMaxMag"));let n=!1;null===this.localState.magnitudeRange&&(n=!0,this.localState.magnitudeRange=[t,r]),(n||this.localState.magnitudeRange[0]!==t||this.localState.magnitudeRange[1]!==r)&&(e.uniform2f(this.magnitudeRangeLocation,t,r),this.localState.magnitudeRange[0]=t,this.localState.magnitudeRange[1]=r)}loadTextureUnit(e,t){this.localState.textureUnit!==t&&(e.uniform1i(this.textureUnitLocation,t-e.TEXTURE0),this.localState.textureUnit=t)}loadFragMode(e,t){this.localState.fragMode!==t&&(e.uniform1i(this.fragModeLocation,t),this.localState.fragMode=t)}loadColor(e,t){let r=!1;null===this.localState.color&&(r=!0,this.localState.color=new Xe(0,0,0,0)),!r&&this.localState.color.equals(t)||(this.loadUniformColor(e,t,this.colorLocation),this.localState.color.copy(t))}}Ze.key="WorldWindGpuStarFieldFullProgram";var $e=Ze;const{Color:Je,Layer:et,Logger:tt,Matrix:rt,REDRAW_EVENT_TYPE:nt}=E.a;var it=class extends et{constructor(e){super("StarField"),this.pickEnabled=!1,this.sunSize=128,this.showSun=!0,this._starDataSource=e||E.a.configuration.baseUrl+"data/stars.json",this._sunImageSource=E.a.configuration.baseUrl+"images/sunTexture.png",this._matrix=rt.fromIdentity(),this._starsPositionsVboCacheKey=null,this._numStars=0,this._starData=null,this._minMagnitude=Number.MAX_VALUE,this._maxMagnitude=Number.MIN_VALUE,this._loadStarted=!1,this._minScale=3e7,this._scale=Number.MAX_SAFE_INTEGER||Math.pow(2,53)-1,this._sunPositionsCacheKey="",this._sunBufferView=new Float32Array(4),this._MAX_GL_POINT_SIZE=0,this.showPlanets=!0;const t=32;this.planets=[{id:He.MERCURY,url:"images/Mercury64.png",size:8,ra:null,dec:null},{id:He.VENUS,url:"images/Venus64.png",size:8,ra:null,dec:null},{id:He.MARS,url:"images/Mars64.png",size:8,ra:null,dec:null},{id:He.JUPITER,url:"images/Jupiter64.png",size:t,ra:null,dec:null},{id:He.SATURN,url:"images/Saturn64.png",size:t,ra:null,dec:null},{id:He.URANUS,url:"images/Uranus64.png",size:16,ra:null,dec:null},{id:He.NEPTUNE,url:"images/Neptune64.png",size:16,ra:null,dec:null}],this._planetsBufferView=null,this._cacheKeys={sunPosition:"",planetPositions:"",starPositions:""}}get starDataSource(){return this._starDataSource}set starDataSource(e){this._starDataSource=e,this.invalidateStarData()}get sunImageSource(){return this._sunImageSource}set sunImageSource(e){this._sunImageSource=e}doRender(e){if(!e.globe.is2D())if(this.haveResources(e)){this.beginRendering(e);try{this.doDraw(e)}finally{this.endRendering(e)}}else this.loadResources(e)}haveResources(e){let t=e.gpuResourceCache.resourceForKey(this._sunImageSource),r=this.planets.every((t=>!!e.gpuResourceCache.resourceForKey(t.url)));return null!=this._starData&&null!=t&&r}loadResources(e){let t=e.currentGlContext,r=e.gpuResourceCache;this._starData||this.fetchStarData(),r.resourceForKey(this._sunImageSource)||r.retrieveTexture(t,this._sunImageSource),this.planets.forEach((e=>{r.resourceForKey(e.url)||r.retrieveTexture(t,e.url)}))}beginRendering(e){let t=e.currentGlContext;e.findAndBindProgram($e),t.enableVertexAttribArray(0),t.depthMask(!1)}doDraw(e){this.loadCommonUniforms(e),this.renderStars(e),this.showSun&&this.renderSun(e),this.showPlanets&&this.renderPlanets(e)}loadCommonUniforms(e){let t=e.currentGlContext,r=e.currentProgram,n=e.modelviewProjection||e.navigatorState.modelviewProjection;this._matrix.copy(n),this._matrix.multiplyByScale(this._scale,this._scale,this._scale),r.loadModelviewProjection(t,this._matrix);let i=We.computeJulianDate(this.time||new Date);r.loadNumDays(t,i-2451545)}renderStars(e){let t=e.currentGlContext,r=e.gpuResourceCache,n=e.currentProgram;this._starsPositionsVboCacheKey||(this._starsPositionsVboCacheKey=r.generateCacheKey());let i=r.resourceForKey(this._starsPositionsVboCacheKey);if(i)t.bindBuffer(t.ARRAY_BUFFER,i);else{i=t.createBuffer();let e=this.createStarsGeometry();r.putResource(this._starsPositionsVboCacheKey,i,4*e.length),t.bindBuffer(t.ARRAY_BUFFER,i),t.bufferData(t.ARRAY_BUFFER,new Float32Array(e),t.STATIC_DRAW)}e.frameStatistics.incrementVboLoadCount(1),t.vertexAttribPointer(0,4,t.FLOAT,!1,0,0),n.loadMagnitudeRange(t,this._minMagnitude,this._maxMagnitude),n.loadFragMode(t,n.FRAG_MODE_MIX_COLOR),t.drawArrays(t.POINTS,0,this._numStars)}renderPlanets(e){let t=e.currentGlContext,r=e.currentProgram,n=e.gpuResourceCache;this._MAX_GL_POINT_SIZE||(this._MAX_GL_POINT_SIZE=t.getParameter(t.ALIASED_POINT_SIZE_RANGE)[1]),this.sunSize>this._MAX_GL_POINT_SIZE&&tt.log(tt.LEVEL_WARNING,"StarFieldLayer - sunSize is to big, max size allowed is: "+this._MAX_GL_POINT_SIZE),this.planets.forEach((e=>{const{ra:t,dec:r}=He.getCelestialLocation(e.id,this.time||new Date);e.ra=t,e.dec=r}),this),this._planetsBufferView||(this._planetsBufferView=new Float32Array(4*this.planets.length));for(let a=0;a<this.planets.length;a++){let e=this.planets[a];this._planetsBufferView[4*a+0]=e.dec,this._planetsBufferView[4*a+1]=e.ra,this._planetsBufferView[4*a+2]=Math.min(e.size,this._MAX_GL_POINT_SIZE),this._planetsBufferView[4*a+3]=1}this._planetsPositionsVboCacheKey||(this._planetsPositionsVboCacheKey=n.generateCacheKey());let i=n.resourceForKey(this._planetsPositionsVboCacheKey);i?(t.bindBuffer(t.ARRAY_BUFFER,i),t.bufferSubData(t.ARRAY_BUFFER,0,this._planetsBufferView)):(i=t.createBuffer(),n.putResource(this._planetsPositionsVboCacheKey,i,4*this._planetsBufferView.length),t.bindBuffer(t.ARRAY_BUFFER,i),t.bufferData(t.ARRAY_BUFFER,this._planetsBufferView,t.DYNAMIC_DRAW)),e.frameStatistics.incrementVboLoadCount(1),t.vertexAttribPointer(0,4,t.FLOAT,!1,0,0),r.loadFragMode(t,r.FRAG_MODE_TEXTURE);for(let a=0;a<this.planets.length;a++){let r=this.planets[a].url;e.gpuResourceCache.resourceForKey(r).bind(e),t.drawArrays(t.POINTS,a,1)}}renderSun(e){let t=e.currentGlContext,r=e.currentProgram,n=e.gpuResourceCache;this._MAX_GL_POINT_SIZE||(this._MAX_GL_POINT_SIZE=t.getParameter(t.ALIASED_POINT_SIZE_RANGE)[1]),this.sunSize>this._MAX_GL_POINT_SIZE&&tt.log(tt.LEVEL_WARNING,"StarFieldLayer - sunSize is to big, max size allowed is: "+this._MAX_GL_POINT_SIZE);let i=We.getAsCelestialLocation(this.time||new Date);this._sunBufferView[0]=i.declination,this._sunBufferView[1]=i.rightAscension,this._sunBufferView[2]=Math.min(this.sunSize,this._MAX_GL_POINT_SIZE),this._sunBufferView[3]=1,this._sunPositionsCacheKey||(this._sunPositionsCacheKey=n.generateCacheKey());let a=n.resourceForKey(this._sunPositionsCacheKey);a?(t.bindBuffer(t.ARRAY_BUFFER,a),t.bufferSubData(t.ARRAY_BUFFER,0,this._sunBufferView)):(a=t.createBuffer(),n.putResource(this._sunPositionsCacheKey,a,4*this._sunBufferView.length),t.bindBuffer(t.ARRAY_BUFFER,a),t.bufferData(t.ARRAY_BUFFER,this._sunBufferView,t.DYNAMIC_DRAW)),e.frameStatistics.incrementVboLoadCount(1),t.vertexAttribPointer(0,4,t.FLOAT,!1,0,0),r.loadFragMode(t,r.FRAG_MODE_TEXTURE),e.gpuResourceCache.resourceForKey(this._sunImageSource).bind(e),t.drawArrays(t.POINTS,0,1)}endRendering(e){let t=e.currentGlContext;t.depthMask(!0),t.disableVertexAttribArray(0)}fetchStarData(){if(this._loadStarted)return;this._loadStarted=!0;let e=this,t=new XMLHttpRequest;t.onload=function(){if(this.status>=200&&this.status<300)try{e._starData=JSON.parse(this.response),e.sendRedrawRequest()}catch(t){tt.log(tt.LEVEL_SEVERE,"StarFieldLayer unable to parse JSON for star data "+t.toString())}else tt.log(tt.LEVEL_SEVERE,"StarFieldLayer unable to fetch star data. Status: "+this.status+" "+this.statusText);e._loadStarted=!1},t.onerror=function(){tt.log(tt.LEVEL_SEVERE,"StarFieldLayer unable to fetch star data"),e._loadStarted=!1},t.ontimeout=function(){tt.log(tt.LEVEL_SEVERE,"StarFieldLayer fetch star data has timeout"),e._loadStarted=!1},t.open("GET",this._starDataSource,!0),t.send()}createStarsGeometry(){let e=this.parseStarsMetadata(this._starData.metadata);if(-1===e.raIndex)throw new Error(tt.logMessage(tt.LEVEL_SEVERE,"StarFieldLayer","createStarsGeometry","Missing ra field in star data."));if(-1===e.decIndex)throw new Error(tt.logMessage(tt.LEVEL_SEVERE,"StarFieldLayer","createStarsGeometry","Missing dec field in star data."));if(-1===e.magIndex)throw new Error(tt.logMessage(tt.LEVEL_SEVERE,"StarFieldLayer","createStarsGeometry","Missing vmag field in star data."));let t=this._starData.data,r=[];this._minMagnitude=Number.MAX_VALUE,this._maxMagnitude=Number.MIN_VALUE;for(let n=0,i=t.length;n<i;n++){let i=t[n],a=i[e.decIndex],s=i[e.raIndex],o=i[e.magIndex],l=o<2?2:1;r.push(a,s,l,o),this._minMagnitude=Math.min(this._minMagnitude,o),this._maxMagnitude=Math.max(this._maxMagnitude,o)}return this._numStars=Math.floor(r.length/4),r}parseStarsMetadata(e){let t=-1,r=-1,n=-1;for(let i=0,a=e.length;i<a;i++){let a=e[i];"ra"===a.name&&(t=i),"dec"===a.name&&(r=i),"vmag"===a.name&&(n=i)}return{raIndex:t,decIndex:r,magIndex:n}}invalidateStarData(){this._starData=null,this._starsPositionsVboCacheKey=null}sendRedrawRequest(){let e=document.createEvent("Event");e.initEvent(nt,!0,!0),window.dispatchEvent(e)}},at=r(10),st=r.n(at);const{Color:ot}=E.a,lt=[{key:"s1a",name:"SENTINEL-1A",shortName:"S-1A",satIndex:0,swathTypes:["black","red","green","white"],swathColors:[ot.colorFromKmlHex("ff000000"),ot.colorFromKmlHex("ff0000ff"),ot.colorFromKmlHex("ff00ff00"),ot.colorFromKmlHex("ffffffff")],swatModes:["IW","EW","SM"],tleLineOne:"1 39634U 14016A   23135.75055234 -.00000139  00000+0 -19716-4 0  9994",tleLineTwo:"2 39634  98.1823 143.5502 0001426  81.2075 278.9272 14.59196457485481",hasModel:!0,filePath:"./satellites/sentinel1/s1.json",rotations:{x:0,y:0,z:0,headingAxis:[0,0,1],headingAdd:-90,headingMultiply:1},preRotations:{x:0,y:0,z:0},scale:5e5,translations:{x:-.1,y:-.1,z:0},ignoreLocalTransforms:!0,launchDate:new Date("2014-04-03T21:02:00.000Z")},{key:"s2a",name:"SENTINEL-2A",shortName:"S-2A",satIndex:1,swathTypes:["red","purple","white","darkGrey","green","greener"],swathColors:[ot.colorFromKmlHex("ff0000ff"),ot.colorFromKmlHex("ffff00ff"),ot.colorFromKmlHex("ffffffff"),ot.colorFromKmlHex("ff7f7f7f"),ot.colorFromKmlHex("ff00ff00"),ot.colorFromKmlHex("ff00fff7")],swatModes:["NOBS"],tleLineOne:"1 40697U 15028A   23135.78094730 -.00000613  00000+0 -21723-3 0  9993",tleLineTwo:"2 40697  98.5701 210.7561 0001081  93.5445 266.5839 14.30810928412372",hasModel:!0,filePath:"./satellites/senti2version6/s2.json",rotations:{x:0,y:0,z:0,headingAxis:[0,0,1],headingAdd:-90,headingMultiply:1},preRotations:{x:0,y:0,z:0},scale:1e6,translations:{x:.1,y:.385,z:.02},ignoreLocalTransforms:!0,launchDate:new Date("2015-06-23T01:52:00.000Z")},{key:"s3a",name:"SENTINEL-3A",shortName:"S-3A",satIndex:2,tleLineOne:"1 41335U 16011A   23136.17745299  .00000172  00000+0  89236-4 0  9995",tleLineTwo:"2 41335  98.6226 203.6975 0001316 103.1271 257.0056 14.26742809377217",hasModel:!0,filePath:"./satellites/Sentinel3/s3.json",rotations:{x:0,y:0,z:0,headingAxis:[0,0,1],headingAdd:180,headingMultiply:1},preRotations:{x:0,y:180,z:0},scale:1e6,translations:{x:.01,y:1.98,z:.07},ignoreLocalTransforms:!0,launchDate:new Date("2016-02-16T17:57:00.000Z")},{key:"s1b",name:"SENTINEL-1B",shortName:"S-1B",satIndex:3,swathTypes:["black","red","green","white"],swathColors:[ot.colorFromKmlHex("ff000000"),ot.colorFromKmlHex("ff0000ff"),ot.colorFromKmlHex("ff00ff00"),ot.colorFromKmlHex("ffffffff")],swatModes:["IW","EW","SM"],tleLineOne:"1 41456U 16025A   22209.21862431  .00000042  00000+0  18606-4 0  9996",tleLineTwo:"2 41456  98.1829 216.0238 0001369  88.6708 271.4653 14.59198877333137",hasModel:!0,filePath:"./satellites/sentinel1/s1.json",rotations:{x:0,y:0,z:0,headingAxis:[0,0,1],headingAdd:-90,headingMultiply:1},preRotations:{x:0,y:0,z:0},scale:5e5,translations:{x:-.1,y:-.1,z:0},ignoreLocalTransforms:!0,launchDate:new Date("2016-04-25T21:02:00.000Z"),retirementDate:new Date("2022-04-01T21:55:00.000Z")},{key:"s2b",name:"SENTINEL-2B",shortName:"S-2B",satIndex:4,swathTypes:["blue"],swathColors:[ot.colorFromKmlHex("ffffff00")],swatModes:["NOBS"],tleLineOne:"1 42063U 17013A   23136.11735053 -.00000029  00000+0  54738-5 0  9990",tleLineTwo:"2 42063  98.5693 211.0962 0001350 106.3618   5.3753 14.30811798323331",groundPosition:{latitude:5.2079,longitude:-52.7724,altitude:0},hasModel:!0,filePath:"./satellites/senti2version6/s2.json",rotations:{x:0,y:0,z:0,headingAxis:[0,0,1],headingAdd:-90,headingMultiply:1},preRotations:{x:0,y:0,z:0},scale:1e6,translations:{x:.1,y:.385,z:.02},ignoreLocalTransforms:!0,launchDate:new Date("2017-03-07T01:49:00.000Z")},{key:"s5p",name:"SENTINEL-5P",shortName:"S-5P",satIndex:5,swathTypes:[],swathColors:[],tleLineOne:"1 42969U 17064A   23135.66826956  .00000093  00000+0  64630-4 0  9994",tleLineTwo:"2 42969  98.7022  76.1729 0001376  82.7461 277.3871 14.19557123289458",groundPosition:{latitude:62.92786,longitude:40.57483,altitude:0},hasModel:!0,filePath:"./satellites/sentinel5p/s5p.json",rotations:{x:0,y:0,z:0,headingAxis:[0,0,1],headingAdd:-90,headingMultiply:1},preRotations:{x:210,y:0,z:0},scale:7e4,translations:{x:.5,y:.4,z:-1.2},ignoreLocalTransforms:!0,launchDate:new Date("2017-10-13T09:27:00.000Z")},{key:"s3b",name:"SENTINEL-3B",shortName:"S-3B",satIndex:6,tleLineOne:"1 43437U 18039A   23136.15029073  .00000164  00000+0  85856-4 0  9990",tleLineTwo:"2 43437  98.6287 203.7069 0001035  82.6596 277.4702 14.26731362263279",groundPosition:{latitude:62.925556,longitude:40.577778,altitude:0},hasModel:!0,filePath:"satellites/Sentinel3/s3.json",rotations:{x:0,y:0,z:0,headingAxis:[0,0,1],headingAdd:180,headingMultiply:1},preRotations:{x:0,y:180,z:0},scale:1e6,translations:{x:.01,y:1.98,z:.07},ignoreLocalTransforms:!0,launchDate:new Date("2018-04-25T17:57:00.000Z")},{key:"env",name:"ENVISAT",shortName:"Envisat",satIndex:0,swathTypes:["black","red","green","white"],swathColors:[ot.colorFromKmlHex("ff000000"),ot.colorFromKmlHex("ff0000ff"),ot.colorFromKmlHex("ff00ff00"),ot.colorFromKmlHex("ffffffff")],swatModes:["IW","EW","SM"],tleLineOne:"1 27386U 02009A   22208.94689716  .00000035  00000+0  24922-4 0  9991",tleLineTwo:"2 27386  98.1855 188.1604 0001389  88.0150 331.3538 14.38141701 69354",hasModel:!0,filePath:"./satellites/sentinel1/s1.json",rotations:{x:0,y:0,z:0,headingAxis:[0,0,1],headingAdd:-90,headingMultiply:1},preRotations:{x:0,y:0,z:0},scale:5e5,translations:{x:-.1,y:-.1,z:0},ignoreLocalTransforms:!0,launchDate:new Date("2002-03-01T21:02:00.000Z"),retirementDate:new Date("2012-05-09T21:55:00.000Z")}];var ct=lt;const{ArgumentError:ut,BasicTextureProgram:dt,Color:ht,Logger:gt,Matrix:pt,Position:mt,PickedObject:ft,Renderable:_t,Vec3:bt}=E.a;var Et=function(e,t){if(!e)throw new ut(gt.logMessage(gt.LEVEL_SEVERE,"ColladaScene","constructor","missingPosition"));_t.call(this),this._position=e,this._nodes=[],this._meshes={},this._materials={},this._images={},this._upAxis="",this._dirPath="",this._xRotation=0,this._yRotation=0,this._zRotation=0,this.preX=0,this.preY=0,this.preZ=0,this._xTranslation=0,this._yTranslation=0,this._zTranslation=0,this._scale=1,this._altitudeMode=E.a.ABSOLUTE,this._localTransforms=!0,this._useTexturePaths=!0,this._nodesToHide=[],this._hideNodes=!1,this._placePoint=new bt(0,0,0),this._transformationMatrix=pt.fromIdentity(),this._mvpMatrix=pt.fromIdentity(),this._normalTransformMatrix=pt.fromIdentity(),this._normalMatrix=pt.fromIdentity(),this._texCoordMatrix=pt.fromIdentity().setToUnitYFlip(),this._entities=[],this._activeTexture=null,this._tmpVector=new bt(0,0,0),this._tmpColor=new ht(1,1,1,1),this._vboCacheKey="",this._iboCacheKey="",this.setSceneData(t)};(Et.prototype=Object.create(_t.prototype)).constructor=Et,Object.defineProperties(Et.prototype,{position:{get:function(){return this._position},set:function(e){this._position=e}},nodes:{get:function(){return this._nodes},set:function(e){this._nodes=e}},meshes:{get:function(){return this._meshes},set:function(e){this._meshes=e}},materials:{get:function(){return this._materials},set:function(e){this._materials=e}},images:{get:function(){return this._images},set:function(e){this._images=e}},upAxis:{get:function(){return this._upAxis},set:function(e){this._upAxis=e}},dirPath:{get:function(){return this._dirPath},set:function(e){this._dirPath=e}},xRotation:{get:function(){return this._xRotation},set:function(e){this._xRotation=e}},yRotation:{get:function(){return this._yRotation},set:function(e){this._yRotation=e}},zRotation:{get:function(){return this._zRotation},set:function(e){this._zRotation=e}},xTranslation:{get:function(){return this._xTranslation},set:function(e){this._xTranslation=e}},yTranslation:{get:function(){return this._yTranslation},set:function(e){this._yTranslation=e}},zTranslation:{get:function(){return this._zTranslation},set:function(e){this._zTranslation=e}},scale:{get:function(){return this._scale},set:function(e){this._scale=e}},placePoint:{get:function(){return this._placePoint},set:function(e){this._placePoint=e}},altitudeMode:{get:function(){return this._altitudeMode},set:function(e){this._altitudeMode=e}},transformationMatrix:{get:function(){return this._transformationMatrix},set:function(e){this._transformationMatrix=e}},normalMatrix:{get:function(){return this._normalMatrix},set:function(e){this._normalMatrix=e}},localTransforms:{get:function(){return this._localTransforms},set:function(e){this._localTransforms=e}},useTexturePaths:{get:function(){return this._useTexturePaths},set:function(e){this._useTexturePaths=e}},nodesToHide:{get:function(){return this._nodesToHide},set:function(e){this._nodesToHide=e}},hideNodes:{get:function(){return this._hideNodes},set:function(e){this._hideNodes=e}}}),Et.prototype.setSceneData=function(e){e&&(this._nodes=e.root.children,this._meshes=e.meshes,this._materials=e.materials,this._images=e.images,this._upAxis=e.metadata.up_axis,this._dirPath=e.dirPath,this.flattenModel())},Et.prototype.flattenModel=function(){for(var e=0,t=this._nodes.length;e<t;e++)this.flattenNode(this._nodes[e]);this._entities.sort((function(e,t){var r=null===e.imageKey?"":""+e,n=null===t.imageKey?"":""+t;return r>n?1:r===n?0:-1}))},Et.prototype.flattenNode=function(e){if(e.mesh)for(var t=e.mesh,r=this._meshes[t].buffers,n=0,i=r.length;n<i;n++){for(var a=r[n].material,s=0;s<e.materials.length;s++)if(a===e.materials[s].symbol){var o=e.materials[s].id;break}var l=this._materials[o],c=null;l&&l.textures&&r[n].uvs&&r[n].uvs.length>0&&(l.textures.diffuse?c=l.textures.diffuse.mapId:l.textures.reflective&&(c=l.textures.reflective.mapId)),this._entities.push({mesh:r[n],material:l,node:e,imageKey:c})}for(var u=0;u<e.children.length;u++)this.flattenNode(e.children[u])},Et.prototype.render=function(e){var t,r=e.frustumInModelCoordinates;this.enabled&&(this.lastFrameTime!==e.timestamp&&(t=this.makeOrderedRenderable(e)),t&&r.containsPoint(this._placePoint)&&(t.layer=e.currentLayer,this.lastFrameTime=e.timestamp,e.addOrderedRenderable(t)))},Et.prototype.makeOrderedRenderable=function(e){return e.surfacePointForMode(this._position.latitude,this._position.longitude,this._position.altitude,this._altitudeMode,this._placePoint),this.eyeDistance=e.eyePoint.distanceTo(this._placePoint),this},Et.prototype.renderOrdered=function(e){if(this.drawOrderedScene(e),e.pickingMode){var t=new ft(this.pickColor.clone(),this,this._position,this.layer,!1);e.resolvePick(t)}},Et.prototype.drawOrderedScene=function(e){try{this.beginDrawing(e)}finally{this.endDrawing(e)}},Et.prototype.beginDrawing=function(e){var t=e.currentGlContext,r=e.gpuResourceCache,n=r.resourceForKey(this._vboCacheKey),i=r.resourceForKey(this._iboCacheKey);n||(this.setupBuffers(e),n=r.resourceForKey(this._vboCacheKey),i=r.resourceForKey(this._iboCacheKey)),t.bindBuffer(t.ARRAY_BUFFER,n),i&&t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,i),e.findAndBindProgram(dt),t.enableVertexAttribArray(0),e.pickingMode&&(this.pickColor=e.uniquePickColor()),this.computeTransformationMatrix(e.globe);for(var a=0,s=this._entities.length;a<s;a++){this.mustRenderNode(this._entities[a].node.id)&&this.draw(e,this._entities[a])}},Et.prototype.setupBuffers=function(e){for(var t=e.currentGlContext,r=Float32Array.BYTES_PER_ELEMENT||4,n=Uint16Array.BYTES_PER_ELEMENT||2,i=Uint32Array.BYTES_PER_ELEMENT||4,a=!1,s=0,o=0,l=0,c=this._entities.length;l<c;l++){var u=this._entities[l].mesh;u.indexedRendering&&(s+=u.indices.length,u.indices instanceof Uint32Array&&(a=!0)),o+=u.vertices.length,this._entities[l].imageKey&&(o+=u.uvs.length),u.normals&&u.normals.length&&(o+=u.normals.length)}var d=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,d),t.bufferData(t.ARRAY_BUFFER,o*r,t.STATIC_DRAW);var h=0;for(l=0,c=this._entities.length;l<c;l++){var g=this._entities[l].mesh.vertices;this._entities[l].vertexOffset=h,t.bufferSubData(t.ARRAY_BUFFER,h*r,g),h+=g.length}for(l=0,c=this._entities.length;l<c;l++)this._entities[l].imageKey&&(g=this._entities[l].mesh.uvs,this._entities[l].uvOffset=h,t.bufferSubData(t.ARRAY_BUFFER,h*r,g),h+=g.length);for(l=0,c=this._entities.length;l<c;l++)(g=g=this._entities[l].mesh.normals)&&g.length&&(this._entities[l].normalOffset=h,t.bufferSubData(t.ARRAY_BUFFER,h*r,g),h+=g.length);var p,m=n,f=s*m;if(a&&((p=e.getExtension("OES_element_index_uint"))?f=s*(m=i):gt.log(gt.LEVEL_SEVERE,'The 3D model is too big and might not render properly. \nYour browser does not support the "OES_element_index_uint" extension, required to render large models.')),s){var _=t.createBuffer();for(t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,_),t.bufferData(t.ELEMENT_ARRAY_BUFFER,f,t.STATIC_DRAW),h=0,l=0,c=this._entities.length;l<c;l++)(u=this._entities[l].mesh).indexedRendering&&((g=u.indices)instanceof Uint32Array&&!p&&(g=new Uint16Array(g)),this._entities[l].indexOffset=h,this._entities[l].indexSize=m,t.bufferSubData(t.ELEMENT_ARRAY_BUFFER,h*m,g),h+=g.length)}this._vboCacheKey=e.gpuResourceCache.generateCacheKey(),e.gpuResourceCache.putResource(this._vboCacheKey,d,o*r),s&&(this._iboCacheKey=e.gpuResourceCache.generateCacheKey(),e.gpuResourceCache.putResource(this._iboCacheKey,_,f))},Et.prototype.draw=function(e,t){var r=e.currentGlContext,n=e.currentProgram,i=e.gpuResourceCache,a=t.mesh,s=t.material,o=t.node.worldMatrix,l=t.node.normalMatrix,c=a.normals&&a.normals.length,u=t.imageKey;if(this.applyColor(e,s),u){var d=this._useTexturePaths?this._images[u].path:this._images[u].filename,h=this._dirPath+d;if(this._activeTexture=i.resourceForKey(h),!this._activeTexture){var g=a.isClamp?r.CLAMP_TO_EDGE:r.REPEAT;this._activeTexture=i.retrieveTexture(r,h,g)}this._activeTexture&&this._activeTexture.bind(e)?(n.loadTextureEnabled(r,!0),r.vertexAttribPointer(2,2,r.FLOAT,!1,8,4*t.uvOffset),r.enableVertexAttribArray(2),n.loadModulateColor(r,e.pickingMode)):(n.loadTextureEnabled(r,!1),r.disableVertexAttribArray(2))}else n.loadTextureEnabled(r,!1),r.disableVertexAttribArray(2);if(c&&!e.pickingMode?(n.loadApplyLighting(r,1),r.vertexAttribPointer(1,3,r.FLOAT,!1,12,4*t.normalOffset),r.enableVertexAttribArray(1)):(n.loadApplyLighting(r,0),r.disableVertexAttribArray(1)),this.applyMatrix(e,c,h,o,l),r.vertexAttribPointer(0,3,r.FLOAT,!1,12,4*t.vertexOffset),a.indexedRendering){var p=t.indexOffset*t.indexSize;a.indices instanceof Uint32Array&&e.getExtension("OES_element_index_uint")?r.drawElements(r.TRIANGLES,a.indices.length,r.UNSIGNED_INT,p):r.drawElements(r.TRIANGLES,a.indices.length,r.UNSIGNED_SHORT,p)}else r.drawArrays(r.TRIANGLES,0,Math.floor(a.vertices.length/3))},Et.prototype.applyColor=function(e,t){var r,n=e.currentGlContext,i=e.currentProgram;if(t)if("constant"===t.techniqueType)var a=t.reflective;else a=t.diffuse;var s=1,o=1,l=1,c=1;a&&(s=a[0],o=a[1],l=a[2],c=null!=a[3]?a[3]:1),this._tmpColor.set(s,o,l,c),r=c*this.layer.opacity,n.depthMask(r>=1||e.pickingMode),i.loadColor(n,e.pickingMode?this.pickColor:this._tmpColor),i.loadOpacity(n,e.pickingMode?r>0?1:0:r)},Et.prototype.applyMatrix=function(e,t,r,n,i){this._mvpMatrix.copy(e.modelviewProjection),this._mvpMatrix.multiplyMatrix(this._transformationMatrix),n&&this._localTransforms&&this._mvpMatrix.multiplyMatrix(n),t&&!e.pickingMode&&(this._normalMatrix.copy(e.modelviewNormalTransform),this._normalMatrix.multiplyMatrix(this._normalTransformMatrix),i&&this._localTransforms&&this._normalMatrix.multiplyMatrix(i),e.currentProgram.loadModelviewInverse(e.currentGlContext,this._normalMatrix)),r&&this._activeTexture&&(e.currentProgram.loadTextureMatrix(e.currentGlContext,this._texCoordMatrix),this._activeTexture=null),e.currentProgram.loadModelviewProjection(e.currentGlContext,this._mvpMatrix)},Et.prototype.endDrawing=function(e){var t=e.currentGlContext,r=e.currentProgram;t.disableVertexAttribArray(1),t.disableVertexAttribArray(2),r.loadApplyLighting(t,0),r.loadTextureEnabled(t,!1)},Et.prototype.computeTransformationMatrix=function(e){this._transformationMatrix.setToIdentity(),this._transformationMatrix.multiplyByLocalCoordinateTransform(this._placePoint,e),this._transformationMatrix.multiplyByRotation(1,0,0,this._xRotation),this._transformationMatrix.multiplyByRotation(0,1,0,this._yRotation),this._transformationMatrix.multiplyByRotation(0,0,1,this._zRotation),this._transformationMatrix.multiplyByScale(this._scale,this._scale,this._scale),this._transformationMatrix.multiplyByTranslation(this._xTranslation,this._yTranslation,this._zTranslation),this._transformationMatrix.multiplyByRotation(1,0,0,this.preX),this._transformationMatrix.multiplyByRotation(0,1,0,this.preY),this._transformationMatrix.multiplyByRotation(0,0,1,this.preZ),this.computeNormalMatrix()},Et.prototype.computeNormalMatrix=function(){this._transformationMatrix.extractRotationAngles(this._tmpVector),this._normalTransformMatrix.setToIdentity(),this._normalTransformMatrix.multiplyByRotation(-1,0,0,this._tmpVector[0]),this._normalTransformMatrix.multiplyByRotation(0,-1,0,this._tmpVector[1]),this._normalTransformMatrix.multiplyByRotation(0,0,-1,this._tmpVector[2])},Et.prototype.mustRenderNode=function(e){var t=!0;this._hideNodes&&(t=-1===this._nodesToHide.indexOf(e));return t};var St=Et;const{Matrix:yt,Renderable:vt}=E.a;var xt=class extends vt{constructor(e,t,r){super(),this._satellite=t;const n=this.parse(e);this.draw(r,n)}position(e){this._model.position=e}draw(e,t){const{rotations:r,translations:n,preRotations:i,scale:a,shortName:s,ignoreLocalTransforms:o}=this._satellite,l=new St(e,t);l.type=this.type,l.satShortName=s,l.nodesToHide=["PlatformCircleAndName","SolarWingsCircleAndName","C-SarCircleAndName","PlatformTextsAndArrows","SolarWingsTextsAndArrows","C-SarTextsAndArrows","SolarArrayGroup","WingsDetailsGroup","Group004","MsiGroup","SatelliteGroup","SatelliteDimensionsGroup","MWRGroup","SRALGroup","OLCIGroup","SLSTRGroup"],l.hideNodes=!0,l.useTexturePaths=!1,l.localTransforms=o,l.scale=a,l.xRotation=r.x,l.yRotation=r.y,l.zRotation=r.z,l.xTranslation=n.x,l.yTranslation=n.y,l.zTranslation=n.z,l.preX=i.x,l.preY=i.y,l.preZ=i.z,this._model=l,t=null}parse(e){const t=e.meshes,r=e.root.children,n=e.materials;for(let i in t)if(t.hasOwnProperty(i)){const e=t[i].buffers;for(let t=0;t<e.length;t++){const r=e[t].vertices||[],n=e[t].normals||[],i=e[t].uvs||[],a=e[t].indices||[],s=new Float32Array(r),o=new Float32Array(n),l=new Float32Array(i),c=new Uint16Array(a);e[t].vertices=s,e[t].normals=o,e[t].uvs=l,e[t].indices=c}}for(let i=0;i<r.length;i++){const e=r[i];if(e.mesh){const t=e.worldMatrix.slice(0);e.worldMatrix=yt.fromIdentity(),e.worldMatrix.copy(t),e.children.length&&console.info("node has children",e)}}for(let i in n)if(n.hasOwnProperty(i)){const e=n[i];"_3_-_Default-material"===e.id?e.reflective&&(e.reflective[0]=.289219,e.reflective[1]=.713497,e.reflective[2]=.870753,e.reflective[3]=1):"_1_-_Default_004-material"===e.id||"_1_-_Default-material"===e.id?e.diffuse[3]=0:"Chrome-material"===e.id?(e.textures=null,e.diffuse[0]=.3137,e.diffuse[1]=.3137,e.diffuse[2]=.3137):"Satellite_panel-material"===e.id?e.textures.reflective.mapId="image9":"_3_-_Default"===e.id?e.textures.reflective.mapId="image4":"_4_-_Default-material"===e.id?e.textures.reflective.mapId="image5":"_5_-_Default_002-material"===e.id?e.textures.reflective.mapId="image6":"_5_-_Default-material"===e.id&&(e.textures.reflective.mapId="image5")}return e}render(e){this._model&&this.enabled&&this._model.render(e)}};const{RenderableLayer:wt,Position:Tt}=E.a,{EoUtils:Rt}=st.a,Ct={rotations:{x:0,y:0,z:0,headingAxis:[0,0,1],headingAdd:-90,headingMultiply:1},preRotations:{x:0,y:0,z:0},scale:5e5,translations:{x:-.1,y:-.1,z:0},ignoreLocalTransforms:!0};var Ot=class extends wt{constructor(e,t){super(e),this.type="SatelliteModelLayer",this._satelliteOptions=t,this._rerenderMap=null,this.key=e.key,this.model=null,this.time=e.time,this.Tle=null,this.heading=null,this.onLayerChanged=e.onLayerChanged||null}setModel(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ct,r=arguments.length>2?arguments[2]:void 0;e&&(this.model=new xt(e,t,r),this.removeAllRenderables(),this.addRenderable(this.model),this.doRerender())}setPosition(e){e&&this.model&&this.model.position(e)}setTle(e){e&&(this.Tle=e,this.update())}update(){if(this.Tle&&this.time){const e=Rt.computeSatrec(...this.Tle),t=Rt.getOrbitPosition(e,new Date(this.time));this.setPosition(new Tt(t.latitude,t.longitude,t.altitude)),this.model&&this.alignWithOrbit(this.time,t,Rt.computeSatrec(...this.Tle),this._satelliteOptions.rotations,this.model._model),this.doRerender()}}alignWithOrbit(e,t,r,n,i){const a=e.getTime(),s=Rt.getOrbitPosition(r,new Date(a+1e4)),o=Rt.headingAngleRadians(t.latitude,t.longitude,s.latitude,s.longitude),l=Rt.rad2deg(o);this.heading=l,"function"===typeof this.onLayerChanged&&this.onLayerChanged({satKey:this.satName,layerKey:this.key,type:this.type},{update:{heading:this.heading}});const c=(l+n.headingAdd)*n.headingMultiply;0!==l&&(1===n.headingAxis[0]?i.xRotation=c:1===n.headingAxis[1]?i.yRotation=c:1===n.headingAxis[2]&&(i.zRotation=c))}setTime(e){e&&(this.time=e,this.update())}setRerender(e){"function"===typeof e&&(this._rerenderMap=e)}doRerender(){"function"===typeof this._rerenderMap&&this._rerenderMap()}};const{EoUtils:Dt}=st.a;var Lt=[];let At,Nt=null;for(let mn=0;mn<ct.length;mn++){console.log(ct[mn].name);const e={rotations:ct[mn].rotations,preRotations:ct[mn].preRotations,scale:ct[mn].scale,translations:ct[mn].translations,ignoreLocalTransforms:ct[mn].ignoreLocalTransforms};Nt=new Date(ct[mn].launchDate.getTime()),null==ct[mn].retirementDate?(At=new Date(Nt.getTime()),At.setUTCFullYear(At.getUTCFullYear()+20)):At=new Date(ct[mn].retirementDate.getTime());let t=new Ot({key:ct[mn].key,time:new Date},e);t.timeRange=[Nt,At];const r=Dt.computeSatrec(ct[mn].tleLineOne,ct[mn].tleLineTwo),n=Dt.getOrbitPosition(r,new Date);fetch(ct[mn].filePath).then((e=>e.json())).then((e=>{t.setModel(e,{rotations:ct[mn].rotations,preRotations:ct[mn].preRotations,scale:ct[mn].scale,translations:ct[mn].translations,ignoreLocalTransforms:ct[mn].ignoreLocalTransforms},n)})),t.setTle([ct[mn].tleLineOne,ct[mn].tleLineTwo]),Lt.push(t)}var Pt=Lt;const{EoUtils:It}=st.a,{ABSOLUTE:Mt,Color:kt,Renderable:jt,Path:Ft,ShapeAttributes:Ut}=E.a;var Gt=class extends jt{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Date,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Date,n=arguments.length>3?arguments[3]:void 0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:120;if(super(),!e)throw new Error("Orbits#constructor Satellite Record is missing.");this._satrec=e,this._orbitPoints=i,this._trail=this.trail(this.trailAttributes(n)),r.getTime()===t.getTime()?(this._currentEndTime=new Date(t.getTime()+1e3*i),this._previousEndTime=new Date(t.getTime()+1e3*i)):(this._currentEndTime=r,this._previousEndTime=r),this._currentStartTime=t,this._previousStartTime=t,this.populate()}satrec(e,t){if(!e)throw Error("No satellite record was provided");this._satrec=e,!0!==t&&this.populate()}time(e,t,r){if(!e)throw Error("No startTime was provided");if(!t)throw Error("No endTime was provided");this._previousStartTime=this._currentStartTime,this._previousEndTime=this._currentEndTime,this._currentStartTime=e,this._currentEndTime=t,!0!==r&&this.update()}render(e){this.enabled&&this._trail.render(e)}update(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const t=this._currentStartTime.getTime(),r=t,n=this._previousStartTime.getTime(),i=n,a=t-n,s=this._currentEndTime.getTime(),o=this._previousEndTime.getTime(),l=s-o;if(0===a&&0===l&&!e)return;if(e)return void this.populate();const c=s-t,u=Math.floor(c/this._orbitPoints);if(Math.ceil(Math.abs(r-i)/u)+Math.ceil(Math.abs(s-o)/u)>this._orbitPoints)this.populate();else{if(a){if(a>0){let e=0;for(;this._trail.positions[e].time<t;)this._trail.positions.shift()}if(a<0){const e=Math.ceil(Math.abs(r-i)/u);for(let t=0;t<e;t++){const e=new Date(i-t*u),r=It.getOrbitPositionWithPositionalData(this._satrec,e).position;r.time=e.getTime(),this._trail.positions=[r,...this._trail.positions]}}}if(l){if(l>0){const e=Math.ceil(Math.abs(s-o)/u);for(let t=0;t<e;t++){const e=new Date(o+t*u),r=It.getOrbitPositionWithPositionalData(this._satrec,e).position;r.time=e.getTime(),this._trail.positions.push(r)}}if(l<0){let e=this._trail.positions.length-1;for(;this._trail.positions[e].time>s;)this._trail.positions.pop(),e=this._trail.positions.length-1}}this._trail.positions=[...this._trail.positions]}}populate(){const e=this._currentStartTime.getTime(),t=this._currentEndTime.getTime()-e,r=Math.floor(t/this._orbitPoints),n=[];for(let i=0;i<this._orbitPoints;i++){const t=new Date(e+i*r),a=It.getOrbitPositionWithPositionalData(this._satrec,t).position;a.time=t.getTime(),n.push(a)}this._trail.positions=[...n]}trail(e){const t=new Ft([]);return t.enabled=!0,t.altitudeMode=Mt,t.numSubSegments=1,t.attributes=e,t}trailAttributes(e){const t=new Ut(null);return t.outlineColor=e,t.outlineWidth=2,t.drawOutline=!0,t.drawInterior=!0,t}};const{RenderableLayer:Bt,Color:Vt}=E.a;var Wt=class extends Bt{constructor(e){super(e),this._rerenderMap=null,this.satRec=null,this.key=e.key,this.timeWindow=9e5,this.opacity=Number.isFinite(e.opacity)&&e.opacity>-1&&e.opacity<101?e.opacity:100,this._beforeCurrentOrbit=new Gt(e.satRec,new Date,new Date,new Vt(213/255,214/255,210/255,.5)),this._afterCurrentOrbit=new Gt(e.satRec,new Date,new Date,new Vt(1,1,0,.5)),this.addRenderable(this._beforeCurrentOrbit),this.currentTime=null,this.selectTime=null,this.endTime=null,this.endTime=null,this.satRec=null,this.setSatRec(e.satRec),this.setTime(e.currentTime,e.time)}setSatRec(e,t){e&&(this._beforeCurrentOrbit.satrec(e,!0),!0!==t&&this._beforeCurrentOrbit.update(!0),this._afterCurrentOrbit.satrec(e,!0),!0!==t&&this._afterCurrentOrbit.update(!0),this.doRerender())}setTime(e){e&&(this.selectTime=e,this.startTime=new Date(e.getTime()-this.timeWindow),this.endTime=new Date(e.getTime()+this.timeWindow),this._beforeCurrentOrbit.time(this.startTime,this.selectTime,!1),this.doRerender())}setTime2(e,t,r){e&&t&&(this.currentTime=e,this.selectTime=t,this.startTime=new Date(t.getTime()-this.timeWindow),this.endTime=new Date(t.getTime()+this.timeWindow),this.removeRenderable(this._beforeCurrentOrbit),this.removeRenderable(this._afterCurrentOrbit),e.getTime()<this.startTime.getTime()?(this._afterCurrentOrbit.time(this.startTime,this.endTime,r),this.addRenderable(this._afterCurrentOrbit)):this.startTime.getTime()<e.getTime()&&e.getTime()<this.endTime.getTime()?(this._beforeCurrentOrbit.time(this.startTime,e,r),this._afterCurrentOrbit.time(e,this.endTime,r),this.addRenderable(this._beforeCurrentOrbit),this.addRenderable(this._afterCurrentOrbit)):e.getTime()>this.endTime.getTime()&&(this._beforeCurrentOrbit.time(this.startTime,this.endTime,r),this.addRenderable(this._beforeCurrentOrbit)),this.doRerender())}forceUpdate(){this._afterCurrentOrbit.update(!0),this._beforeCurrentOrbit.update(!0)}setRerender(e){"function"===typeof e&&(this._rerenderMap=e)}doRerender(){"function"===typeof this._rerenderMap&&this._rerenderMap()}};const{EoUtils:zt}=st.a;var Ht=[];let qt,Kt=null;for(let mn=0;mn<ct.length;mn++){qt=new Date(ct[mn].launchDate.getTime()),null==ct[mn].retirementDate?(Kt=new Date(qt.getTime()),Kt.setUTCFullYear(Kt.getUTCFullYear()+20)):Kt=new Date(ct[mn].retirementDate.getTime());let e=new Wt({key:ct[mn].key,satRec:zt.computeSatrec(ct[mn].tleLineOne,ct[mn].tleLineTwo),time:new Date,currentTime:new Date,opacity:.7});e.timeRange=[qt,Kt],e.displayName="Orbit",Ht.push(e)}var Yt=Ht;const Qt=[{service:"https://tiles.maps.eox.at/wms",layerNames:"s2cloudless-2018",title:"s2cloudless-2018",numLevels:19,format:"image/png",size:256,sector:E.a.Sector.FULL_SPHERE,levelZeroDelta:new E.a.Location(90,90)},{service:"https://tiles.esa.maps.eox.at/wms",layerNames:"s2cloudless-2018",title:"s2cloudless-2018 esa",numLevels:19,format:"image/png",size:256,sector:E.a.Sector.FULL_SPHERE,levelZeroDelta:new E.a.Location(90,90)},{service:"https://tiles.esa.maps.eox.at/wms",layerNames:"osm",title:"osm",numLevels:19,format:"image/png",size:256,sector:E.a.Sector.FULL_SPHERE,levelZeroDelta:new E.a.Location(90,90)},{service:"https://tiles.esa.maps.eox.at/wms",layerNames:"terrain-light",title:"terrain-light",numLevels:19,format:"image/png",size:256,sector:E.a.Sector.FULL_SPHERE,levelZeroDelta:new E.a.Location(90,90)},{service:"https://tiles.esa.maps.eox.at/wms",layerNames:"terrain-light",title:"terrain-light",numLevels:19,format:"image/png",size:256,sector:E.a.Sector.FULL_SPHERE,levelZeroDelta:new E.a.Location(90,90)},{service:"https://s2maps-tiles.eu/wms",layerNames:"s2cloudless-2021",title:"s2cloudless-2021",numLevels:19,format:"image/png",size:256,sector:E.a.Sector.FULL_SPHERE,levelZeroDelta:new E.a.Location(90,90)}],Xt=[{service:"https://tiles.maps.eox.at/wms",layerNames:"hydrography",title:"hydrography",numLevels:19,format:"image/png",size:256,sector:E.a.Sector.FULL_SPHERE,levelZeroDelta:new E.a.Location(90,90)},{service:"https://tiles.maps.eox.at/wms",layerNames:"overlay_bright",title:"overlay_bright",numLevels:19,format:"image/png",size:256,sector:E.a.Sector.FULL_SPHERE,levelZeroDelta:new E.a.Location(90,90)},{service:"https://tiles.esa.maps.eox.at/wms",layerNames:"overlay",title:"overlay",numLevels:19,format:"image/png",size:256,sector:E.a.Sector.FULL_SPHERE,levelZeroDelta:new E.a.Location(90,90)}];var Zt=r(9);function $t(e){let{id:t}=e;const r=Object(n.useRef)(864e9),i=Object(n.useRef)(36e5),a=Object(n.useRef)(864e9),s=Object(n.useRef)(null),[o,l]=Object(n.useState)(""),[c,u]=Object(n.useState)({}),d=Object(n.useRef)(1),h=Object(n.useRef)(0),g=Object(n.useRef)(!1),p=Object(n.useRef)([]),m=Object(n.useRef)(!1),f=Object(n.useRef)(!1),_=Object(n.useRef)(!1),b=Object(n.useRef)(!1),S=Object(n.useRef)(!1),y=Object(n.useRef)(!1),v=Object(n.useRef)(!1),x=Object(n.useRef)(0),w=Object(n.useRef)([]),T=Object(n.useRef)(new Date),R=Object(n.useRef)([]),C=Object(n.useRef)(null),O=Object(n.useRef)();function D(e){console.log("toggleAtmosphere: "+e);let t=G("Atmosphere");m.current=null!==e?e:!m.current,t.enabled=m.current,s.current.redraw()}function L(e,t){g.current=null!=e?e:!g.current,p.current=t,B(T.current,g.current,p.current),V(T.current,g.current,p.current),s.current.redraw()}function A(e){console.log("toggleStarfield: "+e);let t=G("StarField");f.current=null!=e?e:!f.current,t.enabled=f.current,s.current.redraw()}function N(e){let t=G("overlay_bright");_.current=null!==e?e:!_.current,t.enabled=_.current,j(),s.current.redraw()}function P(e){let t=-1;e=null===e?(d.current+1)%Qt.length:e%Qt.length,d.current=e;for(let r=0;r<s.current.layers.length;r++)"background"===s.current.layers[r].type&&s.current.layers[r].type&&(t+=1,s.current.layers[r].enabled=t===e);s.current.redraw()}function I(e){let t=-1;h.current=null==e?(h.current+1)%(Xt.length+1):e%(Xt.length+1);for(let r=0;r<s.current.layers.length;r++)"overlay"===s.current.layers[r].type&&s.current.layers[r].type&&(t+=1,s.current.layers[r].enabled=t===h.current);s.current.redraw()}function M(e){var t;v.current=null!==e?e:!v.current,v.current?(console.log("Switching to Copernicus Dem"),(t=new E.a.ElevationModel).addCoverage(new E.a.TiledElevationCoverage({coverageSector:E.a.Sector.FULL_SPHERE,resolution:.008333333333333,retrievalImageFormat:"image/tiff",minElevation:-11e3,maxElevation:8850,urlBuilder:new E.a.WcsTileUrlBuilder("https://dem.esa.maps.eox.at/elevation","copdem","2.0.1")}))):(console.log("Switching to NASA Dem"),t=new E.a.EarthElevationModel),s.current.globe.elevationModel=t,s.current.redraw()}function k(e){let t=["3D","Equirectangular","Mercator","North Polar","South Polar"],r=t.length;switch(x.current=null===e?(x.current+1)%r:e%r,t[x.current]){case"3D":default:s.current.globe.projection=new E.a.ProjectionWgs84;break;case"Equirectangular":s.current.globe.projection=new E.a.ProjectionEquirectangular;break;case"Mercator":s.current.globe.projection=new E.a.ProjectionMercator;break;case"North Polar":s.current.globe.projection=new E.a.ProjectionPolarEquidistant("North");break;case"South Polar":s.current.globe.projection=new E.a.ProjectionPolarEquidistant("South")}s.current.redraw()}const j=()=>{s.current.layers.sort(((e,t)=>e.zIndex-t.zIndex))};async function F(e){let t=null;if(e.userProperties.title.indexOf("MSIL1C")>=0&&(t="S2L1C_TRUE_COLOR"),e.userProperties.title.indexOf("MSIL2A")>=0&&(t="S2L2A_TRUE_COLOR"),e.userProperties.title.indexOf("GRD")>=0&&(t="S1_IW_GRDH_FullResolution"),null===t)return;let r={service:"https://view.onda-dias.eu/instance00/ows",layerNames:t,title:"QuicklookWMS",numLevels:19,format:"image/png",size:256,sector:e.sector,levelZeroDelta:new E.a.Location(90,90)};U();let n=new E.a.WmsLayer(r,e.timeRange[1].toJSON()),i=[];i[1]=e.timeRange[1],i[0]=new Date(i[1].getTime()-864e5),n.timeRange=i,n.zIndex=900,n.maxActiveAltitude=3e6,s.current.addLayer(n),j(),s.current.redraw(),console.log(s.current.layers)}function U(){s.current.removeLayer(G("QuicklookWMS")),s.current.redraw()}function G(e){for(let t=0;t<s.current.layers.length;t++)if(s.current.layers[t].displayName===e)return s.current.layers[t];return null}function B(e,t,r){for(let n=0;n<Pt.length;n++)Pt[n].timeRange[0].getTime()>e||Pt[n].timeRange[1].getTime()<e?Pt[n].enabled=!1:(Pt[n].setTime(new Date(e)),Pt[n].enabled=r.includes(Pt[n].key)&&t)}function V(e,t,r){for(let n=0;n<Yt.length;n++)Yt[n].timeRange[0].getTime()>e||Yt[n].timeRange[1].getTime()<e?Yt[n].enabled=!1:(Yt[n].setTime(new Date(e)),Yt[n].enabled=r.includes(Pt[n].key)&&t)}function W(e){let t=[];for(let r=0;r<e.renderables.length;r++)e.renderables[r].filtered&&!0===e.renderables[r].filtered||t.push(e.renderables[r].userProperties.earthObservation.acquisitionInformation[0].acquisitionParameter.acquisitionStartTime.getTime());return t}function z(e,t){let r=!0;if(!e.userProperties||void 0===t)return!0;for(let n=0;n<t.length;n++)switch(t[n].attribute){case"relativePassNumber":r*=e.userProperties.earthObservation.acquisitionInformation[0].acquisitionParameter.relativePassNumber===t[n].value;break;case"cloudCoverPercentage":r*=(e.userProperties.earthObservation.productInformation.cloudCoverPercentage?e.userProperties.earthObservation.productInformation.cloudCoverPercentage:0)<=t[n].value;break}return r}function H(e,t,r,n){if(0===e.renderables.length)return null;let i,a,s,o=-1,l=-1,c=-1,u=1e17,d=1e17;for(let h=0;h<e.renderables.length;h++){i=e.renderables[h].timeRange[0].getTime(),a=e.renderables[h].timeRange[1].getTime(),s=!!e.renderables[h].filtered&&e.renderables[h].filtered,a>=t.getTime()-n&&i<=t.getTime()+r&&!s?(e.renderables[h].enabled=!0,e.renderables[h].highlighted=!1):(e.renderables[h].enabled=!1,e.renderables[h].highlighted=!1);let g=i-t.getTime();s||(g<0&&Math.abs(g)<=u&&(l=h,u=Math.abs(g)),0==g&&(o=h),g>0&&Math.abs(g)<=d&&(c=h,d=Math.abs(g)))}return-1==o&&(o=d>=u?l:c),e.renderables[o].enabled=!0,e.renderables[o].highlighted=!0,{closest:e.renderables[o],previous:e.renderables[-1==l?0:l],next:e.renderables[-1==c?e.renderables.length-1:c]}}const q=Object(n.useRef)([]),K=async(e,t,r,n,a,o,l,c,u,d,h,g,p)=>{let m=new AbortController;q.current.push(m);for(let s=0;s<o.renderables.length;s++)if(o.renderables[s].displayName===r[1].toUTCString())return void H(o,T.current,0,i.current);try{let l=await g(e,u,d,h,c.user,c.pass);if(!l.ok)throw new Error("HTTP error (QL)! status: ".concat(l.status));let p=await l.blob(),m=URL.createObjectURL(p),f=await async function(e){return new Promise(((t,r)=>{((e,t)=>{const r=new Image;r.onload=function(){var e=r.width,n=r.height,i=document.createElement("canvas"),a=i.getContext("2d");i.width=e,i.height=n,a.transform(-1,0,0,-1,e,n),a.drawImage(r,0,0),t(i.toDataURL())},r.src=e})(e,(e=>{const r=new Image;r.addEventListener("load",(()=>{t(r)}),!1),r.src=e}))}))}(m),_=new ae(t,n);_.maximumNumEdgeIntervals=2,_.polarThrottle=1,_.timeRange=r,_.displayName=r[1].toUTCString(),_.zIndex=800,_.userProperties=a,_.image=f,o.addRenderable(_),URL.revokeObjectURL(m),j(),H(o,T.current,0,i.current),s.current.redraw()}catch(f){console.log("Error contacting server (QL)..."),console.log(f)}},Y=async(e,t,r,n,i,a,s)=>new Promise((async(o,l)=>{for(s.addEventListener("abort",(()=>{l()}));R.current.length>0;){let s=R.current.shift();await Q(s,t,r,n,e,i,a)}o()})),Q=async(e,t,r,n,i,a,s)=>{if(e){let s,o=e.userProperties.quicklookUrl;if(null==o)return;s=e.userProperties.earthObservation.productInformation.tile?(e=>{let t=0;for(;w.current[t].tile!==e;)t++;let r=w.current[t].footprint.slice(15,w.current[t].footprint.length-3).split(","),n=[];for(let a=0;a<r.length;a++){let e=r[a].split(" "),t=e[1],i=e[0];n.push({latitude:t,longitude:i})}let i=[];return i[0]=n,i})(e.userProperties.earthObservation.productInformation.tile):e.boundaries[0];let l=0;for(let e=0;e<s.length;e++)Math.abs(s[e].latitude)>l&&(l=s[e].latitude);if(l>84)return console.log("I refuse"),void console.log(e.boundaries[0]);let c=[];c[1]=e.timeRange[1],c[0]=e.timeRange[0];let u=e.attributes,d=e.userProperties,h=G("Quicklooks");e.enabled;await K(o,s,c,u,d,h,0,i,t,r,n,a)}};async function X(e){e=e||T.current,f.current&&(G("StarField").time=new Date(e)),m.current&&(G("Atmosphere").time=new Date(e)),S.current&&H(G("Quicklooks"),e,0,i.current);let t=null;t=H(G("Products"),e,a.current,r.current),y.current&&(G("QuicklookWMS"),i.current),g.current&&(B(e,g.current,p.current),V(e,g.current,p.current)),s.current.redraw(),T.current=e,u((e=>({...e,closestRenderable:t})))}async function Z(e,t,r){if(e!==c.latitude||t!==c.longitude){s.current.goToAnimator.travelTime=1300;try{s.current.goTo(new E.a.Position(e,t,e))}catch(n){console.log(n)}s.current.navigator.range=r,s.current.navigator.camera.applyLimits(),s.current.redraw(),X()}else console.log("already moved there...")}const $=(e,t)=>{if(t===E.a.AFTER_REDRAW){let t=e.navigator.lookAtLocation.longitude,r=e.navigator.lookAtLocation.latitude,n=e.navigator.range,i=n<2e6?function(){let e,t,r=s.current.viewport,n={},i="";try{e=s.current.pickTerrain(s.current.canvasCoordinates(r.x,r.y+r.height)).terrainObject().position,e.latitude=Math.round(1e4*e.latitude)/1e4,e.longitude=Math.round(1e4*e.longitude)/1e4}catch(a){e=null}try{t=s.current.pickTerrain(s.current.canvasCoordinates(r.x+r.width,r.y)).terrainObject().position,t.latitude=Math.round(1e4*t.latitude)/1e4,t.longitude=Math.round(1e4*t.longitude)/1e4}catch(a){t=null}return null==e||null==t?i="":(n={type:"bbox",value:e.longitude+","+e.latitude+","+t.longitude+","+t.latitude},i="POLYGON(("+e.longitude+" "+e.latitude+","+t.longitude+" "+e.latitude+","+t.longitude+" "+t.latitude+","+e.longitude+" "+t.latitude+","+e.longitude+" "+e.latitude+"))"),i}():"",a="POINT("+t.toFixed(4)+" "+r.toFixed(4)+")";u((e=>({...e,longitude:t,latitude:r,altitude:n,viewpolygon:i,viewpoint:a})))}};return Object(n.useEffect)((()=>{console.log("Creating the world...");var e=new E.a.ElevationModel;e.removeAllCoverages(),e.addCoverage(new E.a.TiledElevationCoverage({coverageSector:E.a.Sector.FULL_SPHERE,resolution:.008333333333333,retrievalImageFormat:"image/tiff",minElevation:-11e3,maxElevation:8850,urlBuilder:new E.a.WcsTileUrlBuilder("https://dem.esa.maps.eox.at/elevation","copdem","2.0.1")})),s.current=new Ue(t),s.current.worldWindowController=null,s.current.redrawCallbacks().push($),E.a.configuration.baseUrl=window.location.href;let r=new it,n=new E.a.AtmosphereLayer("images/BlackMarble_2016_01deg.jpg"),i=new E.a.RenderableLayer("Quicklooks");i.pickEnabled=!1;let a=[{layer:r,enabled:!1,zIndex:100},{layer:n,enabled:!1,zIndex:600},{layer:new E.a.RenderableLayer("Products"),enabled:!0,zIndex:700},{layer:i,enabled:!0,zIndex:800}];for(let t=0;t<Qt.length;t++){let e=new E.a.WmsLayer(Qt[t],"");e.enabled=!1,e.zIndex=500+t,e.type="background",s.current.addLayer(e,"")}for(let t=0;t<Xt.length;t++){let e=new E.a.WmsLayer(Xt[t],"");e.enabled=!1,e.type="overlay",e.zIndex=1e3+t,s.current.addLayer(e,"")}for(let t=0;t<a.length;t++)a[t].layer.enabled=a[t].enabled,a[t].layer.zIndex=a[t].zIndex,s.current.addLayer(a[t].layer);for(let t=0;t<Pt.length;t++)Pt[t].enabled=g.current,Pt[t].zIndex=200+t,s.current.addLayer(Pt[t]);for(let t=0;t<Yt.length;t++)Yt[t].enabled=g.current,s.current.addLayer(Yt[t]);j(),console.log(s.current.layers),s.current.redraw(),(async e=>{try{let t=await fetch(e,{cache:"force-cache"});if(!t.ok)throw new Error("HTTP error! status: ".concat(t.status));let r=(await t.text()).split("\n"),n=[],i=[];for(let e=0;e<r.length;e++)i=r[e].split(":"),n[e]={tile:i[0],footprint:i[1]};w.current=n}catch(t){console.log("error getting LUT")}})("./data/s2lut.txt")}),[]),{eww:s,ewwstate:c,initMap:function(e){let{clon:t,clat:r,alt:n,atmosphere:i,starfield:a,satellites:o,overlay:l,satelliteList:c,background:u,names:d,dem:h,projection:g}=e;s.current.navigator.range=n,D(i),A(a),L(o,c),P(u),N(d),I(l),M(h),k(g),Z(r,t,n),X()},moveTo:Z,removeGeojson:function(){G("Products").removeAllRenderables(),u((e=>({...e,closestRenderable:null,tics:[]}))),s.current.redraw()},addGeojson:(e,t)=>{let n=G("Products");new E.a.GeoJSONParser(e).load((function(){!function(e){for(let t=0;t<e.renderables.length;t++){let r=e.renderables[t].userProperties.earthObservation.acquisitionInformation[0].acquisitionParameter,n=new Date(r.acquisitionStartTime.getTime()),i=new Date(r.acquisitionStopTime.getTime());e.renderables[t].timeRange=[n,i]}}(n);let e=H(n,t,a.current,r.current),i=W(n);j(),u((t=>({...t,closestRenderable:e,tics:i}))),s.current.redraw()}),(function(e,t){let r={};if(r.userProperties=t,e.isPointType()||e.isMultiPointType()){let e=new E.a.PlacemarkAttributes(null);e.imageScale=10,e.imageColor=new E.a.Color(0,1,1,.2),e.labelAttributes.offset=new E.a.Offset(E.a.OFFSET_FRACTION,5,E.a.OFFSET_FRACTION,5),r.attributes=new E.a.PlacemarkAttributes(e)}else e.isLineStringType()||e.isMultiLineStringType()?(console.log("config call back line string"),r.attributes=new E.a.ShapeAttributes(null),r.attributes.drawOutline=!0,r.attributes.outlineColor=new E.a.Color(.1*r.attributes.interiorColor.red,.3*r.attributes.interiorColor.green,.7*r.attributes.interiorColor.blue,1),r.attributes.outlineWidth=1,r.highlightAttributes=new E.a.ShapeAttributes(r.attributes),r.highlightAttributes.interiorColor=O.current,r.highlightAttributes.outlineColor=new E.a.Color(0,0,1,1),r.highlightAttributes.outlineWidth=5,r.highlightAttributes.drawOutline=!0):(e.isPolygonType()||e.isMultiPolygonType())&&(r.attributes=new E.a.ShapeAttributes(null),r.attributes.interiorColor=new E.a.Color(1,0,0,.2),r.highlightAttributes=new E.a.ShapeAttributes(r.attributes),r.highlightAttributes.interiorColor=O.current,r.highlightAttributes.outlineColor=new E.a.Color(0,0,1,1),r.highlightAttributes.outlineWidth=5,r.highlightAttributes.drawOutline=!0);return r}),n)},toggleGeojson:function(e){let t=G("Products");b.current=null!==e?e:!b.current,t.enabled=b.current,s.current.redraw()},getRenderables:function(e,t){let r=s.current.pick(s.current.canvasCoordinates(e,t)),n=[];for(let i=0;i<r.objects.length;i++)r.objects[i].userObject instanceof ae&&"Products"===r.objects[i].parentLayer.displayName&&n.push(r.objects[i].userObject);return n},addQuicklookWMS:F,removeQuicklookWMS:U,toggleQuicklookWMS:function(e){console.log("QuicklookWMS: "+e);let t=G("QuicklookWMS");t&&(y.current=null!==e?e:!y.current,t.enabled=y.current,s.current.redraw())},removeQuicklooks:function(){R.current=[],G("Quicklooks").removeAllRenderables(),s.current.redraw()},addQuicklook:(e,t,r,n,i,a,s,o)=>{if(e){let l=G("Products"),c=function(e,t){for(let r=0;r<t.renderables.length;r++)if(t.renderables[r].userProperties.title===e.userProperties.title)return r;return null}(e,l),u=0,d=[];if(null==a||0==a)for(;c<l.renderables.length&&u<10;c++)l.renderables[c].filtered&&!0===l.renderables[c].filtered||(u+=1,d.push(l.renderables[c]));else for(;c>=0&&u<10;c--)l.renderables[c].filtered&&!0===l.renderables[c].filtered||(u+=1,d.push(l.renderables[c]));for(let e=d.length;e>=0;e--)R.current.splice(0,0,d[e]);R.current.splice(100,1e3),null==C.current&&(C.current=new AbortController,Y(i,t,r,n,s,o,C.current.signal).then((()=>(C.current.abort(),void(C.current=null)))))}},toggleQuicklooks:function(e){let t=G("Quicklooks");S.current=null!==e?e:!S.current,t.enabled=S.current,s.current.redraw()},toggleStarfield:A,toggleAtmosphere:D,setTime:X,setFilter:e=>{if(e==[])return;console.log(e);let t=G("Products");for(let r=0;r<t.renderables.length;r++)t.renderables[r].filtered=!z(t.renderables[r],e);H(t,T.current,a.current,r.current);let n=W(t);t=G("Quicklooks");for(let r=0;r<t.renderables.length;r++)t.renderables[r].filtered=!z(t.renderables[r],e);H(t,T.current,0,i.current),u((e=>({...e,tics:n}))),s.current.redraw()},toggleProjection:k,toggleNames:N,toggleModel:L,toggleBg:P,toggleOv:I,toggleDem:M,northUp:function(){const e=s.current;let t=e.navigator.heading/-20,r=()=>{Math.abs(e.navigator.heading)>Math.abs(t)?(e.navigator.heading+=t,setTimeout(r,10)):e.navigator.heading=0,e.redraw()};setTimeout(r,10)},setMode:function(e){switch(e){case"point":a.current=0,r.current=864e5;break;case"global":default:a.current=864e9,r.current=864e9;break;case"animated":a.current=0,r.current=5184e6}},setColor:function(e){O.current=E.a.Color.colorFromHex(e.substring(1)+"99");let t=G("Products").renderables;for(let r=0;r<t.length;r++)t[r].highlightAttributes.interiorColor=O.current,t[r].highlightAttributes.outlineColor=new E.a.Color(0,0,1,1);s.current.redraw()}}}var Jt=r(8),er=r(4),tr=r(13);r(61);const rr=Object(n.memo)((e=>{let{world:t,onSimpleClick:r}=e;const i=Object(n.useRef)(),a=Object(n.useRef)(),s=Object(n.useRef)(),o=Object(n.useRef)(null),l=Object(n.useRef)(),c=Object(n.useRef)(),u=(Object(n.useRef)(),Object(n.useRef)()),d=Object(n.useRef)(),h=Object(n.useRef)(!0),g=Object(n.useRef)(!1),m=Object(n.useRef)("undefined"),[f,_]=(Object(n.useRef)(),Object(n.useState)([])),[{x:b,y:S},y]=Object(er.useSpring)((()=>({x:0,y:0}))),v=Object(Jt.a)((e=>{let{offset:[t,r]}=e;return y.start({x:t,y:r})}));er.animated.div,v(),Object(Jt.b)({onDrag:e=>{let{event:n,xy:i,vxvy:u,previous:p,first:m,down:f,initial:_,delta:b,movement:E,offset:S,velocity:y,direction:v,tap:x,scrolling:w,touches:R,pinching:C,origin:O}=e;var D;switch(m&&(o.current=null,d.current=q(i[0],i[1]),d.current||(d.current=q(t.current.canvas.clientWidth/2,t.current.canvas.clientHeight/2)),D=n,l.current=D.button,D.preventDefault(),a.current&&D.timeStamp-a.current<300?s.current=!0:(a.current=D.timeStamp,s.current=!1),s.current&&clearTimeout(c.current)),!0){case!s.current&&x:c.current=setTimeout((()=>{n.timeStamp-a.current<800?function(e){r(e)}(n):function(e){console.log("long click"),r(e)}(n)}),300);break;case s.current&&x:clearTimeout(c.current),console.log("double click"),function(){let e=t.current.navigator.heading/-20,r=()=>{Math.abs(t.current.navigator.heading)>Math.abs(e)?(t.current.navigator.heading+=e,setTimeout(r,10)):(t.current.navigator.heading=0,g.current=!1),t.current.redraw()};setTimeout(r,10)}();break;case!s.current&&!x&&2!=l.current&&2!=R:if(!h.current)return;n.timeStamp,a.current,V.stop(),A.stop(),P.stop(),T.stop(),t.current.globe.is2D()?U(n,_,f,b,S,E,y,v,i,p,m,w):G(n,_,f,b,S,u,y,v,i,p,m,w,R,C);break;case s.current&&!x:V.stop(),W(n,_,f,b,S,E,y,v,i,p,m,w);break;case!s.current&&!x&&2==l.current:k(f,b,!0)}},onDragend:()=>{console.log("drag end")},onWheel:e=>{let{event:t,xy:r,previous:n,first:i,down:a,initial:s,delta:o,movement:l,offset:c,velocity:u,direction:h,tap:g,wheeling:p}=e;i&&(d.current=q(t.clientX,t.clientY)),W(t,s,a,o,c,l,u,h,r,n,i,p)},onPinchStart:e=>{h.current=!1,F.stop(),V.stop(),A.stop(),P.stop(),O.stop(),T.stop(),m.current="undefined"},onPinch:e=>{let{event:t,da:r,vdva:n,origin:i,pinching:a,delta:s,first:o,initial:l,direction:c,previous:u,elapsedTime:d,memo:h={lastY:0}}=e;return x(t,r,n,i,a,s,o,l,c,u,h,d),h.lastY=i[1],h},onPinchEnd:()=>{clearTimeout(u.current),u.current=setTimeout((()=>{h.current=!0}),300),m.current="undefined"}},{domTarget:i,drag:{useTouch:!0},pinch:{useTouch:!0},eventOptions:{passive:!1}});const x=(e,t,r,n,i,a,s,o,l,c,u,d)=>{switch("undefined"===m.current&&d>=100&&(Math.abs(n[1]-u.lastY)>4?m.current="tilt":m.current="zoomrotate"),m.current){case"tilt":R(i,a,n,o,u);break;case"zoomrotate":D(i,a,n,r)}},[{pinchtiltvalue:w},T]=Object(er.useSpring)((()=>({pinchtiltvalue:[0,0]}))),R=(e,r,n,i,a)=>{T.start({pinchtiltvalue:Object(tr.sub)(n,[0,a.lastY]),immediate:e,config:{mass:1,tension:100,friction:40},onChange:()=>{e||(m.current="undefined");let r=e?.5:.2;t.current.navigator.tilt-=w.get()[1]*r*1,Q(),t.current.redraw()}})},[{pinchzoomrotatevalue:C},O]=Object(er.useSpring)((()=>({pinchzoomrotatevalue:[0,0]}))),D=(e,r,n,i)=>{let a=1,s=1;e||(a=Math.abs(i[0])<.2?0:1,s=Math.abs(i[1])<.2?0:1),O.start({pinchzoomrotatevalue:r,immediate:e,config:er.config.molasses,onChange:()=>{let e=1-C.get()[0]/300*a;z(d.current,e),t.current.navigator.range*=e,t.current.navigator.heading-=C.get()[1]*s,0!==t.current.navigator.heading&&(g.current=!0),Q(),t.current.redraw()}})},[{pinchzoomvalue:L},A]=Object(er.useSpring)((()=>({pinchzoomvalue:0}))),[{pinchrotatevalue:N},P]=Object(er.useSpring)((()=>({pinchrotatevalue:0}))),[{tiltvalue:I},M]=Object(er.useSpring)((()=>({tiltvalue:[0,0]}))),k=(e,r,n)=>{M.start({to:{tiltvalue:r},immediate:e,config:{mass:1,tension:100,friction:40},onChange:()=>{let e=-90*I.get()[1]*2/t.current.canvas.clientHeight,r=-90*I.get()[0]*2/t.current.canvas.clientWidth;t.current.navigator.tilt-=e,n&&(t.current.navigator.heading-=r,0!==t.current.navigator.heading&&(g.current=!0)),Q(),t.current.redraw()}})},[{panvalue:j},F]=Object(er.useSpring)((()=>({panvalue:[0,0]}))),U=(e,r,n,i,a,s,o,l,c,u,d,h)=>{let g=1;n||(g=o<.2?0:1);let p=(e.type,1);F.start({panvalue:i,immediate:n,config:{mass:1,tension:150,friction:80},onChange:()=>{let e=[t.current.canvas.clientWidth/2,t.current.canvas.clientHeight/2],r=Object(tr.sub)(e,Object(tr.scale)(j.get(),p*g)),n=q(e[0],e[1]);n||console.log("no currentpos !");let i=q(r[0],r[1]);i||console.log("no nextposition !");let a=new E.a.Vec3(0,0,0),s=new E.a.Vec3(0,0,0);if(!t.current.globe.computePointFromPosition(n.latitude,n.longitude,n.altitude,a))return;if(!t.current.globe.computePointFromPosition(i.latitude,i.longitude,i.altitude,s))return;let o=E.a.Matrix.fromIdentity();t.current.computeViewingTransform(null,o),o.multiplyByTranslation(a[0]-s[0],a[1]-s[1],a[2]-s[2]);var l=t.current.rayThroughScreenPoint(t.current.canvasCoordinates(c[0],c[1]));o.extractEyePoint(l.origin),o.extractForwardVector(l.direction);let u=new E.a.Vec3(0,0,0);if(!t.current.globe.intersectsLine(l,u))return;let d=o.extractViewingParameters(u,t.current.navigator.roll,t.current.globe,{});t.current.navigator.lookAtLocation.copy(d.origin),t.current.navigator.range=d.range,t.current.navigator.heading=d.heading,t.current.navigator.tilt=d.tilt,t.current.navigator.roll=d.roll,Q(),t.current.redraw()},onRest:()=>{}})},G=(e,r,n,i,s,l,c,u,h,p,m,f,_,b)=>{try{m&&(Math.abs(d.current.latitude)>80||t.current.navigator.heading>2)&&(g.current=!0)}catch{console.log("Position at start not detected")}let S=1;n||(S=c<.2?0:1);let y=(e.type,1);n||(y*=1),F.start({panvalue:i,immediate:n,config:{mass:1,tension:100,friction:40},onChange:()=>{o.current||(o.current=e.timeStamp-a.current<400);try{let e=[t.current.canvas.clientWidth/2,t.current.canvas.clientHeight/2],r=Object(tr.sub)(e,Object(tr.scale)(j.get(),y*S)),n=H(e[0],e[1]);n||console.log("no currentpos !");let i=H(r[0],r[1]);i||console.log("no nextposition !");let a=new E.a.Vec3(0,0,0),s=new E.a.Vec3(0,0,0);if(!t.current.globe.computePointFromPosition(n.latitude,n.longitude,n.altitude,a))return;if(!t.current.globe.computePointFromPosition(i.latitude,i.longitude,i.altitude,s))return;let o=new E.a.Vec3(0,0,0),l=K(s,a,o);if(i&&(i.latitude>80||i.latitude<-80)&&!1===g.current)return console.log("out"),void F.stop();Y(o,l,s,i),!1===g.current&&(t.current.navigator.heading=0),t.current.redraw()}catch{console.log("probl !")}},onRest:()=>{}})},[{range:B},V]=Object(er.useSpring)((()=>({range:[0,0]}))),W=(e,r,n,i,a,s,o,l,c,u,h,g)=>{let p=1;n||(p=o<.2?0:.5),V.start({range:i,immediate:n||g,config:{mass:1,tension:100,friction:40},onChange:()=>{let e=0===p?1:1-B.get()[1]/(g?300:100);z(d.current,e),t.current.navigator.range*=e,Q(),t.current.redraw()},onRest:()=>{}})},z=function(e,r){if(!e||r>=1)return;let n,i=t.current.navigator.lookAtLocation,a=t.current.globe.elevationAtLocation(i.latitude,i.longitude),s=new E.a.Position(i.latitude,i.longitude,a);r<1&&(n=E.a.Position.interpolateGreatCircle(r,e,s,new E.a.Position(0,0,0)),i.latitude=n.latitude,i.longitude=n.longitude,i.altitude=n.altitude)},H=(e,r)=>{let n=t.current.rayThroughScreenPoint(t.current.canvasCoordinates(e,r)),i=new E.a.Position(0,0,0),a=[0,0,0];return t.current.globe.intersectsLine(n,a)?(t.current.globe.computePositionFromPoint(a[0],a[1],a[2],i),i):null},q=(e,r)=>{let n=t.current.canvasCoordinates(e,r),i=t.current.pickTerrain(n);for(let t=0;t<i.objects.length;t++){let e=i.objects[t];if(e.isTerrain){let t=e.position;if(t)return new E.a.Position(t.latitude,t.longitude,t.altitude)}}},K=function(e,t,r){var n=E.a.MeasurerUtils.angleBetweenVectors(e,t)*E.a.Angle.RADIANS_TO_DEGREES;return r.copy(e),r.cross(t),r.normalize(),n},Y=function(e,r,n,i){if(!isFinite(r)||!isFinite(e[0])||!isFinite(e[1])||!isFinite(e[2]))return!1;var a=t.current,s=a.navigator,o=E.a.Matrix.fromIdentity(),l=s.lookAtLocation.altitude,c=s.tilt,u=new E.a.Line(new E.a.Vec3(0,0,0),new E.a.Vec3(0,0,0));if(s.tilt=0,a.computeViewingTransform(null,o),o.multiplyByRotation(e[0],e[1],e[2],r),o.extractEyePoint(u.origin),o.extractForwardVector(u.direction),!a.globe.intersectsLine(u,n))return s.tilt=c,!1;var d=o.extractViewingParameters(n,s.roll,a.globe,{});return s.heading=d.heading,s.lookAtLocation.copy(d.origin),s.lookAtLocation.altitude=l,s.tilt=c,!0},Q=()=>{let e=t.current.navigator;e.camera.applyLimits(),e.range=E.a.WWMath.clamp(e.range,t.current.globe.elevationAtLocation(e.lookAtLocation.latitude,e.lookAtLocation.longitude)+2,1e8),e.tilt=E.a.WWMath.clamp(e.tilt,0,90)};return Object(n.useEffect)((()=>{window.addEventListener("contextmenu",(e=>e.preventDefault()))}),[]),Object(p.jsx)("div",{children:Object(p.jsx)("div",{className:"EarthController",ref:i})})}));r(62);var nr=r(6),ir=r(31);var ar=function(e){let{active:t}=e;return Object(p.jsx)("div",{className:"LookAtWidget",style:{display:t?"flex":"none"},children:Object(p.jsx)("div",{className:"Mire",children:Object(p.jsx)(nr.Icon,{icon:ir.a,width:"30px",height:"40px"})})})},sr=(r(63),r(32)),or=r(33);r(64);var lr=function(e){let{active:t}=e;const[r,a]=i.a.useContext(m),s=Object(n.useCallback)((e=>{e.stopPropagation(),a({type:"gotopreviousitem"})}),[]),o=(Object(n.useCallback)((e=>{e.stopPropagation(),a({type:"gotoclosestitem"})}),[]),Object(n.useCallback)((e=>{e.stopPropagation(),a({type:"gotonextitem"})}),[]));return Object(p.jsxs)("div",{className:r.leftHanded?"ViewProductControlL":"ViewProductControl",style:{display:t?"flex":"none"},children:[Object(p.jsx)(nr.Icon,{icon:or.a,width:"50px",onClick:s}),Object(p.jsx)(nr.Icon,{icon:sr.a,width:"50px",onClick:o})]})},cr=r(34),ur=r(35);r(65);var dr=function(e){let{active:t}=e;const[r,a]=i.a.useContext(m),[s,o]=Object(n.useState)(r.filter),l=Object(n.useCallback)((e=>{e.stopPropagation(),a({type:"set_filter"})}),[]);return Object(p.jsx)("div",{className:r.leftHanded?"FilterProductControlL":"FilterProductControl",style:{display:t?"flex":"none"},children:Object(p.jsx)(nr.Icon,{icon:0==r.filter.length?cr.a:ur.a,width:"40px",onClick:l})})};function hr(){const e=Object(n.useRef)(null),t=Object(n.useRef)(null),r=Object(n.useRef)(null),[i,a]=Object(n.useState)({});return{fetchURL:async(n,i,a,s,o,l)=>{let c;if(e.current=new AbortController,i!==r.current&&(t.current=null,r.current=i,console.log("token reset")),a){if(null==t.current||null==t.current.token){console.log("will get token");try{t.current=await(async(e,t,r,n,i)=>{let a=null;switch(r){case"client_credentials":return console.log("client_credentials!!!"),a=new Zt.OAuth2Client({server:e,clientId:n,clientSecret:i,tokenEndpoint:t}),new Zt.OAuth2Fetch({client:a,getNewToken:async()=>a.clientCredentials(),onError:e=>{throw console.log(e),new Error("401")}});case"password":return console.log("password!!!"),a=new Zt.OAuth2Client({server:e,clientId:"cdse-public",tokenEndpoint:t}),console.log(a),new Zt.OAuth2Fetch({client:a,getNewToken:async()=>a.password({username:n,password:i}),onError:e=>{throw console.log(e),new Error("401")}});default:return console.log("default"),a=new Zt.OAuth2Client({server:e,clientId:n,clientSecret:i,tokenEndpoint:t}),new Zt.OAuth2Fetch({client:a,getNewToken:async()=>a.clientCredentials(),onError:e=>{throw console.log(e),new Error("401")}})}})(i,a,s,o,l)}catch(u){throw console.log(u),new Error("401")}}try{if(c=await t.current.fetch(n,{mode:"cors",credentials:"include",signal:e.current.signal,headers:{"Content-Type":"text/plain"}}),401==c.status)throw t.current=null,new Error("401");return c}catch(u){throw console.log(u),console.log("error token fetch"),t.current=null,new Error(u)}}else try{return c=await fetch(n,{mode:"cors",credentials:"include",headers:{"Content-Type":"text/plain",Authorization:"Basic "+window.btoa(o+":"+l)},signal:e.current.signal}),401==c.status&&(t.current=null),c}catch(u){console.log(u),console.log("error basic fetch")}},init_fetcher:async(e,t,r,n,i)=>{a({server:e,tokenendpoint:t,grantType:r,user:n,pass:i})},abort_fetchURL:()=>{e&&e.current&&e.current.abort()}}}var gr=r(99);var pr=e=>{let{id:t}=e;const[r,a]=i.a.useContext(m),s=Object(n.useRef)("keys"),{eww:o,ewwstate:l,initMap:c,moveTo:u,addGeojson:d,removeGeojson:h,toggleGeojson:f,toggleQuicklooks:_,addQuicklook:b,removeQuicklooks:E,getRenderables:S,addQuicklookWMS:y,removeQuicklookWMS:v,toggleQuicklookWMS:x,toggleProjection:w,toggleAtmosphere:T,toggleStarfield:R,toggleBg:C,toggleNames:O,toggleOv:D,toggleModel:L,setTime:A,setFilter:N,toggleDem:P,northUp:I,setMode:M,setColor:k}=$t({id:t}),j=g(r.closestItem,500),F=g(l.viewpoint,500),{fetchURL:U,abort_fetchURL:G}=hr(),B=(e,t)=>{console.log(e.target.tagName),"BODY"===e.target.tagName&&a({type:t.type})};Object(gr.a)(["p"],(e=>B(e,{type:"toggle_projection"}))),Object(gr.a)(["c"],(e=>B(e,{type:"clearResult"}))),Object(gr.a)(["u"],(e=>B(e,{type:"north_up"}))),Object(gr.a)(["w"],(e=>B(e,{type:"toggle_quicklooks"}))),Object(gr.a)(["b"],(e=>B(e,{type:"toggle_background"}))),Object(gr.a)(["m"],(e=>B(e,{type:"toggle_satellites"}))),Object(gr.a)(["d"],(e=>B(e,{type:"toggle_dem"}))),Object(gr.a)(["o"],(e=>B(e,{type:"toggle_overlay"}))),Object(gr.a)(["a"],(e=>B(e,{type:"toggle_atmosphere"}))),Object(gr.a)(["s"],(e=>B(e,{type:"toggle_starfield"}))),Object(gr.a)(["n"],(e=>B(e,{type:"toggle_names"}))),Object(n.useEffect)((()=>{l.altitude&&a({type:"set_altitude",value:l.altitude})}),[l.altitude,a]),Object(n.useEffect)((()=>{a({type:"set_searchPoint",value:l.viewpoint})}),[F,a]),Object(n.useEffect)((()=>{a({type:"set_position",value:{lat:l.latitude,lon:l.longitude}})}),[l.longitude,l.latitude,a]),Object(n.useEffect)((()=>{a({type:"set_tics",value:l.tics})}),[l.tics,a]),Object(n.useEffect)((()=>{A(new Date(r.viewDate))}),[r.viewDate]),Object(n.useEffect)((()=>{k(r.appColor)}),[r.appColor]),Object(n.useEffect)((()=>{r.productOn&&(f(r.productOn),_(r.productOn),x(!r.productOn))}),[r.productOn]),Object(n.useEffect)((()=>{null!==r.geojson&&d(r.geojson,new Date(r.viewDate))}),[r.geojson]),Object(n.useEffect)((()=>{null!==r.filter&&N(r.filter)}),[r.filter]),Object(n.useEffect)((()=>{h(),E(),v()}),[r.clearResultsTrigger]),Object(n.useEffect)((()=>{T(r.mapSettings.atmosphere),A()}),[r.mapSettings.atmosphere]),Object(n.useEffect)((()=>{r.mapSettings.satelliteList&&L(r.mapSettings.satellites,r.mapSettings.satelliteList)}),[r.mapSettings.satellites,r.mapSettings.satelliteList]),Object(n.useEffect)((()=>{R(r.mapSettings.starfield),A()}),[r.mapSettings.starfield]),Object(n.useEffect)((()=>{console.log(r.mapSettings.names),O(r.mapSettings.names)}),[r.mapSettings.names]),Object(n.useEffect)((()=>{w(r.mapSettings.projection)}),[r.mapSettings.projection]),Object(n.useEffect)((()=>{C(r.mapSettings.background)}),[r.mapSettings.background]),Object(n.useEffect)((()=>{I()}),[r.mapSettings.northup]),Object(n.useEffect)((()=>{console.log("Overlay: "+r.mapSettings.overlay),D(r.mapSettings.overlay)}),[r.mapSettings.overlay]),Object(n.useEffect)((()=>{P(r.mapSettings.dem)}),[r.mapSettings.dem]),Object(n.useEffect)((()=>{_(r.mapSettings.quicklooks)}),[r.mapSettings.quicklooks]),Object(n.useEffect)((()=>{a({type:"set_closestitem",value:l.closestRenderable})}),[l.closestRenderable]);Object(n.useEffect)((()=>{if(r.mapSettings.quicklooks&&j&&!r.searching){let e,t,n,i=(e=>{for(let t=0;t<r.collections.length;t++)if(r.collections[t].code===e)return r.collections[t];return null})(r.dataset),a=(e=>{for(let t=0;t<r.credentials.length;t++)if(r.credentials[t].key===e)return{user:r.credentials[t].user,pass:r.credentials[t].pass,grantType:r.credentials[t].grantType};return{user:"",pass:"",grantType:""}})(i.templateUrl.split("/")[2]),s="";i.tokenEndpoint&&(e=i.tokenEndpoint.split("/",3).join("/").length,t=i.tokenEndpoint.substring(0,e),n=i.tokenEndpoint.substring(e),s=i.grantType),b(j.closest,t,n,s,a,r.animated,U,G)}}),[j]),Object(n.useEffect)((()=>{null!=r.closestItem&&null!=r.goToPos&&u(r.goToPos.lat,r.goToPos.lon,r.goToPos.alt)}),[r.goToPos]),Object(n.useEffect)((()=>{null!==r.addQuicklookWMSTrigger&&y(r.selectedProduct)}),[r.addQuicklookWMSTrigger]),Object(n.useEffect)((()=>{r.animated?M("animated"):M(r.browseMode)}),[r.browseMode,r.animated]),Object(n.useEffect)((()=>{let e=r.position.clat,t=r.position.clon,n=r.altitude;console.log("Creating world / "+e+" / "+t+" / "+n),setTimeout((()=>{c({clat:e,clon:t,alt:n,starfield:r.mapSettings.starfield,atmosphere:r.mapSettings.atmosphere,background:r.mapSettings.background,overlay:r.mapSettings.overlay,satellites:r.mapSettings.satellites,satelliteList:r.mapSettings.satelliteList,names:r.mapSettings.names,projection:r.mapSettings.projection,dem:r.mapSettings.dem}),A(new Date(r.viewDate))}),1e3)}),[]);return Object(p.jsxs)("div",{children:[Object(p.jsx)("canvas",{ref:s,id:t,className:"Earth"}),Object(p.jsx)(rr,{world:o,onSimpleClick:e=>{let t=S(e.pageX,e.pageY);0!==t.length&&(console.log("items clicked: "+t.length),a({type:"set_selectedProduct",value:t[0]}))}}),Object(p.jsx)(ar,{active:"point"===r.searchMode}),Object(p.jsx)(lr,{active:null!=r.closestItem}),Object(p.jsx)(dr,{active:null!=r.closestItem})]})},mr=(r(66),r(36));var fr=function(e){const[t,r]=Object(n.useState)(!1),[a,s]=Object(n.useState)(!1),o=i.a.useRef(null),[l]=i.a.useContext(m),[{mr:c},u]=Object(er.useSpring)((()=>({mr:-300}))),d=Object(Jt.b)({onDragStart:()=>s(!0),onDrag:e=>{let{down:n,delta:i,vxvy:a,movement:s}=e;u.start({mr:n?-s[1]:s[1]>100||t?-300:0,immediate:!1,onChange:()=>{r(0===c.get())},onRest:()=>{n||r(0===c.get())}})},onDragEnd:()=>{setTimeout((()=>s(!1)),600)}},{drag:{useTouch:!0},pinch:{useTouch:!0}});return Object(p.jsxs)(er.animated.div,{style:{bottom:c,left:0},className:"ControlPanel",children:[Object(p.jsx)("div",{ref:o,...d(),className:l.leftHanded?"PanelControlL shadow":"PanelControl shadow",children:Object(p.jsx)(nr.Icon,{icon:mr.a,width:"100%"})}),Object(p.jsx)("div",{className:"ControlPanelMask",style:{display:a?"block":"none"}}),Object(p.jsx)("div",{className:"ControlPanelBlend",children:e.children})]})};r(67);var _r=function(e){const[{x:t,y:r},n]=Object(er.useSpring)((()=>({x:0,y:0}))),i=Object(Jt.a)((e=>{let{offset:[t,r]}=e;return n.start({x:t,y:r})}));return Object(p.jsx)(er.animated.div,{...i(),style:{x:t,y:r},className:"Infopanel",children:e.children})};r(68);var br=function(){const[e,t]=i.a.useContext(m),[r,a]=Object(n.useState)("\ud83d\ude42"),[s,o]=Object(n.useState)("\ud83d\ude42");return Object(gr.a)(["l"],(e=>{console.log("l:  "+e.target.tagName),"BODY"===e.target.tagName&&t({type:"toggle_lefthanded"})})),Object(n.useEffect)((()=>{o(e.animated?"\ud83e\udd75":"\ud83d\ude42"),a(e.animated?"\ud83e\udd75":"\ud83d\ude42")}),[e.animated]),Object(n.useEffect)((()=>{a(e.searching?"\ud83e\uddd0":s)}),[e.searching]),Object(p.jsx)("div",{className:"Mood",children:Object(p.jsx)("div",{className:"offset",children:r})})},Er=r(37),Sr=r.n(Er);r(69);var yr=function(e){let{active:t}=e;const[r,a]=i.a.useContext(m),s=Object(n.useCallback)((e=>{let t=window.location.href.split("?")[0],r=JSON.parse(window.localStorage.getItem("eoi_state"));t=t+"?s="+encodeURIComponent(u.a.crush(JSON.stringify(r))),console.log(t),navigator.share({url:t,text:"Care for the Earth..."})}),[]);return Object(p.jsx)("div",{className:r.leftHanded?"ShareL":"Share",children:Object(p.jsx)(nr.Icon,{icon:Sr.a,width:"40px",onClick:s})})};r(70);var vr=function(){const[e,t]=i.a.useContext(m);return Object(p.jsx)("div",{className:"DatasetSelectorContainer",children:Object(p.jsx)("div",{className:"DatasetSelector",children:e.collections.map((r=>Object(p.jsx)("div",{className:e.dataset===r.code?"CircleButtonSelected":"CircleButton",children:Object(p.jsx)("img",{className:"DatasetIcon",src:r.logo,alt:r.code,onClick:()=>t({type:"set_dataset",value:[r.code,r.satellites,r.cycle,r.defaultFreetext?r.defaultFreetext:r.code,r.windowSize]})})},r.code)))})})},xr=r(38),wr=r.n(xr),Tr=r(39),Rr=r.n(Tr),Cr=r(40),Or=r.n(Cr);r(71),r(72);var Dr=function(){const[e,t]=i.a.useContext(m);return Object(p.jsx)("div",{className:"MapSelectorContainer",children:Object(p.jsxs)("div",{className:"MapSelector",children:[Object(p.jsx)("div",{className:e.mapSettings.atmosphere?"CircleButtonSelected":"CircleButton",children:Object(p.jsx)("img",{className:"MapIcon",draggable:"false",src:"./images/atmosphere.png",alt:"",onClick:()=>t({type:"toggle_atmosphere"})})}),Object(p.jsx)("div",{className:e.mapSettings.starfield?"CircleButtonSelected":"CircleButton",children:Object(p.jsx)("img",{className:"MapIcon",draggable:"false",src:"./images/starfield.png",alt:"",onClick:()=>t({type:"toggle_starfield"})})}),Object(p.jsx)("div",{className:"CircleButton",children:Object(p.jsx)(nr.Icon,{icon:wr.a,onClick:()=>t({type:"toggle_background"}),width:"50px"})}),Object(p.jsx)("div",{className:"CircleButton",children:Object(p.jsx)(nr.Icon,{icon:Rr.a,onClick:()=>t({type:"toggle_overlay"}),width:"50px"})}),Object(p.jsx)("div",{className:"CircleButton",children:Object(p.jsx)(nr.Icon,{icon:Or.a,onClick:()=>t({type:"toggle_projection"}),width:"50px"})})]})})},Lr=(r(73),r(41));var Ar=function(){const[e,t]=i.a.useContext(m);return Object(n.useEffect)((()=>{document.documentElement.style.setProperty("--color",e.appColor),document.documentElement.style.setProperty("--colort",e.appColor+"66")}),[e.appColor]),Object(p.jsx)("div",{className:"ColorSelector",children:Object(p.jsx)(Lr.a,{color:e.appColor,onChange:e=>{null!==e&&t({type:"set_color",value:e})},style:{height:"150px",width:"140px"}})})},Nr=(r(74),r(11)),Pr=r.n(Nr);var Ir=function(){Object(gr.a)(["0"],(()=>t({type:"set_dataset",value:[e.dataset,["s1a","s1b","s2a","s2b","s3a","s3b","s5p"]]}))),Object(gr.a)(["1"],(()=>t({type:"set_dataset",value:[e.dataset,["s1a","s1b"]]}))),Object(gr.a)(["2"],(()=>t({type:"set_dataset",value:[e.dataset,["s2a","s2b"]]}))),Object(gr.a)(["3"],(()=>t({type:"set_dataset",value:[e.dataset,["s3a","s3b"]]}))),Object(gr.a)(["5"],(()=>t({type:"set_dataset",value:[e.dataset,["s5p"]]})));const[e,t]=i.a.useContext(m);return Object(p.jsx)("div",{className:"DemSelectorContainer",children:Object(p.jsxs)("div",{className:"verticalContainer DemSelector",children:[Object(p.jsxs)("div",{className:"Selector horizontalContainer",children:[Object(p.jsx)(Pr.a,{id:"satellites",onChange:e=>{t({type:"toggle_satellites",value:e})},checked:e.mapSettings.satellites}),Object(p.jsx)("span",{className:"Label",children:"Satellites"})]}),Object(p.jsxs)("div",{className:"Selector horizontalContainer",children:[Object(p.jsx)(Pr.a,{id:"constellation",onChange:e=>{t({type:"set_constellation",value:[["s1a","s1b","s2a","s2b","s3a","s3b","s5p"],e]})},checked:e.mapSettings.constellation}),Object(p.jsx)("span",{className:"Label",children:"Constellation"})]}),Object(p.jsxs)("div",{className:"Selector horizontalContainer",children:[Object(p.jsx)(Pr.a,{id:"dem",onChange:e=>{t({type:"set_dem",value:e})},checked:e.mapSettings.dem}),Object(p.jsx)("span",{className:"Label",children:"Copernicus DEM"})]}),Object(p.jsxs)("div",{className:"Selector horizontalContainer",children:[Object(p.jsx)(Pr.a,{id:"starfield",onChange:e=>{t({type:"toggle_starfield"})},checked:e.mapSettings.starfield}),Object(p.jsx)("span",{className:"Label",children:"Stars and Planets"})]}),Object(p.jsxs)("div",{className:"Selector horizontalContainer",children:[Object(p.jsx)(Pr.a,{id:"atmosphere",onChange:e=>{t({type:"toggle_atmosphere"})},checked:e.mapSettings.atmosphere}),Object(p.jsx)("span",{className:"Label",children:"Sun and Atmosphere"})]}),Object(p.jsxs)("div",{className:"Selector horizontalContainer",children:[Object(p.jsx)(Pr.a,{id:"quicklooks",onChange:e=>{t({type:"toggle_quicklooks"})},checked:e.mapSettings.quicklooks}),Object(p.jsx)("span",{className:"Label",children:"Quicklooks"})]}),Object(p.jsxs)("div",{className:"Selector horizontalContainer",children:[Object(p.jsx)(Pr.a,{id:"lefthanded",onChange:e=>{t({type:"toggle_lefthanded"})},checked:e.leftHanded}),Object(p.jsx)("span",{className:"Label",children:"Left Handed UI"})]}),Object(p.jsx)("div",{height:"200px",flexgrow:"2",children:"\xa0"})]})})};r(76);var Mr=function(){const[e,t]=i.a.useContext(m),r=Object(n.useRef)(null),a=t=>{for(let r=0;r<e.collections.length;r++)if(e.collections[r].code===t)return e.collections[r];return e.collections[0]};return Object(n.useEffect)((()=>{console.log(e.dataset);let t=a(e.dataset);console.log(t),r.current.value=t.defaultFreetext?t.defaultFreetext:t.code}),[e.dataset]),Object(p.jsx)("div",{className:"FreeTextContainer",children:Object(p.jsx)("form",{onSubmit:n=>{if(n.preventDefault(),n.stopPropagation(),r.current.blur(),console.log(n),""==r.current.value){let t=a(e.dataset);r.current.value=t.defaultFreetext?t.defaultFreetext:t.code}t({type:"freetextsearch",value:r.current.value})},children:Object(p.jsxs)("label",{htmlFor:"freetext",className:"CollCode",children:[a(e.dataset).name,":",Object(p.jsx)("input",{ref:r,id:"freetext",className:"FreeText",type:"text",size:"20",style:{width:200}})]})})})};r(77);var kr=function(){const[e]=i.a.useContext(m);return Object(p.jsx)("div",{className:"GenericLabel",children:(e.altitude,e.altitude>=1e4?Math.floor(e.altitude/1e3)+" Km":Math.floor(e.altitude)+" m")})};r(78);var jr=function(){const[e]=i.a.useContext(m);return Object(p.jsx)("div",{className:"SearchLabel",children:0===e.resultDesc.totalLoaded?"":e.resultDesc.totalLoaded+"/"+e.resultDesc.totalResults})},Fr=r(97);r(79);function Ur(){const[e,t]=i.a.useContext(m),r=g(e.viewDate,200);Object(gr.a)(["="],(()=>a(e.searchWindow+864e5))),Object(gr.a)(["-"],(()=>a(e.searchWindow-864e5)));const a=r=>{let n=864e5,i="number"===typeof r?Math.max(r,864e5):r.target.value,a=Math.floor(i/n)*n,s=Math.floor(e.viewDate/a)*a;t({type:"set_searchWindow",value:{win:i,wins:s,wine:s+a}})};return Object(n.useEffect)((()=>{console.log("slider chnge"),a(e.searchWindow)}),[r]),Object(p.jsx)(Fr.a,{className:"Slider",min:864e5,max:864e7,"aria-label":"Search Window",value:"number"===typeof e.searchWindow?e.searchWindow:864e5,onChange:a,color:"secondary"})}var Gr=r(14),Br=r.n(Gr);r(83);var Vr=function(e){let{date:t,highlight:r,handleLabelClick:n}=e;return Object(p.jsxs)("div",{className:"LabelContainer",children:[Object(p.jsx)("span",{className:"year"===r?"Highlighted":"NotHighlighted",onClick:()=>n("year"),children:t.getUTCFullYear()}),"-",Object(p.jsx)("span",{className:"month"===r?"Highlighted":"NotHighlighted",onClick:()=>n("month"),children:Br()(t,"UTC:mmm").toUpperCase()}),"-",Object(p.jsx)("span",{className:"day"===r?"Highlighted":"NotHighlighted",onClick:()=>n("day"),children:Br()(t,"UTC:dd")}),Object(p.jsx)("span",{children:"\xa0\xa0\xa0"}),Object(p.jsx)("span",{className:"hour"===r?"Highlighted":"NotHighlighted",onClick:()=>n("hour"),children:Br()(t,"UTC:HH")}),":",Object(p.jsx)("span",{className:"minute"===r?"Highlighted":"NotHighlighted",onClick:()=>n("minute"),children:Br()(t,"UTC:MM")}),":",Object(p.jsx)("span",{className:"second"===r?"Highlighted":"NotHighlighted",onClick:()=>n("second"),children:Br()(t,"UTC:ss")}),Object(p.jsx)("span",{children:"\xa0\xa0"})]})};var Wr=r(43),zr=r(44),Hr=r(45),qr=r(46);function Kr(e,t){const[r,i]=Object(n.useState)(),a=Object(n.useRef)();return{handleTap:n=>{n.stopPropagation(),n.preventDefault();const s=Date.now();r&&s-r<300?(clearTimeout(a.current),t()):(i(s),a.current=setTimeout((()=>{e()}),300))}}}r(84);var Yr=function(e){let{startdate:t,onDateChange:r,onStateChange:i,animated:a,lefthanded:s}=e;const{date:o,speed:l,start:c,stop:u,reset:d,increaseSpeed:h,decreaseSpeed:g,forceDate:m}=function(e){let{initdate:t}=e;const[r,i]=Object(n.useState)(t),[a,s]=Object(n.useState)(1),[o,l]=Object(n.useState)(!1),c=Object(n.useRef)(),u=Object(n.useRef)();u.current=200;const d=Object(n.useRef)(),h=Object(n.useRef)(),g=Object(n.useRef)(),p=Object(n.useCallback)((()=>{console.log("start clock"),c.current||(c.current=u.current),o||(h.current=setInterval((()=>{d.current+=c.current,i(new Date(d.current))}),u.current)),l(!0)}),[]),m=Object(n.useCallback)((()=>{console.log("stop clock"),g.current&&clearTimeout(g.current),h.current&&clearInterval(h.current),l(!1)}),[]),f=Object(n.useCallback)((e=>{d.current=e.getTime(),i(new Date(d.current))}),[]);return{date:r,speed:a,playing:o,togglePause:function(){o?m():p()},start:p,stop:m,reset:function(){d.current=(new Date).getTime(),i(new Date(d.current))},increaseSpeed:function(){c.current=c.current>0?c.current*=2:c.current/=2,Math.abs(c.current)<u.current&&(c.current=u.current),console.log("step: "+c.current),s(c.current/200)},decreaseSpeed:function(){c.current=c.current>0?c.current/=2:c.current*=2,Math.abs(c.current)<u.current&&(c.current=-1*u.current),console.log("step: "+c.current),s(c.current/200)},forceDate:f}}({initdate:t}),[f,_]=Object(n.useState)(a);Object(gr.a)(["t"],(()=>{_((e=>!e))})),Object(gr.a)(["r"],(()=>{d()})),Object(gr.a)(["."],(()=>{h()})),Object(gr.a)([","],(()=>{g()})),Object(n.useEffect)((()=>{i(f),!0===f?c():u()}),[f,i,c,u]),Object(n.useEffect)((()=>{console.log("animated: "+a)}),[a]),Object(n.useEffect)((()=>{r(o)}),[o,r]),Object(n.useEffect)((()=>{null!==t&&m(t)}),[t,m]);const{handleTap:b}=Kr((()=>{_((e=>!e))}),d);return Object(p.jsxs)("div",{className:s?"DateControllerL":"DateController",children:[Object(p.jsx)("div",{className:l>0?"controlbutton shadow":"controlbutton shadow flipped",children:Object(p.jsx)(nr.Icon,{icon:f?qr.a:Hr.a,onClick:b,className:"controlbutton shadow"})}),Object(p.jsxs)("div",{className:s?"speedbarL":"speedbar",children:[Object(p.jsx)(nr.Icon,{icon:zr.a,onClick:g,className:"smallcontrolbutton shadow Backward",style:{display:f?"block":"none"}}),Object(p.jsxs)("span",{className:"Speed",style:{display:f?"block":"none"},children:["x",Math.abs(l)]}),Object(p.jsx)(nr.Icon,{icon:Wr.a,onClick:h,className:"smallcontrolbutton shadow Forward",style:{display:f?"block":"none"}})]})]})};r(30);var Qr=function(e){let{date:t,zoomfactor:r,resulttics:i,lefthanded:a,searchWinStart:s,searchWinEnd:o}=e;const l=Object(n.useRef)(0),c=Object(n.useRef)(null),[u,d]=Object(n.useState)(""),h=Object(n.useRef)(a),g=Object(n.useRef)(r),m=Object(n.useRef)(t),f=Object(n.useRef)(i),_=Object(n.useRef)(0),b=Object(n.useRef)(0),E=(e,t,r,n,i)=>{let a=c.current.getContext("2d");a.font="14px Arial",a.shadowColor="rgba(0,0,0,0.8",a.shadowOffsetX=1,a.shadowOffsetY=1,a.shadowBlur=2,a.clearRect(0,0,window.innerWidth,window.innerHeight);const s=["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"];function o(e,t){for(var r=""+e;r.length<t;)r="0"+r;return r}function u(e){return h.current?e+"L":e}let d,g,m,f,_=0,b=0,E=0,S=0,y=0,v=0,x=[],w=0,T=0;for(let c=0;c<l.current.offsetHeight;c+=1){let r=new Date((c-l.current.offsetHeight/2)*t+e.getTime());switch(d=r.getUTCDate(),g=r.getUTCMonth(),m=r.getUTCHours(),f=r.getUTCFullYear(),_=r.getUTCMinutes(),!0){case t<3e3:T=6e4,_!==v&&0!==c&&(0!==_||0!==m?x.push({class:u("HourTic"),pos:c,label:o(m,2)+":"+o(_,2)}):0===_&&0===m&&(x.push({class:u("DayTic_h"),pos:c,label:o(d,2)}),x.push({class:u("MonthTic_h2"),pos:c,label:s[g]})));break;case t<5e3:T=12e4,_!==v&&0!==c&&(0===_&&0===m||_%2!==0?0===_&&0===m&&(x.push({class:u("DayTic_h"),pos:c,label:o(d,2)}),x.push({class:u("MonthTic_h2"),pos:c,label:s[g]})):x.push({class:u("HourTic"),pos:c,label:o(m,2)+":"+o(_,2)}));break;case t<3e4:T=6e5,_!==v&&0!==c&&(0===_&&0===m||_%10!==0?0===_&&0===m&&(x.push({class:u("DayTic_h"),pos:c,label:o(d,2)}),x.push({class:"MonthTic_h2",pos:c,label:s[g]})):x.push({class:u("HourTic"),pos:c,label:o(m,2)+":"+o(_,2)}));break;case t<6e4:T=12e5,_!==v&&0!==c&&(0===_&&0===m||_%20!==0?0===_&&0===m&&(x.push({class:u("DayTic_h"),pos:c,label:o(d,2)}),x.push({class:u("MonthTic_h2"),pos:c,label:s[g]})):x.push({class:u("HourTic"),pos:c,label:o(m,2)+":"+o(_,2)}));break;case t<18e4:T=36e5,m!==y&&0!==c&&(0!==m?x.push({class:u("HourTic"),pos:c,label:o(m,2)+":00"}):(x.push({class:u("DayTic_h"),pos:c,label:o(d,2)}),x.push({class:u("MonthTic_h2"),pos:c,label:s[g]})));break;case t<42e4:T=108e5,m!==y&&0!==c&&(0!==m&&m%3===0?x.push({class:u("HourTic"),pos:c,label:o(m,2)+":00"}):0===m&&(x.push({class:u("DayTic_h"),pos:c,label:o(d,2)}),x.push({class:u("MonthTic_h2"),pos:c,label:s[g]})));break;case t<12e5:T=216e5,m!==y&&0!==c&&(0!==m&&m%6===0?x.push({class:u("HourTic"),pos:c,label:o(m,2)+":00"}):0===m&&(x.push({class:u("DayTic_h"),pos:c,label:o(d,2)}),x.push({class:u("MonthTic_h2"),pos:c,label:s[g]})));break;case t<18e5:T=864e5,d!==b&&0!==c&&(x.push({class:u("DayTic_h"),pos:c,label:o(d,2)}),x.push({class:u("MonthTic_h2"),pos:c,label:s[g]}));break;case t<42e5:T=864e5,d!==b&&0!==c&&(1!==d?x.push({class:u("DayTic"),pos:c,label:d}):(x.push({class:u("MonthTic_h"),pos:c,label:s[g]}),0===g&&x.push({class:u("YearTic_h2"),pos:c,label:f})));break;case t<288e5:T=432e6,d!==b&&0!==c&&(1!==d&&30!==d&&d%5===0?x.push({class:u("DayTic"),pos:c,label:d}):1===d&&(x.push({class:u("MonthTic_h"),pos:c,label:s[g]}),0===g&&x.push({class:u("YearTic_h2"),pos:c,label:f})));break;case t<1728e5:T=24192e5,g!==E&&0!==c&&(0!==g?x.push({class:u("MonthTic"),pos:c,label:s[g]}):(x.push({class:u("MonthTic_h"),pos:c,label:s[g]}),x.push({class:u("YearTic_h2"),pos:c,label:f})));break;case t<3456e5:T=72576e5,g!==E&&0!==c&&(0!==g&&11!==g&&g%3===0?x.push({class:u("MonthTic"),pos:c,label:s[g]}):0===g&&(x.push({class:u("MonthTic_h"),pos:c,label:s[g]}),x.push({class:u("YearTic_h2"),pos:c,label:f})));break;case t<7776e6:T=31104e6,f!==S&&0!==c&&(0!==g?x.push({class:u("MonthTic"),pos:c,label:s[g]}):x.push({class:u("YearTic"),pos:c,label:f}))}b=d,S=f,E=g,y=m,v=_,x.length!==w&&(c+=T/t-4),w=x.length}if(n&&i){let r=(n-e.getTime())/t+l.current.offsetHeight/2;a.font="30px Arial",a.fillStyle="green",a.fillRect(h.current?0:l.current.offsetWidth-4,r+5,4,(i-n)/t)}if(r){let n=-10;for(let i=r.length;i>=0;i-=1){let s=(r[i]-e.getTime())/t+l.current.offsetHeight/2;s>0&&s<l.current.offsetHeight&&(a.font="30px Arial",a.fillStyle="red",s-n>3&&(n=s,a.fillText(".",h.current?0:l.current.offsetWidth-8,s+5)))}}return x.map((e=>Object(p.jsx)("div",{className:e.class,style:{top:e.pos,opacity:1},children:e.label},e.class+e.pos)))};return Object(n.useEffect)((()=>{g.current=r,d(E(m.current,g.current,f.current,_.current,b.current))}),[r]),Object(n.useEffect)((()=>{m.current=t,d(E(m.current,g.current,f.current,_.current,b.current))}),[t]),Object(n.useEffect)((()=>{h.current=a,d(E(m.current,g.current,f.current,_.current,b.current))}),[a]),Object(n.useEffect)((()=>{f.current=i,f.current&&f.current.sort(((e,t)=>t-e)),d(E(m.current,g.current,f.current,_.current,b.current))}),[i]),Object(n.useEffect)((()=>{_.current=s,b.current=o,d(E(m.current,g.current,f.current,_.current,b.current))}),[s,o]),Object(n.useEffect)((()=>{const e=e=>{e.preventDefault(),e.stopPropagation(),d(E(m.current,g.current,f.current,_.current,b.current))};return window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}}),[]),Object(p.jsxs)("div",{children:[Object(p.jsx)("canvas",{ref:c,className:"DateSelectorCanvas",width:"{window.innerWidth}",height:window.innerHeight}),Object(p.jsx)("div",{ref:l,className:"DateSelectorScale",id:"DateSelectorScale",style:{fontSize:"14px"},children:u})]})};var Xr=function(e){let{startdate:t,tics:r,gotoscalezoom:i,onDateChange:a,onFinalDateChange:s,onStepChange:o,onZoomChange:l,satcycle:c,leftHanded:u,searchWinStart:d,searchWinEnd:h}=e;const g=1296e6,m=1e3,f=36e5,_=Object(n.useRef)(f),[b,E]=Object(n.useState)(f),S=Object(n.useRef)(),[y,v]=Object(n.useState)(t),x=Object(n.useRef)(!1),[w,T]=Object(n.useState)("hour"),R=Object(n.useRef)(),C=Object(n.useRef)(new Date(0)),O=Object(n.useRef)(),D=Object(n.useRef)(),L=Object(n.useRef)(t),A=Object(n.useRef)(t),N=Object(n.useRef)(c),P=Object(n.useRef)(c),[{posy_wheel:I},M]=Object(er.useSpring)((()=>({posy_wheel:0}))),[{zoom:k},j]=Object(er.useSpring)((()=>({zoom:0}))),[{test:F},U]=Object(er.useSpring)((()=>({test:0}))),G=Object(Jt.b)({onWheel:e=>{let{active:t,delta:r,first:n,down:i,direction:o,velocity:l,xy:c,movement:u,wheeling:d,ctrlKey:h,shiftKey:p}=e;n&&(U.stop(),A.current=y),h||p?j.start({zoom:r[1],immediate:!0,config:{mass:1,tension:100,friction:25,precision:.1},onChange:()=>{let e=_.current+_.current/300*k.get()*-1;e<m&&(e=m),e>g&&(e=g),E(e),_.current=e}}):M.start({posy_wheel:r[1],immediate:!0,config:{mass:1,tension:100,friction:40},onChange:()=>{let e;x.current=!0;let t=(I.get()<0?Math.ceil:Math.floor)(I.get()*b/P.current[0]);0===t&&M.stop(),"month"===w?(e=new Date(A.current.getTime()),e.setUTCMonth(e.getUTCMonth()-t)):e=new Date(A.current.getTime()-t*P.current[0]),A.current=e,v(e),a(e)},onRest:()=>{d||(s(A.current),x.current=!1)}})},onDragStart:()=>{x.current=!0},onDrag:e=>{let{event:t,active:r,first:n,down:i,touches:o,offset:l,delta:c,initial:u,distance:d,velocity:h,direction:g,shiftKey:p,ctrlKey:m,xy:f,movement:_,vxvy:E,wheeling:S}=e;t.preventDefault(),n&&(M.stop(),(e=>{const t=Date.now();D.current=e.button,R.current&&t-R.current<300?O.current=!0:(R.current=t,C.current=y,O.current=!1)})(t),L.current=A.current),h=h<.2?0:h,O.current||p||m||2===D.current?B(c,i,h,!1):U.start({test:i?_[1]:_[1]+_[1]*h*5,immediate:i,config:{mass:1,tension:100,friction:25,precision:.1},onChange:()=>{if(x.current=!0,Math.abs(_[1])>5&&(R.current=new Date(0)),"month"===w){let e=Math.ceil(F.get()*b/P.current[0]),t=new Date(L.current.getTime());t.setUTCMonth(t.getUTCMonth()-e),A.current=t}else A.current=new Date(L.current.getTime()-Math.ceil(F.get()*b/P.current[0])*P.current[0]);v(A.current),a(A.current)},onRest:()=>{i||(s(A.current),x.current=!1)}})},onDragEnd:e=>{s(A.current),x.current=!1}},{drag:{useTouch:!0}}),B=(e,t,r,n)=>{let i=1;t||(i=r<.2?0:.5),j.start({zoom:e[1],immediate:t,config:{mass:1,tension:100,friction:25,precision:.1},onChange:()=>{let e=_.current+_.current/50*k.get()*-1*i;e<m&&(e=m),e>g&&(e=g),E(e),_.current=e}})},[{xy2:V},W]=Object(er.useSpring)((()=>({xy2:[0,0]}))),z=Object(n.useCallback)((e=>{if(e.getTime()===A.current.getTime())return;let t=A.current.getTime(),r=[0,t-e.getTime()];W.start({from:{xy2:[0,0]},to:{xy2:r},immediate:!1,config:{reset:!0,duration:300},onChange:()=>{let e=new Date(t-V.get()[1]);A.current=e,v(e),a(e)},onRest:()=>{s(A.current)}})}),[]);return Object(n.useEffect)((()=>{x.current||z(t)}),[t,z]),Object(n.useEffect)((()=>{switch(console.log("gotoscalezoom: "+i),i&&(E(i),_.current=i),i){case"year":E(1029135270),_.current=1029135270;break;case"month":E(167184283),_.current=167184283;break;case"day":E(17046262),_.current=17046262;break;case"hour":E(735260),_.current=735260;break;case"minute":E(32276),_.current=32276;break;case"second":E(1058),_.current=1058}}),[i]),Object(n.useEffect)((()=>{o(w)}),[w,o]),Object(n.useEffect)((()=>{console.log("cycle changed to: "+c),N.current=c,"cycle"===w&&(console.log("new step"),P.current=[c])}),[c]),Object(n.useEffect)((()=>{switch(!0){case b>120426316:P.current=[26784e5,24192e5,26784e5,2592e6,26784e5,2592e6,26784e5,26784e5,2592e6,26784e5,2592e6,26784e5],T("month");break;case b>94544702:P.current=[N.current],T("cycle");break;case b>14544702:P.current=[864e5],T("day");break;case b>735259:P.current=[36e5],T("hour");break;case b>32274:P.current=[6e4],T("minute");break;default:P.current=[1e3],T("second")}l(b)}),[b]),Object(p.jsx)("div",{children:Object(p.jsxs)("div",{className:u?"DateSelectorL":"DateSelector",ref:S,children:[Object(p.jsx)("div",{...G(),className:u?"touchMaskL":"touchMask",children:" "}),Object(p.jsxs)("div",{className:"Mask",children:[Object(p.jsx)(Qr,{className:u?"scale lefthanded":"scale",date:y,zoomfactor:b,resulttics:r,lefthanded:u,searchWinStart:d,searchWinEnd:h}),Object(p.jsx)("div",{className:u?"TriangleContainerL":"TriangleContainer",children:Object(p.jsx)("svg",{height:"40",width:"20",className:"Triangle",children:Object(p.jsx)("polygon",{points:"20,5 20,35 12,20"})})})]})]})})};var Zr=function(e){let{onDateChange:t,onFinalDateChange:r,onStateChange:i,onStepChange:a,onZoomChange:s,animated:o,searching:l,startdate:c,tics:u,gotoscalezoom:d,cycle:h,leftHanded:g,searchWinStart:m,searchWinEnd:f,searchDate:_}=e;const[b,E]=Object(n.useState)(c),[S,y]=Object(n.useState)(c),[v,x]=Object(n.useState)(d),[w,T]=Object(n.useState)(1),R=Object(n.useCallback)((e=>{y(e),t(e)}),[t]),C=Object(n.useCallback)((e=>{r(e)}),[r]),O=Object(n.useCallback)((e=>{E(e)}),[]),D=Object(n.useCallback)((e=>{a(e),T(e)}),[]),L=Object(n.useCallback)((e=>{s(e)}),[]),A=Object(n.useCallback)((e=>{console.log(e),x(e)}),[]);return Object(p.jsxs)("div",{children:[Object(p.jsx)(Yr,{startdate:c,onDateChange:O,onStateChange:i,animated:o,lefthanded:g}),Object(p.jsx)(Vr,{date:S,highlight:w,handleLabelClick:A}),Object(p.jsx)(Xr,{startdate:b,tics:u,gotoscalezoom:v,satcycle:h,onDateChange:R,onFinalDateChange:C,onStepChange:D,onZoomChange:L,leftHanded:g,searchWinStart:m,searchWinEnd:f})]})};var $r=function(){const[e,t]=i.a.useContext(m),[r,a]=Object(n.useState)(e.tics),[s,o]=Object(n.useState)(new Date(e.goToDate)),l=Object(n.useCallback)((e=>{t({type:"set_searchDate",value:e})}),[t]),c=Object(n.useCallback)((e=>{t({type:"set_viewDate",value:e})}),[t]),u=Object(n.useCallback)((e=>{t({type:"set_animated",value:e})}),[t]),d=Object(n.useCallback)((e=>{t({type:"set_zoomscale",value:e})}),[t]),h=Object(n.useCallback)((e=>{t({type:"set_step",value:e})}),[t]);return Object(n.useEffect)((()=>{o(null===e.goToDate?null:new Date(e.goToDate))}),[e.goToDate]),Object(p.jsx)(Zr,{onDateChange:c,onFinalDateChange:l,onStepChange:h,onZoomChange:d,startdate:s,tics:e.tics,gotoscalezoom:e.zoomScale,onStateChange:u,animated:e.animated,cycle:e.cycle,searching:e.searching,leftHanded:e.leftHanded,searchWinStart:e.searchWinStart,searchWinEnd:e.searchWinEnd})},Jr=(r(85),r(16)),en=r.n(Jr);function tn(e){let t=[];try{e.features?Array.isArray(e.features)&&(console.log("features is an  array"),t=e.features.map((e=>function(e){try{var t=null,r=null;for(let n=0;n<e.properties.link.length;n++)"Download"===e.properties.link[n]["@"].title&&(t=e.properties.link[n]["@"].href),"Quicklook"===e.properties.link[n]["@"].title&&(r=e.properties.link[n]["@"].href);return{id:e.id,geometry:e.geometry,type:"Feature",properties:{updated:e.properties.updated,title:e.properties.title,name:e.properties.title,uuid:e.properties.identifier,date:e.properties.date,downloadUrl:t,quicklookUrl:r,earthObservation:{parentIdentifier:e.properties.EarthObservation.metaDataProperty.EarthObservationMetaData.parentIdentifier,status:"ARCHIVED",acquisitionInformation:[{platform:{platformShortName:e.properties.EarthObservation.procedure.EarthObservationEquipment.platform.Platform.shortName,platformSerialIdentifier:null},sensor:{instrument:e.properties.EarthObservation.procedure.EarthObservationEquipment.instrument.Instrument.shortName,operationalMode:e.properties.EarthObservation.procedure.EarthObservationEquipment.sensor.Sensor.operationalMode},acquisitionParameter:{acquisitionStartTime:new Date(e.properties.EarthObservation.phenomenonTime.TimePeriod.beginPosition),acquisitionStopTime:new Date(e.properties.EarthObservation.phenomenonTime.TimePeriod.endPosition),relativePassNumber:null,orbitNumber:e.properties.EarthObservation.procedure.EarthObservationEquipment.acquisitionParameters.Acquisition.orbitNumber,startTimeFromAscendingNode:null,stopTimeFromAscendingNode:null,orbitDirection:e.properties.EarthObservation.procedure.EarthObservationEquipment.acquisitionParameters.Acquisition.orbitDirection}}],productInformation:{productType:e.properties.EarthObservation.metaDataProperty.EarthObservationMetaData.productType,downloadUrl:t,quicklookUrl:r,size:null}}}}}catch(n){return console.log("error parsing item from dhus: "+n.message),{}}}(e))).filter((e=>e!=={}))):t=[]}catch(r){console.log(e),console.log("Error: "),console.log(r),t=[]}return{type:"FeatureCollection",id:"search",properties:{totalResults:e.properties.totalResults,startIndex:e.properties.startIndex,itemsPerPage:e.properties.itemsPerPage,title:e.properties.title,updated:e.properties.updated},features:t}}function rn(e,t){let r=[];console.log(e.features);try{e.features?Array.isArray(e.features)&&(console.log("features is an  array"),r=e.features.map((e=>function(e){console.log(e);try{let t={};return t=null==e.geometry?{type:"Point",coordinates:[0,0]}:e.geometry,{id:e.id,geometry:t,type:"Feature",properties:{updated:null,title:e.properties.Name.string,name:e.properties.Name.string,uuid:e.id,date:e.properties.date,downloadUrl:null,quicklookUrl:null,earthObservation:{parentIdentifier:null,status:"ARCHIVED",acquisitionInformation:[{acquisitionParameter:{acquisitionStartTime:new Date(e.properties.ContentDate.Start),acquisitionStopTime:new Date(e.properties.ContentDate.End),startTimeFromAscendingNode:null,stopTimeFromAscendingNode:null,orbitDirection:null}}],productInformation:{quicklookUrl:null,size:null}}}}}catch(t){return console.log("error parsing item from rs stac: "+t.message),{}}}(e))).filter((e=>e!=={}))):r=[]}catch(n){console.log(e),console.log("Error: "),console.log(n),r=[]}return{type:"FeatureCollection",id:"search",properties:{totalResults:e.features.length,startIndex:t,itemsPerPage:e.features.length,title:"stac search",updated:null},features:r}}function nn(e,t){let r=[];try{r=Array.isArray(e.value)?e.value.filter((e=>null!==e)).map((e=>function(e){try{let t={type:"Point",coordinates:[0,0]},r=e.GeoFootprint?e.GeoFootprint:t;return{id:e.Id,geometry:r,type:"Feature",properties:{updated:new Date(e.PublicationDate),title:e.Name,name:e.Name,uuid:e.Id,date:e.ContentDate.Start+"/"+e.ContentDate.End,downloadUrl:null,quicklookUrl:e.Assets[0].DownloadLink,earthObservation:{parentIdentifier:"",status:"ARCHIVED",acquisitionInformation:[{platform:{platformShortName:"any",platformSerialIdentifier:"any"},sensor:{instrument:"any",operationalMode:"any"},acquisitionParameter:{acquisitionStartTime:new Date(e.ContentDate.Start),acquisitionStopTime:new Date(e.ContentDate.End),relativePassNumber:0,orbitNumber:0,startTimeFromAscendingNode:null,stopTimeFromAscendingNode:null,orbitDirection:null}}],productInformation:{productType:null,tile:null,size:e.ContentLength}}}}}catch(t){return console.log("error parsing item from PRIP: "+t.message),null}}(e))).filter((e=>null!==e)):[]}catch(n){console.log(e),console.log("Error: "),console.log(n)}return{type:"FeatureCollection",id:"search",properties:{totalResults:e["@odata.count"]-(e.value.length-r.length),startIndex:t,itemsPerPage:e.value.length,title:"PRIP search response",updated:new Date},features:r}}function an(e,t){let r=[];try{e.features?Array.isArray(e.features)&&(r=e.features.map((e=>function(e){try{var t=e.assets.QUICKLOOK?e.assets.QUICKLOOK.href:null;let r={};return r=null==e.geometry?{type:"Point",coordinates:[0,0]}:e.geometry,{id:e.id,geometry:r,type:"Feature",properties:{updated:null,title:e.id,name:e.id,uuid:e.id,date:e.properties.start_datetime,downloadUrl:null,quicklookUrl:t,earthObservation:{parentIdentifier:null,status:"ARCHIVED",acquisitionInformation:[{acquisitionParameter:{acquisitionStartTime:new Date(e.properties.start_datetime),acquisitionStopTime:new Date(e.properties.end_datetime),relativePassNumber:e.properties.relativeOrbitNumber,orbitNumber:e.properties.orbitNumber,orbitDirection:e.properties.orbitDirection,startTimeFromAscendingNode:null,stopTimeFromAscendingNode:null,orbitDirection:null}}],productInformation:{productType:e.properties.productType,quicklookUrl:null,size:null}}}}}catch(r){return console.log("error parsing item from cdse stac: "+r.message),{}}}(e))).filter((e=>e!={}))):r=[]}catch(n){console.log("Error: "),console.log(e),console.log(n),r=[]}return{type:"FeatureCollection",id:"search",properties:{totalResults:0==e.features.length?0:1e3,startIndex:t,itemsPerPage:e.features.length,title:"CDSE Stac search",updated:null},features:r}}function sn(e,t){let r=[];try{r=Array.isArray(e.value)?e.value.filter((e=>null!==e)).map((e=>function(e){try{let t={type:"Point",coordinates:[0,0]},r=e.Footprint?e.Footprint:t;return{id:e.Id,geometry:r,type:"Feature",properties:{updated:new Date(e.PublicationDate),title:e.Name,name:e.Name,uuid:e.Id,date:e.ContentDate.Start+"/"+e.ContentDate.End,downloadUrl:null,quicklookUrl:"https://processing.platform.ops-csc.com/odata/v1/Products("+e.Id+")/Quicklooks('"+e.Name.slice(0,-4)+"_bwi.png')/$value",earthObservation:{parentIdentifier:"",status:"ARCHIVED",acquisitionInformation:[{platform:{platformShortName:"any",platformSerialIdentifier:"any"},sensor:{instrument:"any",operationalMode:"any"},acquisitionParameter:{acquisitionStartTime:new Date(e.ContentDate.Start),acquisitionStopTime:new Date(e.ContentDate.End),relativePassNumber:0,orbitNumber:0,startTimeFromAscendingNode:null,stopTimeFromAscendingNode:null,orbitDirection:null}}],productInformation:{productType:null,tile:null,size:e.ContentLength}}}}}catch(t){return console.log("error parsing item from PRIP: "+t.message),null}}(e))).filter((e=>null!==e)):[]}catch(n){console.log(e),console.log("Error: "),console.log(n)}return{type:"FeatureCollection",id:"search",properties:{totalResults:e["@odata.count"]-(e.value.length-r.length),startIndex:t,itemsPerPage:e.value.length,title:"PRIP search response",updated:new Date},features:r}}function on(e,t){let r=[];console.log(e.value);try{Array.isArray(e.value)?(console.log(e.value[0]),r=e.value.filter((e=>null!==e)).map((e=>function(e){try{let t={};return t=null==e.GeoFootprint?{type:"Point",coordinates:[0,0]}:e.GeoFootprint,{id:e.Id,geometry:t,type:"Feature",properties:{updated:new Date(e.PublicationDate),title:e.Name,name:e.Name,uuid:e.Id,date:e.ContentDate.Start+"/"+e.ContentDate.End,downloadUrl:null,quicklookUrl:null,earthObservation:{parentIdentifier:"",status:"ARCHIVED",acquisitionInformation:[{platform:{platformShortName:"any",platformSerialIdentifier:"any"},sensor:{instrument:"any",operationalMode:"any"},acquisitionParameter:{acquisitionStartTime:new Date(e.ContentDate.Start),acquisitionStopTime:new Date(e.ContentDate.End),relativePassNumber:0,orbitNumber:0,startTimeFromAscendingNode:null,stopTimeFromAscendingNode:null,orbitDirection:null}}],productInformation:{productType:null,tile:null,size:e.ContentLength}}}}}catch(t){return console.log("error parsing item from LTA: "+t.message),null}}(e))).filter((e=>null!==e))):r=[]}catch(n){console.log(e),console.log("Error: "),console.log(n)}return{type:"FeatureCollection",id:"search",properties:{totalResults:e["@odata.count"]-(e.value.length-r.length),startIndex:t,itemsPerPage:e.value.length,title:"LTA search response",updated:new Date},features:r}}function ln(){const e=Object(n.useRef)(null),[t,r]=Object(n.useState)(null),[i,a]=Object(n.useState)(!1),[s,o]=Object(n.useState)(-1),[l,c]=Object(n.useContext)(m),{fetchURL:u,init_fetcher:d,abort_fetchURL:h}=(Object(n.useRef)(null),hr()),g=async(t,n,i,s,l)=>{a(!0),e.current=new AbortController;let c=t;c=c.replace("{startindex}",n),c=c.replace("{pagesize}",100);let d=Math.ceil(n/100);c=c.replace("{page}",d),console.log("Search: "+c);let h,p={totalresults:0,startindex:0,itemsperpage:0},m=i.grantType?i.tokenEndpoint.split("/",3).join("/").length:0,f=i.grantType?i.tokenEndpoint.substring(0,m):null,_=i.grantType?i.tokenEndpoint.substring(m):null,b=i.grantType;try{h=await u(c,f,_,b,s,l)}catch(E){return console.log(E.message),"Error: 401"==E.message&&o(Math.random()),void a(!1)}if(!h)return o(-1),a(!1),null;try{const e=await h.json();let o;switch(console.log("Response:"),console.log(e),i.type){case"DHUS":console.log("Mapping DHUS/OpenSearch:"),o=function(e){function t(e){let t=e.slice(e.indexOf("<gml:coordinates>")+17,e.indexOf("</gml:coordinates>")).replaceAll(","," ").split(" "),r="MULTIPOLYGON(((";for(let n=0;n<t.length;n+=2)r=r+t[n+1]+" "+t[n]+",";return r=r.slice(0,-1),r+=")))",r}function r(e){function r(e){let t={};if(Array.isArray(e))for(let r=0;r<e.length;r++)t[e[r].name]=e[r].content;else t[e.name]=e.content;return t}try{let a={};e.date&&Object.assign(a,r(e.date)),e.int&&Object.assign(a,r(e.int)),e.double&&Object.assign(a,r(e.double)),e.str&&Object.assign(a,r(e.str));var n,i=a.size.split(" ");switch(i[1]){case"B":default:n=Math.round(parseFloat(i[0]));break;case"MB":n=Math.round(1024*parseFloat(i[0]));break;case"GB":n=Math.round(1024*parseFloat(i[0])*1024);break;case"TB":n=Math.round(1024*parseFloat(i[0])*1024*1024)}return{id:e.title,geometry:en()(t(a.gmlfootprint)),type:"Feature",properties:{updated:new Date(a.ingestiondate),title:e.title,name:e.title,uuid:e.id,date:a.beginposition+"/"+a.endposition,downloadUrl:e.link[0].href,quicklookUrl:e.link.length>=2?e.link[2].href:null,earthObservation:{parentIdentifier:"",status:"ARCHIVED",acquisitionInformation:[{platform:{platformShortName:a.platformname,platformSerialIdentifier:a.platformserialidentifier},sensor:{instrument:a.instrumentshortname,operationalMode:a.sensoroperationalmode},acquisitionParameter:{acquisitionStartTime:new Date(a.beginposition),acquisitionStopTime:new Date(a.endposition),relativePassNumber:parseInt(a.relativeorbitnumber),orbitNumber:parseInt(a.orbitnumber),startTimeFromAscendingNode:null,stopTimeFromAscendingNode:null,orbitDirection:a.orbitdirection}}],productInformation:{productType:a.producttype,tile:a.tileid,size:n,cloudCoverPercentage:a.cloudcoverpercentage}}}}}catch(E){return console.log("error parsing item from dhus: "+E.message),{}}}let n=[];try{n=e.feed.entry?Array.isArray(e.feed.entry)?e.feed.entry.map((e=>r(e))).filter((e=>e!=={})):[r(e.feed.entry)]:[]}catch(E){console.log(e),console.log("Error: "),console.log(E),n=[]}return{type:"FeatureCollection",id:"search",properties:{totalResults:e.feed["opensearch:totalResults"],startIndex:e.feed["opensearch:startIndex"]?e.feed["opensearch:startIndex"]:1,itemsPerPage:e.feed["opensearch:itemsPerPage"],title:"DHuS search response",updated:new Date},features:n}}(e);break;case"PRIP":console.log("Mapping RS/PRIP:"),o=sn(e,n);break;case"EOCAT":console.log("Mapping EOCAT:"),o=tn(e);break;case"STAC":console.log("Mapping RS/STAC:"),o=rn(e,n);break;case"CDSEOdata":console.log("Mapping CDSE/DDIP:"),o=nn(e,n);break;case"CDSEStac":console.log("Mapping CDSE/STAC:"),o=an(e,n);break;case"LTA":console.log("Mapping LTA/AUXIP:"),o=on(e,n);break;default:a(!1)}console.log(o),p={totalresults:null==o.properties.totalResults?1e3:Number(o.properties.totalResults),startindex:Number(o.properties.startIndex),itemsperpage:Number(o.properties.itemsPerPage)},p.totalresults>0&&r(o),p.startindex+p.itemsperpage<Math.min(p.totalresults,1e3)&&0!=p.itemsperpage?(console.log("There's More..."),g(t,p.startindex+p.itemsperpage,i,s,l)):(console.log("Finished..."),a(!1))}catch(E){console.log("Didn't receive a json !"),console.log(E),a(!1),o(-1)}};return{geojsonResults:t,loading:i,status:s,search:t=>{let r,{dataset:n,freetext:a,searchpoint:s,windowStart:o,windowEnd:l,credentials:c}=t,u="";if(!n||0==o)return console.log("No dataset to search"),null;i&&e.current.abort(),o&&l&&(r=new Date(o).toJSON(),u=new Date(l-1e3).toJSON());let d=(e=>{let{dataset:t,polygon:r,start:n,end:i,freetext:a}=e;if(console.log(n+"   /   "+i),!t)return null;let s=t.templateUrl;return s=null!=r?s.replace("{polygon}",r):s.replace(t.areaOff,""),null!=n&&null!=i?(s=s.replace("{start}",n),s=s.replace("{end}",i)):s=s.replace(t.dateOff,""),s=null!=a&&""!=a?s.replace("{freetext}",a):s.replace("{freetext}",t.defaultFreetext),s})({dataset:n,polygon:s,start:r,end:u,freetext:a}),h=n.startIndexOrigin,p=n.tokenEndpoint,m=((e,t)=>{for(let r=0;r<t.length;r++)if(t[r].key===e)return{user:t[r].user,pass:t[r].pass};return{user:"",pass:""}})(d.split("/")[2],c);g(d,h,n,m.user,m.pass,p)},abort:()=>{e&&e.current&&h()}}}var cn=r(47);var un=function(e){let{searchdate:t,searchpoint:r,searchmode:i,searchWinStart:a,searchWinEnd:s,credentials:o,dataset:l,animated:c,searching:u,freetext:d,trigger:h,altitude:g,onClearResult:m,onSearchStart:f,onPageSearch:_,onSearchComplete:b,on401:E,lefthanded:S}=e;const[y,v]=Object(n.useState)(0),x=Object(n.useRef)(new Date(0)),w=Object(n.useRef)(new Date),T=Object(n.useRef)(0),R=Object(n.useRef)(0),[C,O]=Object(n.useState)({}),{geojsonResults:D,loading:L,status:A,search:N,abort:P}=ln(),{handleTap:I}=Kr((()=>{v(Math.random())}),m);return Object(gr.a)(["x"],(()=>v(Math.random()))),Object(n.useEffect)((()=>{v(Math.random())}),[h]),Object(n.useEffect)((()=>{if(D){let e=new Date(D.features[0].properties.earthObservation.acquisitionInformation[0].acquisitionParameter.acquisitionStartTime);(x.current.getTime()<e.getTime()||null===x.current)&&(x.current=e);let t=new Date(D.features[D.features.length-1].properties.earthObservation.acquisitionInformation[0].acquisitionParameter.acquisitionStartTime);(w.current.getTime()>t.getTime()||null===t.current)&&(w.current=t),R.current+=D.features.length,T.current=Number(D.properties.totalResults);let r={totalResults:T.current,totalLoaded:R.current};_(D,r)}}),[D]),Object(n.useEffect)((()=>{!1===L&&b({firstResultDate:x.current,lastResultDate:w.current,totalResults:T.current,totalLoaded:R.current})}),[L]),Object(n.useEffect)((()=>{console.log("status: "),console.log(A),-1!==A&&E(l)}),[A]),Object(n.useEffect)((()=>{y&&0!=y&&(L&&!c?(console.log("aborting current search"),P()):(c&&P(),x.current=new Date(0),w.current=new Date,R.current=0,T.current=0,f(),N(C)))}),[y]),Object(n.useEffect)((()=>{console.log("should reset token")}),[l]),Object(n.useEffect)((()=>{console.log("search param changed:");let e=new Date(t),n=r;"global"===i?n=null:e=null,O((e=>({...e,dataset:l,freetext:d,searchpoint:n,windowStart:a,windowEnd:s,credentials:o})))}),[l,d,r,i,a,s,o]),Object(n.useEffect)((()=>{console.log("auto search"),c&&v(Math.random())}),[a,s]),Object(p.jsx)("div",{className:(!0===u?"SearchController Active":"SearchController")+(S?" lefthanded":""),onClick:I,children:Object(p.jsx)(nr.Icon,{icon:cn.a,width:"50px"})})};var dn=()=>{const[e,t]=i.a.useContext(m),r=g(e.searchPoint,200),a=g(e.altitude,200),s=Object(n.useCallback)(((e,r)=>{t({type:"onResultPage",value:{resultdesc:r,results:e}})}),[t]),o=Object(n.useCallback)((()=>{t({type:"onSearchStart",value:Math.random()})}),[t]),l=Object(n.useCallback)((()=>{t({type:"clearResult"})}),[t]),c=Object(n.useCallback)((e=>{t({type:"onSearchComplete",value:e})}),[t]),u=Object(n.useCallback)((r=>{console.log(r);let n=r.templateUrl.split("/")[2],i=(t=>{for(let r=0;r<e.credentials.length;r++)if(e.credentials[r].key===t)return{user:e.credentials[r].user,pass:e.credentials[r].pass};return{user:"",pass:""}})(n);console.log(n);let a=window.prompt("Please enter your username for \n"+n,i.user?i.user:""),s=window.prompt("Please enter your password for \n"+n,i.pass?i.pass:"");t({type:"set_credentials",value:{key:n,user:a,pass:s}})}),[t]);return Object(p.jsx)(un,{searchdate:e.searchDate,searchpoint:r,searchmode:e.searchMode,searchWinStart:e.searchWinStart,searchWinEnd:e.searchWinEnd,dataset:(t=>{for(let r=0;r<e.collections.length;r++)if(e.collections[r].code===t)return e.collections[r];return null})(e.dataset),animated:e.animated,searching:e.searching,freetext:e.freetext,trigger:e.searchtrigger,credentials:e.credentials,altitude:a,onClearResult:l,onSearchStart:o,onPageSearch:s,onSearchComplete:c,on401:u,lefthanded:e.leftHanded})},hn=r(98);r(86);var gn=function(){const[e]=i.a.useContext(m);return Object(p.jsx)("div",{className:"ProductInfo Small",children:e.closestItem?e.closestItem.closest.userProperties.title:""})};var pn=function(){const e=Object(n.useRef)(),{toggle:t}=Object(hn.a)();return Object(gr.a)(["f"],(r=>{"BODY"===r.target.tagName&&t(e.current)})),Object(p.jsx)(_,{children:Object(p.jsxs)("div",{className:"App",ref:e,id:"container",children:[Object(p.jsx)(pr,{id:"globe"}),Object(p.jsx)($r,{}),Object(p.jsx)(br,{}),Object(p.jsx)(Mr,{}),Object(p.jsx)(Ur,{}),Object(p.jsx)(yr,{}),Object(p.jsx)(dn,{}),Object(p.jsx)(fr,{active:"false",children:Object(p.jsxs)("div",{className:"horizontalContainer",children:[Object(p.jsx)(vr,{}),Object(p.jsx)(Dr,{}),Object(p.jsxs)("div",{className:"horizontalContainer",children:[Object(p.jsx)(Ar,{}),Object(p.jsx)(Ir,{})]})]})}),Object(p.jsx)(kr,{}),Object(p.jsxs)(_r,{children:[Object(p.jsx)(jr,{}),Object(p.jsx)(gn,{})]})]})})};s.a.render(Object(p.jsx)(i.a.StrictMode,{children:Object(p.jsx)(pn,{})}),document.getElementById("root"))}},[[87,1,2]]]);
//# sourceMappingURL=main.bc2c0b19.chunk.js.map