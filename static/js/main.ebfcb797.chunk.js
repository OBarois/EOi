(this.webpackJsonpeoi=this.webpackJsonpeoi||[]).push([[0],{100:function(e,t,r){},101:function(e,t,r){"use strict";r.r(t);var n=r(0),i=r.n(n),a=r(28),o=r.n(a),s=(r(62),r(5)),l=r(4),c=function(e,t){switch(t.type){case"toggle_names":return console.log("togglename!"),Object(l.a)(Object(l.a)({},e),{},{mapSettings:Object(l.a)(Object(l.a)({},e.mapSettings),{},{names:!e.mapSettings.names})});case"toggle_starfield":return console.log("togglename!"),Object(l.a)(Object(l.a)({},e),{},{mapSettings:Object(l.a)(Object(l.a)({},e.mapSettings),{},{starfield:!e.mapSettings.starfield})});case"toggle_atmosphere":return console.log("togglename!"),Object(l.a)(Object(l.a)({},e),{},{mapSettings:Object(l.a)(Object(l.a)({},e.mapSettings),{},{atmosphere:!e.mapSettings.atmosphere})});case"toggle_background":return console.log("togglename!"),Object(l.a)(Object(l.a)({},e),{},{mapSettings:Object(l.a)(Object(l.a)({},e.mapSettings),{},{background:e.mapSettings.background+1})});case"toggle_overlay":return console.log("toggleoverlay!"),Object(l.a)(Object(l.a)({},e),{},{mapSettings:Object(l.a)(Object(l.a)({},e.mapSettings),{},{overlay:e.mapSettings.overlay+1})});case"toggle_projection":return console.log("toggleprojection!"),Object(l.a)(Object(l.a)({},e),{},{mapSettings:Object(l.a)(Object(l.a)({},e.mapSettings),{},{projection:e.mapSettings.projection+1})});case"set_mission":return console.log("set mission!"),Object(l.a)(Object(l.a)({},e),{},{mission:t.value});case"set_dem":return Object(l.a)(Object(l.a)({},e),{},{mapSettings:Object(l.a)(Object(l.a)({},e.mapSettings),{},{dem:t.value})});case"toggle_satellites":return Object(l.a)(Object(l.a)({},e),{},{mapSettings:Object(l.a)(Object(l.a)({},e.mapSettings),{},{satellites:!e.mapSettings.satellites})});case"toggle_quicklooks":return Object(l.a)(Object(l.a)({},e),{},{mapSettings:Object(l.a)(Object(l.a)({},e.mapSettings),{},{quicklooks:!e.mapSettings.quicklooks})});case"set_altitude":return Object(l.a)(Object(l.a)({},e),{},{altitude:t.value,productOn:t.value>e.pointSearchMaxAltitude||e.productOn,searchMode:t.value>e.pointSearchMaxAltitude?"global":"point"});case"onResultPage":return console.log("onResultPage"),console.log(t.value),Object(l.a)(Object(l.a)({},e),{},{resultDesc:t.value.resultdesc,geojson:t.value.results});case"onSearchStart":return console.log("onSearchStart"),console.log(t.value),Object(l.a)(Object(l.a)({},e),{},{tics:[],clearResultsTrigger:Math.random(),resultDesc:{totalResults:0,totalLoaded:0},closestItem:null,browseMode:e.searchMode,searching:!0});case"onSearchComplete":return console.log("onSearchComplete"),console.log(t.value),e.altitude,e.pointSearchMaxAltitude,Object(l.a)(Object(l.a)({},e),{},{resultDesc:t.value,searching:!1});case"set_selectedProduct":return console.log("set_selectedProduct:"),null!=e.selectedProduct&&t.value===e.selectedProduct?Object(l.a)(Object(l.a)({},e),{},{selectedProduct:t.value,goToDate:t.value?t.value.timeRange[0].getTime():null,productOn:!1,addQuicklookWMSTrigger:Math.random()}):Object(l.a)(Object(l.a)({},e),{},{selectedProduct:t.value,goToDate:t.value?t.value.timeRange[0].getTime():null});case"set_closestitem":return t.value?Object(l.a)(Object(l.a)({},e),{},{closestItem:t.value}):e;case"set_tics":return Object(l.a)(Object(l.a)({},e),{},{tics:t.value});case"set_filter":return console.log("toggle_filter"),null===e.closestItem?e:(console.log(e.filter.length),console.log(e.mission),0===e.filter.length?(e.mission.indexOf("S1")<0&&(console.log("filter S1"),r=[{attribute:"relativePassNumber",value:e.closestItem.userProperties.earthObservation.acquisitionInformation[0].acquisitionParameter.relativePassNumber}]),e.mission.indexOf("S2")<0&&(r=[{attribute:"relativePassNumber",value:e.closestItem.userProperties.earthObservation.acquisitionInformation[0].acquisitionParameter.relativePassNumber}])):r=[],Object(l.a)(Object(l.a)({},e),{},{filter:r}));var r;case"gotoclosestitem":return null==e.closestItem||null==e.closestItem._sector?e:(console.log(e),Object(l.a)(Object(l.a)({},e),{},{goToDate:e.closestItem.timeRange[0].getTime(),goToPos:{lat:e.closestItem._sector.minLatitude,lon:e.closestItem._sector.minLongitude,alt:e.altitude}}));case"set_goToDate":return console.log("set_goToDate"),console.log(t.value),null===t.value?e:Object(l.a)(Object(l.a)({},e),{},{goToDate:t.value.getTime()});case"set_searchDate":return console.log("set_searchDate"),console.log(t.value),Object(l.a)(Object(l.a)({},e),{},{searchDate:t.value.getTime(),goToDate:t.value.getTime()});case"set_animated":return console.log("set_animated"),Object(l.a)(Object(l.a)({},e),{},{animated:t.value});case"set_color":return console.log("set_color: "+t.value),Object(l.a)(Object(l.a)({},e),{},{appColor:t.value});case"set_viewDate":return Object(l.a)(Object(l.a)({},e),{},{viewDate:t.value.getTime(),productOn:!0});case"clear_results":return console.log("clear_results"),Object(l.a)(Object(l.a)({},e),{},{tics:[],resultDesc:{totalResults:0,totalLoaded:0},clearResultsTrigger:Math.random()});case"set_searchPoint":return Object(l.a)(Object(l.a)({},e),{},{searchPoint:t.value});case"set_zoomscale":return Object(l.a)(Object(l.a)({},e),{},{zoomScale:t.value});case"set_position":return Object(l.a)(Object(l.a)({},e),{},{position:{clon:t.value.lon,clat:t.value.lat}});case"set_credentials":return console.log(t.value),Object(l.a)(Object(l.a)({},e),{},{credentials:t.value});case"reset_credentials":return console.log("reset credentials"),Object(l.a)(Object(l.a)({},e),{},{credentials:{user:"",pass:""}});default:return e}},u=new Date,d={active:!1,searching:!1,mission:"S1A",altitude:"5000000",appColor:"#b575c5",position:{clon:"0.5",clat:"45"},viewDate:u.getTime(),goToDate:u.getTime(),goToPos:{lat:0,lon:0},searchDate:null,credentials:{user:"",pass:""},resetStartDateTrigger:null,pointSearchMaxAltitude:3e6,selectedProduct:null,searchPoint:"POINT(40 0)",searchMode:"global",browseMode:"global",geojson:null,filter:[],closestItem:null,tics:[],addQuicklookWMSTrigger:null,moveToClosestItemTrigger:null,resultDesc:{firstItemDate:null,lastItemDate:null,totalResults:0,totalLoaded:0},animated:!1,clearResultsTrigger:null,mapSettings:{atmosphere:!1,starfield:!1,names:!1,background:0,overlay:1,dem:!1,satellites:!1,quicklooks:!0,projection:0},collections:[{code:"S1",templateUrl:'https://scihub.copernicus.eu/dhus/search?q=( footprint:"Intersects({polygon})" AND beginposition:[{start} TO {end}] AND platformname:Sentinel-1 AND producttype:GRD)&start={startindex}&rows=100&orderby=beginposition desc&format=json',name:"Sentinel-1 GRD",logo:"./images/s1_black.png",type:"DHUS",startIndexOrigin:0,dateOff:" beginposition:[{start} TO {end}] AND",areaOff:' footprint:"Intersects({polygon})" AND',windowSize:648e5},{code:"S1A",templateUrl:'https://scihub.copernicus.eu/dhus/search?q=( footprint:"Intersects({polygon})" AND beginposition:[{start} TO {end}] AND platformname:Sentinel-1 AND filename:S1A* AND producttype:GRD)&start={startindex}&rows=100&orderby=beginposition desc&format=json',name:"Sentinel-1A GRD",logo:"./images/s1_black.png",type:"DHUS",startIndexOrigin:0,dateOff:" beginposition:[{start} TO {end}] AND",areaOff:' footprint:"Intersects({polygon})" AND',windowSize:648e5},{code:"S1B",templateUrl:'https://scihub.copernicus.eu/dhus/search?q=( footprint:"Intersects({polygon})" AND beginposition:[{start} TO {end}] AND platformname:Sentinel-1 AND filename:S1B* AND producttype:GRD)&start={startindex}&rows=100&orderby=beginposition desc&format=json',name:"Sentinel-1B GRD",logo:"./images/s1_black.png",type:"DHUS",startIndexOrigin:0,dateOff:" beginposition:[{start} TO {end}] AND",areaOff:' footprint:"Intersects({polygon})" AND',windowSize:648e5},{code:"S2",templateUrl:'https://scihub.copernicus.eu/dhus/search?q=( footprint:"Intersects({polygon})" AND beginposition:[{start} TO {end}] AND platformname:Sentinel-2 AND filename:*MSIL1C*)&start={startindex}&rows=100&orderby=beginposition desc&format=json',name:"Sentinel-2 A/B Level 1C",logo:"./images/s2_black.png",type:"DHUS",startIndexOrigin:0,dateOff:" beginposition:[{start} TO {end}] AND",areaOff:' footprint:"Intersects({polygon})" AND',windowSize:108e5},{code:"S2A",templateUrl:'https://scihub.copernicus.eu/dhus/search?q=( footprint:"Intersects({polygon})" AND beginposition:[{start} TO {end}] AND platformname:Sentinel-2 AND filename:S2A_MSIL1C*)&start={startindex}&rows=100&orderby=beginposition desc&format=json',name:"Sentinel-2 A/B Level 1C",logo:"./images/s2_black.png",type:"DHUS",startIndexOrigin:0,dateOff:" beginposition:[{start} TO {end}] AND",areaOff:' footprint:"Intersects({polygon})" AND',windowSize:108e5},{code:"S2B",templateUrl:'https://scihub.copernicus.eu/dhus/search?q=( footprint:"Intersects({polygon})" AND beginposition:[{start} TO {end}] AND platformname:Sentinel-2 AND filename:S2B_MSIL1C*)&start={startindex}&rows=100&orderby=beginposition desc&format=json',name:"Sentinel-2 A/B Level 1C",logo:"./images/s2_black.png",type:"DHUS",startIndexOrigin:0,dateOff:" beginposition:[{start} TO {end}] AND",areaOff:' footprint:"Intersects({polygon})" AND',windowSize:108e5},{code:"S3",templateUrl:'https://scihub.copernicus.eu/dhus/search?q=( footprint:"Intersects({polygon})" AND beginposition:[{start} TO {end}] AND platformname:Sentinel-3 AND (producttype:OL_1_LFR___ OR producttype:SL_1_RBT___ OR producttype:SR_1_SRA___))&start={startindex}&rows=100&orderby=beginposition desc&format=json',name:"Sentinel-3 A/B, OLCI/SLSTR/SRAL",logo:"./images/s3_black.png",type:"DHUS",startIndexOrigin:0,dateOff:" beginposition:[{start} TO {end}] AND",areaOff:' footprint:"Intersects({polygon})" AND',windowSize:864e5},{code:"S3A/OLCI/LFR",templateUrl:'https://scihub.copernicus.eu/dhus/search?q=( footprint:"Intersects({polygon})" AND beginposition:[{start} TO {end}] AND platformname:Sentinel-3 AND filename:S3A_*  AND (producttype:OL_2_LFR___))&start={startindex}&rows=100&orderby=beginposition desc&format=json',name:"Sentinel-3 A, OLCI/LFR",logo:"./images/s3_black.png",type:"DHUS",startIndexOrigin:0,dateOff:" beginposition:[{start} TO {end}] AND",areaOff:' footprint:"Intersects({polygon})" AND',windowSize:864e5},{code:"S3B/OLCI/LFR",templateUrl:'https://scihub.copernicus.eu/dhus/search?q=( footprint:"Intersects({polygon})" AND beginposition:[{start} TO {end}] AND platformname:Sentinel-3 AND filename:S3B_* AND (producttype:OL_2_LFR___))&start={startindex}&rows=100&orderby=beginposition desc&format=json',name:"Sentinel-3 B, OLCI/LFR",logo:"./images/s3_black.png",type:"DHUS",startIndexOrigin:0,dateOff:" beginposition:[{start} TO {end}] AND",areaOff:' footprint:"Intersects({polygon})" AND',windowSize:864e5},{code:"S3A/OLCI/RBT",templateUrl:'https://scihub.copernicus.eu/dhus/search?q=( footprint:"Intersects({polygon})" AND beginposition:[{start} TO {end}] AND platformname:Sentinel-3 AND filename:S3A_*  AND (producttype:SL_1_RBT___))&start={startindex}&rows=100&orderby=beginposition desc&format=json',name:"Sentinel-3 A, OLCI/RBT",logo:"./images/s3_black.png",type:"DHUS",startIndexOrigin:0,dateOff:" beginposition:[{start} TO {end}] AND",areaOff:' footprint:"Intersects({polygon})" AND',windowSize:864e5},{code:"S3B/SLSTR/RBT",templateUrl:'https://scihub.copernicus.eu/dhus/search?q=( footprint:"Intersects({polygon})" AND beginposition:[{start} TO {end}] AND platformname:Sentinel-3 AND filename:S3B_* AND (producttype:SL_1_RBT___))&start={startindex}&rows=100&orderby=beginposition desc&format=json',name:"Sentinel-3 B, SLSTR/RBT",logo:"./images/s3_black.png",type:"DHUS",startIndexOrigin:0,dateOff:" beginposition:[{start} TO {end}] AND",areaOff:' footprint:"Intersects({polygon})" AND',windowSize:864e5},{code:"S3/SLSTR",templateUrl:'https://scihub.copernicus.eu/dhus/search?q=( footprint:"Intersects({polygon})" AND beginposition:[{start} TO {end}] AND platformname:Sentinel-3 AND (producttype:SL_1_RBT___))&start={startindex}&rows=100&orderby=beginposition desc&format=json',name:"Sentinel-3 A/B, SLSTR",logo:"./images/s3_black.png",type:"DHUS",startIndexOrigin:0,dateOff:" beginposition:[{start} TO {end}] AND",areaOff:' footprint:"Intersects({polygon})" AND',windowSize:864e5},{code:"S3/SRAL",templateUrl:'https://scihub.copernicus.eu/dhus/search?q=( footprint:"Intersects({polygon})" AND beginposition:[{start} TO {end}] AND platformname:Sentinel-3 AND (producttype:SR_1_SRA___))&start={startindex}&rows=100&orderby=beginposition desc&format=json',name:"Sentinel-3 A/B, SRAL",logo:"./images/s3_black.png",type:"DHUS",startIndexOrigin:0,dateOff:" beginposition:[{start} TO {end}] AND",areaOff:' footprint:"Intersects({polygon})" AND',windowSize:864e5},{code:"S5P",templateUrl:'https://scihub.copernicus.eu/dhus/search?q=( footprint:"Intersects({polygon})" AND beginposition:[{start} TO {end}] AND platformname:Sentinel-5 precursor AND (producttype:L1B_RA_BD1 OR (producttype:L2__NO2___ AND processingmode:Near real time)))&start={startindex}&rows=100&orderby=beginposition desc&format=json',name:"S5P",logo:"./images/s5p_black.png",type:"DHUS",startIndexOrigin:0,dateOff:" beginposition:[{start} TO {end}] AND",areaOff:' footprint:"Intersects({polygon})" AND',windowSize:864e5},{code:"ENVISAT/MERIS/FRS",templateUrl:'https://dhr.datahub.eodc.eu/search?q=( footprint:"Intersects({polygon})" AND beginposition:[{start} TO {end}] AND platformname:Envisat AND producttype:MER_FRS_2P) &start={startindex}&rows=100&orderby=beginposition desc&format=json',name:"ENVISAT/MERIS/FRS from EODC's EO Mission Data relay",logo:"./images/s5p_black.png",type:"DHUS",startIndexOrigin:0,dateOff:" beginposition:[{start} TO {end}] AND",areaOff:' footprint:"Intersects({polygon})" AND',windowSize:864e5},{code:"EOCAT-MER_FRS_2P",templateUrl:"https://eocat.esa.int/api/catalogue/EOCAT-MER_FRS_2P/search?start={start}&stop={end}&geom={polygon}&format=json&count=50&startIndex={startindex}",startIndexOrigin:1,name:"EOCAT-MER_FRS_2P",logo:"./images/s5p_black.png",type:"EOCAT",dateOff:"start={start}&stop={end}&",areaOff:"&geom={polygon}",windowSize:2592e5},{code:"EOCAT-ENVISAT.ASA.IMP_1P",templateUrl:"https://eocat.esa.int/api/catalogue/EOCAT-ENVISAT.ASA.IMP_1P/search?start={start}&stop={end}&geom={polygon}&format=json&count=50&startIndex={startindex}",startIndexOrigin:1,name:"EOCAT-ENVISAT.ASA.IMP_1P",logo:"./images/s5p_black.png",type:"EOCAT",dateOff:"start={start}&stop={end}&",areaOff:"&geom={polygon}",windowSize:2592e5},{code:"RefSysStac",templateUrl:"https://processing.platform.ops-csc.com/native-api/stac/search?datetime={start}/{end}",startIndexOrigin:1,name:"RS Stac",type:"STAC",logo:"./images/s5p_black.png",dateOff:"datetime={start}/{end}",areaOff:" and OData.CSC.Intersects(area=geography%27SRID=4326;{polygon}%27)",windowSize:2592e5},{code:"S1A_IW_RAW__0SDV",templateUrl:"https://processing.platform.ops-csc.com/ddip/odata/v1/Products?$format=json&$count=true&$top=100&$skip={startindex}&$filter=contains(Name,%27S1A_IW_RAW__0SDV%27)%20and%20ContentDate/Start%20gt%20{start}%20and%20ContentDate/Start%20lt%20{end}&$orderby=%20ContentDate/Start%20desc",startIndexOrigin:0,name:"RS PRIP",logo:"./images/s5p_black.png",type:"PRIP",dateOff:"%20and%20ContentDate/Start%20gt%20{start}%20and%20ContentDate/Start%20lt%20{end}",areaOff:" and OData.CSC.Intersects(area=geography%27SRID=4326;{polygon}%27)",windowSize:2592e5},{code:"S3 RS",templateUrl:"https://processing.platform.ops-csc.com/ddip/odata/v1/Products?$format=json&$count=true&$top=100&$skip={startindex}&$filter=contains(Name,%27S3%27)%20and%20ContentDate/Start%20gt%20{start}%20and%20ContentDate/Start%20lt%20{end}&$orderby=%20ContentDate/Start%20desc",startIndexOrigin:0,name:"RS PRIP",logo:"./images/s5p_black.png",type:"PRIP",dateOff:"%20and%20ContentDate/Start%20gt%20{start}%20and%20ContentDate/Start%20lt%20{end}",areaOff:" and OData.CSC.Intersects(area=geography%27SRID=4326;{polygon}%27)",windowSize:2592e5}]};function h(e,t){var r=Object(n.useState)(e),i=Object(s.a)(r,2),a=i[0],o=i[1];return Object(n.useEffect)((function(){var r=setTimeout((function(){o(e)}),t);return function(){clearTimeout(r)}}),[e,t]),a}var g=r(3),f=i.a.createContext({state:d,dispatch:function(){return null}}),p=function(e){var t=e.children,r=JSON.parse(window.sessionStorage.getItem("eoi_state")),a=Object(l.a)(Object(l.a)({},d),r);a.searchDate=a.viewDate;var o=i.a.useReducer(c,a),u=Object(s.a)(o,2),p=u[0],m=u[1],_=h(p,1e3);return Object(n.useEffect)((function(){console.log("saving session");var e={mission:_.mission,altitude:_.altitude,appColor:_.appColor,position:_.position,animated:_.animated,mapSettings:_.mapSettings,viewDate:_.viewDate,goToDate:_.goToDate,credentials:_.credentials};console.log(e),window.sessionStorage.setItem("eoi_state",JSON.stringify(e))}),[_]),Object(g.jsx)(f.Provider,{value:[p,m],children:t})},m=(r(64),r(37),r(10)),_=r(13),v=r(2),b=r.n(v),y=b.a.AbstractError,E=b.a.Angle,S=b.a.Location,x=b.a.Logger,w=b.a.NotYetImplementedError,T=b.a.PickedObject,O=b.a.PolygonSplitter,R=b.a.Renderable,C=b.a.Sector,D=b.a.ShapeAttributes,j=b.a.Vec3,L=b.a.MemoryCache,A=b.a.BoundingBox,N=b.a.SurfaceShape;(N=function(e){R.call(this),this._displayName="Surface Shape",this._attributes=e||new D(null),this._highlightAttributes=null,this._highlighted=!1,this._enabled=!0,this._pathType=b.a.GREAT_CIRCLE,this._maximumNumEdgeIntervals=N.DEFAULT_NUM_EDGE_INTERVALS,this._polarThrottle=N.DEFAULT_POLAR_THROTTLE,this._sector=null,this.pickDelegate=null,this._sectors=[],this._locations=null,this._boundaries=null,this._interiorGeometry=null,this._outlineGeometry=null,this._isInteriorInhibited=!1,this.stateKeyInvalid=!0,this._attributesStateKey=null,this.boundariesArePrepared=!1,this.layer=null,this.pickColor=null,this.contours=[],this.containsPole=!1,this.crossesAntiMeridian=!1,this.expirationInterval=2e3,this.shapeDataCache=new L(3,2),this.currentData=null}).prototype=Object.create(R.prototype),Object.defineProperties(N.prototype,{stateKey:{get:function(){if(this._attributesStateKey){var e=null;this._highlighted?this._highlightAttributes&&(e=this._highlightAttributes.stateKey):this._attributes&&(e=this._attributes.stateKey),e!=this._attributesStateKey&&(this._attributesStateKey=e,this.stateKeyInvalid=!0)}else this._highlighted?this._highlightAttributes&&(this._attributesStateKey=this._highlightAttributes.stateKey):this._attributes&&(this._attributesStateKey=this._attributes.stateKey),this._attributesStateKey&&(this.stateKeyInvalid=!0);return this.stateKeyInvalid&&(this._stateKey=this.computeStateKey()),this._stateKey}},displayName:{get:function(){return this._displayName},set:function(e){this.stateKeyInvalid=!0,this._displayName=e}},attributes:{get:function(){return this._attributes},set:function(e){this.stateKeyInvalid=!0,this._attributes=e,this._attributesStateKey=e.stateKey}},highlightAttributes:{get:function(){return this._highlightAttributes},set:function(e){this.stateKeyInvalid=!0,this._highlightAttributes=e}},highlighted:{get:function(){return this._highlighted},set:function(e){this.stateKeyInvalid=!0,this._highlighted=e}},enabled:{get:function(){return this._enabled},set:function(e){this.stateKeyInvalid=!0,this._enabled=e}},pathType:{get:function(){return this._pathType},set:function(e){this.stateKeyInvalid=!0,this.resetBoundaries(),this._pathType=e}},maximumNumEdgeIntervals:{get:function(){return this._maximumNumEdgeIntervals},set:function(e){this.stateKeyInvalid=!0,this.resetBoundaries(),this._maximumNumEdgeIntervals=e}},polarThrottle:{get:function(){return this._polarThrottle},set:function(e){this.stateKeyInvalid=!0,this.resetBoundaries(),this._polarThrottle=e}},sector:{get:function(){return this._sector}}}),N.staticStateKey=function(e){return e.stateKeyInvalid=!1,e.highlighted&&e._highlightAttributes?e._attributesStateKey=e._highlightAttributes.stateKey:e._attributes?e._attributesStateKey=e._attributes.stateKey:e._attributesStateKey=null,"dn "+e.displayName+" at "+(e._attributesStateKey?e._attributesStateKey:"null")+" hi "+e.highlighted+" en "+e.enabled+" pt "+e.pathType+" ne "+e.maximumNumEdgeIntervals+" po "+e.polarThrottle+" se ["+e.sector.minLatitude+","+e.sector.maxLatitude+","+e.sector.minLongitude+","+e.sector.maxLongitude+"]"},N.prototype.computeStateKey=function(){return N.staticStateKey(this)},N.prototype.area=function(e,t){throw new w(x.logMessage(x.LEVEL_SEVERE,"SurfaceShape","area","notYetImplemented"))},N.prototype.computeBoundaries=function(e){throw new y(x.logMessage(x.LEVEL_SEVERE,"SurfaceShape","computeBoundaries","abstractInvocation"))},N.prototype.intersectsFrustum=function(e){return!this.currentData||!this.currentData.extent||(e.pickingMode?this.currentData.extent.intersectsFrustum(e.pickFrustum):this.currentData.extent.intersectsFrustum(e.frustumInModelCoordinates))},N.prototype.isShapeDataCurrent=function(e,t){return t.verticalExaggeration===e.verticalExaggeration&&t.expiryTime>Date.now()},N.prototype.createShapeDataObject=function(){return{}},N.prototype.resetExpiration=function(e){e.expiryTime=Date.now()+this.expirationInterval+1e3*Math.random()},N.prototype.establishCurrentData=function(e){this.currentData=this.shapeDataCache.entryForKey(e.globeStateKey),this.currentData||(this.currentData=this.createShapeDataObject(),this.resetExpiration(this.currentData),this.shapeDataCache.putEntry(e.globeStateKey,this.currentData,1)),this.currentData.isExpired=!this.isShapeDataCurrent(e,this.currentData)},N.prototype.render=function(e){this.enabled&&(this.layer=e.currentLayer,this.prepareBoundaries(e),this.establishCurrentData(e),!this.currentData.isExpired&&this.currentData.extent||(this.computeExtent(e),this.currentData.verticalExaggeration=e.verticalExaggeration,this.resetExpiration(this.currentData)),this.currentData&&this.currentData.extent&&!this.intersectsFrustum(e)||e.surfaceShapeTileBuilder.insertSurfaceShape(this))},N.prototype.interpolateLocations=function(e){var t,r,n,i=e[0],a=i,o=!0,s=!0,l=0,c=!0;for(this._locations=[i],r=1,n=e.length;r<n;r+=1)t=a,s=o,c=!0,((o=(a=e[r]).latitude==i.latitude&&a.longitude==i.longitude)||s)&&(l+=1)>2&&(c=!1),c&&this.interpolateEdge(t,a,this._locations),this._locations.push(a),t=a;this._isInteriorInhibited||t.latitude==i.latitude&&t.longitude==i.longitude||(this.interpolateEdge(t,i,this._locations),this._locations.push(i))},N.prototype.interpolateEdge=function(e,t,r){var n,i,a=S.greatCircleDistance(e,t),o=Math.round(this._maximumNumEdgeIntervals*a/Math.PI);if(o>0){n=1/o,i=e;for(var s=this.throttledStep(n,i);s<1;s+=this.throttledStep(n,i))i=new S(0,0),S.interpolateAlongPath(this._pathType,s,e,t,i),180===e.longitude&&180===t.longitude?i.longitude=180:-180===e.longitude&&-180===t.longitude&&(i.longitude=-180),r.push(i)}},N.prototype.throttledStep=function(e,t){var r=Math.cos(t.latitude*E.DEGREES_TO_RADIANS);r*=r;var n=this._polarThrottle/(1+this._polarThrottle);return e*(1-n+n*r)},N.prototype.prepareBoundaries=function(e){if(!this.boundariesArePrepared){this._boundaries||this.computeBoundaries(e);var t=this.formatBoundaries();this.normalizeAngles(t),t=this.interpolateBoundaries(t);var r=[],n=O.splitContours(t,r);this.contours=r,this.crossesAntiMeridian=n,this.prepareGeometry(e,r),this.prepareSectors(),this.boundariesArePrepared=!0}},N.prototype.resetBoundaries=function(){this.boundariesArePrepared=!1,this.shapeDataCache.clear(!1)},N.prototype.formatBoundaries=function(){var e=[];return this._boundaries.length?(null!=this._boundaries[0].latitude?e.push(this._boundaries):e=this._boundaries,e):e},N.prototype.normalizeAngles=function(e){for(var t=0,r=e.length;t<r;t++)for(var n=e[t],i=0,a=n.length;i<a;i++){var o=n[i];(o.longitude<-180||o.longitude>180)&&(o.longitude=E.normalizedDegreesLongitude(o.longitude)),(o.latitude<-90||o.latitude>90)&&(o.latitude=E.normalizedDegreesLatitude(o.latitude))}},N.prototype.interpolateBoundaries=function(e){for(var t=[],r=0,n=e.length;r<n;r++){var i=e[r];this.interpolateLocations(i),t.push(this._locations.slice()),this._locations.length=0}return t},N.prototype.computeSectors=function(e){return this._sectors&&this._sectors.length>0||this.prepareBoundaries(e),this._sectors},N.prototype.computeExtent=function(e){if(!this._sectors||0===this._sectors.length)return null;if(!this.currentData)return null;var t;if(this.currentData.extent||(this.currentData.extent=new A),1===this._sectors.length)t=this._sectors[0].computeBoundingPoints(e.globe,e.verticalExaggeration),this.currentData.extent.setToVec3Points(t);else{for(var r=[],n=0;n<this._sectors.length;n++){t=this._sectors[n].computeBoundingPoints(e.globe,e.verticalExaggeration);var i=new A;i.setToVec3Points(t);for(var a=i.getCorners(),o=0;o<a.length;o++)r.push(a[o])}this.currentData.extent.setToVec3Points(r)}return this.currentData.extent},N.prototype.computeShiftedLocations=function(e,t,r,n){var i=[],a=new j(0,0,0),o=new b.a.Position(0,0,0),s=e.computePointFromLocation(t.latitude,t.longitude,new j(0,0,0)),l=e.computePointFromLocation(r.latitude,r.longitude,new j(0,0,0));if(e.is2D())for(var c=l.subtract(s),u=0,d=n.length;u<d;u++)e.computePointFromLocation(n[u].latitude,n[u].longitude,a),a.add(c),e.computePositionFromPoint(a[0],a[1],a[2],o),i.push(new S(o.latitude,o.longitude));else{var h=r.latitude-t.latitude,g=r.longitude-t.longitude,f=-90,p=90;for(u=0,d=n.length;u<d;u++){var m=n[u].latitude+h,_=n[u].longitude+g;m>90?(m=180-m,_+=180):m<-90&&(m=-180-m,_+=180),_<-180?_+=360:_>180&&(_-=360),m>f&&(f=m),m<p&&(p=m),i.push(new S(m,_))}if(f>90)for(c=f-90,u=0,d=i.length;u<d;u++)i[u].latitude-=c}return i},N.prototype.prepareSectors=function(){this.determineSectors(),this.crossesAntiMeridian?this.sectorsOverAntiMeridian():this.sectorsNotOverAntiMeridian()},N.prototype.determineSectors=function(){for(var e=0,t=this.contours.length;e<t;e++){var r=this.contours[e],n=r.polygons;r.sectors=[];for(var i=0,a=n.length;i<a;i++){var o=n[i],s=new C(0,0,0,0);if(s.setToBoundingSector(o),this._pathType===b.a.GREAT_CIRCLE){var l=S.greatCircleArcExtremeLocations(o),c=Math.min(s.minLatitude,l[0].latitude),u=Math.max(s.maxLatitude,l[1].latitude);s.minLatitude=c,s.maxLatitude=u}r.sectors.push(s)}}},N.prototype.sectorsOverAntiMeridian=function(){for(var e=new C(90,-90,180,-180),t=new C(90,-90,180,-180),r=0,n=this.contours.length;r<n;r++)for(var i=this.contours[r].sectors,a=0,o=i.length;a<o;a++){var s=i[a];s.minLongitude<0&&s.maxLongitude>0?(t.union(s),e.union(s)):s.minLongitude<0?t.union(s):e.union(s)}var l=Math.min(e.minLatitude,t.minLatitude),c=Math.max(e.maxLatitude,e.maxLatitude);this._sector=new C(l,c,-180,180),this._sectors=[e,t]},N.prototype.sectorsNotOverAntiMeridian=function(){this._sector=new C(90,-90,180,-180);for(var e=0,t=this.contours.length;e<t;e++)for(var r=this.contours[e].sectors,n=0,i=r.length;n<i;n++)this._sector.union(r[n]);this._sectors=[this._sector]},N.prototype.prepareGeometry=function(e,t){for(var r=[],n=[],i=0,a=t.length;i<a;i++)for(var o=t[i],s=o.poleIndex,l=0,c=o.polygons.length;l<c;l++){var u=o.polygons[l],d=o.iMap[l];r.push(u),o.pole!==S.poles.NONE&&c>1?l===s?this.outlineForPole(u,d,n):this.outlineForSplit(u,d,n):o.pole!==S.poles.NONE&&1===c?this.outlineForPole(u,d,n):o.pole===S.poles.NONE&&c>1?this.outlineForSplit(u,d,n):o.pole===S.poles.NONE&&1===c&&n.push(u)}this._interiorGeometry=r,this._outlineGeometry=n},N.prototype.outlineForPole=function(e,t,r){this.containsPole=!0;for(var n=[],i=0,a=0,o=e.length;a<o;a++){var s=e[a],l=t.get(a);l&&l.forPole&&++i%2===1&&(n.push(s),r.push(n),n=[]),i%2===0&&n.push(s)}n.length&&r.push(n)},N.prototype.outlineForSplit=function(e,t,r){for(var n=[],i=0,a=0,o=e.length;a<o;a++){var s=e[a],l=t.get(a);l&&!l.forPole&&++i%2===0&&(n.push(s),r.push(n),n=[]),i%2===1&&n.push(s)}},N.prototype.resetPickColor=function(){this.pickColor=null},N.prototype.renderToTexture=function(e,t,r,n,i,a){var o=this._highlighted&&this._highlightAttributes||this._attributes,s=!this._isInteriorInhibited&&o.drawInterior,l=o.drawOutline&&o.outlineWidth>0;if(s||l){if(e.pickingMode&&!this.pickColor&&(this.pickColor=e.uniquePickColor()),e.pickingMode)var c=this.pickColor.toHexString();if(this.crossesAntiMeridian||this.containsPole?(s&&(this.draw(this._interiorGeometry,t,r,n,i,a),t.fillStyle=e.pickingMode?c:o.interiorColor.toRGBAString(),t.fill()),l&&(this.draw(this._outlineGeometry,t,r,n,i,a),t.lineWidth=4*o.outlineWidth,t.strokeStyle=e.pickingMode?c:o.outlineColor.toRGBAString(),t.stroke())):(this.draw(this._interiorGeometry,t,r,n,i,a),s&&(t.fillStyle=e.pickingMode?c:o.interiorColor.toRGBAString(),t.fill()),l&&(t.lineWidth=4*o.outlineWidth,t.strokeStyle=e.pickingMode?c:o.outlineColor.toRGBAString(),t.stroke())),e.pickingMode){var u=new T(this.pickColor.clone(),this.pickDelegate?this.pickDelegate:this,null,this.layer,!1);e.resolvePick(u)}}},N.prototype.draw=function(e,t,r,n,i,a){t.beginPath();for(var o=0,s=e.length;o<s;o++){var l=e[o],c=l[0],u=c.longitude*r+i,d=c.latitude*n+a;t.moveTo(u,d);for(var h=1,g=l.length;h<g;h++)u=(c=l[h]).longitude*r+i,d=c.latitude*n+a,t.lineTo(u,d)}},N.DEFAULT_NUM_EDGE_INTERVALS=128,N.DEFAULT_POLAR_THROTTLE=10,b.a.SurfaceShape=N;var k=N;b.a.DrawContext.prototype.resolvePick=function(e){if(e.userObject instanceof k||!this.deepPicking||this.regionPicking)this.addPickedObject(e);else{var t=this.readPickColor(this.pickPoint);if(!t)return null;e.color.equals(t)&&this.addPickedObject(e)}};var P=r(6),M=r(7),I=function(){function e(t,r,n){Object(P.a)(this,e),this.textureId=t||null,this.imageWidth=r,this.imageHeight=n,this.size=r*n*4,this.originalImageWidth=r,this.originalImageHeight=n,this.creationTime=new Date}return Object(M.a)(e,[{key:"bind",value:function(e){return e.currentGlContext.bindTexture(e.currentGlContext.TEXTURE_2D,this.textureId),e.frameStatistics.incrementTextureLoadCount(1),!0}},{key:"dispose",value:function(e){e.deleteTexture(this.textureId),delete this.textureId}}]),e}(),G=function(){function e(){Object(P.a)(this,e),this.framebufferId=null,this.textureId=null,this.width=0,this.height=0,this.texture=null}return Object(M.a)(e,[{key:"attachTexture",value:function(e,t,r){return this.textureId=this.createTexture(e,t,r),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.textureId,0),this.texture=new I(this.textureId,t,r),!0}},{key:"bind",value:function(e,t,r){this.framebufferId||(this.framebufferId=e.createFramebuffer()),this.width=t,this.height=r,e.bindFramebuffer(e.FRAMEBUFFER,this.framebufferId),e.viewport(0,0,t,r)}},{key:"bind_or",value:function(e,t,r){return this.framebufferId||(this.framebufferId=e.createFramebuffer()),this.width=t,this.height=r,e.bindFramebuffer(e.FRAMEBUFFER,this.framebufferId),e.viewport(0,0,t,r),this.textureId=this.createTexture(e,t,r),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.textureId,0),this.texture=new I(this.textureId,t,r),!0}},{key:"clear",value:function(e){e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT)}},{key:"unbind",value:function(e,t){t?(e.bindFramebuffer(e.FRAMEBUFFER,t.framebufferId),e.viewport(0,0,t.width,t.height)):(e.bindFramebuffer(e.FRAMEBUFFER,null),e.viewport(0,0,e.canvas.width,e.canvas.height))}},{key:"createTexture",value:function(e,t,r){256!==t&&console.log("width",t),256!==r&&console.log("width",r);var n=e.createTexture();return e.bindTexture(e.TEXTURE_2D,n),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,t,r,0,e.RGBA,e.UNSIGNED_BYTE,null),n}}]),e}(),U=b.a.ArgumentError,F=b.a.Logger,B=b.a.SurfaceShapeTileBuilder,V=b.a.SurfaceShape,z=b.a.PickedObject,W="SurfaceShapeFBO";B.prototype.buildTiles=function(e){if(!e)throw new U(F.logMessage(F.LEVEL_SEVERE,"SurfaceShapeTileBuilder","buildTiles","missingDc"));if(this.surfaceShapes&&!(this.surfaceShapes.length<1)){if(this.assembleTiles(e),B.__fboBound__)B.getFbo(e).unbind(e.currentGlContext,e.currentFramebuffer),B.__fboBound__=!1;this.surfaceShapes.splice(0,this.surfaceShapes.length);for(var t=0,r=this.surfaceShapeTiles.length;t<r;t+=1){this.surfaceShapeTiles[t].clearShapes()}}},B.prototype.addTile=function(e,t){if(e.pickingMode&&(t.pickSequence=B.pickSequence),t.needsUpdate(e)){var r=B.getFbo(e);B.__fboBound__||(r.bind(e.currentGlContext,this.tileWidth,this.tileHeight),B.__fboBound__=!0),t.updateTexture(e)}this.surfaceShapeTiles.push(t)},B.prototype.doRender=function(e){if(e.pickingMode){for(var t=0,r=this.surfaceShapes.length;t<r;t+=1)this.surfaceShapes[t].resetPickColor();B.pickSequence+=1;var n=this.surfaceShapeTiles,i=this.topLevelTiles;this.surfaceShapeTiles=[],this.topLevelTiles=[],this.buildTiles(e),e.deepPicking?this.doDeepPickingRender(e):e.surfaceTileRenderer.renderTiles(e,this.surfaceShapeTiles,1),this.surfaceShapeTiles=n,this.topLevelTiles=i}else this.buildTiles(e),e.surfaceTileRenderer.renderTiles(e,this.surfaceShapeTiles,1)},B.prototype.doDeepPickingRender=function(e){var t,r,n,i,a,o,s,l,c,u=[];for(a=0,o=e.objectsAtPickPoint.objects.length;a<o;a+=1)(s=e.objectsAtPickPoint.objects[a]).userObject instanceof V&&(l=s.userObject,u.indexOf(l)<0&&(u.push(l),e.objectsAtPickPoint.objects.splice(a,1),a-=1,o-=1));if(!(u.length<=0)){var d=[];for(n=0,i=u.length;n<i;n+=1){l=u[n];var h=B.getFbo(e);for(B.__fboBound__||(h.bind(e.currentGlContext,this.tileWidth,this.tileHeight),B.__fboBound__=!0),t=0,r=this.surfaceShapeTiles.length;t<r;t+=1)(c=this.surfaceShapeTiles[t]).setShapes([l]),c.updateTexture(e);if(B.__fboBound__)B.getFbo(e).unbind(e.currentGlContext,e.currentFramebuffer),B.__fboBound__=!1;e.surfaceTileRenderer.renderTiles(e,this.surfaceShapeTiles,1);var g=e.readPickColor(e.pickPoint);g&&l.pickColor.equals(g)&&(s=new z(l.pickColor.clone(),l.pickDelegate?l.pickDelegate:l,null,l.layer,!1),d.push(s))}for(a=0,o=e.objectsAtPickPoint.objects.length;a<o;a+=1)(s=e.objectsAtPickPoint.objects[a]).userObject instanceof V&&(e.objectsAtPickPoint.objects.splice(a,1),a-=1,o-=1);for(a=0,o=d.length;a<o;a+=1)s=d[a],e.objectsAtPickPoint.objects.push(s)}},B.getFbo=function(e){var t=e.gpuResourceCache.resourceForKey(W);return t||(t=new G,e.gpuResourceCache.putResource(W,t,1)),t},B.__frameStart__=!1,B.__fboBound__=!1,b.a.SurfaceShapeTile.prototype.updateTexture=function(e){var t=e.currentGlContext,r=this.tileWidth/this.sector.deltaLongitude(),n=-this.tileHeight/this.sector.deltaLatitude(),i=-this.sector.minLongitude*r,a=-this.sector.maxLatitude*n;this.asRenderedSurfaceShapeStateKeys=[];var o=e.gpuResourceCache.resourceForKey("SurfaceShapeFBO");o.attachTexture(t,this.tileWidth,this.tileHeight),o.clear(t);for(var s=0,l=this.surfaceShapes.length;s<l;s+=1){var c=this.surfaceShapes[s];this.asRenderedSurfaceShapeStateKeys.push(this.surfaceShapeStateKeys[s]),c.renderToTexture(e,o,r,n,i,a)}this.gpuCacheKey=this.getCacheKey();var u=e.gpuResourceCache,d=o.texture;return u.putResource(this.gpuCacheKey,d,d.size),d};var H=b.a.TiledImageLayer;H.prototype.retrieveTileImage=function(e,t,r){(this.pendingRequests||(this.pendingRequests=[]),this.MAX_REQUESTS||(this.MAX_REQUESTS=16),this.currentRetrievals.indexOf(t.imagePath)>=0)||(this.pendingRequests.some((function(e){return e.imagePath===t.imagePath}))||this.absentResourceList.isResourceAbsent(t.imagePath)||(this.resourceUrlForTile(t,this.retrievalImageFormat)?(20===this.pendingRequests.length&&this.pendingRequests.shift(),this.pendingRequests.push(t),this.currentRetrievals.length<=this.MAX_REQUESTS&&this.fetchMoreImages(e,this)):this.currentTilesInvalid=!0))},H.prototype.fetchMoreImages=function(e,t){var r=t.pendingRequests.length;if(t.pendingRequests=t.pendingRequests.filter((function(r){return t.isTileVisible(e,r)})),t.pendingRequests.length){t.pendingRequests.length;var n=t.pendingRequests.shift(),i=n.imagePath,a=t.resourceUrlForTile(n,t.retrievalImageFormat);if(i&&a){var o=e.gpuResourceCache;t.fetchImage(a,(function(r,n){if(r)return t.removeFromCurrentRetrievals(i),t.absentResourceList.markResourceAbsent(i),void(t.currentRetrievals.length<=t.MAX_REQUESTS&&t.fetchMoreImages(e,t));var a=t.createTexture(e,null,n);if(t.removeFromCurrentRetrievals(i),a){o.putResource(i,a,a.size),t.currentTilesInvalid=!0,t.absentResourceList.unmarkResourceAbsent(i);var s=document.createEvent("Event");s.initEvent(b.a.REDRAW_EVENT_TYPE,!0,!0),window.dispatchEvent(s)}t.currentRetrievals.length<=t.MAX_REQUESTS&&t.fetchMoreImages(e,t)})),t.currentRetrievals.push(i)}}},H.prototype.fetchImage=function(e,t){var r=new Image;r.onload=function(){t(null,r)},r.onerror=function(){t(new Error("Image retrieval failed"),null)},r.crossOrigin="anonymous",window.webkit||!window.webkit&&window.AndroidApp,r.src=e},H.prototype.doRender_=function(e){e.terrain&&(!this.currentTilesInvalid&&this.lasTtMVP&&e.navigatorState.modelviewProjection.equals(this.lasTtMVP)&&e.globeStateKey===this.lastGlobeStateKey||(this.currentTilesInvalid=!1,this.assembleTiles(e)),this.lasTtMVP=e.navigatorState.modelviewProjection,this.lastGlobeStateKey=e.globeStateKey,this.currentTiles.length>0&&(e.surfaceTileRenderer.renderTiles(e,this.currentTiles,this.opacity,e.surfaceOpacity>=1),e.frameStatistics.incrementImageTileCount(this.currentTiles.length),this.inCurrentFrame=!0))},H.prototype.cleanCache=function(){};var q=r(8),K=r(9),Y={DEBUG:!1,assert:function(e,t){if(Y.DEBUG&&!e)throw new Error("Assertion failed"+(t?": "+t:""))},GLU_TESS_MAX_COORD:1e150,TRUE_PROJECT:!1,TESS_MAX_CACHE:100,GLU_TESS_DEFAULT_TOLERANCE:0,windingRule:{GLU_TESS_WINDING_ODD:100130,GLU_TESS_WINDING_NONZERO:100131,GLU_TESS_WINDING_POSITIVE:100132,GLU_TESS_WINDING_NEGATIVE:100133,GLU_TESS_WINDING_ABS_GEQ_TWO:100134},primitiveType:{GL_LINE_LOOP:2,GL_TRIANGLES:4,GL_TRIANGLE_STRIP:5,GL_TRIANGLE_FAN:6},errorType:{GLU_TESS_MISSING_BEGIN_POLYGON:100151,GLU_TESS_MISSING_END_POLYGON:100153,GLU_TESS_MISSING_BEGIN_CONTOUR:100152,GLU_TESS_MISSING_END_CONTOUR:100154,GLU_TESS_COORD_TOO_LARGE:100155,GLU_TESS_NEED_COMBINE_CALLBACK:100156},gluEnum:{GLU_TESS_BEGIN:100100,GLU_TESS_VERTEX:100101,GLU_TESS_END:100102,GLU_TESS_ERROR:100103,GLU_TESS_EDGE_FLAG:100104,GLU_TESS_COMBINE:100105,GLU_TESS_BEGIN_DATA:100106,GLU_TESS_VERTEX_DATA:100107,GLU_TESS_END_DATA:100108,GLU_TESS_ERROR_DATA:100109,GLU_TESS_EDGE_FLAG_DATA:100110,GLU_TESS_COMBINE_DATA:100111,GLU_TESS_MESH:100112,GLU_TESS_TOLERANCE:100142,GLU_TESS_WINDING_RULE:100140,GLU_TESS_BOUNDARY_ONLY:100141,GLU_INVALID_ENUM:100900,GLU_INVALID_VALUE:100901},geom:{}};Y.geom.vertEq=function(e,t){return e.s===t.s&&e.t===t.t},Y.geom.vertLeq=function(e,t){return e.s<t.s||e.s===t.s&&e.t<=t.t},Y.geom.edgeEval=function(e,t,r){var n=t.s-e.s,i=r.s-t.s;return n+i>0?n<i?t.t-e.t+(e.t-r.t)*(n/(n+i)):t.t-r.t+(r.t-e.t)*(i/(n+i)):0},Y.geom.edgeSign=function(e,t,r){var n=t.s-e.s,i=r.s-t.s;return n+i>0?(t.t-r.t)*n+(t.t-e.t)*i:0},Y.geom.transLeq=function(e,t){return e.t<t.t||e.t===t.t&&e.s<=t.s},Y.geom.transEval=function(e,t,r){var n=t.t-e.t,i=r.t-t.t;return n+i>0?n<i?t.s-e.s+(e.s-r.s)*(n/(n+i)):t.s-r.s+(r.s-e.s)*(i/(n+i)):0},Y.geom.transSign=function(e,t,r){var n=t.t-e.t,i=r.t-t.t;return n+i>0?(t.s-r.s)*n+(t.s-e.s)*i:0},Y.geom.edgeGoesLeft=function(e){return Y.geom.vertLeq(e.dst(),e.org)},Y.geom.edgeGoesRight=function(e){return Y.geom.vertLeq(e.org,e.dst())},Y.geom.vertL1dist=function(e,t){return Math.abs(e.s-t.s)+Math.abs(e.t-t.t)},Y.geom.vertCCW=function(e,t,r){return e.s*(t.t-r.t)+t.s*(r.t-e.t)+r.s*(e.t-t.t)>=0},Y.geom.interpolate_=function(e,t,r,n){return(e=e<0?0:e)<=(r=r<0?0:r)?0===r?(t+n)/2:t+e/(e+r)*(n-t):n+r/(e+r)*(t-n)},Y.geom.edgeIntersect=function(e,t,r,n,i){var a,o,s;Y.geom.vertLeq(e,t)||(s=e,e=t,t=s),Y.geom.vertLeq(r,n)||(s=r,r=n,n=s),Y.geom.vertLeq(e,r)||(s=e,e=r,r=s,s=t,t=n,n=s),Y.geom.vertLeq(r,t)?Y.geom.vertLeq(t,n)?((a=Y.geom.edgeEval(e,r,t))+(o=Y.geom.edgeEval(r,t,n))<0&&(a=-a,o=-o),i.s=Y.geom.interpolate_(a,r.s,o,t.s)):((a=Y.geom.edgeSign(e,r,t))+(o=-Y.geom.edgeSign(e,n,t))<0&&(a=-a,o=-o),i.s=Y.geom.interpolate_(a,r.s,o,n.s)):i.s=(r.s+t.s)/2,Y.geom.transLeq(e,t)||(s=e,e=t,t=s),Y.geom.transLeq(r,n)||(s=r,r=n,n=s),Y.geom.transLeq(e,r)||(s=e,e=r,r=s,s=t,t=n,n=s),Y.geom.transLeq(r,t)?Y.geom.transLeq(t,n)?((a=Y.geom.transEval(e,r,t))+(o=Y.geom.transEval(r,t,n))<0&&(a=-a,o=-o),i.t=Y.geom.interpolate_(a,r.t,o,t.t)):((a=Y.geom.transSign(e,r,t))+(o=-Y.geom.transSign(e,n,t))<0&&(a=-a,o=-o),i.t=Y.geom.interpolate_(a,r.t,o,n.t)):i.t=(r.t+t.t)/2},Y.mesh={},Y.mesh.makeEdge=function(e){var t=Y.mesh.makeEdgePair_(e.eHead);return Y.mesh.makeVertex_(t,e.vHead),Y.mesh.makeVertex_(t.sym,e.vHead),Y.mesh.makeFace_(t,e.fHead),t},Y.mesh.meshSplice=function(e,t){var r=!1,n=!1;e!==t&&(t.org!==e.org&&(n=!0,Y.mesh.killVertex_(t.org,e.org)),t.lFace!==e.lFace&&(r=!0,Y.mesh.killFace_(t.lFace,e.lFace)),Y.mesh.splice_(t,e),n||(Y.mesh.makeVertex_(t,e.org),e.org.anEdge=e),r||(Y.mesh.makeFace_(t,e.lFace),e.lFace.anEdge=e))},Y.mesh.deleteEdge=function(e){var t=e.sym,r=!1;e.lFace!==e.rFace()&&(r=!0,Y.mesh.killFace_(e.lFace,e.rFace())),e.oNext===e?Y.mesh.killVertex_(e.org,null):(e.rFace().anEdge=e.oPrev(),e.org.anEdge=e.oNext,Y.mesh.splice_(e,e.oPrev()),r||Y.mesh.makeFace_(e,e.lFace)),t.oNext===t?(Y.mesh.killVertex_(t.org,null),Y.mesh.killFace_(t.lFace,null)):(e.lFace.anEdge=t.oPrev(),t.org.anEdge=t.oNext,Y.mesh.splice_(t,t.oPrev())),Y.mesh.killEdge_(e)},Y.mesh.addEdgeVertex=function(e){var t=Y.mesh.makeEdgePair_(e),r=t.sym;return Y.mesh.splice_(t,e.lNext),t.org=e.dst(),Y.mesh.makeVertex_(r,t.org),t.lFace=r.lFace=e.lFace,t},Y.mesh.splitEdge=function(e){var t=Y.mesh.addEdgeVertex(e).sym;return Y.mesh.splice_(e.sym,e.sym.oPrev()),Y.mesh.splice_(e.sym,t),e.sym.org=t.org,t.dst().anEdge=t.sym,t.sym.lFace=e.rFace(),t.winding=e.winding,t.sym.winding=e.sym.winding,t},Y.mesh.connect=function(e,t){var r=!1,n=Y.mesh.makeEdgePair_(e),i=n.sym;return t.lFace!==e.lFace&&(r=!0,Y.mesh.killFace_(t.lFace,e.lFace)),Y.mesh.splice_(n,e.lNext),Y.mesh.splice_(i,t),n.org=e.dst(),i.org=t.org,n.lFace=i.lFace=e.lFace,e.lFace.anEdge=i,r||Y.mesh.makeFace_(n,e.lFace),n},Y.mesh.zapFace=function(e){var t,r=e.anEdge,n=r.lNext;do{if(n=(t=n).lNext,t.lFace=null,null===t.rFace()){t.oNext===t?Y.mesh.killVertex_(t.org,null):(t.org.anEdge=t.oNext,Y.mesh.splice_(t,t.oPrev()));var i=t.sym;i.oNext===i?Y.mesh.killVertex_(i.org,null):(i.org.anEdge=i.oNext,Y.mesh.splice_(i,i.oPrev())),Y.mesh.killEdge_(t)}}while(t!==r);var a=e.prev,o=e.next;o.prev=a,a.next=o},Y.mesh.meshUnion=function(e,t){var r=e.fHead,n=e.vHead,i=e.eHead,a=t.fHead,o=t.vHead,s=t.eHead;return a.next!==a&&(r.prev.next=a.next,a.next.prev=r.prev,a.prev.next=r,r.prev=a.prev),o.next!==o&&(n.prev.next=o.next,o.next.prev=n.prev,o.prev.next=n,n.prev=o.prev),s.next!==s&&(i.sym.next.sym.next=s.next,s.next.sym.next=i.sym.next,s.sym.next.sym.next=i,i.sym.next=s.sym.next),e},Y.mesh.deleteMesh=function(e){},Y.mesh.makeEdgePair_=function(e){var t=new Y.GluHalfEdge,r=new Y.GluHalfEdge,n=e.sym.next;return r.next=n,n.sym.next=t,t.next=e,e.sym.next=r,t.sym=r,t.oNext=t,t.lNext=r,r.sym=t,r.oNext=r,r.lNext=t,t},Y.mesh.splice_=function(e,t){var r=e.oNext,n=t.oNext;r.sym.lNext=t,n.sym.lNext=e,e.oNext=n,t.oNext=r},Y.mesh.makeVertex_=function(e,t){var r=t.prev,n=new Y.GluVertex(t,r);r.next=n,t.prev=n,n.anEdge=e;var i=e;do{i.org=n,i=i.oNext}while(i!==e)},Y.mesh.makeFace_=function(e,t){var r=t.prev,n=new Y.GluFace(t,r);r.next=n,t.prev=n,n.anEdge=e,n.inside=t.inside;var i=e;do{i.lFace=n,i=i.lNext}while(i!==e)},Y.mesh.killEdge_=function(e){var t=e.next,r=e.sym.next;t.sym.next=r,r.sym.next=t},Y.mesh.killVertex_=function(e,t){var r=e.anEdge,n=r;do{n.org=t,n=n.oNext}while(n!==r);var i=e.prev,a=e.next;a.prev=i,i.next=a},Y.mesh.killFace_=function(e,t){var r=e.anEdge,n=r;do{n.lFace=t,n=n.lNext}while(n!==r);var i=e.prev,a=e.next;a.prev=i,i.next=a},Y.normal={},Y.normal.S_UNIT_X_=1,Y.normal.S_UNIT_Y_=0,Y.normal.projectPolygon=function(e){var t=!1,r=[e.normal[0],e.normal[1],e.normal[2]];0===r[0]&&0===r[1]&&0===r[2]&&(Y.normal.computeNormal_(e,r),t=!0);var n=e.sUnit,i=e.tUnit,a=Y.normal.longAxis_(r);if(Y.TRUE_PROJECT){Y.normal.normalize_(r),n[a]=0,n[(a+1)%3]=Y.normal.S_UNIT_X_,n[(a+2)%3]=Y.normal.S_UNIT_Y_;var o=Y.normal.dot_(n,r);n[0]-=o*r[0],n[1]-=o*r[1],n[2]-=o*r[2],Y.normal.normalize_(n),i[0]=r[1]*n[2]-r[2]*n[1],i[1]=r[2]*n[0]-r[0]*n[2],i[2]=r[0]*n[1]-r[1]*n[0],Y.normal.normalize_(i)}else n[a]=0,n[(a+1)%3]=Y.normal.S_UNIT_X_,n[(a+2)%3]=Y.normal.S_UNIT_Y_,i[a]=0,i[(a+1)%3]=r[a]>0?-Y.normal.S_UNIT_Y_:Y.normal.S_UNIT_Y_,i[(a+2)%3]=r[a]>0?Y.normal.S_UNIT_X_:-Y.normal.S_UNIT_X_;for(var s=e.mesh.vHead,l=s.next;l!==s;l=l.next)l.s=Y.normal.dot_(l.coords,n),l.t=Y.normal.dot_(l.coords,i);t&&Y.normal.checkOrientation_(e)},Y.normal.dot_=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},Y.normal.normalize_=function(e){var t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];t=Math.sqrt(t),e[0]/=t,e[1]/=t,e[2]/=t},Y.normal.longAxis_=function(e){var t=0;return Math.abs(e[1])>Math.abs(e[0])&&(t=1),Math.abs(e[2])>Math.abs(e[t])&&(t=2),t},Y.normal.computeNormal_=function(e,t){var r,n=[-2*Y.GLU_TESS_MAX_COORD,-2*Y.GLU_TESS_MAX_COORD,-2*Y.GLU_TESS_MAX_COORD],i=[2*Y.GLU_TESS_MAX_COORD,2*Y.GLU_TESS_MAX_COORD,2*Y.GLU_TESS_MAX_COORD],a=[],o=[],s=e.mesh.vHead;for(r=s.next;r!==s;r=r.next)for(var l=0;l<3;++l){var c=r.coords[l];c<i[l]&&(i[l]=c,o[l]=r),c>n[l]&&(n[l]=c,a[l]=r)}var u=0;if(n[1]-i[1]>n[0]-i[0]&&(u=1),n[2]-i[2]>n[u]-i[u]&&(u=2),i[u]>=n[u])return t[0]=0,t[1]=0,void(t[2]=1);var d=0,h=o[u],g=a[u],f=[0,0,0],p=[h.coords[0]-g.coords[0],h.coords[1]-g.coords[1],h.coords[2]-g.coords[2]],m=[0,0,0];for(r=s.next;r!==s;r=r.next){m[0]=r.coords[0]-g.coords[0],m[1]=r.coords[1]-g.coords[1],m[2]=r.coords[2]-g.coords[2],f[0]=p[1]*m[2]-p[2]*m[1],f[1]=p[2]*m[0]-p[0]*m[2],f[2]=p[0]*m[1]-p[1]*m[0];var _=f[0]*f[0]+f[1]*f[1]+f[2]*f[2];_>d&&(d=_,t[0]=f[0],t[1]=f[1],t[2]=f[2])}d<=0&&(t[0]=t[1]=t[2]=0,t[Y.normal.longAxis_(p)]=1)},Y.normal.checkOrientation_=function(e){for(var t=0,r=e.mesh.fHead,n=r.next;n!==r;n=n.next){var i=n.anEdge;if(!(i.winding<=0))do{t+=(i.org.s-i.dst().s)*(i.org.t+i.dst().t),i=i.lNext}while(i!==n.anEdge)}if(t<0){for(var a=e.mesh.vHead,o=a.next;o!==a;o=o.next)o.t=-o.t;e.tUnit[0]=-e.tUnit[0],e.tUnit[1]=-e.tUnit[1],e.tUnit[2]=-e.tUnit[2]}},Y.render={},Y.render.renderMesh=function(e,t,r){for(var n=!1,i=-1,a=t.fHead.prev;a!==t.fHead;a=a.prev)if(a.inside){n||(e.callBeginOrBeginData(Y.primitiveType.GL_TRIANGLES),n=!0);var o=a.anEdge;do{if(r){var s=o.rFace().inside?0:1;i!==s&&(i=s,e.callEdgeFlagOrEdgeFlagData(!!i))}e.callVertexOrVertexData(o.org.data),o=o.lNext}while(o!==a.anEdge)}n&&e.callEndOrEndData()},Y.render.renderBoundary=function(e,t){for(var r=t.fHead.next;r!==t.fHead;r=r.next)if(r.inside){e.callBeginOrBeginData(Y.primitiveType.GL_LINE_LOOP);var n=r.anEdge;do{e.callVertexOrVertexData(n.org.data),n=n.lNext}while(n!==r.anEdge);e.callEndOrEndData()}},Y.sweep={},Y.sweep.SENTINEL_COORD_=4*Y.GLU_TESS_MAX_COORD,Y.sweep.TOLERANCE_NONZERO_=!1,Y.sweep.computeInterior=function(e){var t;for(e.fatalError=!1,Y.sweep.removeDegenerateEdges_(e),Y.sweep.initPriorityQ_(e),Y.sweep.initEdgeDict_(e);null!==(t=e.pq.extractMin());){for(;;){var r=e.pq.minimum();if(null===r||!Y.geom.vertEq(r,t))break;r=e.pq.extractMin(),Y.sweep.spliceMergeVertices_(e,t.anEdge,r.anEdge)}Y.sweep.sweepEvent_(e,t)}var n=e.dict.getMin().getKey();e.event=n.eUp.org,Y.sweep.doneEdgeDict_(e),Y.sweep.donePriorityQ_(e),Y.sweep.removeDegenerateFaces_(e.mesh),e.mesh.checkMesh()},Y.sweep.addWinding_=function(e,t){e.winding+=t.winding,e.sym.winding+=t.sym.winding},Y.sweep.edgeLeq_=function(e,t,r){var n=e.event,i=t.eUp,a=r.eUp;return i.dst()===n?a.dst()===n?Y.geom.vertLeq(i.org,a.org)?Y.geom.edgeSign(a.dst(),i.org,a.org)<=0:Y.geom.edgeSign(i.dst(),a.org,i.org)>=0:Y.geom.edgeSign(a.dst(),n,a.org)<=0:a.dst()===n?Y.geom.edgeSign(i.dst(),n,i.org)>=0:Y.geom.edgeEval(i.dst(),n,i.org)>=Y.geom.edgeEval(a.dst(),n,a.org)},Y.sweep.deleteRegion_=function(e,t){t.fixUpperEdge,t.eUp.activeRegion=null,e.dict.deleteNode(t.nodeUp),t.nodeUp=null},Y.sweep.fixUpperEdge_=function(e,t){Y.mesh.deleteEdge(e.eUp),e.fixUpperEdge=!1,e.eUp=t,t.activeRegion=e},Y.sweep.topLeftRegion_=function(e){var t=e.eUp.org;do{e=e.regionAbove()}while(e.eUp.org===t);if(e.fixUpperEdge){var r=Y.mesh.connect(e.regionBelow().eUp.sym,e.eUp.lNext);Y.sweep.fixUpperEdge_(e,r),e=e.regionAbove()}return e},Y.sweep.topRightRegion_=function(e){var t=e.eUp.dst();do{e=e.regionAbove()}while(e.eUp.dst()===t);return e},Y.sweep.addRegionBelow_=function(e,t,r){var n=new Y.ActiveRegion;return n.eUp=r,n.nodeUp=e.dict.insertBefore(t.nodeUp,n),r.activeRegion=n,n},Y.sweep.isWindingInside_=function(e,t){switch(e.windingRule){case Y.windingRule.GLU_TESS_WINDING_ODD:return 0!==(1&t);case Y.windingRule.GLU_TESS_WINDING_NONZERO:return 0!==t;case Y.windingRule.GLU_TESS_WINDING_POSITIVE:return t>0;case Y.windingRule.GLU_TESS_WINDING_NEGATIVE:return t<0;case Y.windingRule.GLU_TESS_WINDING_ABS_GEQ_TWO:return t>=2||t<=-2}return!1},Y.sweep.computeWinding_=function(e,t){t.windingNumber=t.regionAbove().windingNumber+t.eUp.winding,t.inside=Y.sweep.isWindingInside_(e,t.windingNumber)},Y.sweep.finishRegion_=function(e,t){var r=t.eUp,n=r.lFace;n.inside=t.inside,n.anEdge=r,Y.sweep.deleteRegion_(e,t)},Y.sweep.finishLeftRegions_=function(e,t,r){for(var n=t,i=t.eUp;n!==r;){n.fixUpperEdge=!1;var a=n.regionBelow(),o=a.eUp;if(o.org!==i.org){if(!a.fixUpperEdge){Y.sweep.finishRegion_(e,n);break}o=Y.mesh.connect(i.lPrev(),o.sym),Y.sweep.fixUpperEdge_(a,o)}i.oNext!==o&&(Y.mesh.meshSplice(o.oPrev(),o),Y.mesh.meshSplice(i,o)),Y.sweep.finishRegion_(e,n),i=a.eUp,n=a}return i},Y.sweep.addRightEdges_=function(e,t,r,n,i,a){var o=!0,s=r;do{Y.sweep.addRegionBelow_(e,t,s.sym),s=s.oNext}while(s!==n);null===i&&(i=t.regionBelow().eUp.rPrev());for(var l,c=t,u=i;(s=(l=c.regionBelow()).eUp.sym).org===u.org;)s.oNext!==u&&(Y.mesh.meshSplice(s.oPrev(),s),Y.mesh.meshSplice(u.oPrev(),s)),l.windingNumber=c.windingNumber-s.winding,l.inside=Y.sweep.isWindingInside_(e,l.windingNumber),c.dirty=!0,!o&&Y.sweep.checkForRightSplice_(e,c)&&(Y.sweep.addWinding_(s,u),Y.sweep.deleteRegion_(e,c),Y.mesh.deleteEdge(u)),o=!1,c=l,u=s;c.dirty=!0,a&&Y.sweep.walkDirtyRegions_(e,c)},Y.sweep.callCombine_=function(e,t,r,n,i){var a=[t.coords[0],t.coords[1],t.coords[2]];t.data=null,t.data=e.callCombineOrCombineData(a,r,n),null===t.data&&(i?e.fatalError||(e.callErrorOrErrorData(Y.errorType.GLU_TESS_NEED_COMBINE_CALLBACK),e.fatalError=!0):t.data=r[0])},Y.sweep.spliceMergeVertices_=function(e,t,r){var n=[null,null,null,null];n[0]=t.org.data,n[1]=r.org.data,Y.sweep.callCombine_(e,t.org,n,[.5,.5,0,0],!1),Y.mesh.meshSplice(t,r)},Y.sweep.vertexWeights_=function(e,t,r,n,i){var a=Y.geom.vertL1dist(t,e),o=Y.geom.vertL1dist(r,e),s=i,l=i+1;n[s]=.5*o/(a+o),n[l]=.5*a/(a+o),e.coords[0]+=n[s]*t.coords[0]+n[l]*r.coords[0],e.coords[1]+=n[s]*t.coords[1]+n[l]*r.coords[1],e.coords[2]+=n[s]*t.coords[2]+n[l]*r.coords[2]},Y.sweep.getIntersectData_=function(e,t,r,n,i,a){var o=[0,0,0,0],s=[r.data,n.data,i.data,a.data];t.coords[0]=t.coords[1]=t.coords[2]=0,Y.sweep.vertexWeights_(t,r,n,o,0),Y.sweep.vertexWeights_(t,i,a,o,2),Y.sweep.callCombine_(e,t,s,o,!0)},Y.sweep.checkForRightSplice_=function(e,t){var r=t.regionBelow(),n=t.eUp,i=r.eUp;if(Y.geom.vertLeq(n.org,i.org)){if(Y.geom.edgeSign(i.dst(),n.org,i.org)>0)return!1;Y.geom.vertEq(n.org,i.org)?n.org!==i.org&&(e.pq.remove(n.org.pqHandle),Y.sweep.spliceMergeVertices_(e,i.oPrev(),n)):(Y.mesh.splitEdge(i.sym),Y.mesh.meshSplice(n,i.oPrev()),t.dirty=r.dirty=!0)}else{if(Y.geom.edgeSign(n.dst(),i.org,n.org)<0)return!1;t.regionAbove().dirty=t.dirty=!0,Y.mesh.splitEdge(n.sym),Y.mesh.meshSplice(i.oPrev(),n)}return!0},Y.sweep.checkForLeftSplice_=function(e,t){var r,n=t.regionBelow(),i=t.eUp,a=n.eUp;if(Y.geom.vertLeq(i.dst(),a.dst())){if(Y.geom.edgeSign(i.dst(),a.dst(),i.org)<0)return!1;t.regionAbove().dirty=t.dirty=!0,r=Y.mesh.splitEdge(i),Y.mesh.meshSplice(a.sym,r),r.lFace.inside=t.inside}else{if(Y.geom.edgeSign(a.dst(),i.dst(),a.org)>0)return!1;t.dirty=n.dirty=!0,r=Y.mesh.splitEdge(a),Y.mesh.meshSplice(i.lNext,a.sym),r.rFace().inside=t.inside}return!0},Y.sweep.checkForIntersect_=function(e,t){var r=t.regionBelow(),n=t.eUp,i=r.eUp,a=n.org,o=i.org,s=n.dst(),l=i.dst(),c=new Y.GluVertex;if(a===o)return!1;if(Math.min(a.t,s.t)>Math.max(o.t,l.t))return!1;if(Y.geom.vertLeq(a,o)){if(Y.geom.edgeSign(l,a,o)>0)return!1}else if(Y.geom.edgeSign(s,o,a)<0)return!1;Y.geom.edgeIntersect(s,a,l,o,c),Y.geom.vertLeq(c,e.event)&&(c.s=e.event.s,c.t=e.event.t);var u=Y.geom.vertLeq(a,o)?a:o;if(Y.geom.vertLeq(u,c)&&(c.s=u.s,c.t=u.t),Y.geom.vertEq(c,a)||Y.geom.vertEq(c,o))return Y.sweep.checkForRightSplice_(e,t),!1;if(!Y.geom.vertEq(s,e.event)&&Y.geom.edgeSign(s,e.event,c)>=0||!Y.geom.vertEq(l,e.event)&&Y.geom.edgeSign(l,e.event,c)<=0){if(l===e.event)return Y.mesh.splitEdge(n.sym),Y.mesh.meshSplice(i.sym,n),n=(t=Y.sweep.topLeftRegion_(t)).regionBelow().eUp,Y.sweep.finishLeftRegions_(e,t.regionBelow(),r),Y.sweep.addRightEdges_(e,t,n.oPrev(),n,n,!0),!0;if(s===e.event){Y.mesh.splitEdge(i.sym),Y.mesh.meshSplice(n.lNext,i.oPrev()),r=t;var d=(t=Y.sweep.topRightRegion_(t)).regionBelow().eUp.rPrev();return r.eUp=i.oPrev(),i=Y.sweep.finishLeftRegions_(e,r,null),Y.sweep.addRightEdges_(e,t,i.oNext,n.rPrev(),d,!0),!0}return Y.geom.edgeSign(s,e.event,c)>=0&&(t.regionAbove().dirty=t.dirty=!0,Y.mesh.splitEdge(n.sym),n.org.s=e.event.s,n.org.t=e.event.t),Y.geom.edgeSign(l,e.event,c)<=0&&(t.dirty=r.dirty=!0,Y.mesh.splitEdge(i.sym),i.org.s=e.event.s,i.org.t=e.event.t),!1}return Y.mesh.splitEdge(n.sym),Y.mesh.splitEdge(i.sym),Y.mesh.meshSplice(i.oPrev(),n),n.org.s=c.s,n.org.t=c.t,n.org.pqHandle=e.pq.insert(n.org),Y.sweep.getIntersectData_(e,n.org,a,s,o,l),t.regionAbove().dirty=t.dirty=r.dirty=!0,!1},Y.sweep.walkDirtyRegions_=function(e,t){for(var r=t.regionBelow();;){for(;r.dirty;)t=r,r=r.regionBelow();if(!t.dirty&&(r=t,null===(t=t.regionAbove())||!t.dirty))return;t.dirty=!1;var n=t.eUp,i=r.eUp;if(n.dst()!==i.dst()&&Y.sweep.checkForLeftSplice_(e,t)&&(r.fixUpperEdge?(Y.sweep.deleteRegion_(e,r),Y.mesh.deleteEdge(i),i=(r=t.regionBelow()).eUp):t.fixUpperEdge&&(Y.sweep.deleteRegion_(e,t),Y.mesh.deleteEdge(n),n=(t=r.regionAbove()).eUp)),n.org!==i.org)if(n.dst()===i.dst()||t.fixUpperEdge||r.fixUpperEdge||n.dst()!==e.event&&i.dst()!==e.event)Y.sweep.checkForRightSplice_(e,t);else if(Y.sweep.checkForIntersect_(e,t))return;n.org===i.org&&n.dst()===i.dst()&&(Y.sweep.addWinding_(i,n),Y.sweep.deleteRegion_(e,t),Y.mesh.deleteEdge(n),t=r.regionAbove())}},Y.sweep.connectRightVertex_=function(e,t,r){var n,i=r.oNext,a=t.regionBelow(),o=t.eUp,s=a.eUp,l=!1;(o.dst()!==s.dst()&&Y.sweep.checkForIntersect_(e,t),Y.geom.vertEq(o.org,e.event)&&(Y.mesh.meshSplice(i.oPrev(),o),i=(t=Y.sweep.topLeftRegion_(t)).regionBelow().eUp,Y.sweep.finishLeftRegions_(e,t.regionBelow(),a),l=!0),Y.geom.vertEq(s.org,e.event)&&(Y.mesh.meshSplice(r,s.oPrev()),r=Y.sweep.finishLeftRegions_(e,a,null),l=!0),l)?Y.sweep.addRightEdges_(e,t,r.oNext,i,i,!0):(n=Y.geom.vertLeq(s.org,o.org)?s.oPrev():o,n=Y.mesh.connect(r.lPrev(),n),Y.sweep.addRightEdges_(e,t,n,n.oNext,n.oNext,!1),n.sym.activeRegion.fixUpperEdge=!0,Y.sweep.walkDirtyRegions_(e,t))},Y.sweep.connectLeftDegenerate_=function(e,t,r){var n=t.eUp;if(Y.geom.vertEq(n.org,r))Y.sweep.TOLERANCE_NONZERO_&&Y.sweep.spliceMergeVertices_(e,n,r.anEdge);else{if(!Y.geom.vertEq(n.dst(),r))return Y.mesh.splitEdge(n.sym),t.fixUpperEdge&&(Y.mesh.deleteEdge(n.oNext),t.fixUpperEdge=!1),Y.mesh.meshSplice(r.anEdge,n),void Y.sweep.sweepEvent_(e,r);if(Y.sweep.TOLERANCE_NONZERO_){var i=(t=Y.sweep.topRightRegion_(t)).regionBelow(),a=i.eUp.sym,o=a.oNext,s=o;i.fixUpperEdge&&(Y.sweep.deleteRegion_(e,i),Y.mesh.deleteEdge(a),a=o.oPrev()),Y.mesh.meshSplice(r.anEdge,a),Y.geom.edgeGoesLeft(o)||(o=null),Y.sweep.addRightEdges_(e,t,a.oNext,s,o,!0)}}},Y.sweep.connectLeftVertex_=function(e,t){var r=new Y.ActiveRegion;r.eUp=t.anEdge.sym;var n=e.dict.search(r).getKey(),i=n.regionBelow(),a=n.eUp,o=i.eUp;if(0!==Y.geom.edgeSign(a.dst(),t,a.org)){var s,l=Y.geom.vertLeq(o.dst(),a.dst())?n:i;if(n.inside||l.fixUpperEdge){if(l===n)s=Y.mesh.connect(t.anEdge.sym,a.lNext);else s=Y.mesh.connect(o.dNext(),t.anEdge).sym;l.fixUpperEdge?Y.sweep.fixUpperEdge_(l,s):Y.sweep.computeWinding_(e,Y.sweep.addRegionBelow_(e,n,s)),Y.sweep.sweepEvent_(e,t)}else Y.sweep.addRightEdges_(e,n,t.anEdge,t.anEdge,null,!0)}else Y.sweep.connectLeftDegenerate_(e,n,t)},Y.sweep.sweepEvent_=function(e,t){e.event=t;for(var r=t.anEdge;null===r.activeRegion;)if((r=r.oNext)===t.anEdge)return void Y.sweep.connectLeftVertex_(e,t);var n=Y.sweep.topLeftRegion_(r.activeRegion),i=n.regionBelow(),a=i.eUp,o=Y.sweep.finishLeftRegions_(e,i,null);o.oNext===a?Y.sweep.connectRightVertex_(e,n,o):Y.sweep.addRightEdges_(e,n,o.oNext,a,a,!0)},Y.sweep.addSentinel_=function(e,t){var r=new Y.ActiveRegion,n=Y.mesh.makeEdge(e.mesh);n.org.s=Y.sweep.SENTINEL_COORD_,n.org.t=t,n.dst().s=-Y.sweep.SENTINEL_COORD_,n.dst().t=t,e.event=n.dst(),r.eUp=n,r.windingNumber=0,r.inside=!1,r.fixUpperEdge=!1,r.sentinel=!0,r.dirty=!1,r.nodeUp=e.dict.insert(r)},Y.sweep.initEdgeDict_=function(e){e.dict=new Y.Dict(e,Y.sweep.edgeLeq_),Y.sweep.addSentinel_(e,-Y.sweep.SENTINEL_COORD_),Y.sweep.addSentinel_(e,Y.sweep.SENTINEL_COORD_)},Y.sweep.doneEdgeDict_=function(e){for(var t;null!==(t=e.dict.getMin().getKey());)t.sentinel,Y.sweep.deleteRegion_(e,t);e.dict=null},Y.sweep.removeDegenerateEdges_=function(e){for(var t,r=e.mesh.eHead,n=r.next;n!==r;n=t){t=n.next;var i=n.lNext;Y.geom.vertEq(n.org,n.dst())&&n.lNext.lNext!==n&&(Y.sweep.spliceMergeVertices_(e,i,n),Y.mesh.deleteEdge(n),i=(n=i).lNext),i.lNext===n&&(i!==n&&(i!==t&&i!==t.sym||(t=t.next),Y.mesh.deleteEdge(i)),n!==t&&n!==t.sym||(t=t.next),Y.mesh.deleteEdge(n))}},Y.sweep.initPriorityQ_=function(e){var t=new Y.PriorityQ(Y.geom.vertLeq);e.pq=t;var r,n=e.mesh.vHead;for(r=n.next;r!==n;r=r.next)r.pqHandle=t.insert(r);t.init()},Y.sweep.donePriorityQ_=function(e){e.pq.deleteQ(),e.pq=null},Y.sweep.removeDegenerateFaces_=function(e){for(var t,r=e.fHead.next;r!==e.fHead;r=t){t=r.next;var n=r.anEdge;n.lNext.lNext===n&&(Y.sweep.addWinding_(n.oNext,n),Y.mesh.deleteEdge(n))}},Y.tessmono={},Y.tessmono.tessellateMonoRegion_=function(e){for(var t=e.anEdge;Y.geom.vertLeq(t.dst(),t.org);t=t.lPrev());for(;Y.geom.vertLeq(t.org,t.dst());t=t.lNext);for(var r,n=t.lPrev();t.lNext!==n;)if(Y.geom.vertLeq(t.dst(),n.org)){for(;n.lNext!==t&&(Y.geom.edgeGoesLeft(n.lNext)||Y.geom.edgeSign(n.org,n.dst(),n.lNext.dst())<=0);)n=(r=Y.mesh.connect(n.lNext,n)).sym;n=n.lPrev()}else{for(;n.lNext!==t&&(Y.geom.edgeGoesRight(t.lPrev())||Y.geom.edgeSign(t.dst(),t.org,t.lPrev().org)>=0);)r=Y.mesh.connect(t,t.lPrev()),t=r.sym;t=t.lNext}for(;n.lNext.lNext!==t;)n=(r=Y.mesh.connect(n.lNext,n)).sym},Y.tessmono.tessellateInterior=function(e){for(var t,r=e.fHead.next;r!==e.fHead;r=t)t=r.next,r.inside&&Y.tessmono.tessellateMonoRegion_(r)},Y.tessmono.discardExterior=function(e){for(var t,r=e.fHead.next;r!==e.fHead;r=t)t=r.next,r.inside||Y.mesh.zapFace(r)},Y.tessmono.setWindingNumber=function(e,t,r){for(var n,i=e.eHead.next;i!==e.eHead;i=n)n=i.next,i.rFace().inside!==i.lFace.inside?i.winding=i.lFace.inside?t:-t:r?Y.mesh.deleteEdge(i):i.winding=0},Y.Dict=function(e,t){this.head_=new Y.DictNode,this.frame_=e,this.leq_=t},Y.Dict.prototype.deleteDict_=function(){},Y.Dict.prototype.insertBefore=function(e,t){do{e=e.prev}while(null!==e.key&&!this.leq_(this.frame_,e.key,t));var r=new Y.DictNode(t,e.next,e);return e.next.prev=r,e.next=r,r},Y.Dict.prototype.insert=function(e){return this.insertBefore(this.head_,e)},Y.Dict.prototype.deleteNode=function(e){e.next.prev=e.prev,e.prev.next=e.next},Y.Dict.prototype.search=function(e){var t=this.head_;do{t=t.next}while(null!==t.key&&!this.leq_(this.frame_,e,t.key));return t},Y.Dict.prototype.getMin=function(){return this.head_.next},Y.Dict.prototype.getMax=function(){return this.head_.prev},Y.DictNode=function(e,t,r){this.key=e||null,this.next=t||this,this.prev=r||this},Y.DictNode.prototype.getKey=function(){return this.key},Y.DictNode.prototype.getSuccessor=function(){return this.next},Y.DictNode.prototype.getPredecessor=function(){return this.prev},Y.CachedVertex=function(){this.coords=[0,0,0],this.data=null},Y.GluTesselator=function(){this.state=Y.GluTesselator.tessState_.T_DORMANT,this.lastEdge_=null,this.mesh=null,this.callError_=null,this.normal=[0,0,0],this.sUnit=[0,0,0],this.tUnit=[0,0,0],this.relTolerance=Y.GLU_TESS_DEFAULT_TOLERANCE,this.windingRule=Y.windingRule.GLU_TESS_WINDING_ODD,this.fatalError=!1,this.dict=null,this.pq=null,this.event=null,this.callCombine_=null,this.boundaryOnly=!1,this.callBegin_=null,this.callEdgeFlag_=null,this.callVertex_=null,this.callEnd_=null,this.callMesh_=null,this.callBeginData_=null,this.callEdgeFlagData_=null,this.callVertexData_=null,this.callEndData_=null,this.callErrorData_=null,this.callCombineData_=null,this.polygonData_=null,this.emptyCache=!1,this.cacheCount=0,this.cache=new Array(Y.TESS_MAX_CACHE);for(var e=0;e<Y.TESS_MAX_CACHE;e++)this.cache[e]=new Y.CachedVertex},Y.GluTesselator.tessState_={T_DORMANT:0,T_IN_POLYGON:1,T_IN_CONTOUR:2},Y.GluTesselator.prototype.gluDeleteTess=function(){this.requireState_(Y.GluTesselator.tessState_.T_DORMANT)},Y.GluTesselator.prototype.gluTessProperty=function(e,t){switch(e){case Y.gluEnum.GLU_TESS_TOLERANCE:if(t<0||t>1)break;return void(this.relTolerance=t);case Y.gluEnum.GLU_TESS_WINDING_RULE:var r=t;switch(r){case Y.windingRule.GLU_TESS_WINDING_ODD:case Y.windingRule.GLU_TESS_WINDING_NONZERO:case Y.windingRule.GLU_TESS_WINDING_POSITIVE:case Y.windingRule.GLU_TESS_WINDING_NEGATIVE:case Y.windingRule.GLU_TESS_WINDING_ABS_GEQ_TWO:return void(this.windingRule=r)}break;case Y.gluEnum.GLU_TESS_BOUNDARY_ONLY:return void(this.boundaryOnly=!!t);default:return void this.callErrorOrErrorData(Y.gluEnum.GLU_INVALID_ENUM)}this.callErrorOrErrorData(Y.gluEnum.GLU_INVALID_VALUE)},Y.GluTesselator.prototype.gluGetTessProperty=function(e){switch(e){case Y.gluEnum.GLU_TESS_TOLERANCE:return this.relTolerance;case Y.gluEnum.GLU_TESS_WINDING_RULE:return this.windingRule;case Y.gluEnum.GLU_TESS_BOUNDARY_ONLY:return this.boundaryOnly;default:this.callErrorOrErrorData(Y.gluEnum.GLU_INVALID_ENUM)}return!1},Y.GluTesselator.prototype.gluTessNormal=function(e,t,r){this.normal[0]=e,this.normal[1]=t,this.normal[2]=r},Y.GluTesselator.prototype.gluTessCallback=function(e,t){var r=t||null;switch(e){case Y.gluEnum.GLU_TESS_BEGIN:return void(this.callBegin_=r);case Y.gluEnum.GLU_TESS_BEGIN_DATA:return void(this.callBeginData_=r);case Y.gluEnum.GLU_TESS_EDGE_FLAG:return void(this.callEdgeFlag_=r);case Y.gluEnum.GLU_TESS_EDGE_FLAG_DATA:return void(this.callEdgeFlagData_=r);case Y.gluEnum.GLU_TESS_VERTEX:return void(this.callVertex_=r);case Y.gluEnum.GLU_TESS_VERTEX_DATA:return void(this.callVertexData_=r);case Y.gluEnum.GLU_TESS_END:return void(this.callEnd_=r);case Y.gluEnum.GLU_TESS_END_DATA:return void(this.callEndData_=r);case Y.gluEnum.GLU_TESS_ERROR:return void(this.callError_=r);case Y.gluEnum.GLU_TESS_ERROR_DATA:return void(this.callErrorData_=r);case Y.gluEnum.GLU_TESS_COMBINE:return void(this.callCombine_=r);case Y.gluEnum.GLU_TESS_COMBINE_DATA:return void(this.callCombineData_=r);case Y.gluEnum.GLU_TESS_MESH:return void(this.callMesh_=r);default:return void this.callErrorOrErrorData(Y.gluEnum.GLU_INVALID_ENUM)}},Y.GluTesselator.prototype.gluTessVertex=function(e,t){var r=!1,n=[0,0,0];this.requireState_(Y.GluTesselator.tessState_.T_IN_CONTOUR),this.emptyCache&&(this.emptyCache_(),this.lastEdge_=null);for(var i=0;i<3;++i){var a=e[i];a<-Y.GLU_TESS_MAX_COORD&&(a=-Y.GLU_TESS_MAX_COORD,r=!0),a>Y.GLU_TESS_MAX_COORD&&(a=Y.GLU_TESS_MAX_COORD,r=!0),n[i]=a}if(r&&this.callErrorOrErrorData(Y.errorType.GLU_TESS_COORD_TOO_LARGE),null===this.mesh){if(this.cacheCount<Y.TESS_MAX_CACHE)return void this.cacheVertex_(n,t);this.emptyCache_()}this.addVertex_(n,t)},Y.GluTesselator.prototype.gluTessBeginPolygon=function(e){this.requireState_(Y.GluTesselator.tessState_.T_DORMANT),this.state=Y.GluTesselator.tessState_.T_IN_POLYGON,this.cacheCount=0,this.emptyCache=!1,this.mesh=null,this.polygonData_=e},Y.GluTesselator.prototype.gluTessBeginContour=function(){this.requireState_(Y.GluTesselator.tessState_.T_IN_POLYGON),this.state=Y.GluTesselator.tessState_.T_IN_CONTOUR,this.lastEdge_=null,this.cacheCount>0&&(this.emptyCache=!0)},Y.GluTesselator.prototype.gluTessEndContour=function(){this.requireState_(Y.GluTesselator.tessState_.T_IN_CONTOUR),this.state=Y.GluTesselator.tessState_.T_IN_POLYGON},Y.GluTesselator.prototype.gluTessEndPolygon=function(){if(this.requireState_(Y.GluTesselator.tessState_.T_IN_POLYGON),this.state=Y.GluTesselator.tessState_.T_DORMANT,null===this.mesh&&this.emptyCache_(),Y.normal.projectPolygon(this),Y.sweep.computeInterior(this),!this.fatalError){var e=this.mesh;if(this.boundaryOnly?Y.tessmono.setWindingNumber(e,1,!0):Y.tessmono.tessellateInterior(e),this.mesh.checkMesh(),this.callBegin_||this.callEnd_||this.callVertex_||this.callEdgeFlag_||this.callBeginData_||this.callEndData_||this.callVertexData_||this.callEdgeFlagData_)if(this.boundaryOnly)Y.render.renderBoundary(this,this.mesh);else{var t=!(!this.callEdgeFlag_&&!this.callEdgeFlagData_);Y.render.renderMesh(this,this.mesh,t)}if(this.callMesh_)return Y.tessmono.discardExterior(this.mesh),this.callMesh_(this.mesh),this.mesh=null,void(this.polygonData_=null)}Y.mesh.deleteMesh(this.mesh),this.polygonData_=null,this.mesh=null},Y.GluTesselator.prototype.makeDormant_=function(){this.mesh&&Y.mesh.deleteMesh(this.mesh),this.state=Y.GluTesselator.tessState_.T_DORMANT,this.lastEdge_=null,this.mesh=null},Y.GluTesselator.prototype.requireState_=function(e){this.state!==e&&this.gotoState_(e)},Y.GluTesselator.prototype.gotoState_=function(e){for(;this.state!==e;)if(this.state<e)switch(this.state){case Y.GluTesselator.tessState_.T_DORMANT:this.callErrorOrErrorData(Y.errorType.GLU_TESS_MISSING_BEGIN_POLYGON),this.gluTessBeginPolygon(null);break;case Y.GluTesselator.tessState_.T_IN_POLYGON:this.callErrorOrErrorData(Y.errorType.GLU_TESS_MISSING_BEGIN_CONTOUR),this.gluTessBeginContour()}else switch(this.state){case Y.GluTesselator.tessState_.T_IN_CONTOUR:this.callErrorOrErrorData(Y.errorType.GLU_TESS_MISSING_END_CONTOUR),this.gluTessEndContour();break;case Y.GluTesselator.tessState_.T_IN_POLYGON:this.callErrorOrErrorData(Y.errorType.GLU_TESS_MISSING_END_POLYGON),this.makeDormant_()}},Y.GluTesselator.prototype.addVertex_=function(e,t){var r=this.lastEdge_;null===r?(r=Y.mesh.makeEdge(this.mesh),Y.mesh.meshSplice(r,r.sym)):(Y.mesh.splitEdge(r),r=r.lNext),r.org.data=t,r.org.coords[0]=e[0],r.org.coords[1]=e[1],r.org.coords[2]=e[2],r.winding=1,r.sym.winding=-1,this.lastEdge_=r},Y.GluTesselator.prototype.cacheVertex_=function(e,t){var r=this.cache[this.cacheCount];r.data=t,r.coords[0]=e[0],r.coords[1]=e[1],r.coords[2]=e[2],++this.cacheCount},Y.GluTesselator.prototype.emptyCache_=function(){this.mesh=new Y.GluMesh;for(var e=0;e<this.cacheCount;e++){var t=this.cache[e];this.addVertex_(t.coords,t.data)}this.cacheCount=0,this.emptyCache=!1},Y.GluTesselator.prototype.callBeginOrBeginData=function(e){this.callBeginData_?this.callBeginData_(e,this.polygonData_):this.callBegin_&&this.callBegin_(e)},Y.GluTesselator.prototype.callVertexOrVertexData=function(e){this.callVertexData_?this.callVertexData_(e,this.polygonData_):this.callVertex_&&this.callVertex_(e)},Y.GluTesselator.prototype.callEdgeFlagOrEdgeFlagData=function(e){this.callEdgeFlagData_?this.callEdgeFlagData_(e,this.polygonData_):this.callEdgeFlag_&&this.callEdgeFlag_(e)},Y.GluTesselator.prototype.callEndOrEndData=function(){this.callEndData_?this.callEndData_(this.polygonData_):this.callEnd_&&this.callEnd_()},Y.GluTesselator.prototype.callCombineOrCombineData=function(e,t,r){var n;return this.callCombineData_?n=this.callCombineData_(e,t,r,this.polygonData_):this.callCombine_&&(n=this.callCombine_(e,t,r)),void 0===n&&(n=null),n},Y.GluTesselator.prototype.callErrorOrErrorData=function(e){this.callErrorData_?this.callErrorData_(e,this.polygonData_):this.callError_&&this.callError_(e)},Y.GluFace=function(e,t){this.next=e||this,this.prev=t||this,this.anEdge=null,this.data=null,this.inside=!1},Y.GluHalfEdge=function(e){this.next=e||this,this.sym=null,this.oNext=null,this.lNext=null,this.org=null,this.lFace=null,this.activeRegion=null,this.winding=0},Y.GluHalfEdge.prototype.rFace=function(){return this.sym.lFace},Y.GluHalfEdge.prototype.dst=function(){return this.sym.org},Y.GluHalfEdge.prototype.oPrev=function(){return this.sym.lNext},Y.GluHalfEdge.prototype.lPrev=function(){return this.oNext.sym},Y.GluHalfEdge.prototype.dPrev=function(){return this.lNext.sym},Y.GluHalfEdge.prototype.rPrev=function(){return this.sym.oNext},Y.GluHalfEdge.prototype.dNext=function(){return this.rPrev().sym},Y.GluHalfEdge.prototype.rNext=function(){return this.oPrev().sym},Y.GluMesh=function(){this.vHead=new Y.GluVertex,this.fHead=new Y.GluFace,this.eHead=new Y.GluHalfEdge,this.eHeadSym=new Y.GluHalfEdge,this.eHead.sym=this.eHeadSym,this.eHeadSym.sym=this.eHead},Y.GluMesh.prototype.checkMesh=function(){if(Y.DEBUG){var e,t,r,n=this.fHead,i=this.vHead,a=this.eHead,o=n;for(o=n;(t=o.next)!==n;o=t){e=t.anEdge;do{e=e.lNext}while(e!==t.anEdge)}var s=i;for(s=i;(r=s.next)!==i;s=r){e=r.anEdge;do{e=e.oNext}while(e!==r.anEdge)}var l=a;for(l=a;(e=l.next)!==a;l=e);}},Y.GluVertex=function(e,t){this.next=e||this,this.prev=t||this,this.anEdge=null,this.data=null,this.coords=[0,0,0],this.s=0,this.t=0,this.pqHandle=null},Y.PQHandleElem=function(){this.key=null,this.node=0},Y.PQHandleElem.realloc=function(e,t){var r=new Array(t),n=0;if(null!==e)for(;n<e.length;n++)r[n]=e[n];for(;n<t;n++)r[n]=new Y.PQHandleElem;return r},Y.PQNode=function(){this.handle=0},Y.PQNode.realloc=function(e,t){var r=new Array(t),n=0;if(null!==e)for(;n<e.length;n++)r[n]=e[n];for(;n<t;n++)r[n]=new Y.PQNode;return r},Y.PriorityQ=function(e){this.keys_=Y.PriorityQ.prototype.PQKeyRealloc_(null,Y.PriorityQ.INIT_SIZE_),this.order_=null,this.size_=0,this.max_=Y.PriorityQ.INIT_SIZE_,this.initialized_=!1,this.leq_=e,this.heap_=new Y.PriorityQHeap(this.leq_)},Y.PriorityQ.INIT_SIZE_=32,Y.PriorityQ.prototype.deleteQ=function(){this.heap_.deleteHeap(),this.heap_=null,this.order_=null,this.keys_=null},Y.PriorityQ.prototype.init=function(){this.order_=[];for(var e=0;e<this.size_;e++)this.order_[e]=e;var t,r,n=(t=this.keys_,r=this.leq_,function(e,n){return r(t[e],t[n])?1:-1});if(this.order_.sort(n),this.max_=this.size_,this.initialized_=!0,this.heap_.init(),Y.DEBUG){var i=0+this.size_-1;for(e=0;e<i;++e);}},Y.PriorityQ.prototype.insert=function(e){if(this.initialized_)return this.heap_.insert(e);var t=this.size_;return++this.size_>=this.max_&&(this.max_*=2,this.keys_=Y.PriorityQ.prototype.PQKeyRealloc_(this.keys_,this.max_)),this.keys_[t]=e,-(t+1)},Y.PriorityQ.prototype.PQKeyRealloc_=function(e,t){var r=new Array(t),n=0;if(null!==e)for(;n<e.length;n++)r[n]=e[n];for(;n<t;n++)r[n]=null;return r},Y.PriorityQ.prototype.keyLessThan_=function(e,t){var r=this.keys_[e],n=this.keys_[t];return!this.leq_(n,r)},Y.PriorityQ.prototype.keyGreaterThan_=function(e,t){var r=this.keys_[e],n=this.keys_[t];return!this.leq_(r,n)},Y.PriorityQ.prototype.extractMin=function(){if(0===this.size_)return this.heap_.extractMin();var e=this.keys_[this.order_[this.size_-1]];if(!this.heap_.isEmpty()){var t=this.heap_.minimum();if(this.leq_(t,e))return this.heap_.extractMin()}do{--this.size_}while(this.size_>0&&null===this.keys_[this.order_[this.size_-1]]);return e},Y.PriorityQ.prototype.minimum=function(){if(0===this.size_)return this.heap_.minimum();var e=this.keys_[this.order_[this.size_-1]];if(!this.heap_.isEmpty()){var t=this.heap_.minimum();if(this.leq_(t,e))return t}return e},Y.PriorityQ.prototype.isEmpty_=function(){return 0===this.size_&&this.heap_.isEmpty()},Y.PriorityQ.prototype.remove=function(e){if(e>=0)this.heap_.remove(e);else for(e=-(e+1),this.keys_[e]=null;this.size_>0&&null===this.keys_[this.order_[this.size_-1]];)--this.size_},Y.PriorityQHeap=function(e){this.nodes_=Y.PQNode.realloc(null,Y.PriorityQHeap.INIT_SIZE_+1),this.handles_=Y.PQHandleElem.realloc(null,Y.PriorityQHeap.INIT_SIZE_+1),this.size_=0,this.max_=Y.PriorityQHeap.INIT_SIZE_,this.freeList_=0,this.initialized_=!1,this.leq_=e,this.nodes_[1].handle=1},Y.PriorityQHeap.INIT_SIZE_=32,Y.PriorityQHeap.prototype.deleteHeap=function(){this.handles_=null,this.nodes_=null},Y.PriorityQHeap.prototype.init=function(){for(var e=this.size_;e>=1;--e)this.floatDown_(e);this.initialized_=!0},Y.PriorityQHeap.prototype.insert=function(e){var t,r=++this.size_;return 2*r>this.max_&&(this.max_*=2,this.nodes_=Y.PQNode.realloc(this.nodes_,this.max_+1),this.handles_=Y.PQHandleElem.realloc(this.handles_,this.max_+1)),0===this.freeList_?t=r:(t=this.freeList_,this.freeList_=this.handles_[t].node),this.nodes_[r].handle=t,this.handles_[t].node=r,this.handles_[t].key=e,this.initialized_&&this.floatUp_(r),t},Y.PriorityQHeap.prototype.isEmpty=function(){return 0===this.size_},Y.PriorityQHeap.prototype.minimum=function(){return this.handles_[this.nodes_[1].handle].key},Y.PriorityQHeap.prototype.extractMin=function(){var e=this.nodes_,t=this.handles_,r=e[1].handle,n=t[r].key;return this.size_>0&&(e[1].handle=e[this.size_].handle,t[e[1].handle].node=1,t[r].key=null,t[r].node=this.freeList_,this.freeList_=r,--this.size_>0&&this.floatDown_(1)),n},Y.PriorityQHeap.prototype.remove=function(e){var t=this.nodes_,r=this.handles_,n=r[e].node;t[n].handle=t[this.size_].handle,r[t[n].handle].node=n,n<=--this.size_&&(n<=1||this.leq_(r[t[n>>1].handle].key,r[t[n].handle].key)?this.floatDown_(n):this.floatUp_(n)),r[e].key=null,r[e].node=this.freeList_,this.freeList_=e},Y.PriorityQHeap.prototype.floatDown_=function(e){for(var t=this.nodes_,r=this.handles_,n=t[e].handle;;){var i=e<<1;i<this.size_&&this.leq_(r[t[i+1].handle].key,r[t[i].handle].key)&&++i;var a=t[i].handle;if(i>this.size_||this.leq_(r[n].key,r[a].key)){t[e].handle=n,r[n].node=e;break}t[e].handle=a,r[a].node=e,e=i}},Y.PriorityQHeap.prototype.floatUp_=function(e){for(var t=this.nodes_,r=this.handles_,n=t[e].handle;;){var i=e>>1,a=t[i].handle;if(0===i||this.leq_(r[a].key,r[n].key)){t[e].handle=n,r[n].node=e;break}t[e].handle=a,r[a].node=e,e=i}},Y.ActiveRegion=function(){this.eUp=null,this.nodeUp=null,this.windingNumber=0,this.inside=!1,this.sentinel=!1,this.dirty=!1,this.fixUpperEdge=!1},Y.ActiveRegion.prototype.regionBelow=function(){return this.nodeUp.getPredecessor().getKey()},Y.ActiveRegion.prototype.regionAbove=function(){return this.nodeUp.getSuccessor().getKey()};var Q=Y,X=function(e){Object(q.a)(r,e);var t=Object(K.a)(r);function r(e){var n;Object(P.a)(this,r);return(n=t.call(this,e,"attribute vec3 a_position;\nuniform vec2 u_resolution;\nvoid main() {\n   vec2 zeroToOne = a_position.xy / u_resolution;\n   vec2 zeroToTwo = zeroToOne * 2.0;\n   vec2 clipSpace = zeroToTwo - 1.0;\n   gl_Position = vec4(clipSpace, 0, 1);\n}","precision mediump float;\nuniform vec4 color;\nvoid main() {\n   gl_FragColor = color;\n}",["a_position"])).resolutionLocation=n.uniformLocation(e,"u_resolution"),n.colorLocation=n.uniformLocation(e,"color"),n.localCache={resolution:{width:null,height:null},color:{r:null,g:null,b:null,a:null}},n}return Object(M.a)(r,[{key:"loadResolution",value:function(e,t,r){this.localCache.resolution.width===t&&this.localCache.resolution.height===r||(e.uniform2f(this.resolutionLocation,t,r),this.localCache.resolution.width=t,this.localCache.resolution.height=r)}},{key:"loadColor",value:function(e,t){var r=this.localCache.color;if(r.r!==t.red||r.g!==t.green||r.b!==t.blue||r.a!==t.alpha){var n=t.alpha;e.uniform4f(this.colorLocation,t.red*n,t.green*n,t.blue*n,t.alpha),r.r=t.red,r.g=t.green,r.b=t.blue,r.a=t.alpha}}}]),r}(b.a.GpuProgram);X.key="WorldWindGpuScreenColorProgram";var Z=function(e){Object(q.a)(r,e);var t=Object(K.a)(r);function r(e){var n;Object(P.a)(this,r);return(n=t.call(this,e,"attribute vec3 a_position;\nattribute vec2 vertexTexCoord;\nuniform vec2 u_resolution;\nvarying vec2 texCoord;\nvoid main() {\n   vec2 zeroToOne = a_position.xy / u_resolution;\n   vec2 zeroToTwo = zeroToOne * 2.0;\n   vec2 clipSpace = zeroToTwo - 1.0;\n   gl_Position = vec4(clipSpace, 0, 1);\n   gl_PointSize = 3.0;\n   texCoord = vertexTexCoord;\n}","precision mediump float;\nuniform sampler2D textureSampler;\nvarying vec2 texCoord;\nvoid main() {\n   gl_FragColor = texture2D(textureSampler, texCoord);\n}",["a_position","vertexTexCoord"])).resolutionLocation=n.uniformLocation(e,"u_resolution"),n.texUnitLocation=n.uniformLocation(e,"textureSampler"),n.localCache={resolution:{width:null,height:null},textureUnit:null},n}return Object(M.a)(r,[{key:"loadResolution",value:function(e,t,r){this.localCache.resolution.width===t&&this.localCache.resolution.height===r||(e.uniform2f(this.resolutionLocation,t,r),this.localCache.resolution.width=t,this.localCache.resolution.height=r)}},{key:"loadTextureUnit",value:function(e,t){this.localCache.textureUnit!==t&&(e.uniform1i(this.texUnitLocation,t-e.TEXTURE0),this.localCache.textureUnit=t)}}]),r}(b.a.GpuProgram);Z.key="WorldWindGpuScreenTextureProgram";var J=b.a.Angle,$=b.a.SurfaceShape,ee=b.a.PickedObject,te=b.a.Texture,re=b.a.Location,ne=6378137,ie=function(e){Object(q.a)(r,e);var t=Object(K.a)(r);function r(e){var n;return Object(P.a)(this,r),(n=t.call(this,e))._image=null,n._imageUUID="",n._interiorVboCacheKey="",n._outlineVboCacheKey="",n._contoursPrepered=!1,n._contoursInfo=[],n._id=r.nextId(),n}return Object(M.a)(r,[{key:"image",get:function(){return this._image},set:function(e){this._image=e,this.stateKeyInvalid=!0}},{key:"imageUUID",get:function(){return this._imageUUID},set:function(e){this._imageUUID=e}},{key:"renderToTexture",value:function(e,t,r,n,i,a){var o=this._highlighted&&this._highlightAttributes||this._attributes,s=!this._isInteriorInhibited&&o.drawInterior,l=o.drawOutline&&o.outlineWidth>0;if(s||l){e.pickingMode&&!this.pickColor&&(this.pickColor=e.uniquePickColor());var c,u=this.mapGeometry(this._interiorGeometry,r,n,i,a);for(c=0;c<u.length;c++){if(!this._contoursPrepered){var d=this.windingOrder_all(u[c]);this._contoursInfo.push({wo:d})}var h=u[c];h[0]===h[h.length-2]&&h[1]===h[h.length-1]&&(h.pop(),h.pop())}if(!this._image||e.pickingMode||this.crossesAntiMeridian||this.containsPole)this.renderColor(e,{tileWidth:256,tileHeight:256,xScale:r,yScale:n,dx:i,dy:a,drawInterior:s,interiorColor:o.interiorColor,drawOutline:l,outlineColor:o.outlineColor}),this._contoursPrepered=!0;else{if(!this._contoursPrepered&&1===u.length){var g=this.getCorners(u[0],this._contoursInfo[0].wo),f=g.anglesMap,p=g.topLeftIndex,m=this.computeUvs(this._contoursInfo[0].wo,f,p,this._interiorGeometry[0]);this._contoursInfo[0].anglesMap=f,this._contoursInfo[0].topLeftIndex=p,this._contoursInfo[0].uvs=m;var _=this.tessellate_p1(u[0],m),v=[];for(c=0;c<_.length;c+=5)for(var b=_[c],y=_[c+1],E=0;E<u[0].length;E+=2){var S=u[0][E],x=u[0][E+1];if(S===b&&x===y){v.push(E/2);break}}this._contoursInfo[0].iboData=new Uint16Array(v);var w=5*Math.floor(u[0].length/2);this._contoursInfo[0].vboData=new Float32Array(w);var T=this._contoursInfo[0].vboData,O=0;for(c=0;c<T.length;c+=5)T[c]=u[O],T[c+1]=u[O+1],T[c+2]=0,T[c+3]=m[O],T[c+4]=m[O+1],O+=2;this._contoursPrepered=!0}this.renderTexture(e,{points:u[0],tileWidth:256,tileHeight:256,xScale:r,yScale:n,dx:i,dy:a})}if(e.pickingMode){var R=new ee(this.pickColor.clone(),this.pickDelegate?this.pickDelegate:this,null,this.layer,!1);e.resolvePick(R)}}}},{key:"renderColor",value:function(e,t){var r=t.tileWidth,n=t.tileHeight,i=t.xScale,a=t.yScale,o=t.dx,s=t.dy,l=t.drawInterior,c=t.interiorColor;t.drawOutline,t.outlineColor;if(this.tessGeom||(this.tessGeom=this.tessellate(this._interiorGeometry),this.tessTris=new Float32Array(this.tessGeom.length)),!this.wo){var u=this.mapGeometry(this._interiorGeometry,i,a,o,s);this.wo=this.windingOrder_all(u[0])}var d=e.currentGlContext,h=e.findAndBindProgram(X);if(h.loadResolution(d,r,n),d.enableVertexAttribArray(0),l){h.loadColor(d,e.pickingMode?this.pickColor:c);for(var g=0;g<this.tessGeom.length;g+=3){var f=this.tessGeom[g],p=this.tessGeom[g+1];this.tessTris[g]=f*J.RADIANS_TO_DEGREES*i+o,this.tessTris[g+1]=p*J.RADIANS_TO_DEGREES*a+s,this.tessTris[g+2]=0}this.bindInteriorVbo(e,this.tessTris,null),d.vertexAttribPointer(0,3,d.FLOAT,!1,0,0),"CW"===this.wo&&d.frontFace(d.CW),d.drawArrays(d.TRIANGLES,0,Math.floor(this.tessTris.length/3)),"CW"===this.wo&&d.frontFace(d.CCW)}}},{key:"renderTexture",value:function(e,t){for(var r=t.points,n=t.tileWidth,i=t.tileHeight,a=(t.xScale,t.yScale,t.dx,t.dy,t.anglesMap,t.topLeftIndex,this._contoursInfo[0].vboData),o=0,s=0;s<a.length;s+=5)a[s]=r[o],a[s+1]=r[o+1],o+=2;var l=e.currentGlContext,c=e.findAndBindProgram(Z);c.loadResolution(l,n,i),l.enableVertexAttribArray(0),l.enableVertexAttribArray(1),c.loadTextureUnit(l,l.TEXTURE0);var u=this._imageUUID||this._image.src;u||console.error("TexturedSurfaceShape, no uuid for image. Use shape.imageUUID to set a unique id");var d=e.gpuResourceCache.resourceForKey(u);d||(d=new te(l,this._image,null,!0),e.gpuResourceCache.putResource(u,d,d.size)),d.bind(e),this.bindInteriorVbo(e,a,null),this.bindInteriorIbo(e,this._contoursInfo[0].iboData,null);l.vertexAttribPointer(0,3,l.FLOAT,!1,20,0),l.vertexAttribPointer(1,2,l.FLOAT,!1,20,12),"CW"===this._contoursInfo[0].wo&&l.frontFace(l.CW),l.drawElements(l.TRIANGLES,this._contoursInfo[0].iboData.length,l.UNSIGNED_SHORT,0),"CW"===this._contoursInfo[0].wo&&l.frontFace(l.CCW),l.disableVertexAttribArray(1)}},{key:"computeUvs",value:function(e,t,r,n){var i=n.slice();i.pop();for(var a=new Float32Array(2*i.length),o="",s=r;s<i.length+r;s++){var l=s%i.length,c={s:-1,t:-1};if(t[l]){o=this.nextSide(o,e);for(var u=i[l],d=null,h=s+1;h<i.length+r;h++){var g=h%i.length;if(null!=t[g]){d=i[g];break}}d||(d=i[r]);var f=re.greatCircleDistance(u,d)*ne}var p=re.greatCircleDistance(u,i[l])*ne;"CW"===e?"top"===o?(c.s=p/f,c.t=0):"right"===o?(c.s=1,c.t=p/f):"bottom"===o?(c.s=1-p/f,c.t=1):"left"===o&&(c.s=0,c.t=1-p/f):"left"===o?(c.s=0,c.t=p/f):"bottom"===o?(c.s=p/f,c.t=1):"right"===o?(c.s=1,c.t=1-p/f):"top"===o&&(c.s=1-p/f,c.t=0),a[2*l]=c.s,a[2*l+1]=c.t}return a}},{key:"nextSide",value:function(e,t){var r="";return"CW"===t?(r="top","top"===e?r="right":"right"===e?r="bottom":"bottom"===e?r="left":"left"===e&&(r="top")):(r="left","left"===e?r="bottom":"bottom"===e?r="right":"right"===e?r="top":"top"===e&&(r="left")),r}},{key:"mapGeometry",value:function(e,t,r,n,i){return e.map((function(e){return e.reduce((function(e,a){var o=a.longitude*t+n,s=a.latitude*r+i;return e.push(o,s),e}),[])}))}},{key:"bindInteriorVbo",value:function(e,t,r){r=r||e.currentGlContext.STATIC_DRAW,this._interiorVboCacheKey||(this._interiorVboCacheKey=e.gpuResourceCache.generateCacheKey()),this.bindVbo(e,t,r,this._interiorVboCacheKey)}},{key:"bindOutlineVbo",value:function(e,t,r){r=r||e.currentGlContext.STATIC_DRAW,this._outlineVboCacheKey||(this._outlineVboCacheKey=e.gpuResourceCache.generateCacheKey()),this.bindVbo(e,t,r,this._outlineVboCacheKey)}},{key:"bindVbo",value:function(e,t,r,n){var i=e.currentGlContext,a=e.gpuResourceCache.resourceForKey(n),o=e.gpuResourceCache.entries.entries[n],s=0;o&&(s=o.size),!a||s<t.length*t.BYTES_PER_ELEMENT?(a=i.createBuffer(),i.bindBuffer(i.ARRAY_BUFFER,a),i.bufferData(i.ARRAY_BUFFER,t,r),e.gpuResourceCache.putResource(n,a,t.length*t.BYTES_PER_ELEMENT)):(i.bindBuffer(i.ARRAY_BUFFER,a),i.bufferSubData(i.ARRAY_BUFFER,0,t))}},{key:"bindInteriorIbo",value:function(e,t,r){r=r||e.currentGlContext.STATIC_DRAW,this._interiorIboCacheKey||(this._interiorIboCacheKey=e.gpuResourceCache.generateCacheKey()),this.bindIbo(e,t,r,this._interiorIboCacheKey)}},{key:"bindIbo",value:function(e,t,r,n){var i=e.currentGlContext,a=e.gpuResourceCache.resourceForKey(n),o=e.gpuResourceCache.entries.entries[n],s=0;o&&(s=o.size),!a||s<t.length*t.BYTES_PER_ELEMENT?(a=i.createBuffer(),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,a),i.bufferData(i.ELEMENT_ARRAY_BUFFER,t,r),e.gpuResourceCache.putResource(n,a,t.length*t.BYTES_PER_ELEMENT)):i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,a)}},{key:"tessellate_p",value:function(e,t){var n=r.tesselator(),i=[];n.gluTessCallback(Q.gluEnum.GLU_TESS_BEGIN,(function(e){e!==Q.primitiveType.GL_TRIANGLES&&console.error("Tessellation error, primitive is not TRIANGLES.")})),n.gluTessCallback(Q.gluEnum.GLU_TESS_COMBINE,(function(e,r,n){var i=[e[0],e[1],e[2]];if(t&&t.length)for(var a=3;a<=4;a++){for(var o=0,s=0;s<4;s++)n[s]>0&&(o+=n[s]*r[s][a]);i[a]=o}return i})),n.gluTessCallback(Q.gluEnum.GLU_TESS_EDGE_FLAG,(function(){})),n.gluTessCallback(Q.gluEnum.GLU_TESS_VERTEX_DATA,(function(e,r){r.push(e[0]),r.push(e[1]),r.push(e[2]),t&&t.length&&(r.push(e[3]),r.push(e[4]))})),n.gluTessCallback(Q.gluEnum.GLU_TESS_ERROR,(function(e){console.error("tess err",e)})),n.gluTessBeginPolygon(i),n.gluTessBeginContour();for(var a=0,o=0;o<e.length;o++){var s=[e[o].x,e[o].y,0];t&&t.length&&(s.push(t[a],t[a+1]),a+=2),n.gluTessVertex(s,s)}return n.gluTessEndContour(),n.gluTessEndPolygon(),i}},{key:"tessellate_p1",value:function(e,t){var n=r.tesselator(),i=[];n.gluTessCallback(Q.gluEnum.GLU_TESS_BEGIN,(function(e){e!==Q.primitiveType.GL_TRIANGLES&&console.error("Tessellation error, primitive is not TRIANGLES.")})),n.gluTessCallback(Q.gluEnum.GLU_TESS_COMBINE,(function(e,r,n){var i=[e[0],e[1],e[2]];if(t&&t.length)for(var a=3;a<=4;a++){for(var o=0,s=0;s<4;s++)n[s]>0&&(o+=n[s]*r[s][a]);i[a]=o}return i})),n.gluTessCallback(Q.gluEnum.GLU_TESS_EDGE_FLAG,(function(){})),n.gluTessCallback(Q.gluEnum.GLU_TESS_VERTEX_DATA,(function(e,r){r.push(e[0]),r.push(e[1]),r.push(e[2]),t&&t.length&&(r.push(e[3]),r.push(e[4]))})),n.gluTessCallback(Q.gluEnum.GLU_TESS_ERROR,(function(e){console.error("tess err",e)})),n.gluTessBeginPolygon(i),n.gluTessBeginContour();for(var a=0,o=0;o<e.length;o+=2){var s=[e[o],e[o+1],0];t&&t.length&&(s.push(t[a],t[a+1]),a+=2),n.gluTessVertex(s,s)}return n.gluTessEndContour(),n.gluTessEndPolygon(),i}},{key:"tessellate",value:function(e,t){var n=r.tesselator(),i=[];n.gluTessCallback(Q.gluEnum.GLU_TESS_BEGIN,(function(e){e!==Q.primitiveType.GL_TRIANGLES&&console.error("Tessellation error, primitive is not TRIANGLES.")})),n.gluTessCallback(Q.gluEnum.GLU_TESS_COMBINE,(function(e,r,n){var i=[e[0],e[1],e[2]];if(t&&t.length)for(var a=3;a<=4;a++){for(var o=0,s=0;s<4;s++)n[s]>0&&(o+=n[s]*r[s][a]);i[a]=o}return i})),n.gluTessCallback(Q.gluEnum.GLU_TESS_EDGE_FLAG,(function(){})),n.gluTessCallback(Q.gluEnum.GLU_TESS_VERTEX_DATA,(function(e,r){r.push(e[0]),r.push(e[1]),r.push(e[2]),t&&t.length&&(r.push(e[3]),r.push(e[4]))})),n.gluTessCallback(Q.gluEnum.GLU_TESS_ERROR,(function(e){console.error("tess err",e)})),n.gluTessBeginPolygon(i);for(var a=0,o=0;o<e.length;o++){n.gluTessBeginContour();for(var s=e[o],l=0;l<s.length;l+=1){var c=s[l],u=[c.longitude*J.DEGREES_TO_RADIANS,c.latitude*J.DEGREES_TO_RADIANS,0];t&&t.length&&(u.push(t[a],t[a+1]),a+=2),n.gluTessVertex(u,u)}n.gluTessEndContour()}return n.gluTessEndPolygon(),i}},{key:"getBbox",value:function(e){for(var t={minX:Number.MAX_SAFE_INTEGER,maxX:Number.MIN_SAFE_INTEGER,minY:Number.MAX_SAFE_INTEGER,maxY:Number.MIN_SAFE_INTEGER,width:0,height:0},r=0;r<e.length;r++){var n=e[r];t.minX=Math.min(t.minX,n.x),t.maxX=Math.max(t.maxX,n.x),t.minY=Math.min(t.minY,n.y),t.maxY=Math.max(t.maxY,n.y)}return t.width=Math.abs(t.maxX-t.minX),t.height=Math.abs(t.maxY-t.minY),t}},{key:"getCorners",value:function(e,t){e.length;for(var r=[],n=0;n<e.length;n+=2){var i,a,o,s,l,c;0===n?(i=e[e.length-2],a=e[e.length-1]):(i=e[n-2],a=e[n-1]),o=e[n],s=e[n+1],n===e.length-2?(l=e[0],c=e[1]):(l=e[n+2],c=e[n+3]);var u=Math.atan2(c-s,l-o)-Math.atan2(a-s,i-o);r.push({index:n/2,angle:Math.abs(u)*J.RADIANS_TO_DEGREES})}var d={x:e[2*(r=r.filter((function(e){return e.angle<170||e.angle>190})))[0].index],y:e[2*r[0].index+1],index:r[0].index},h={x:e[2*r[1].index],y:e[2*r[1].index+1],index:r[1].index},g={x:e[2*r[2].index],y:e[2*r[2].index+1],index:r[2].index},f={x:e[2*r[3].index],y:e[2*r[3].index+1],index:r[3].index},p=this.findWhichCorners([d,h,g,f]),m=p[0].index,_=r.reduce((function(e,r){var n="",i=p.findIndex((function(e){return e.index===r.index}));return"CW"===t?0===i?n="tl":1===i?n="tr":2===i?n="br":3===i&&(n="bl"):0===i?n="tl":1===i?n="bl":2===i?n="br":3===i&&(n="tr"),e[r.index]=n,e}),Object.create(null));return{anglesMap:_,topLeftIndex:m}}},{key:"findWhichCorners",value:function(e){var t=this.userProperties;if(t&&t.identifier){var r=t.identifier;if(0===r.indexOf("S3")&&-1!==r.indexOf("OL_1_ERR___")){var n=this._interiorGeometry[0],i=e.map((function(e){var t=n[e.index];return{latitude:t.latitude,longitude:t.longitude,index:e.index}}));i.sort((function(e,t){return e.latitude-t.latitude})),i.length=2;var a=i[0],o=i[1];a.longitude<0&&o.longitude>0||a.longitude>0&&o.longitude<0?i.sort((function(e,t){return Math.abs(t.longitude)-Math.abs(e.longitude)})):i.sort((function(e,t){return Math.abs(e.longitude)-Math.abs(t.longitude)}));var s,l=e.findIndex((function(e){return e.index===i[0].index}));if(l>0){s=[];for(var c=l;c<e.length+l;c++)s.push(e[c%e.length])}return s||e}}return this.reindexCorners(e)}},{key:"getCorners_old",value:function(e,t){if(this.isEqualPoints(e[0],e[e.length-1])&&e.pop(),4===e.length)return this.reindexCorners(e);t=t||this.getBbox(e);for(var r=[],n=0;n<e.length-1;n++){var i=e[n];i.x===t.minX||i.x===t.maxX?r.push(i):i.y!==t.minY&&i.y!==t.maxY||r.push(i)}return r.length<4?r:this.reindexCorners(r)}},{key:"reindexCorners",value:function(e){var t,r,n=e.slice();if(n.sort((function(e,t){return t.y-e.y})),n.length=2,n.sort((function(e,t){return e.x-t.x})),n[0].index,(t=e.findIndex((function(e){return e.index===n[0].index})))>0){r=[];for(var i=t;i<e.length+t;i++)r.push(e[i%e.length])}return r||e}},{key:"reindexCorners_old",value:function(e){var t,r=-1;if(this.getSlope(e[0],e[2])>0&&(r=e[0].y<e[2].y?0:2),this.getSlope(e[1],e[3])>0&&(e[1].y<e[3].y?(-1!==r&&console.error("slope method is not ok 1"),r=1):(-1!==r&&console.error("slope method is not ok 2"),r=3)),-1===r&&console.error("slope method could not determine topLeft"),r>0){t=[];for(var n=r;n<e.length+r;n++)t.push(e[n%e.length])}return t||e}},{key:"isEqualPoints",value:function(e,t){return e.x===t.x&&e.y===t.y}},{key:"windingOrder",value:function(e){return(e[1].x-e[0].x)*(e[1].y+e[0].y)+(e[2].x-e[1].x)*(e[2].y+e[1].y)+(e[3].x-e[2].x)*(e[3].y+e[2].y)+(e[0].x-e[3].x)*(e[0].y+e[3].y)<0?"CCW":"CW"}},{key:"windingOrder_all",value:function(e){for(var t=0,r=0;r<e.length-2;r+=2){var n=(r+2)%e.length,i=r%e.length,a=e[n],o=e[n+1];t+=(a-e[i])*(o+e[i+1])}return t<0?"CCW":"CW"}},{key:"getSlope",value:function(e,t){return(e.y-t.y)/(e.x-t.x)}},{key:"distance2D",value:function(e,t){var r=t.x-e.x,n=t.y-e.y;return Math.sqrt(r*r+n*n)}}],[{key:"tesselator",value:function(){return r.tess||(r.tess=new Q.GluTesselator),r.tess}},{key:"nextId",value:function(){return r._nextId||(r._nextId=0),r._nextId++}},{key:"staticStateKey",value:function(e){return e.stateKeyInvalid=!1,e.highlighted&&e._highlightAttributes?e._attributesStateKey=e._highlightAttributes.stateKey:e._attributes?e._attributesStateKey=e._attributes.stateKey:e._attributesStateKey=null,"dn "+e.displayName+" id "+e._id+" at "+(e._attributesStateKey?e._attributesStateKey:"null")+" hi "+e.highlighted+" en "+e.enabled+" pt "+e.pathType+" ne "+e.maximumNumEdgeIntervals+" po "+e.polarThrottle+" img "+!!e.image+" se ["+e.sector.minLatitude+","+e.sector.maxLatitude+","+e.sector.minLongitude+","+e.sector.maxLongitude+"]"}}]),r}($),ae=function(e){Object(q.a)(r,e);var t=Object(K.a)(r);function r(e,n){var i;if(Object(P.a)(this,r),i=t.call(this,n),!Array.isArray(e))throw new Error("TexturedSurfacePolygon - constructor - The specified boundary is not an array.");return i._boundaries=i.removeDuplicateLocations(e),i}return Object(M.a)(r,[{key:"boundaries",get:function(){return this._boundaries},set:function(e){if(!Array.isArray(e))throw new Error("TexturedSurfacePolygon - set boundaries - The specified boundary is not an array.");this._boundaries=this.removeDuplicateLocations(e),this.isPrepared=!1,this.stateKeyInvalid=!0}},{key:"removeDuplicateLocations",value:function(e){if(Array.isArray(e[0])){for(var t=[],r=0;r<e.length;r++){var n=this.removeDuplicateLocationsFromContour(e[r]);t.push(n)}return t}return this.removeDuplicateLocationsFromContour(e)}},{key:"removeDuplicateLocationsFromContour",value:function(e){for(var t=[],r=0;r<e.length;r++){var n=e[r];t.push(n);for(var i=r+1;i<e.length;i++){var a=e[i];if(n.latitude!==a.latitude||n.longitude!==a.longitude)break;r++}}return t}},{key:"computeStateKey",value:function(){return r.staticStateKey(this)}}],[{key:"staticStateKey",value:function(e){return ie.staticStateKey(e)}}]),r}(ie),oe=b.a.ArgumentError,se=(b.a.GeoJSONConstants,b.a.GeoJSONParser),le=b.a.Location,ce=b.a.Logger,ue=b.a.RenderableLayer;se.prototype.addRenderablesForPolygon=function(e,t,r){if(!e)throw new oe(ce.logMessage(ce.LEVEL_SEVERE,"GeoJSON","addRenderablesForPolygon","missingLayer"));if(!t)throw new oe(ce.logMessage(ce.LEVEL_SEVERE,"GeoJSON","addRenderablesForPolygon","missingGeometry"));var n=this.shapeConfigurationCallback(t,r);if(!this.crs||this.crs.isCRSSupported()){for(var i,a=[],o=0,s=t.coordinates;o<s.length;o++){for(var l=[],c=0,u=s[o];c<u.length;c++){var d=u[c][0],h=u[c][1],g=this.getReprojectedIfRequired(h,d,this.crs),f=new le(g[1],g[0]);l.push(f)}a.push(l)}i=new ae(a,n&&n.attributes?n.attributes:null),n.highlightAttributes&&(i.highlightAttributes=n.highlightAttributes),n&&n.name&&(i.displayName=n.name),n&&n.pickDelegate&&(i.pickDelegate=n.pickDelegate),n&&n.userProperties&&(i.userProperties=n.userProperties),n&&n.timeRange&&(i.timeRange=n.timeRange),e.addRenderable(i)}},se.prototype.load=function(e,t,r){e&&(this._parserCompletionCallback=e),t&&(this._shapeConfigurationCallback=t),this._layer=r||new ue;var n=typeof this.dataSource;if("string"===n){var i=se.tryParseJSONString(this.dataSource);null!==i?this.handle(i):this.requestUrl(this.dataSource)}else"object"===n?this.handle(this.dataSource):ce.logMessage(ce.LEVEL_SEVERE,"GeoJSON","load","Unsupported data source type: "+n)},se.prototype.addRenderablesForMultiPolygon=function(e,t,r){if(!e)throw new oe(ce.logMessage(ce.LEVEL_SEVERE,"GeoJSON","addRenderablesForMultiPolygon","missingLayer"));if(!t)throw new oe(ce.logMessage(ce.LEVEL_SEVERE,"GeoJSON","addRenderablesForMultiPolygon","missingGeometry"));var n=this.shapeConfigurationCallback(t,r);if(!this.crs||this.crs.isCRSSupported())for(var i=0,a=t.coordinates;i<a.length;i++){for(var o,s=[],l=0;l<a[i].length;l++){for(var c=[],u=0,d=a[i][l];u<d.length;u++){var h=d[u][0],g=d[u][1],f=this.getReprojectedIfRequired(g,h,this.crs),p=new le(f[1],f[0]);c.push(p)}s.push(c)}o=new ae(s,n&&n.attributes?n.attributes:null),n.highlightAttributes&&(o.highlightAttributes=n.highlightAttributes),n&&n.name&&(o.displayName=n.name),n&&n.pickDelegate&&(o.pickDelegate=n.pickDelegate),n&&n.userProperties&&(o.userProperties=n.userProperties),n&&n.timeRange&&(o.timeRange=n.timeRange),e.addRenderable(o)}};var de=b.a.ArcBallCamera,he=b.a.ArgumentError,ge=(b.a.BasicWorldWindowController,b.a.DrawContext),fe=b.a.EarthElevationModel,pe=b.a.FrameStatistics,me=b.a.Frustum,_e=b.a.Globe,ve=(b.a.Globe2D,b.a.GoToAnimator),be=(b.a.GpuResourceCache,b.a.Line),ye=b.a.Logger,Ee=(b.a.LookAtNavigator,b.a.Matrix),Se=b.a.Navigator,xe=b.a.PickedObjectList,we=b.a.Position,Te=b.a.Rectangle,Oe=(b.a.Sector,b.a.SurfaceShape),Re=(b.a.SurfaceShapeTileBuilder,b.a.Terrain,b.a.Vec2),Ce=b.a.Vec3,De=b.a.WWMath,je=function(){function e(t,r,n,i){if(Object(P.a)(this,e),console.log("constructing worlwindow"),!window.WebGLRenderingContext)throw new he(ye.logMessage(ye.LEVEL_SEVERE,"WorldWindow","constructor","webglNotSupported"));var a;if(t instanceof HTMLCanvasElement)a=t;else if(!(a=document.getElementById(t)))throw new he(ye.logMessage(ye.LEVEL_SEVERE,"WorldWindow","constructor","The specified canvas ID is not in the document."));var o=this.createContext(a);if(!o)throw new he(ye.logMessage(ye.LEVEL_SEVERE,"WorldWindow","constructor","webglNotSupported"));function s(e){e.preventDefault()}this.drawContext=new ge(o),this.eventListeners={},this.redrawRequested=!0,this.redrawRequestId=null,this.scratchModelview=Ee.fromIdentity(),this.scratchProjection=Ee.fromIdentity(),this.hasStencilBuffer=o.getContextAttributes().stencil,this.canvas=a,this.depthBits=o.getParameter(o.DEPTH_BITS),this.viewport=new Te(0,0,o.drawingBufferWidth,o.drawingBufferHeight),this.globe=new _e(r||new fe),this.layers=[],this.navigator=new Se(i&&new i(this)||new de(this)),this.verticalExaggeration=1,this.deepPicking=!1,this.subsurfaceMode=!1,this.surfaceOpacity=1,this.frameStatistics=new pe,this.goToAnimator=new ve(this),this._redrawCallbacks=[],this._orderedRenderingFilters=[function(e){l.declutter(e,1)},function(e){l.declutter(e,2)}],this.pixelScale=1,this.addEventListener("mousedown",s),this.addEventListener("touchstart",s),this.addEventListener("contextmenu",s),this.addEventListener("wheel",s);var l=this;function c(e){l.handleRedrawEvent(e)}this.canvas.addEventListener("webglcontextlost",(function(e){l.handleContextLost(e)}),!1),this.canvas.addEventListener("webglcontextrestored",(function(e){l.handleContextRestored(e)}),!1),this.canvas.addEventListener(b.a.REDRAW_EVENT_TYPE,c,!1),window.addEventListener(b.a.REDRAW_EVENT_TYPE,c,!1),this.animationFrameLoop()}return Object(M.a)(e,[{key:"orderedRenderingFilters",value:function(){return this._orderedRenderingFilters}},{key:"redrawCallbacks",value:function(){return this._redrawCallbacks}},{key:"canvasCoordinates",value:function(e,t){var r=this.canvas.getBoundingClientRect(),n=e-(r.left+this.canvas.clientLeft),i=t-(r.top+this.canvas.clientTop);return new Re(n,i)}},{key:"addEventListener",value:function(e,t){if(!e)throw new he(ye.logMessage(ye.LEVEL_SEVERE,"WorldWindow","addEventListener","missingType"));if(!t)throw new he(ye.logMessage(ye.LEVEL_SEVERE,"WorldWindow","addEventListener","missingListener"));var r=this,n=this.eventListeners[e];n||(n={listeners:[],callback:function(e){e.worldWindow=r;for(var t=0,i=n.listeners.length;t<i;t++)n.listeners[t](e)}},this.eventListeners[e]=n),-1==n.listeners.indexOf(t)&&(n.listeners.splice(0,0,t),1==n.listeners.length&&this.canvas.addEventListener(e,n.callback,!1))}},{key:"removeEventListener",value:function(e,t){if(!e)throw new he(ye.logMessage(ye.LEVEL_SEVERE,"WorldWindow","removeEventListener","missingType"));if(!t)throw new he(ye.logMessage(ye.LEVEL_SEVERE,"WorldWindow","removeEventListener","missingListener"));var r=this.eventListeners[e];if(r){var n=r.listeners.indexOf(t);-1!=n&&(r.listeners.splice(n,1),0==r.listeners.length&&this.canvas.removeEventListener(e,r.callback,!1))}}},{key:"redraw",value:function(){this.redrawRequested=!0}},{key:"pick",value:function(e){if(!e)throw new he(ye.logMessage(ye.LEVEL_SEVERE,"WorldWindow","pick","missingPoint"));return this.drawContext.currentGlContext.isContextLost()?new xe:(this.resize(),this.resetDrawContext(),this.drawContext.pickingMode=!0,this.drawContext.pickPoint=e,this.drawContext.pickRay=this.rayThroughScreenPoint(e),this.drawFrame(),this.drawContext.objectsAtPickPoint)}},{key:"pickTerrain",value:function(e){if(!e)throw new he(ye.logMessage(ye.LEVEL_SEVERE,"WorldWindow","pickTerrain","missingPoint"));return this.drawContext.currentGlContext.isContextLost()?new xe:(this.resize(),this.resetDrawContext(),this.drawContext.pickingMode=!0,this.drawContext.pickTerrainOnly=!0,this.drawContext.pickPoint=e,this.drawContext.pickRay=this.rayThroughScreenPoint(e),this.drawFrame(),this.drawContext.objectsAtPickPoint)}},{key:"pickShapesInRegion",value:function(e){if(!e)throw new he(ye.logMessage(ye.LEVEL_SEVERE,"WorldWindow","pickShapesInRegion","missingRectangle"));return this.drawContext.currentGlContext.isContextLost()?new xe:(this.resize(),this.resetDrawContext(),this.drawContext.pickingMode=!0,this.drawContext.regionPicking=!0,this.drawContext.pickRectangle=new Te(e.x,this.canvas.height-e.y,e.width,e.height),this.drawFrame(),this.drawContext.objectsAtPickPoint)}},{key:"createContext",value:function(e){var t={antialias:!1,stencil:!0},r=e.getContext("webgl",t);return r||(r=e.getContext("experimental-webgl",t)),r}},{key:"handleContextLost",value:function(e){ye.log(ye.LEVEL_INFO,"WebGL context event: "+e.statusMessage),e.preventDefault(),this.drawContext.contextLost(),window.cancelAnimationFrame(this.redrawRequestId)}},{key:"handleContextRestored",value:function(e){ye.log(ye.LEVEL_INFO,"WebGL context event: "+e.statusMessage),this.drawContext.contextRestored(),this.redraw(),this.animationFrameLoop()}},{key:"handleRedrawEvent",value:function(e){this.redraw()}},{key:"animationFrameLoop",value:function(){this.redrawIfNeeded();var e=this;this.redrawRequestId=window.requestAnimationFrame((function(){e.animationFrameLoop()}))}},{key:"redrawIfNeeded",value:function(){if(this.resize(),this.redrawRequested)try{this.redrawRequested=!1,this.drawContext.previousRedrawTimestamp=this.drawContext.timestamp,this.callRedrawCallbacks(b.a.BEFORE_REDRAW),this.resetDrawContext(),this.drawFrame()}catch(e){ye.logMessage(ye.LEVEL_SEVERE,"WorldWindow","redrawIfNeeded","Exception occurred during redrawing.\n"+e.toString())}finally{this.callRedrawCallbacks(b.a.AFTER_REDRAW),this.drawContext.redrawRequested&&(this.redrawRequested=!0)}}},{key:"resize",value:function(){var e=this.drawContext.currentGlContext,t=e.canvas.clientWidth*this.pixelScale,r=e.canvas.clientHeight*this.pixelScale;e.canvas.width==t&&e.canvas.height==r||(e.canvas.width=t,e.canvas.height=r,e.viewport(0,0,e.drawingBufferWidth,e.drawingBufferHeight),this.viewport=new Te(0,0,e.drawingBufferWidth,e.drawingBufferHeight),this.redrawRequested=!0)}},{key:"computeViewingTransform",value:function(e,t){if(!t)throw new he(ye.logMessage(ye.LEVEL_SEVERE,"WorldWindow","computeViewingTransform","missingModelview"));var r=this.globe;if(this.navigator.camera.createViewMatrix(t),e){e.setToIdentity();var n=De.max(r.equatorialRadius,r.polarRadius),i=t.extractEyePoint(new Ce(0,0,0)),a=r.computePositionFromPoint(i[0],i[1],i[2],new we(0,0,0)),o=De.horizonDistanceForGlobeRadius(n,a.altitude),s=De.horizonDistanceForGlobeRadius(n,16e4),l=this.viewport,c=o+s;c<1e3&&(c=1e3);var u=De.perspectiveNearDistanceForFarDistance(c,10,this.depthBits),d=a.altitude-r.elevationAtLocation(a.latitude,a.longitude);if(d>0){var h=De.perspectiveNearDistance(l.width,l.height,d);u>h&&(u=h)}u<1&&(u=1),e.setToPerspectiveProjection(l.width,l.height,u,c)}}},{key:"computePixelMetrics",value:function(e){var t=Ee.fromIdentity();t.invertMatrix(e);var r=new Ce(-1,-1,-1),n=new Ce(1,1,-1),i=new Ce(-1,-1,1),a=new Ce(1,1,1);r.multiplyByMatrix(t),n.multiplyByMatrix(t),i.multiplyByMatrix(t),a.multiplyByMatrix(t);var o=De.fabs(n[0]-r[0]),s=De.fabs(a[0]-i[0]),l=-r[2],c=(s-o)/(-i[2]-l),u=o-c*l;return{pixelSizeFactor:c/this.viewport.width,pixelSizeOffset:u/this.viewport.height}}},{key:"pixelSizeAtDistance",value:function(e){this.computeViewingTransform(this.scratchProjection,this.scratchModelview);var t=this.computePixelMetrics(this.scratchProjection);return t.pixelSizeFactor*e+t.pixelSizeOffset}},{key:"computeDrawContext",value:function(){var e=this.drawContext;this.computeViewingTransform(e.projection,e.modelview),e.viewport=this.viewport,e.eyePoint=e.modelview.extractEyePoint(new Ce(0,0,0)),e.modelviewProjection.setToIdentity(),e.modelviewProjection.setToMultiply(e.projection,e.modelview);var t=this.computePixelMetrics(e.projection);e.pixelSizeFactor=t.pixelSizeFactor,e.pixelSizeOffset=t.pixelSizeOffset;var r=Ee.fromIdentity();r.invertOrthonormalMatrix(e.modelview),e.modelviewNormalTransform=Ee.fromIdentity().setToTransposeOfMatrix(r.upper3By3());var n=Ee.fromIdentity();n.setToTransposeOfMatrix(e.modelview),e.frustumInModelCoordinates=me.fromProjectionMatrix(e.projection),e.frustumInModelCoordinates.transformByMatrix(n),e.frustumInModelCoordinates.normalize()}},{key:"resetDrawContext",value:function(){this.globe.offset=0;var e=this.drawContext;e.reset(),e.globe=this.globe,e.navigator=this.navigator,e.layers=this.layers.slice(),e.layers.push(e.screenCreditController),this.computeDrawContext(),e.verticalExaggeration=this.verticalExaggeration,e.surfaceOpacity=this.surfaceOpacity,e.deepPicking=this.deepPicking,e.frameStatistics=this.frameStatistics,e.pixelScale=this.pixelScale,e.update()}},{key:"drawFrame",value:function(){try{this.drawContext.frameStatistics.beginFrame(),this.beginFrame(),this.drawContext.globe.is2D()&&this.drawContext.globe.continuous?this.do2DContiguousRepaint():this.doNormalRepaint()}finally{this.endFrame(),this.drawContext.frameStatistics.endFrame()}}},{key:"doNormalRepaint",value:function(){this.createTerrain(),this.clearFrame(),this.deferOrderedRendering=!1,this.drawContext.pickingMode?this.drawContext.makePickFrustum()&&(this.doPick(),this.resolvePick()):(this.doDraw(),this.subsurfaceMode&&this.hasStencilBuffer&&(this.redrawSurface(),this.drawScreenRenderables()))}},{key:"do2DContiguousRepaint",value:function(){this.createTerrain2DContiguous(),this.clearFrame(),this.drawContext.pickingMode?this.drawContext.makePickFrustum()&&(this.pick2DContiguous(),this.resolvePick()):this.draw2DContiguous()}},{key:"resolvePick",value:function(){this.drawContext.pickTerrainOnly?this.resolveTerrainPick():this.drawContext.regionPicking?this.resolveRegionPick():this.resolveTopPick()}},{key:"beginFrame",value:function(){var e=this.drawContext.currentGlContext;e.enable(e.BLEND),e.enable(e.CULL_FACE),e.enable(e.DEPTH_TEST),e.blendFunc(e.ONE,e.ONE_MINUS_SRC_ALPHA),e.depthFunc(e.LEQUAL),this.drawContext.pickingMode&&(this.drawContext.makePickFramebuffer(),this.drawContext.bindFramebuffer(this.drawContext.pickFramebuffer))}},{key:"endFrame",value:function(){var e=this.drawContext.currentGlContext;e.disable(e.BLEND),e.disable(e.CULL_FACE),e.disable(e.DEPTH_TEST),e.blendFunc(e.ONE,e.ZERO),e.depthFunc(e.LESS),e.clearColor(0,0,0,1),this.drawContext.bindFramebuffer(null),this.drawContext.bindProgram(null)}},{key:"clearFrame",value:function(){var e=this.drawContext,t=e.currentGlContext;t.clearColor(e.clearColor.red,e.clearColor.green,e.clearColor.blue,e.clearColor.alpha),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)}},{key:"doDraw",value:function(){this.drawContext.renderShapes=!0,this.subsurfaceMode&&this.hasStencilBuffer?(this.drawContext.currentGlContext.disable(this.drawContext.currentGlContext.STENCIL_TEST),this.drawContext.surfaceShapeTileBuilder.clear(),this.drawLayers(!0),this.drawSurfaceRenderables(),this.drawContext.surfaceShapeTileBuilder.doRender(this.drawContext),this.deferOrderedRendering||(this.drawContext.currentGlContext.clear(this.drawContext.currentGlContext.DEPTH_BUFFER_BIT|this.drawContext.currentGlContext.STENCIL_BUFFER_BIT),this.drawContext.currentGlContext.enable(this.drawContext.currentGlContext.STENCIL_TEST),this.drawContext.currentGlContext.stencilFunc(this.drawContext.currentGlContext.ALWAYS,1,1),this.drawContext.currentGlContext.stencilOp(this.drawContext.currentGlContext.REPLACE,this.drawContext.currentGlContext.REPLACE,this.drawContext.currentGlContext.REPLACE),this.drawOrderedRenderables())):(this.drawContext.surfaceShapeTileBuilder.clear(),this.drawLayers(!0),this.drawSurfaceRenderables(),this.drawContext.surfaceShapeTileBuilder.doRender(this.drawContext),this.deferOrderedRendering||(this.drawOrderedRenderables(),this.drawScreenRenderables()))}},{key:"redrawSurface",value:function(){this.drawContext.currentGlContext.enable(this.drawContext.currentGlContext.STENCIL_TEST),this.drawContext.currentGlContext.stencilFunc(this.drawContext.currentGlContext.EQUAL,1,1),this.drawContext.currentGlContext.stencilOp(this.drawContext.currentGlContext.KEEP,this.drawContext.currentGlContext.KEEP,this.drawContext.currentGlContext.KEEP),this.drawContext.surfaceShapeTileBuilder.clear(),this.drawLayers(!1),this.drawSurfaceRenderables(),this.drawContext.surfaceShapeTileBuilder.doRender(this.drawContext),this.drawContext.currentGlContext.disable(this.drawContext.currentGlContext.STENCIL_TEST)}},{key:"doPick",value:function(){this.drawContext.terrain&&this.drawContext.terrain.pick(this.drawContext),this.drawContext.pickTerrainOnly||(this.subsurfaceMode&&this.hasStencilBuffer?(this.drawContext.currentGlContext.disable(this.drawContext.currentGlContext.STENCIL_TEST),this.drawContext.surfaceShapeTileBuilder.clear(),this.drawLayers(!0),this.drawSurfaceRenderables(),this.drawContext.surfaceShapeTileBuilder.doRender(this.drawContext),this.deferOrderedRendering||(this.drawContext.currentGlContext.clear(this.drawContext.currentGlContext.DEPTH_BUFFER_BIT|this.drawContext.currentGlContext.STENCIL_BUFFER_BIT),this.drawContext.currentGlContext.enable(this.drawContext.currentGlContext.STENCIL_TEST),this.drawContext.currentGlContext.stencilFunc(this.drawContext.currentGlContext.ALWAYS,1,1),this.drawContext.currentGlContext.stencilOp(this.drawContext.currentGlContext.REPLACE,this.drawContext.currentGlContext.REPLACE,this.drawContext.currentGlContext.REPLACE),this.drawOrderedRenderables(),this.drawContext.terrain.pick(this.drawContext),this.drawScreenRenderables())):(this.drawContext.surfaceShapeTileBuilder.clear(),this.drawLayers(!0),this.drawSurfaceRenderables(),this.drawContext.surfaceShapeTileBuilder.doRender(this.drawContext),this.deferOrderedRendering||(this.drawOrderedRenderables(),this.drawScreenRenderables())))}},{key:"createTerrain",value:function(){var e=this.drawContext;e.terrain=this.globe.tessellator.tessellate(e),e.frameStatistics.setTerrainTileCount(e.terrain?e.terrain.surfaceGeometry.length:0)}},{key:"makeCurrent",value:function(e){var t=this.drawContext;switch(t.globe.offset=e,t.globeStateKey=t.globe.stateKey,e){case-1:t.terrain=this.terrainLeft;break;case 0:t.terrain=this.terrainCenter;break;case 1:t.terrain=this.terrainRight}}},{key:"createTerrain2DContiguous",value:function(){var e=this.drawContext;this.terrainCenter=null,e.globe.offset=0,e.globeStateKey=e.globe.stateKey,e.globe.intersectsFrustum(e.frustumInModelCoordinates)&&(this.terrainCenter=e.globe.tessellator.tessellate(e)),this.terrainRight=null,e.globe.offset=1,e.globeStateKey=e.globe.stateKey,e.globe.intersectsFrustum(e.frustumInModelCoordinates)&&(this.terrainRight=e.globe.tessellator.tessellate(e)),this.terrainLeft=null,e.globe.offset=-1,e.globeStateKey=e.globe.stateKey,e.globe.intersectsFrustum(e.frustumInModelCoordinates)&&(this.terrainLeft=e.globe.tessellator.tessellate(e))}},{key:"draw2DContiguous",value:function(){this.terrainCenter&&(" 0 ",this.makeCurrent(0),this.deferOrderedRendering=this.terrainLeft||this.terrainRight,this.doDraw()),this.terrainRight&&(" 1 ",this.makeCurrent(1),this.deferOrderedRendering=this.terrainLeft||this.terrainLeft,this.doDraw()),this.deferOrderedRendering=!1,this.terrainLeft&&(" -1 ",this.makeCurrent(-1),this.doDraw()),this.subsurfaceMode&&this.hasStencilBuffer&&(this.deferOrderedRendering=!0,this.terrainCenter&&(" 0 ",this.makeCurrent(0),this.redrawSurface()),this.terrainRight&&(" 1 ",this.makeCurrent(1),this.redrawSurface()),this.terrainLeft&&(" -1 ",this.makeCurrent(-1),this.redrawSurface())),this.drawScreenRenderables()}},{key:"pick2DContiguous",value:function(){this.terrainCenter&&(this.makeCurrent(0),this.deferOrderedRendering=this.terrainLeft||this.terrainRight,this.doPick()),this.terrainRight&&(this.makeCurrent(1),this.deferOrderedRendering=this.terrainLeft||this.terrainLeft,this.doPick()),this.deferOrderedRendering=!1,this.terrainLeft&&(this.makeCurrent(-1),this.doPick())}},{key:"drawLayers",value:function(e){var t,r=Date.now(),n=this.drawContext,i=n.layers;n.accumulateOrderedRenderables=e;for(var a=0,o=i.length;a<o;a++)if(t=i[a]){n.currentLayer=t;try{t.render(n)}catch(l){ye.log(ye.LEVEL_SEVERE,"Error while rendering layer "+t.displayName+".\n"+l.toString())}}n.currentLayer=null;var s=Date.now();n.frameStatistics.layerRenderingTime=s-r}},{key:"addLayer",value:function(e){e&&this.layers.push(e)}},{key:"removeLayer",value:function(e){var t=this.indexOfLayer(e);t>=0&&this.layers.splice(t,1)}},{key:"insertLayer",value:function(e,t){t&&this.layers.splice(e,0,t)}},{key:"indexOfLayer",value:function(e){return this.layers.indexOf(e)}},{key:"drawSurfaceRenderables",value:function(){var e,t=this.drawContext;for(t.reverseSurfaceRenderables();e=t.popSurfaceRenderable();)try{e.renderSurface(t)}catch(r){ye.logMessage(ye.LEVEL_WARNING,"WorldWindow","drawSurfaceRenderables","Error while rendering a surface renderable.\n"+r.message)}}},{key:"drawOrderedRenderables",value:function(){var e,t=Date.now(),r=this.drawContext;if(r.sortOrderedRenderables(),this._orderedRenderingFilters)for(var n=0;n<this._orderedRenderingFilters.length;n++)this._orderedRenderingFilters[n](this.drawContext);for(r.orderedRenderingMode=!0;e=r.popOrderedRenderable();)try{e.renderOrdered(r)}catch(i){ye.logMessage(ye.LEVEL_WARNING,"WorldWindow","drawOrderedRenderables","Error while rendering an ordered renderable.\n"+i.message)}r.orderedRenderingMode=!1,r.frameStatistics.orderedRenderingTime=Date.now()-t}},{key:"drawScreenRenderables",value:function(){for(var e,t=this.drawContext;e=t.nextScreenRenderable();)try{e.renderOrdered(t)}catch(r){ye.logMessage(ye.LEVEL_WARNING,"WorldWindow","drawOrderedRenderables","Error while rendering a screen renderable.\n"+r.message)}}},{key:"resolveTopPick",value:function(){if(0!=this.drawContext.objectsAtPickPoint.objects.length){var e=this.drawContext.objectsAtPickPoint,t=this.drawContext.readPickColor(this.drawContext.pickPoint),r=null,n=null;if(t){for(var i=0,a=e.objects.length;i<a;i++){var o=e.objects[i];if(o.isTerrain&&(n=o),o.color.equals(t)&&(o.isOnTop=!0,r=o,n))break}this.drawContext.deepPicking||(e.clear(),r&&e.add(r),n&&n!=r&&e.add(n))}else e.clear()}}},{key:"resolveTerrainPick",value:function(){for(var e,t=this.drawContext.objectsAtPickPoint,r=0,n=t.objects.length;r<n;r++)if((e=t.objects[r]).isTerrain){e.isOnTop=!0;break}}},{key:"resolveRegionPick",value:function(){if(0!=this.drawContext.objectsAtPickPoint.objects.length)for(var e,t=this.drawContext.objectsAtPickPoint,r=this.drawContext.readPickColors(this.drawContext.pickRectangle),n=0,i=t.objects.length;n<i;n++){if(e=t.objects[n])r[e.color.toByteString()]?e.isOnTop=!0:e.userObject instanceof Oe&&(t.objects.splice(n,1),n-=1)}}},{key:"callRedrawCallbacks",value:function(e){for(var t=0,r=this._redrawCallbacks.length;t<r;t++)try{this._redrawCallbacks[t](this,e)}catch(n){ye.log(ye.LEVEL_SEVERE,"Exception calling redraw callback.\n"+n.toString())}}},{key:"goTo",value:function(e,t){this.goToAnimator.goTo(e,t)}},{key:"declutter",value:function(e,t){if(!t)throw new he(ye.logMessage(ye.LEVEL_SEVERE,"WorldWindow","declutter","Group ID is null, undefined or 0."));for(var r=[],n=0;n<e.orderedRenderables.length;n++){var i=e.orderedRenderables[n].orderedRenderable;i.declutterGroup===t&&r.push(i)}for(var a=[],o=0;o<r.length;o++){var s=r[o],l=s.screenBounds;l&&l.intersectsRectangles(a)?s.targetVisibility=0:(s.targetVisibility=1,l&&a.push(l))}}},{key:"rayThroughScreenPoint",value:function(e){if(!e)throw new he(ye.logMessage(ye.LEVEL_SEVERE,"WorldWindow","rayThroughScreenPoint","missingPoint"));var t=new Ce(e[0],this.viewport.height-e[1],0),r=new Ce(0,0,0),n=new Ce(0,0,0);this.computeViewingTransform(this.scratchProjection,this.scratchModelview);var i=Ee.fromIdentity();i.setToMultiply(this.scratchProjection,this.scratchModelview);var a=Ee.fromIdentity();if(a.invertMatrix(i),!a.unProject(t,this.viewport,r))return null;if(t[2]=1,!a.unProject(t,this.viewport,n))return null;var o=this.scratchModelview.extractEyePoint(new Ce(0,0,0)),s=new Ce(o[0],o[1],o[2]),l=new Ce(n[0],n[1],n[2]);return l.subtract(r),l.normalize(),new be(s,l)}}]),e}(),Le=b.a.Angle,Ae=b.a.ArgumentError,Ne=b.a.Logger,ke={getAsGeographicLocation:function(e){if(e instanceof Date===!1)throw new Ae(Ne.logMessage(Ne.LEVEL_SEVERE,"SunPosition","getAsGeographicLocation","missingDate"));var t=this.getAsCelestialLocation(e);return this.celestialToGeographic(t,e)},getAsCelestialLocation:function(e){if(e instanceof Date===!1)throw new Ae(Ne.logMessage(Ne.LEVEL_SEVERE,"SunPosition","getAsCelestialLocation","missingDate"));var t=this.computeJulianDate(e)-2451545,r=this.normalizeAngle360(280.46+.9856474*t),n=this.normalizeAngle360(357.528+.9856003*t)*Le.DEGREES_TO_RADIANS,i=r+1.915*Math.sin(n)+.02*Math.sin(2*n),a=i*Le.DEGREES_TO_RADIANS,o=(23.439-4e-7*t)*Le.DEGREES_TO_RADIANS,s=Math.asin(Math.sin(o)*Math.sin(a))*Le.RADIANS_TO_DEGREES,l=Math.atan(Math.cos(o)*Math.tan(a))*Le.RADIANS_TO_DEGREES;return i>=90&&i<270&&(l+=180),{declination:s,rightAscension:l=this.normalizeAngle360(l)}},celestialToGeographic:function(e,t){if(!e)throw new Ae(Ne.logMessage(Ne.LEVEL_SEVERE,"SunPosition","celestialToGeographic","missingCelestialLocation"));if(t instanceof Date===!1)throw new Ae(Ne.logMessage(Ne.LEVEL_SEVERE,"SunPosition","celestialToGeographic","missingDate"));var r=this.computeJulianDate(t)-2451545,n=this.normalizeAngle360(280.46061837+360.98564736629*r),i=this.normalizeAngle360(n-e.rightAscension),a=Le.normalizedDegreesLongitude(-i);return{latitude:e.declination,longitude:a}},computeJulianDate:function(e){if(e instanceof Date===!1)throw new Ae(Ne.logMessage(Ne.LEVEL_SEVERE,"SunPosition","computeJulianDate","missingDate"));var t=e.getUTCFullYear(),r=e.getUTCMonth()+1,n=e.getUTCDate(),i=(e.getUTCHours()+e.getUTCMinutes()/60+e.getUTCSeconds()/3600)/24;r<=2&&(t-=1,r+=12);var a=Math.trunc(t/100),o=2-a+Math.trunc(a/4);return Math.trunc(365.25*(t+4716))+Math.trunc(30.6001*(r+1))+n+o-1524.5+i},normalizeAngle360:function(e){var t=e%360;return t>=0?t:t<0?360+t:360-t}},Pe=b.a.Angle,Me={SUN:0,MERCURY:1,VENUS:2,MARS:4,JUPITER:5,SATURN:6,URANUS:7,NEPTUNE:8,getCelestialLocation:function(e,t){var r,n=ke.computeJulianDate(t)-2451543.5;switch(e){case this.SUN:r=this.computeSun(n);break;case this.MERCURY:r=this.computeMercury(n);break;case this.VENUS:r=this.computeVenus(n);break;case this.MARS:r=this.computeMars(n);break;case this.JUPITER:r=this.computeJupiter(n);break;case this.SATURN:r=this.computeSaturn(n);break;case this.URANUS:r=this.computeUranus(n);break;case this.NEPTUNE:r=this.computeNeptune(n)}return this.computePosition(n,r)},computeMercury:function(e){return{N:48.3313+324587e-10*e,i:7.0047+5e-8*e,w:29.1241+101444e-10*e,a:.387098,e:.205635+5.59e-10*e,M:168.6562+4.0923344368*e}},computeVenus:function(e){return{N:76.6799+24659e-9*e,i:3.3946+2.75e-8*e,w:54.891+138374e-10*e,a:.72333,e:.006773-1.302e-9*e,M:48.0052+1.6021302244*e}},computeMars:function(e){return{N:49.5574+211081e-10*e,i:1.8497-1.78e-8*e,w:286.5016+292961e-10*e,a:1.523688,e:.093405+2.516e-9*e,M:18.6021+.5240207766*e}},computeJupiter:function(e){return{N:100.4542+276854e-10*e,i:1.303-1.557e-7*e,w:273.8777+164505e-10*e,a:5.20256,e:.048498+4.469e-9*e,M:19.895+.0830853001*e}},computeSaturn:function(e){return{N:113.6634+23898e-9*e,i:2.4886-1.081e-7*e,w:339.3939+297661e-10*e,a:9.55475,e:.055546-9.499e-9*e,M:316.967+.0334442282*e}},computeUranus:function(e){return{N:74.0005+13978e-9*e,i:.7733+19e-9*e,w:96.6612+30565e-9*e,a:19.18171-1.55e-8*e,e:.047318+7.45e-9*e,M:142.5905+.011725806*e}},computeNeptune:function(e){return{N:131.7806+30173e-9*e,i:1.77-255e-9*e,w:272.8461-6027e-9*e,a:30.05826+3.313e-8*e,e:.008606+2.15e-9*e,M:260.2471+.005995147*e}},computeSun:function(e){return{N:0,i:0,w:282.9404+470935e-10*e,a:1,e:.016709-1.151e-9*e,M:356.047+.9856002585*e}},computePosition:function(e,t){var r=t.N,n=t.i,i=t.w,a=t.a,o=t.e,s=t.M;r=ke.normalizeAngle360(r)*Pe.DEGREES_TO_RADIANS,n=ke.normalizeAngle360(n)*Pe.DEGREES_TO_RADIANS,i=ke.normalizeAngle360(i)*Pe.DEGREES_TO_RADIANS;var l=(s=ke.normalizeAngle360(s)*Pe.DEGREES_TO_RADIANS)+o*Math.sin(s)*(1+o*Math.cos(s));if(o>=.06)for(var c=0;c<10;c++){var u=l-(l-o*Math.sin(l)-s)/(1-o*Math.cos(l));if(Math.abs(u-l)<.001){l=u;break}l=u}var d=a*(Math.cos(l)-o),h=a*(Math.sqrt(1-o*o)*Math.sin(l)),g=Math.atan2(h,d),f=Math.sqrt(d*d+h*h),p=f*(Math.cos(r)*Math.cos(g+i)-Math.sin(r)*Math.sin(g+i)*Math.cos(n)),m=f*(Math.sin(r)*Math.cos(g+i)+Math.cos(r)*Math.sin(g+i)*Math.cos(n)),_=f*(Math.sin(g+i)*Math.sin(n)),v=382394e-10*(0-e)*Pe.DEGREES_TO_RADIANS,b=Math.atan2(m,p)+v,y=Math.atan2(_,Math.sqrt(p*p+m*m));p=f*Math.cos(b)*Math.cos(y),m=f*Math.sin(b)*Math.cos(y),_=f*Math.sin(y);var E=this.getLonSun(e,this.computeSun(e)),S=E.lonsun,x=E.rsun;S*=Pe.RADIANS_TO_DEGREES,S=ke.normalizeAngle360(S)*Pe.DEGREES_TO_RADIANS;var w=p+x*Math.cos(S),T=m+x*Math.sin(S),O=_,R=ke.normalizeAngle360(23.4393-3.563e-7*e)*Pe.DEGREES_TO_RADIANS,C=w,D=T*Math.cos(R)-O*Math.sin(R),j=T*Math.sin(R)+O*Math.cos(R);return{ra:ke.normalizeAngle360(Math.atan2(D,C)*Pe.RADIANS_TO_DEGREES),dec:Math.atan2(j,Math.sqrt(C*C+D*D))*Pe.RADIANS_TO_DEGREES}},getLonSun:function(e,t){var r=t.w,n=t.e,i=t.M;r=ke.normalizeAngle360(r)*Pe.DEGREES_TO_RADIANS;var a=(i=ke.normalizeAngle360(i)*Pe.DEGREES_TO_RADIANS)+n*Math.sin(i)*(1+n*Math.cos(i)),o=Math.cos(a)-n,s=Math.sqrt(1-n*n)*Math.sin(a);return{lonsun:Math.atan2(s,o)+r,rsun:Math.sqrt(o*o+s*s)}}},Ie=b.a.ArgumentError,Ge=b.a.GpuProgram,Ue=b.a.Logger,Fe=b.a.Matrix,Be=b.a.Color,Ve=function(e){Object(q.a)(r,e);var t=Object(K.a)(r);function r(e){var n;return Object(P.a)(this,r),(n=t.call(this,e,"attribute vec4 vertexPoint;\nuniform mat4 mvpMatrix;\nuniform float numDays;\nuniform vec2 magnitudeRange;\nvarying float magnitudeWeight;\nfloat normalizeAngle(float angle) {\n   float angleDivisions = angle / 360.0;\n   return 360.0 * (angleDivisions - floor(angleDivisions));\n}\nvec3 computePosition(float dec, float ra) {\n   float GMST = normalizeAngle(280.46061837 + 360.98564736629 * numDays);\n   float GHA = normalizeAngle(GMST - ra);\n   float lon = -GHA + 360.0 * step(180.0, GHA);\n   float latRad = radians(dec);\n   float lonRad = radians(lon);\n   float radCosLat = cos(latRad);\n   return vec3(radCosLat * sin(lonRad), sin(latRad), radCosLat * cos(lonRad));\n}\nfloat normalizeScalar(float value, float minValue, float maxValue){\n   return (value - minValue) / (maxValue - minValue);\n}\nvoid main() {\n   vec3 vertexPosition = computePosition(vertexPoint.x, vertexPoint.y);\n   gl_Position = mvpMatrix * vec4(vertexPosition.xyz, 1.0);\n   gl_Position.z = gl_Position.w - 0.00001;\n   gl_PointSize = vertexPoint.z;\n   magnitudeWeight = normalizeScalar(vertexPoint.w, magnitudeRange.x, magnitudeRange.y);\n}","precision mediump float;\nuniform sampler2D textureSampler;\nuniform int fragMode;\nuniform vec4 color;\nvarying float magnitudeWeight;\nconst vec4 white = vec4(1.0, 1.0, 1.0, 1.0);\nconst vec4 grey = vec4(0.5, 0.5, 0.5, 1.0);\nvoid main() {\n   if (fragMode == 1) {\n       gl_FragColor = texture2D(textureSampler, gl_PointCoord);\n   }\n   else if (fragMode == 0) {\n       gl_FragColor = mix(white, grey, magnitudeWeight);\n   }\n   else if (fragMode == 2) {\n       gl_FragColor = color;\n   }\n}",["vertexPoint"])).FRAG_MODE_MIX_COLOR=0,n.FRAG_MODE_TEXTURE=1,n.FRAG_MODE_COLOR=2,n.vertexPointLocation=n.attributeLocation(e,"vertexPoint"),n.mvpMatrixLocation=n.uniformLocation(e,"mvpMatrix"),n.numDaysLocation=n.uniformLocation(e,"numDays"),n.magnitudeRangeLocation=n.uniformLocation(e,"magnitudeRange"),n.textureUnitLocation=n.uniformLocation(e,"textureSampler"),n.fragModeLocation=n.uniformLocation(e,"fragMode"),n.colorLocation=n.uniformLocation(e,"color"),n.localState={mvpMatrix:null,numDays:null,magnitudeRange:null,textureUnit:null,fragMode:null,color:null},n}return Object(M.a)(r,[{key:"loadModelviewProjection",value:function(e,t){if(!t)throw new Ie(Ue.logMessage(Ue.LEVEL_SEVERE,"StarFieldProgram","loadModelviewProjection","missingMatrix"));var r=!1;null===this.localState.mvpMatrix&&(r=!0,this.localState.mvpMatrix=Fe.fromIdentity()),!r&&this.localState.mvpMatrix.equals(t)||(this.loadUniformMatrix(e,t,this.mvpMatrixLocation),this.localState.mvpMatrix.copy(t))}},{key:"loadNumDays",value:function(e,t){if(null==t)throw new Ie(Ue.logMessage(Ue.LEVEL_SEVERE,"StarFieldProgram","loadNumDays","missingNumDays"));this.localState.numDays!==t&&(e.uniform1f(this.numDaysLocation,t),this.localState.numDays=t)}},{key:"loadMagnitudeRange",value:function(e,t,r){if(null==t)throw new Ie(Ue.logMessage(Ue.LEVEL_SEVERE,"StarFieldProgram","loadMagRange","missingMinMag"));if(null==r)throw new Ie(Ue.logMessage(Ue.LEVEL_SEVERE,"StarFieldProgram","loadMagRange","missingMaxMag"));var n=!1;null===this.localState.magnitudeRange&&(n=!0,this.localState.magnitudeRange=[t,r]),(n||this.localState.magnitudeRange[0]!==t||this.localState.magnitudeRange[1]!==r)&&(e.uniform2f(this.magnitudeRangeLocation,t,r),this.localState.magnitudeRange[0]=t,this.localState.magnitudeRange[1]=r)}},{key:"loadTextureUnit",value:function(e,t){this.localState.textureUnit!==t&&(e.uniform1i(this.textureUnitLocation,t-e.TEXTURE0),this.localState.textureUnit=t)}},{key:"loadFragMode",value:function(e,t){this.localState.fragMode!==t&&(e.uniform1i(this.fragModeLocation,t),this.localState.fragMode=t)}},{key:"loadColor",value:function(e,t){var r=!1;null===this.localState.color&&(r=!0,this.localState.color=new Be(0,0,0,0)),!r&&this.localState.color.equals(t)||(this.loadUniformColor(e,t,this.colorLocation),this.localState.color.copy(t))}}]),r}(Ge);Ve.key="WorldWindGpuStarFieldFullProgram";var ze=Ve,We=(b.a.Color,b.a.Layer),He=b.a.Logger,qe=b.a.Matrix,Ke=b.a.REDRAW_EVENT_TYPE,Ye=function(e){Object(q.a)(r,e);var t=Object(K.a)(r);function r(e){var n;Object(P.a)(this,r),(n=t.call(this,"StarField")).pickEnabled=!1,n.sunSize=128,n.showSun=!0,n._starDataSource=e||b.a.configuration.baseUrl+"data/stars.json",n._sunImageSource=b.a.configuration.baseUrl+"images/sunTexture.png",n._matrix=qe.fromIdentity(),n._starsPositionsVboCacheKey=null,n._numStars=0,n._starData=null,n._minMagnitude=Number.MAX_VALUE,n._maxMagnitude=Number.MIN_VALUE,n._loadStarted=!1,n._minScale=3e7,n._scale=Number.MAX_SAFE_INTEGER||Math.pow(2,53)-1,n._sunPositionsCacheKey="",n._sunBufferView=new Float32Array(4),n._MAX_GL_POINT_SIZE=0,n.showPlanets=!0;var i=32;return n.planets=[{id:Me.MERCURY,url:"images/Mercury64.png",size:8,ra:null,dec:null},{id:Me.VENUS,url:"images/Venus64.png",size:8,ra:null,dec:null},{id:Me.MARS,url:"images/Mars64.png",size:8,ra:null,dec:null},{id:Me.JUPITER,url:"images/Jupiter64.png",size:i,ra:null,dec:null},{id:Me.SATURN,url:"images/Saturn64.png",size:i,ra:null,dec:null},{id:Me.URANUS,url:"images/Uranus64.png",size:16,ra:null,dec:null},{id:Me.NEPTUNE,url:"images/Neptune64.png",size:16,ra:null,dec:null}],n._planetsBufferView=null,n._cacheKeys={sunPosition:"",planetPositions:"",starPositions:""},n}return Object(M.a)(r,[{key:"starDataSource",get:function(){return this._starDataSource},set:function(e){this._starDataSource=e,this.invalidateStarData()}},{key:"sunImageSource",get:function(){return this._sunImageSource},set:function(e){this._sunImageSource=e}},{key:"doRender",value:function(e){if(!e.globe.is2D())if(this.haveResources(e)){this.beginRendering(e);try{this.doDraw(e)}finally{this.endRendering(e)}}else this.loadResources(e)}},{key:"haveResources",value:function(e){var t=e.gpuResourceCache.resourceForKey(this._sunImageSource),r=this.planets.every((function(t){return!!e.gpuResourceCache.resourceForKey(t.url)}));return null!=this._starData&&null!=t&&r}},{key:"loadResources",value:function(e){var t=e.currentGlContext,r=e.gpuResourceCache;this._starData||this.fetchStarData(),r.resourceForKey(this._sunImageSource)||r.retrieveTexture(t,this._sunImageSource),this.planets.forEach((function(e){r.resourceForKey(e.url)||r.retrieveTexture(t,e.url)}))}},{key:"beginRendering",value:function(e){var t=e.currentGlContext;e.findAndBindProgram(ze),t.enableVertexAttribArray(0),t.depthMask(!1)}},{key:"doDraw",value:function(e){this.loadCommonUniforms(e),this.renderStars(e),this.showSun&&this.renderSun(e),this.showPlanets&&this.renderPlanets(e)}},{key:"loadCommonUniforms",value:function(e){var t=e.currentGlContext,r=e.currentProgram,n=e.modelviewProjection||e.navigatorState.modelviewProjection;this._matrix.copy(n),this._matrix.multiplyByScale(this._scale,this._scale,this._scale),r.loadModelviewProjection(t,this._matrix);var i=ke.computeJulianDate(this.time||new Date);r.loadNumDays(t,i-2451545)}},{key:"renderStars",value:function(e){var t=e.currentGlContext,r=e.gpuResourceCache,n=e.currentProgram;this._starsPositionsVboCacheKey||(this._starsPositionsVboCacheKey=r.generateCacheKey());var i=r.resourceForKey(this._starsPositionsVboCacheKey);if(i)t.bindBuffer(t.ARRAY_BUFFER,i);else{i=t.createBuffer();var a=this.createStarsGeometry();r.putResource(this._starsPositionsVboCacheKey,i,4*a.length),t.bindBuffer(t.ARRAY_BUFFER,i),t.bufferData(t.ARRAY_BUFFER,new Float32Array(a),t.STATIC_DRAW)}e.frameStatistics.incrementVboLoadCount(1),t.vertexAttribPointer(0,4,t.FLOAT,!1,0,0),n.loadMagnitudeRange(t,this._minMagnitude,this._maxMagnitude),n.loadFragMode(t,n.FRAG_MODE_MIX_COLOR),t.drawArrays(t.POINTS,0,this._numStars)}},{key:"renderPlanets",value:function(e){var t=this,r=e.currentGlContext,n=e.currentProgram,i=e.gpuResourceCache;this._MAX_GL_POINT_SIZE||(this._MAX_GL_POINT_SIZE=r.getParameter(r.ALIASED_POINT_SIZE_RANGE)[1]),this.sunSize>this._MAX_GL_POINT_SIZE&&He.log(He.LEVEL_WARNING,"StarFieldLayer - sunSize is to big, max size allowed is: "+this._MAX_GL_POINT_SIZE),this.planets.forEach((function(e){var r=Me.getCelestialLocation(e.id,t.time||new Date),n=r.ra,i=r.dec;e.ra=n,e.dec=i}),this),this._planetsBufferView||(this._planetsBufferView=new Float32Array(4*this.planets.length));for(var a=0;a<this.planets.length;a++){var o=this.planets[a];this._planetsBufferView[4*a+0]=o.dec,this._planetsBufferView[4*a+1]=o.ra,this._planetsBufferView[4*a+2]=Math.min(o.size,this._MAX_GL_POINT_SIZE),this._planetsBufferView[4*a+3]=1}this._planetsPositionsVboCacheKey||(this._planetsPositionsVboCacheKey=i.generateCacheKey());var s=i.resourceForKey(this._planetsPositionsVboCacheKey);s?(r.bindBuffer(r.ARRAY_BUFFER,s),r.bufferSubData(r.ARRAY_BUFFER,0,this._planetsBufferView)):(s=r.createBuffer(),i.putResource(this._planetsPositionsVboCacheKey,s,4*this._planetsBufferView.length),r.bindBuffer(r.ARRAY_BUFFER,s),r.bufferData(r.ARRAY_BUFFER,this._planetsBufferView,r.DYNAMIC_DRAW)),e.frameStatistics.incrementVboLoadCount(1),r.vertexAttribPointer(0,4,r.FLOAT,!1,0,0),n.loadFragMode(r,n.FRAG_MODE_TEXTURE);for(var l=0;l<this.planets.length;l++){var c=this.planets[l].url;e.gpuResourceCache.resourceForKey(c).bind(e),r.drawArrays(r.POINTS,l,1)}}},{key:"renderSun",value:function(e){var t=e.currentGlContext,r=e.currentProgram,n=e.gpuResourceCache;this._MAX_GL_POINT_SIZE||(this._MAX_GL_POINT_SIZE=t.getParameter(t.ALIASED_POINT_SIZE_RANGE)[1]),this.sunSize>this._MAX_GL_POINT_SIZE&&He.log(He.LEVEL_WARNING,"StarFieldLayer - sunSize is to big, max size allowed is: "+this._MAX_GL_POINT_SIZE);var i=ke.getAsCelestialLocation(this.time||new Date);this._sunBufferView[0]=i.declination,this._sunBufferView[1]=i.rightAscension,this._sunBufferView[2]=Math.min(this.sunSize,this._MAX_GL_POINT_SIZE),this._sunBufferView[3]=1,this._sunPositionsCacheKey||(this._sunPositionsCacheKey=n.generateCacheKey());var a=n.resourceForKey(this._sunPositionsCacheKey);a?(t.bindBuffer(t.ARRAY_BUFFER,a),t.bufferSubData(t.ARRAY_BUFFER,0,this._sunBufferView)):(a=t.createBuffer(),n.putResource(this._sunPositionsCacheKey,a,4*this._sunBufferView.length),t.bindBuffer(t.ARRAY_BUFFER,a),t.bufferData(t.ARRAY_BUFFER,this._sunBufferView,t.DYNAMIC_DRAW)),e.frameStatistics.incrementVboLoadCount(1),t.vertexAttribPointer(0,4,t.FLOAT,!1,0,0),r.loadFragMode(t,r.FRAG_MODE_TEXTURE),e.gpuResourceCache.resourceForKey(this._sunImageSource).bind(e),t.drawArrays(t.POINTS,0,1)}},{key:"endRendering",value:function(e){var t=e.currentGlContext;t.depthMask(!0),t.disableVertexAttribArray(0)}},{key:"fetchStarData",value:function(){if(!this._loadStarted){this._loadStarted=!0;var e=this,t=new XMLHttpRequest;t.onload=function(){if(this.status>=200&&this.status<300)try{e._starData=JSON.parse(this.response),e.sendRedrawRequest()}catch(t){He.log(He.LEVEL_SEVERE,"StarFieldLayer unable to parse JSON for star data "+t.toString())}else He.log(He.LEVEL_SEVERE,"StarFieldLayer unable to fetch star data. Status: "+this.status+" "+this.statusText);e._loadStarted=!1},t.onerror=function(){He.log(He.LEVEL_SEVERE,"StarFieldLayer unable to fetch star data"),e._loadStarted=!1},t.ontimeout=function(){He.log(He.LEVEL_SEVERE,"StarFieldLayer fetch star data has timeout"),e._loadStarted=!1},t.open("GET",this._starDataSource,!0),t.send()}}},{key:"createStarsGeometry",value:function(){var e=this.parseStarsMetadata(this._starData.metadata);if(-1===e.raIndex)throw new Error(He.logMessage(He.LEVEL_SEVERE,"StarFieldLayer","createStarsGeometry","Missing ra field in star data."));if(-1===e.decIndex)throw new Error(He.logMessage(He.LEVEL_SEVERE,"StarFieldLayer","createStarsGeometry","Missing dec field in star data."));if(-1===e.magIndex)throw new Error(He.logMessage(He.LEVEL_SEVERE,"StarFieldLayer","createStarsGeometry","Missing vmag field in star data."));var t=this._starData.data,r=[];this._minMagnitude=Number.MAX_VALUE,this._maxMagnitude=Number.MIN_VALUE;for(var n=0,i=t.length;n<i;n++){var a=t[n],o=a[e.decIndex],s=a[e.raIndex],l=a[e.magIndex],c=l<2?2:1;r.push(o,s,c,l),this._minMagnitude=Math.min(this._minMagnitude,l),this._maxMagnitude=Math.max(this._maxMagnitude,l)}return this._numStars=Math.floor(r.length/4),r}},{key:"parseStarsMetadata",value:function(e){for(var t=-1,r=-1,n=-1,i=0,a=e.length;i<a;i++){var o=e[i];"ra"===o.name&&(t=i),"dec"===o.name&&(r=i),"vmag"===o.name&&(n=i)}return{raIndex:t,decIndex:r,magIndex:n}}},{key:"invalidateStarData",value:function(){this._starData=null,this._starsPositionsVboCacheKey=null}},{key:"sendRedrawRequest",value:function(){var e=document.createEvent("Event");e.initEvent(Ke,!0,!0),window.dispatchEvent(e)}}]),r}(We),Qe=r(18),Xe=r.n(Qe),Ze=b.a.Color,Je=[{key:"s1a",name:"SENTINEL-1A",shortName:"S-1A",satIndex:0,swathTypes:["black","red","green","white"],swathColors:[Ze.colorFromKmlHex("ff000000"),Ze.colorFromKmlHex("ff0000ff"),Ze.colorFromKmlHex("ff00ff00"),Ze.colorFromKmlHex("ffffffff")],swatModes:["IW","EW","SM"],tleLineOne:"1 39634U 14016A   18124.03591006  .00000001  00000-0  10014-4 0  9998",tleLineTwo:"2 39634  98.1819 132.0838 0001369  78.7198 281.4156 14.59198520217480",hasModel:!0,filePath:"./satellites/sentinel1/s1.json",rotations:{x:0,y:0,z:0,headingAxis:[0,0,1],headingAdd:-90,headingMultiply:1},preRotations:{x:0,y:0,z:0},scale:5e5,translations:{x:-.1,y:-.1,z:0},ignoreLocalTransforms:!0,launchDate:new Date("2014-04-03T21:02:00.000Z")},{key:"s2a",name:"SENTINEL-2A",shortName:"S-2A",satIndex:1,swathTypes:["red","purple","white","darkGrey","green","greener"],swathColors:[Ze.colorFromKmlHex("ff0000ff"),Ze.colorFromKmlHex("ffff00ff"),Ze.colorFromKmlHex("ffffffff"),Ze.colorFromKmlHex("ff7f7f7f"),Ze.colorFromKmlHex("ff00ff00"),Ze.colorFromKmlHex("ff00fff7")],swatModes:["NOBS"],tleLineOne:"1 40697U 15028A   18124.08865983  .00000004  00000-0  17994-4 0  9993",tleLineTwo:"2 40697  98.5686 199.4434 0001286  92.5669 267.5666 14.30817033149583",hasModel:!0,filePath:"./satellites/senti2version6/s2.json",rotations:{x:0,y:0,z:0,headingAxis:[0,0,1],headingAdd:-90,headingMultiply:1},preRotations:{x:0,y:0,z:0},scale:1e6,translations:{x:.1,y:.385,z:.02},ignoreLocalTransforms:!0,launchDate:new Date("2015-06-23T01:52:00.000Z")},{key:"s3a",name:"SENTINEL-3A",shortName:"S-3A",satIndex:2,tleLineOne:"1 41335U 16011A   18124.14356592 -.00000000  00000-0  18017-4 0  9998",tleLineTwo:"2 41335  98.6266 192.0005 0001035 100.1921 259.9376 14.26736754115121",hasModel:!0,filePath:"./satellites/Sentinel3/s3.json",rotations:{x:0,y:0,z:0,headingAxis:[0,0,1],headingAdd:180,headingMultiply:1},preRotations:{x:0,y:180,z:0},scale:1e6,translations:{x:.01,y:1.98,z:.07},ignoreLocalTransforms:!0,launchDate:new Date("2016-02-16T17:57:00.000Z")},{key:"s1b",name:"SENTINEL-1B",shortName:"S-1B",satIndex:3,swathTypes:["black","red","green","white"],swathColors:[Ze.colorFromKmlHex("ff000000"),Ze.colorFromKmlHex("ff0000ff"),Ze.colorFromKmlHex("ff00ff00"),Ze.colorFromKmlHex("ffffffff")],swatModes:["IW","EW","SM"],tleLineOne:"1 41456U 16025A   18124.13828432 -.00000022  00000-0  49756-5 0  9992",tleLineTwo:"2 41456  98.1817 132.0102 0001487  82.9964 277.1419 14.59197806107664",hasModel:!0,filePath:"./satellites/sentinel1/s1.json",rotations:{x:0,y:0,z:0,headingAxis:[0,0,1],headingAdd:-90,headingMultiply:1},preRotations:{x:0,y:0,z:0},scale:5e5,translations:{x:-.1,y:-.1,z:0},ignoreLocalTransforms:!0,launchDate:new Date("2016-04-25T21:02:00.000Z")},{key:"s2b",name:"SENTINEL-2B",shortName:"S-2B",satIndex:4,swathTypes:["blue"],swathColors:[Ze.colorFromKmlHex("ffffff00")],swatModes:["NOBS"],tleLineOne:"1 42063U 17013A   18124.12358125  .00000002  00000-0  17497-4 0  9994",tleLineTwo:"2 42063  98.5687 199.4702 0001382  97.5073 262.6270 14.30817718 60503",groundPosition:{latitude:5.2079,longitude:-52.7724,altitude:0},hasModel:!0,filePath:"./satellites/senti2version6/s2.json",rotations:{x:0,y:0,z:0,headingAxis:[0,0,1],headingAdd:-90,headingMultiply:1},preRotations:{x:0,y:0,z:0},scale:1e6,translations:{x:.1,y:.385,z:.02},ignoreLocalTransforms:!0,launchDate:new Date("2017-03-07T01:49:00.000Z")},{key:"s5p",name:"SENTINEL-5P",shortName:"S-5P",satIndex:5,swathTypes:[],swathColors:[],tleLineOne:"1 42969U 17064A   18123.85141871 -.00000009  00000-0  16636-4 0  9994",tleLineTwo:"2 42969  98.7352  64.1585 0001101  78.1817 281.9482 14.19565315 28712",groundPosition:{latitude:62.92786,longitude:40.57483,altitude:0},hasModel:!0,filePath:"./satellites/sentinel5p/s5p.json",rotations:{x:0,y:0,z:0,headingAxis:[0,0,1],headingAdd:-90,headingMultiply:1},preRotations:{x:210,y:0,z:0},scale:7e4,translations:{x:.5,y:.4,z:-1.2},ignoreLocalTransforms:!0,launchDate:new Date("2017-10-13T09:27:00.000Z")},{key:"s3b",name:"SENTINEL-3B",shortName:"S-3B",satIndex:6,tleLineOne:"1 43437U 18039A   18122.61596633  .00002473  00000-0  10753-2 0  9999",tleLineTwo:"2 43437  98.6226 190.4610 0008811 292.4467  67.5830 14.24954518   977",groundPosition:{latitude:62.925556,longitude:40.577778,altitude:0},hasModel:!0,filePath:"satellites/Sentinel3/s3.json",rotations:{x:0,y:0,z:0,headingAxis:[0,0,1],headingAdd:180,headingMultiply:1},preRotations:{x:0,y:180,z:0},scale:1e6,translations:{x:.01,y:1.98,z:.07},ignoreLocalTransforms:!0,launchDate:new Date("2018-04-25T17:57:00.000Z")}],$e=Je,et=r(14),tt=b.a.ArgumentError,rt=b.a.BasicTextureProgram,nt=b.a.Color,it=b.a.Logger,at=b.a.Matrix,ot=(b.a.Position,b.a.PickedObject),st=b.a.Renderable,lt=b.a.Vec3,ct=function(e,t){if(!e)throw new tt(it.logMessage(it.LEVEL_SEVERE,"ColladaScene","constructor","missingPosition"));st.call(this),this._position=e,this._nodes=[],this._meshes={},this._materials={},this._images={},this._upAxis="",this._dirPath="",this._xRotation=0,this._yRotation=0,this._zRotation=0,this.preX=0,this.preY=0,this.preZ=0,this._xTranslation=0,this._yTranslation=0,this._zTranslation=0,this._scale=1,this._altitudeMode=b.a.ABSOLUTE,this._localTransforms=!0,this._useTexturePaths=!0,this._nodesToHide=[],this._hideNodes=!1,this._placePoint=new lt(0,0,0),this._transformationMatrix=at.fromIdentity(),this._mvpMatrix=at.fromIdentity(),this._normalTransformMatrix=at.fromIdentity(),this._normalMatrix=at.fromIdentity(),this._texCoordMatrix=at.fromIdentity().setToUnitYFlip(),this._entities=[],this._activeTexture=null,this._tmpVector=new lt(0,0,0),this._tmpColor=new nt(1,1,1,1),this._vboCacheKey="",this._iboCacheKey="",this.setSceneData(t)};(ct.prototype=Object.create(st.prototype)).constructor=ct,Object.defineProperties(ct.prototype,{position:{get:function(){return this._position},set:function(e){this._position=e}},nodes:{get:function(){return this._nodes},set:function(e){this._nodes=e}},meshes:{get:function(){return this._meshes},set:function(e){this._meshes=e}},materials:{get:function(){return this._materials},set:function(e){this._materials=e}},images:{get:function(){return this._images},set:function(e){this._images=e}},upAxis:{get:function(){return this._upAxis},set:function(e){this._upAxis=e}},dirPath:{get:function(){return this._dirPath},set:function(e){this._dirPath=e}},xRotation:{get:function(){return this._xRotation},set:function(e){this._xRotation=e}},yRotation:{get:function(){return this._yRotation},set:function(e){this._yRotation=e}},zRotation:{get:function(){return this._zRotation},set:function(e){this._zRotation=e}},xTranslation:{get:function(){return this._xTranslation},set:function(e){this._xTranslation=e}},yTranslation:{get:function(){return this._yTranslation},set:function(e){this._yTranslation=e}},zTranslation:{get:function(){return this._zTranslation},set:function(e){this._zTranslation=e}},scale:{get:function(){return this._scale},set:function(e){this._scale=e}},placePoint:{get:function(){return this._placePoint},set:function(e){this._placePoint=e}},altitudeMode:{get:function(){return this._altitudeMode},set:function(e){this._altitudeMode=e}},transformationMatrix:{get:function(){return this._transformationMatrix},set:function(e){this._transformationMatrix=e}},normalMatrix:{get:function(){return this._normalMatrix},set:function(e){this._normalMatrix=e}},localTransforms:{get:function(){return this._localTransforms},set:function(e){this._localTransforms=e}},useTexturePaths:{get:function(){return this._useTexturePaths},set:function(e){this._useTexturePaths=e}},nodesToHide:{get:function(){return this._nodesToHide},set:function(e){this._nodesToHide=e}},hideNodes:{get:function(){return this._hideNodes},set:function(e){this._hideNodes=e}}}),ct.prototype.setSceneData=function(e){e&&(this._nodes=e.root.children,this._meshes=e.meshes,this._materials=e.materials,this._images=e.images,this._upAxis=e.metadata.up_axis,this._dirPath=e.dirPath,this.flattenModel())},ct.prototype.flattenModel=function(){for(var e=0,t=this._nodes.length;e<t;e++)this.flattenNode(this._nodes[e]);this._entities.sort((function(e,t){var r=null===e.imageKey?"":""+e,n=null===t.imageKey?"":""+t;return r>n?1:r===n?0:-1}))},ct.prototype.flattenNode=function(e){if(e.mesh)for(var t=e.mesh,r=this._meshes[t].buffers,n=0,i=r.length;n<i;n++){for(var a=r[n].material,o=0;o<e.materials.length;o++)if(a===e.materials[o].symbol){var s=e.materials[o].id;break}var l=this._materials[s],c=null;l&&l.textures&&r[n].uvs&&r[n].uvs.length>0&&(l.textures.diffuse?c=l.textures.diffuse.mapId:l.textures.reflective&&(c=l.textures.reflective.mapId)),this._entities.push({mesh:r[n],material:l,node:e,imageKey:c})}for(var u=0;u<e.children.length;u++)this.flattenNode(e.children[u])},ct.prototype.render=function(e){var t,r=e.frustumInModelCoordinates;this.enabled&&(this.lastFrameTime!==e.timestamp&&(t=this.makeOrderedRenderable(e)),t&&r.containsPoint(this._placePoint)&&(t.layer=e.currentLayer,this.lastFrameTime=e.timestamp,e.addOrderedRenderable(t)))},ct.prototype.makeOrderedRenderable=function(e){return e.surfacePointForMode(this._position.latitude,this._position.longitude,this._position.altitude,this._altitudeMode,this._placePoint),this.eyeDistance=e.eyePoint.distanceTo(this._placePoint),this},ct.prototype.renderOrdered=function(e){if(this.drawOrderedScene(e),e.pickingMode){var t=new ot(this.pickColor.clone(),this,this._position,this.layer,!1);e.resolvePick(t)}},ct.prototype.drawOrderedScene=function(e){try{this.beginDrawing(e)}finally{this.endDrawing(e)}},ct.prototype.beginDrawing=function(e){var t=e.currentGlContext,r=e.gpuResourceCache,n=r.resourceForKey(this._vboCacheKey),i=r.resourceForKey(this._iboCacheKey);n||(this.setupBuffers(e),n=r.resourceForKey(this._vboCacheKey),i=r.resourceForKey(this._iboCacheKey)),t.bindBuffer(t.ARRAY_BUFFER,n),i&&t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,i),e.findAndBindProgram(rt),t.enableVertexAttribArray(0),e.pickingMode&&(this.pickColor=e.uniquePickColor()),this.computeTransformationMatrix(e.globe);for(var a=0,o=this._entities.length;a<o;a++){this.mustRenderNode(this._entities[a].node.id)&&this.draw(e,this._entities[a])}},ct.prototype.setupBuffers=function(e){for(var t=e.currentGlContext,r=Float32Array.BYTES_PER_ELEMENT||4,n=Uint16Array.BYTES_PER_ELEMENT||2,i=Uint32Array.BYTES_PER_ELEMENT||4,a=!1,o=0,s=0,l=0,c=this._entities.length;l<c;l++){var u=this._entities[l].mesh;u.indexedRendering&&(o+=u.indices.length,u.indices instanceof Uint32Array&&(a=!0)),s+=u.vertices.length,this._entities[l].imageKey&&(s+=u.uvs.length),u.normals&&u.normals.length&&(s+=u.normals.length)}var d=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,d),t.bufferData(t.ARRAY_BUFFER,s*r,t.STATIC_DRAW);var h=0;for(l=0,c=this._entities.length;l<c;l++){var g=this._entities[l].mesh.vertices;this._entities[l].vertexOffset=h,t.bufferSubData(t.ARRAY_BUFFER,h*r,g),h+=g.length}for(l=0,c=this._entities.length;l<c;l++)this._entities[l].imageKey&&(g=this._entities[l].mesh.uvs,this._entities[l].uvOffset=h,t.bufferSubData(t.ARRAY_BUFFER,h*r,g),h+=g.length);for(l=0,c=this._entities.length;l<c;l++)(g=g=this._entities[l].mesh.normals)&&g.length&&(this._entities[l].normalOffset=h,t.bufferSubData(t.ARRAY_BUFFER,h*r,g),h+=g.length);var f,p=n,m=o*p;if(a&&((f=e.getExtension("OES_element_index_uint"))?m=o*(p=i):it.log(it.LEVEL_SEVERE,'The 3D model is too big and might not render properly. \nYour browser does not support the "OES_element_index_uint" extension, required to render large models.')),o){var _=t.createBuffer();for(t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,_),t.bufferData(t.ELEMENT_ARRAY_BUFFER,m,t.STATIC_DRAW),h=0,l=0,c=this._entities.length;l<c;l++)(u=this._entities[l].mesh).indexedRendering&&((g=u.indices)instanceof Uint32Array&&!f&&(g=new Uint16Array(g)),this._entities[l].indexOffset=h,this._entities[l].indexSize=p,t.bufferSubData(t.ELEMENT_ARRAY_BUFFER,h*p,g),h+=g.length)}this._vboCacheKey=e.gpuResourceCache.generateCacheKey(),e.gpuResourceCache.putResource(this._vboCacheKey,d,s*r),o&&(this._iboCacheKey=e.gpuResourceCache.generateCacheKey(),e.gpuResourceCache.putResource(this._iboCacheKey,_,m))},ct.prototype.draw=function(e,t){var r=e.currentGlContext,n=e.currentProgram,i=e.gpuResourceCache,a=t.mesh,o=t.material,s=t.node.worldMatrix,l=t.node.normalMatrix,c=a.normals&&a.normals.length,u=t.imageKey;if(this.applyColor(e,o),u){var d=this._useTexturePaths?this._images[u].path:this._images[u].filename,h=this._dirPath+d;if(this._activeTexture=i.resourceForKey(h),!this._activeTexture){var g=a.isClamp?r.CLAMP_TO_EDGE:r.REPEAT;this._activeTexture=i.retrieveTexture(r,h,g)}this._activeTexture&&this._activeTexture.bind(e)?(n.loadTextureEnabled(r,!0),r.vertexAttribPointer(2,2,r.FLOAT,!1,8,4*t.uvOffset),r.enableVertexAttribArray(2),n.loadModulateColor(r,e.pickingMode)):(n.loadTextureEnabled(r,!1),r.disableVertexAttribArray(2))}else n.loadTextureEnabled(r,!1),r.disableVertexAttribArray(2);if(c&&!e.pickingMode?(n.loadApplyLighting(r,1),r.vertexAttribPointer(1,3,r.FLOAT,!1,12,4*t.normalOffset),r.enableVertexAttribArray(1)):(n.loadApplyLighting(r,0),r.disableVertexAttribArray(1)),this.applyMatrix(e,c,h,s,l),r.vertexAttribPointer(0,3,r.FLOAT,!1,12,4*t.vertexOffset),a.indexedRendering){var f=t.indexOffset*t.indexSize;a.indices instanceof Uint32Array&&e.getExtension("OES_element_index_uint")?r.drawElements(r.TRIANGLES,a.indices.length,r.UNSIGNED_INT,f):r.drawElements(r.TRIANGLES,a.indices.length,r.UNSIGNED_SHORT,f)}else r.drawArrays(r.TRIANGLES,0,Math.floor(a.vertices.length/3))},ct.prototype.applyColor=function(e,t){var r,n=e.currentGlContext,i=e.currentProgram;if(t)if("constant"===t.techniqueType)var a=t.reflective;else a=t.diffuse;var o=1,s=1,l=1,c=1;a&&(o=a[0],s=a[1],l=a[2],c=null!=a[3]?a[3]:1),this._tmpColor.set(o,s,l,c),r=c*this.layer.opacity,n.depthMask(r>=1||e.pickingMode),i.loadColor(n,e.pickingMode?this.pickColor:this._tmpColor),i.loadOpacity(n,e.pickingMode?r>0?1:0:r)},ct.prototype.applyMatrix=function(e,t,r,n,i){this._mvpMatrix.copy(e.modelviewProjection),this._mvpMatrix.multiplyMatrix(this._transformationMatrix),n&&this._localTransforms&&this._mvpMatrix.multiplyMatrix(n),t&&!e.pickingMode&&(this._normalMatrix.copy(e.modelviewNormalTransform),this._normalMatrix.multiplyMatrix(this._normalTransformMatrix),i&&this._localTransforms&&this._normalMatrix.multiplyMatrix(i),e.currentProgram.loadModelviewInverse(e.currentGlContext,this._normalMatrix)),r&&this._activeTexture&&(e.currentProgram.loadTextureMatrix(e.currentGlContext,this._texCoordMatrix),this._activeTexture=null),e.currentProgram.loadModelviewProjection(e.currentGlContext,this._mvpMatrix)},ct.prototype.endDrawing=function(e){var t=e.currentGlContext,r=e.currentProgram;t.disableVertexAttribArray(1),t.disableVertexAttribArray(2),r.loadApplyLighting(t,0),r.loadTextureEnabled(t,!1)},ct.prototype.computeTransformationMatrix=function(e){this._transformationMatrix.setToIdentity(),this._transformationMatrix.multiplyByLocalCoordinateTransform(this._placePoint,e),this._transformationMatrix.multiplyByRotation(1,0,0,this._xRotation),this._transformationMatrix.multiplyByRotation(0,1,0,this._yRotation),this._transformationMatrix.multiplyByRotation(0,0,1,this._zRotation),this._transformationMatrix.multiplyByScale(this._scale,this._scale,this._scale),this._transformationMatrix.multiplyByTranslation(this._xTranslation,this._yTranslation,this._zTranslation),this._transformationMatrix.multiplyByRotation(1,0,0,this.preX),this._transformationMatrix.multiplyByRotation(0,1,0,this.preY),this._transformationMatrix.multiplyByRotation(0,0,1,this.preZ),this.computeNormalMatrix()},ct.prototype.computeNormalMatrix=function(){this._transformationMatrix.extractRotationAngles(this._tmpVector),this._normalTransformMatrix.setToIdentity(),this._normalTransformMatrix.multiplyByRotation(-1,0,0,this._tmpVector[0]),this._normalTransformMatrix.multiplyByRotation(0,-1,0,this._tmpVector[1]),this._normalTransformMatrix.multiplyByRotation(0,0,-1,this._tmpVector[2])},ct.prototype.mustRenderNode=function(e){var t=!0;this._hideNodes&&(t=-1===this._nodesToHide.indexOf(e));return t};for(var ut=ct,dt=b.a.Matrix,ht=function(e){Object(q.a)(r,e);var t=Object(K.a)(r);function r(e,n,i){var a;Object(P.a)(this,r),(a=t.call(this))._satellite=n;var o=a.parse(e);return a.draw(i,o),a}return Object(M.a)(r,[{key:"position",value:function(e){this._model.position=e}},{key:"draw",value:function(e,t){var r=this._satellite,n=r.rotations,i=r.translations,a=r.preRotations,o=r.scale,s=r.shortName,l=r.ignoreLocalTransforms,c=new ut(e,t);c.type=this.type,c.satShortName=s,c.nodesToHide=["PlatformCircleAndName","SolarWingsCircleAndName","C-SarCircleAndName","PlatformTextsAndArrows","SolarWingsTextsAndArrows","C-SarTextsAndArrows","SolarArrayGroup","WingsDetailsGroup","Group004","MsiGroup","SatelliteGroup","SatelliteDimensionsGroup","MWRGroup","SRALGroup","OLCIGroup","SLSTRGroup"],c.hideNodes=!0,c.useTexturePaths=!1,c.localTransforms=l,c.scale=o,c.xRotation=n.x,c.yRotation=n.y,c.zRotation=n.z,c.xTranslation=i.x,c.yTranslation=i.y,c.zTranslation=i.z,c.preX=a.x,c.preY=a.y,c.preZ=a.z,this._model=c,t=null}},{key:"parse",value:function(e){var t=e.meshes,r=e.root.children,n=e.materials;for(var i in t)if(t.hasOwnProperty(i))for(var a=t[i].buffers,o=0;o<a.length;o++){var s=a[o].vertices||[],l=a[o].normals||[],c=a[o].uvs||[],u=a[o].indices||[],d=new Float32Array(s),h=new Float32Array(l),g=new Float32Array(c),f=new Uint16Array(u);a[o].vertices=d,a[o].normals=h,a[o].uvs=g,a[o].indices=f}for(var p=0;p<r.length;p++){var m=r[p];if(m.mesh){var _=m.worldMatrix.slice(0);m.worldMatrix=dt.fromIdentity(),m.worldMatrix.copy(_),m.children.length&&console.info("node has children",m)}}for(var v in n)if(n.hasOwnProperty(v)){var b=n[v];"_3_-_Default-material"===b.id?b.reflective&&(b.reflective[0]=.289219,b.reflective[1]=.713497,b.reflective[2]=.870753,b.reflective[3]=1):"_1_-_Default_004-material"===b.id||"_1_-_Default-material"===b.id?b.diffuse[3]=0:"Chrome-material"===b.id?(b.textures=null,b.diffuse[0]=.3137,b.diffuse[1]=.3137,b.diffuse[2]=.3137):"Satellite_panel-material"===b.id?b.textures.reflective.mapId="image9":"_3_-_Default"===b.id?b.textures.reflective.mapId="image4":"_4_-_Default-material"===b.id?b.textures.reflective.mapId="image5":"_5_-_Default_002-material"===b.id?b.textures.reflective.mapId="image6":"_5_-_Default-material"===b.id&&(b.textures.reflective.mapId="image5")}return e}},{key:"render",value:function(e){this._model&&this.enabled&&this._model.render(e)}}]),r}(b.a.Renderable),gt=b.a.RenderableLayer,ft=b.a.Position,pt=Xe.a.EoUtils,mt={rotations:{x:0,y:0,z:0,headingAxis:[0,0,1],headingAdd:-90,headingMultiply:1},preRotations:{x:0,y:0,z:0},scale:5e5,translations:{x:-.1,y:-.1,z:0},ignoreLocalTransforms:!0},_t=function(e){Object(q.a)(r,e);var t=Object(K.a)(r);function r(e,n){var i;return Object(P.a)(this,r),(i=t.call(this,e)).type="SatelliteModelLayer",i._satelliteOptions=n,i._rerenderMap=null,i.key=e.key,i.model=null,i.time=e.time,i.Tle=null,i.heading=null,i.onLayerChanged=e.onLayerChanged||null,i}return Object(M.a)(r,[{key:"setModel",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:mt,r=arguments.length>2?arguments[2]:void 0;e&&(this.model=new ht(e,t,r),this.removeAllRenderables(),this.addRenderable(this.model),this.doRerender())}},{key:"setPosition",value:function(e){e&&this.model&&this.model.position(e)}},{key:"setTle",value:function(e){e&&(this.Tle=e,this.update())}},{key:"update",value:function(){if(this.Tle&&this.time){var e=pt.computeSatrec.apply(pt,Object(et.a)(this.Tle)),t=pt.getOrbitPosition(e,new Date(this.time));this.setPosition(new ft(t.latitude,t.longitude,t.altitude)),this.model&&this.alignWithOrbit(this.time,t,pt.computeSatrec.apply(pt,Object(et.a)(this.Tle)),this._satelliteOptions.rotations,this.model._model),this.doRerender()}}},{key:"alignWithOrbit",value:function(e,t,r,n,i){var a=e.getTime(),o=pt.getOrbitPosition(r,new Date(a+1e4)),s=pt.headingAngleRadians(t.latitude,t.longitude,o.latitude,o.longitude),l=pt.rad2deg(s);this.heading=l,"function"===typeof this.onLayerChanged&&this.onLayerChanged({satKey:this.satName,layerKey:this.key,type:this.type},{update:{heading:this.heading}});var c=(l+n.headingAdd)*n.headingMultiply;0!==l&&(1===n.headingAxis[0]?i.xRotation=c:1===n.headingAxis[1]?i.yRotation=c:1===n.headingAxis[2]&&(i.zRotation=c))}},{key:"setTime",value:function(e){e&&(this.time=e,this.update())}},{key:"setRerender",value:function(e){"function"===typeof e&&(this._rerenderMap=e)}},{key:"doRerender",value:function(){"function"===typeof this._rerenderMap&&this._rerenderMap()}}]),r}(gt),vt=_t,bt=Xe.a.EoUtils,yt=[],Et=function(e){console.log($e[e].name);var t={rotations:$e[e].rotations,preRotations:$e[e].preRotations,scale:$e[e].scale,translations:$e[e].translations,ignoreLocalTransforms:$e[e].ignoreLocalTransforms},r=$e[e].launchDate,n=new Date(r.getTime());n.setUTCFullYear(n.getUTCFullYear()+20);var i=new vt({key:$e[e].key,time:new Date},t);i.timeRange=[r,n];var a=bt.computeSatrec($e[e].tleLineOne,$e[e].tleLineTwo),o=bt.getOrbitPosition(a,new Date);fetch($e[e].filePath).then((function(e){return e.json()})).then((function(t){i.setModel(t,{rotations:$e[e].rotations,preRotations:$e[e].preRotations,scale:$e[e].scale,translations:$e[e].translations,ignoreLocalTransforms:$e[e].ignoreLocalTransforms},o)})),i.setTle([$e[e].tleLineOne,$e[e].tleLineTwo]),yt.push(i)},St=0;St<$e.length;St++)Et(St);for(var xt=yt,wt=Xe.a.EoUtils,Tt=b.a.ABSOLUTE,Ot=(b.a.Color,b.a.Renderable),Rt=b.a.Path,Ct=b.a.ShapeAttributes,Dt=function(e){Object(q.a)(r,e);var t=Object(K.a)(r);function r(e){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Date,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Date,o=arguments.length>3?arguments[3]:void 0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:120;if(Object(P.a)(this,r),n=t.call(this),!e)throw new Error("Orbits#constructor Satellite Record is missing.");return n._satrec=e,n._orbitPoints=s,n._trail=n.trail(n.trailAttributes(o)),a.getTime()===i.getTime()?(n._currentEndTime=new Date(i.getTime()+1e3*s),n._previousEndTime=new Date(i.getTime()+1e3*s)):(n._currentEndTime=a,n._previousEndTime=a),n._currentStartTime=i,n._previousStartTime=i,n.populate(),n}return Object(M.a)(r,[{key:"satrec",value:function(e,t){if(!e)throw Error("No satellite record was provided");this._satrec=e,!0!==t&&this.populate()}},{key:"time",value:function(e,t,r){if(!e)throw Error("No startTime was provided");if(!t)throw Error("No endTime was provided");this._previousStartTime=this._currentStartTime,this._previousEndTime=this._currentEndTime,this._currentStartTime=e,this._currentEndTime=t,!0!==r&&this.update()}},{key:"render",value:function(e){this.enabled&&this._trail.render(e)}},{key:"update",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this._currentStartTime.getTime(),r=t,n=this._previousStartTime.getTime(),i=n,a=t-n,o=this._currentEndTime.getTime(),s=this._previousEndTime.getTime(),l=o-s;if(0!==a||0!==l||e)if(e)this.populate();else{var c=o-t,u=Math.floor(c/this._orbitPoints),d=Math.ceil(Math.abs(r-i)/u)+Math.ceil(Math.abs(o-s)/u);if(d>this._orbitPoints)this.populate();else{if(a){if(a>0)for(var h=0;this._trail.positions[h].time<t;)this._trail.positions.shift();if(a<0)for(var g=Math.ceil(Math.abs(r-i)/u),f=0;f<g;f++){var p=new Date(i-f*u),m=wt.getOrbitPositionWithPositionalData(this._satrec,p).position;m.time=p.getTime(),this._trail.positions=[m].concat(Object(et.a)(this._trail.positions))}}if(l){if(l>0)for(var _=Math.ceil(Math.abs(o-s)/u),v=0;v<_;v++){var b=new Date(s+v*u),y=wt.getOrbitPositionWithPositionalData(this._satrec,b).position;y.time=b.getTime(),this._trail.positions.push(y)}if(l<0)for(var E=this._trail.positions.length-1;this._trail.positions[E].time>o;)this._trail.positions.pop(),E=this._trail.positions.length-1}this._trail.positions=Object(et.a)(this._trail.positions)}}}},{key:"populate",value:function(){for(var e=this._currentStartTime.getTime(),t=this._currentEndTime.getTime()-e,r=Math.floor(t/this._orbitPoints),n=[],i=0;i<this._orbitPoints;i++){var a=new Date(e+i*r),o=wt.getOrbitPositionWithPositionalData(this._satrec,a).position;o.time=a.getTime(),n.push(o)}this._trail.positions=[].concat(n)}},{key:"trail",value:function(e){var t=new Rt([]);return t.enabled=!0,t.altitudeMode=Tt,t.numSubSegments=1,t.attributes=e,t}},{key:"trailAttributes",value:function(e){var t=new Ct(null);return t.outlineColor=e,t.outlineWidth=2,t.drawOutline=!0,t.drawInterior=!0,t}}]),r}(Ot),jt=Dt,Lt=b.a.RenderableLayer,At=b.a.Color,Nt=function(e){Object(q.a)(r,e);var t=Object(K.a)(r);function r(e){var n;return Object(P.a)(this,r),(n=t.call(this,e))._rerenderMap=null,n.satRec=null,n.key=e.key,n.timeWindow=9e5,n.opacity=Number.isFinite(e.opacity)&&e.opacity>-1&&e.opacity<101?e.opacity:100,n._beforeCurrentOrbit=new jt(e.satRec,new Date,new Date,new At(213/255,214/255,210/255,.5)),n._afterCurrentOrbit=new jt(e.satRec,new Date,new Date,new At(1,1,0,.5)),n.addRenderable(n._beforeCurrentOrbit),n.currentTime=null,n.selectTime=null,n.endTime=null,n.endTime=null,n.satRec=null,n.setSatRec(e.satRec),n.setTime(e.currentTime,e.time),n}return Object(M.a)(r,[{key:"setSatRec",value:function(e,t){e&&(this._beforeCurrentOrbit.satrec(e,!0),!0!==t&&this._beforeCurrentOrbit.update(!0),this._afterCurrentOrbit.satrec(e,!0),!0!==t&&this._afterCurrentOrbit.update(!0),this.doRerender())}},{key:"setTime",value:function(e){e&&(this.selectTime=e,this.startTime=new Date(e.getTime()-this.timeWindow),this.endTime=new Date(e.getTime()+this.timeWindow),this._beforeCurrentOrbit.time(this.startTime,this.selectTime,!1),this.doRerender())}},{key:"setTime2",value:function(e,t,r){e&&t&&(this.currentTime=e,this.selectTime=t,this.startTime=new Date(t.getTime()-this.timeWindow),this.endTime=new Date(t.getTime()+this.timeWindow),this.removeRenderable(this._beforeCurrentOrbit),this.removeRenderable(this._afterCurrentOrbit),e.getTime()<this.startTime.getTime()?(this._afterCurrentOrbit.time(this.startTime,this.endTime,r),this.addRenderable(this._afterCurrentOrbit)):this.startTime.getTime()<e.getTime()&&e.getTime()<this.endTime.getTime()?(this._beforeCurrentOrbit.time(this.startTime,e,r),this._afterCurrentOrbit.time(e,this.endTime,r),this.addRenderable(this._beforeCurrentOrbit),this.addRenderable(this._afterCurrentOrbit)):e.getTime()>this.endTime.getTime()&&(this._beforeCurrentOrbit.time(this.startTime,this.endTime,r),this.addRenderable(this._beforeCurrentOrbit)),this.doRerender())}},{key:"forceUpdate",value:function(){this._afterCurrentOrbit.update(!0),this._beforeCurrentOrbit.update(!0)}},{key:"setRerender",value:function(e){"function"===typeof e&&(this._rerenderMap=e)}},{key:"doRerender",value:function(){"function"===typeof this._rerenderMap&&this._rerenderMap()}}]),r}(Lt),kt=Xe.a.EoUtils,Pt=[],Mt=0;Mt<$e.length;Mt++){console.log($e[Mt].name);var It=$e[Mt].launchDate,Gt=new Date(It.getTime()),Ut=$e[Mt].key;Gt.setUTCFullYear(Gt.getUTCFullYear()+20);var Ft=new Nt({key:Ut,satRec:kt.computeSatrec($e[Mt].tleLineOne,$e[Mt].tleLineTwo),time:new Date,currentTime:new Date,opacity:.7});Ft.timeRange=[It,Gt],Ft.displayName="Orbit",Pt.push(Ft)}var Bt=Pt,Vt=[{service:"https://tiles.maps.eox.at/wms",layerNames:"s2cloudless-2018",title:"s2cloudless-2018",numLevels:19,format:"image/png",size:256,sector:b.a.Sector.FULL_SPHERE,levelZeroDelta:new b.a.Location(90,90)},{service:"https://tiles.esa.maps.eox.at/wms",layerNames:"s2cloudless-2018",title:"s2cloudless-2018 esa",numLevels:19,format:"image/png",size:256,sector:b.a.Sector.FULL_SPHERE,levelZeroDelta:new b.a.Location(90,90)},{service:"https://tiles.esa.maps.eox.at/wms",layerNames:"osm",title:"osm",numLevels:19,format:"image/png",size:256,sector:b.a.Sector.FULL_SPHERE,levelZeroDelta:new b.a.Location(90,90)},{service:"https://tiles.esa.maps.eox.at/wms",layerNames:"terrain-light",title:"terrain-light",numLevels:19,format:"image/png",size:256,sector:b.a.Sector.FULL_SPHERE,levelZeroDelta:new b.a.Location(90,90)},{service:"https://tiles.maps.eox.at/wms",layerNames:"terrain",title:"terrain",numLevels:19,format:"image/png",size:256,sector:b.a.Sector.FULL_SPHERE,levelZeroDelta:new b.a.Location(90,90)}],zt=[{service:"https://tiles.maps.eox.at/wms",layerNames:"hydrography",title:"hydrography",numLevels:19,format:"image/png",size:256,sector:b.a.Sector.FULL_SPHERE,levelZeroDelta:new b.a.Location(90,90)},{service:"https://tiles.maps.eox.at/wms",layerNames:"overlay_bright",title:"overlay_bright",numLevels:19,format:"image/png",size:256,sector:b.a.Sector.FULL_SPHERE,levelZeroDelta:new b.a.Location(90,90)},{service:"https://tiles.esa.maps.eox.at/wms",layerNames:"overlay",title:"overlay",numLevels:19,format:"image/png",size:256,sector:b.a.Sector.FULL_SPHERE,levelZeroDelta:new b.a.Location(90,90)}];function Wt(e){var t=e.id,r=864e5,i=Object(n.useRef)(864e9),a=Object(n.useRef)(36e5),o=Object(n.useRef)(864e9),c=Object(n.useRef)(null),u=Object(n.useState)(""),d=Object(s.a)(u,2),h=(d[0],d[1],Object(n.useState)({})),g=Object(s.a)(h,2),f=g[0],p=g[1],v=Object(n.useRef)(1),y=Object(n.useRef)(0),E=Object(n.useRef)(!1),S=Object(n.useRef)(!1),x=Object(n.useRef)(!1),w=Object(n.useRef)(!1),T=Object(n.useRef)(!1),O=Object(n.useRef)(!1),R=Object(n.useRef)(!1),C=Object(n.useRef)(!1),D=Object(n.useRef)(0),j=Object(n.useRef)([]),L=Object(n.useRef)(new Date),A=(Object(n.useRef)(-1),Object(n.useRef)());function N(e){console.log("toggleAtmosphere: "+e);var t=W("Atmosphere");S.current=null!==e?e:!S.current,t.enabled=S.current,c.current.redraw()}function k(e){console.log("toggleModel: "+e),E.current=null!=e?e:!E.current,q(L.current,E.current),K(L.current,E.current),c.current.redraw()}function P(e){console.log("toggleStarfield: "+e);var t=W("StarField");x.current=null!=e?e:!x.current,t.enabled=x.current,c.current.redraw()}function M(e){console.log("toggleNames: "+e);var t=W("overlay_bright");w.current=null!==e?e:!w.current,t.enabled=w.current,F(),c.current.redraw()}function I(e){var t=-1;e=null===e?(v.current+1)%Vt.length:e%Vt.length,v.current=e;for(var r=0;r<c.current.layers.length;r++)"background"===c.current.layers[r].type&&c.current.layers[r].type&&(t+=1,c.current.layers[r].enabled=t===e);c.current.redraw()}function G(e){var t;console.log("toogleDem: "+e),C.current=null!==e?e:!C.current,C.current?(console.log("Switching to Copernicus Dem"),(t=new b.a.ElevationModel).addCoverage(new b.a.TiledElevationCoverage({coverageSector:b.a.Sector.FULL_SPHERE,resolution:.008333333333333,retrievalImageFormat:"image/tiff",minElevation:-11e3,maxElevation:8850,urlBuilder:new b.a.WcsTileUrlBuilder("https://dem.esa.maps.eox.at/elevation","copdem","2.0.1")}))):(console.log("Switching to NASA Dem"),t=new b.a.EarthElevationModel),c.current.globe.elevationModel=t,c.current.redraw()}function U(e){var t=["3D","Equirectangular","Mercator","North Polar","South Polar"],r=t.length;switch(D.current=null===e?(D.current+1)%r:e%r,t[D.current]){case"3D":default:c.current.globe.projection=new b.a.ProjectionWgs84;break;case"Equirectangular":c.current.globe.projection=new b.a.ProjectionEquirectangular;break;case"Mercator":c.current.globe.projection=new b.a.ProjectionMercator;break;case"North Polar":c.current.globe.projection=new b.a.ProjectionPolarEquidistant("North");break;case"South Polar":c.current.globe.projection=new b.a.ProjectionPolarEquidistant("South")}c.current.redraw()}var F=function(){c.current.layers.sort((function(e,t){return e.zIndex-t.zIndex}))};function B(e){return V.apply(this,arguments)}function V(){return(V=Object(_.a)(Object(m.a)().mark((function e(t){var n,i,a,o;return Object(m.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=null,t.userProperties.title.indexOf("MSIL1C")>=0&&(n="S2L1C_TRUE_COLOR"),t.userProperties.title.indexOf("MSIL2A")>=0&&(n="S2L2A_TRUE_COLOR"),t.userProperties.title.indexOf("GRD")>=0&&(n="S1_IW_GRDH_FullResolution"),null!==n){e.next=6;break}return e.abrupt("return");case 6:i={service:"https://view.onda-dias.eu/instance00/ows",layerNames:n,title:"QuicklookWMS",numLevels:19,format:"image/png",size:256,sector:t.sector,levelZeroDelta:new b.a.Location(90,90)},z(),a=new b.a.WmsLayer(i,t.timeRange[1].toJSON()),(o=[])[1]=t.timeRange[1],o[0]=new Date(o[1].getTime()-r),a.timeRange=o,a.zIndex=900,a.maxActiveAltitude=3e6,c.current.addLayer(a),F(),c.current.redraw(),console.log(c.current.layers);case 19:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function z(){c.current.removeLayer(W("QuicklookWMS")),c.current.redraw()}function W(e){for(var t=0;t<c.current.layers.length;t++)if(c.current.layers[t].displayName===e)return c.current.layers[t];return null}function H(e,t){for(var r=0;r<t.renderables.length;r++)if(t.renderables[r].userProperties.title===e.userProperties.title)return r;return null}function q(e,t){for(var r=0;r<xt.length;r++)xt[r].timeRange[0].getTime()>e||xt[r].timeRange[1].getTime()<e?xt[r].enabled=!1:(xt[r].setTime(new Date(e)),xt[r].enabled=null===t?E.current:t)}function K(e,t){for(var r=0;r<Bt.length;r++)Bt[r].timeRange[0].getTime()>e||Bt[r].timeRange[1].getTime()<e?Bt[r].enabled=!1:(Bt[r].setTime(new Date(e)),Bt[r].enabled=null===t?E.current:t)}function Y(e){for(var t=[],r=0;r<e.renderables.length;r++)e.renderables[r].filtered&&!0===e.renderables[r].filtered||t.push(e.renderables[r].userProperties.earthObservation.acquisitionInformation[0].acquisitionParameter.acquisitionStartTime.getTime());return t}function Q(e,t){var r=!0;if(!e.userProperties)return!0;for(var n=0;n<t.length;n++)"relativePassNumber"===t[n].attribute&&(r*=e.userProperties.earthObservation.acquisitionInformation[0].acquisitionParameter.relativePassNumber===t[n].value);return r}function X(e,t,r,n){if(0===e.renderables.length)return null;for(var i,a,o,s=-1,l=1e17,c=0;c<e.renderables.length;c++)i=e.renderables[c].timeRange[0].getTime(),a=e.renderables[c].timeRange[1].getTime(),o=!!e.renderables[c].filtered&&e.renderables[c].filtered,a>=t.getTime()-n&&i<=t.getTime()+r&&!o?(e.renderables[c].enabled=!0,e.renderables[c].highlighted=!1):(e.renderables[c].enabled=!1,e.renderables[c].highlighted=!1),i<=t.getTime()&&Math.abs(i-t.getTime())<l&&!o&&(s=c,l=Math.abs(i-t.getTime()));return-1===s&&(console.log("closest not found"),s=e.renderables.length-1),e.renderables[s].enabled=!0,e.renderables[s].highlighted=!0,e.renderables[s]}var Z=Object(n.useRef)([]),J=function(e,t){var r=new Image;r.onload=function(){var e=r.width,n=r.height,i=document.createElement("canvas"),a=i.getContext("2d");i.width=e,i.height=n,a.transform(1,0,0,-1,0,n),a.drawImage(r,0,0),t(i.toDataURL())},r.src=e},$=function(){var e=Object(_.a)(Object(m.a)().mark((function e(t){var r,n,i,a,o,s;return Object(m.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch(t,{cache:"force-cache"});case 3:if((r=e.sent).ok){e.next=6;break}throw new Error("HTTP error! status: ".concat(r.status));case 6:return e.next=8,r.text();case 8:for(n=e.sent,i=n.split("\n"),a=[],o=[],s=0;s<i.length;s++)o=i[s].split(":"),a[s]={tile:o[0],footprint:o[1]};j.current=a,e.next=19;break;case 16:e.prev=16,e.t0=e.catch(0),console.log("error getting LUT");case 19:case"end":return e.stop()}}),e,null,[[0,16]])})));return function(t){return e.apply(this,arguments)}}(),ee=function(e){for(var t=0;j.current[t].tile!==e;)t++;for(var r=j.current[t].footprint.slice(15,j.current[t].footprint.length-3).split(","),n=[],i=0;i<r.length;i++){var a=r[i].split(" "),o=a[1],s=a[0];n.push({latitude:o,longitude:s})}var l=[];return l[0]=n,l},te=function(){var e=Object(_.a)(Object(m.a)().mark((function e(t,r,n,i,a,o,s){var l,u,d,h,g,f,p,v,b;return Object(m.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:u=function(){return u=Object(_.a)(Object(m.a)().mark((function e(t){return Object(m.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){J(t,(function(t){var r=new Image;r.addEventListener("load",(function(){e(r)}),!1),r.src=t}))})));case 1:case"end":return e.stop()}}),e)}))),u.apply(this,arguments)},l=function(e){return u.apply(this,arguments)},d=new AbortController,Z.current.push(d),h=0;case 5:if(!(h<o.renderables.length)){e.next=11;break}if(o.renderables[h].displayName!==n[1].toUTCString()){e.next=8;break}return e.abrupt("return");case 8:h++,e.next=5;break;case 11:return e.prev=11,e.next=14,fetch(t,{mode:"cors",credentials:"include",signal:d.signal,cache:"force-cache"});case 14:if((g=e.sent).ok){e.next=17;break}throw new Error("HTTP error (QL)! status: ".concat(g.status));case 17:return e.next=19,g.blob();case 19:return f=e.sent,p=URL.createObjectURL(f),e.next=23,l(p);case 23:for(v=e.sent,(b=new ae(r,i)).maximumNumEdgeIntervals=2,b.polarThrottle=1,b.timeRange=n,b.displayName=n[1].toUTCString(),b.zIndex=800,b.userProperties=a,b.enabled=s.enabled,b.image=v,o.addRenderable(b);o.renderables.length>20;)o.renderables.shift();URL.revokeObjectURL(p),F(),c.current.redraw(),e.next=43;break;case 40:e.prev=40,e.t0=e.catch(11),console.log("Error contacting server (QL)...");case 43:case"end":return e.stop()}}),e,null,[[11,40]])})));return function(t,r,n,i,a,o,s){return e.apply(this,arguments)}}(),re=function(){var e=Object(_.a)(Object(m.a)().mark((function e(t){var r,n,i,a,o,s,l,c;return Object(m.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=20;break}if(null!=(r=t.userProperties.quicklookUrl)){e.next=5;break}return console.log("no QL"),e.abrupt("return");case 5:for(n=t.userProperties.earthObservation.productInformation.tile?ee(t.userProperties.earthObservation.productInformation.tile):t.boundaries[0],i=0,a=0;a<n.length;a++)Math.abs(n[a].latitude)>i&&(i=n[a].latitude);if(!(i>84)){e.next=12;break}return console.log("I refuse"),console.log(t.boundaries[0]),e.abrupt("return");case 12:(o=[])[1]=t.timeRange[1],o[0]=t.timeRange[0],s=t.attributes,l=t.userProperties,c=W("Quicklooks"),t.enabled,te(r,n,o,s,l,c,t);case 20:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();function ne(){return ne=Object(_.a)(Object(m.a)().mark((function e(t){var r;return Object(m.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=t||L.current,x.current&&(W("StarField").time=new Date(t)),S.current&&(W("Atmosphere").time=new Date(t)),O.current&&X(W("Quicklooks"),t,0,a.current),null,r=X(W("Products"),t,o.current,i.current),R.current&&(W("QuicklookWMS"),a.current),E.current&&(q(t,null),K(t,null)),c.current.redraw(),L.current=t,p((function(e){return Object(l.a)(Object(l.a)({},e),{},{closestRenderable:r})}));case 11:case"end":return e.stop()}}),e)}))),ne.apply(this,arguments)}function ie(e,t,r){return oe.apply(this,arguments)}function oe(){return(oe=Object(_.a)(Object(m.a)().mark((function e(t,r,n){return Object(m.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t!==f.latitude||r!==f.longitude){e.next=3;break}return console.log("already moved there..."),e.abrupt("return");case 3:c.current.goToAnimator.travelTime=1300;try{c.current.goTo(new b.a.Position(t,r,t))}catch(i){console.log(i)}c.current.navigator.range=n,c.current.navigator.camera.applyLimits(),c.current.redraw();case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var se=function(e,t){if(t===b.a.AFTER_REDRAW){var r=e.navigator.lookAtLocation.longitude,n=e.navigator.lookAtLocation.latitude,i=e.navigator.range,a=i<2e6?function(){var e,t,r=c.current.viewport,n="";try{(e=c.current.pickTerrain(c.current.canvasCoordinates(r.x,r.y+r.height)).terrainObject().position).latitude=Math.round(1e4*e.latitude)/1e4,e.longitude=Math.round(1e4*e.longitude)/1e4}catch(i){e=null}try{(t=c.current.pickTerrain(c.current.canvasCoordinates(r.x+r.width,r.y)).terrainObject().position).latitude=Math.round(1e4*t.latitude)/1e4,t.longitude=Math.round(1e4*t.longitude)/1e4}catch(i){t=null}return null==e||null==t?n="":(e.longitude,e.latitude,t.longitude,t.latitude,n="POLYGON(("+e.longitude+" "+e.latitude+","+t.longitude+" "+e.latitude+","+t.longitude+" "+t.latitude+","+e.longitude+" "+t.latitude+","+e.longitude+" "+e.latitude+"))"),n}():"",o="POINT("+r.toFixed(4)+" "+n.toFixed(4)+")";p((function(e){return Object(l.a)(Object(l.a)({},e),{},{longitude:r,latitude:n,altitude:i,viewpolygon:a,viewpoint:o})}))}};return Object(n.useEffect)((function(){console.log("Creating the world...");var e=new b.a.ElevationModel;e.removeAllCoverages(),e.addCoverage(new b.a.TiledElevationCoverage({coverageSector:b.a.Sector.FULL_SPHERE,resolution:.008333333333333,retrievalImageFormat:"image/tiff",minElevation:-11e3,maxElevation:8850,urlBuilder:new b.a.WcsTileUrlBuilder("https://dem.esa.maps.eox.at/elevation","copdem","2.0.1")})),c.current=new je(t),c.current.redrawCallbacks().push(se);var r=new Ye,n=new b.a.AtmosphereLayer("images/BlackMarble_2016_01deg.jpg"),i=new b.a.RenderableLayer("Quicklooks");i.pickEnabled=!1;for(var a=[{layer:r,enabled:!1,zIndex:100},{layer:n,enabled:!1,zIndex:600},{layer:new b.a.RenderableLayer("Products"),enabled:!0,zIndex:700},{layer:i,enabled:!0,zIndex:800}],o=0;o<Vt.length;o++){var s=new b.a.WmsLayer(Vt[o],"");s.enabled=!1,s.zIndex=500+o,s.type="background",c.current.addLayer(s,"")}for(var l=0;l<zt.length;l++){var u=new b.a.WmsLayer(zt[l],"");u.enabled=!1,u.type="overlay",u.zIndex=1e3+l,c.current.addLayer(u,"")}for(var d=0;d<a.length;d++)a[d].layer.enabled=a[d].enabled,a[d].layer.zIndex=a[d].zIndex,c.current.addLayer(a[d].layer);for(var h=0;h<xt.length;h++)xt[h].enabled=E.current,xt[h].zIndex=200+h,c.current.addLayer(xt[h]);for(var g=0;g<Bt.length;g++)Bt[g].enabled=E.current,c.current.addLayer(Bt[g]);F(),console.log(c.current.layers),$("./data/s2lut.txt")}),[]),{eww:c,ewwstate:f,initMap:function(e){var t=e.clon,r=e.clat,n=e.alt,i=e.atmosphere,a=e.starfield,o=e.satellites,s=e.background,l=e.names,u=e.dem,d=e.projection;c.current.navigator.range=n,N(i),P(a),k(o),I(s),M(l),G(u),U(d),console.log("init:"+n),ie(r,t,n)},moveTo:ie,removeGeojson:function(){W("Products").removeAllRenderables(),c.current.redraw()},addGeojson:function(e,t){console.log("adding geo: ");var r=W("Products");new b.a.GeoJSONParser(e).load((function(){!function(e){for(var t=0;t<e.renderables.length;t++){var r=e.renderables[t].userProperties.earthObservation.acquisitionInformation[0].acquisitionParameter,n=new Date(r.acquisitionStartTime.getTime()),i=new Date(r.acquisitionStopTime.getTime());e.renderables[t].timeRange=[n,i]}}(r);var e=X(r,t,o.current,i.current),n=Y(r);F(),p((function(t){return Object(l.a)(Object(l.a)({},t),{},{closestRenderable:e,tics:n})})),c.current.redraw()}),(function(e,t){var r={};r.userProperties=t;var n=new b.a.PlacemarkAttributes(null);return n.imageScale=10,n.imageColor=new b.a.Color(0,1,1,.2),n.labelAttributes.offset=new b.a.Offset(b.a.OFFSET_FRACTION,5,b.a.OFFSET_FRACTION,5),e.isPointType()||e.isMultiPointType()?r.attributes=new b.a.PlacemarkAttributes(n):e.isLineStringType()||e.isMultiLineStringType()?(r.attributes=new b.a.ShapeAttributes(null),r.attributes.drawOutline=!0,r.attributes.outlineColor=new b.a.Color(.1*r.attributes.interiorColor.red,.3*r.attributes.interiorColor.green,.7*r.attributes.interiorColor.blue,1),r.attributes.outlineWidth=1):(e.isPolygonType()||e.isMultiPolygonType())&&(r.attributes=new b.a.ShapeAttributes(null),r.attributes.interiorColor=new b.a.Color(1,0,0,.2),r.attributes.interiorColor=new b.a.Color(1,0,0,.2),r.highlightAttributes=new b.a.ShapeAttributes(r.attributes),r.highlightAttributes.interiorColor=A.current),r}),r)},toggleGeojson:function(e){console.log("toggleGeojson: "+e);var t=W("Products");T.current=null!==e?e:!T.current,t.enabled=T.current,c.current.redraw()},getRenderables:function(e,t){for(var r=c.current.pick(c.current.canvasCoordinates(e,t)),n=[],i=0;i<r.objects.length;i++)r.objects[i].userObject instanceof ae&&"Products"===r.objects[i].parentLayer.displayName&&n.push(r.objects[i].userObject);return n},addQuicklookWMS:B,removeQuicklookWMS:z,toggleQuicklookWMS:function(e){console.log("QuicklookWMS: "+e);var t=W("QuicklookWMS");t&&(R.current=null!==e?e:!R.current,t.enabled=R.current,c.current.redraw())},removeQuicklooks:function(){for(var e=0;e<Z.current.length;e++)Z.current[e].abort();Z.current=[],W("Quicklooks").removeAllRenderables(),c.current.redraw()},addQuicklook:function(e){if(e){var t=W("Products"),r=H(e,t);!function(){for(var e=0;e<Z.current.length;e++)Z.current[e].abort();Z.current=[]}();for(var n=0;r<t.renderables.length&&n<10;r++)t.renderables[r].filtered&&!0===t.renderables[r].filtered||(re(t.renderables[r]),n+=1)}},toggleQuicklooks:function(e){console.log("toggleQuicklooks: "+e);var t=W("Quicklooks");O.current=null!==e?e:!O.current,t.enabled=O.current,c.current.redraw()},toggleStarfield:P,toggleAtmosphere:N,setTime:function(e){return ne.apply(this,arguments)},setFilter:function(e){console.log(e);for(var t=W("Products"),r=0;r<t.renderables.length;r++)t.renderables[r].filtered=!Q(t.renderables[r],e);X(t,L.current,o.current,i.current);var n=Y(t);t=W("Quicklooks");for(var s=0;s<t.renderables.length;s++)t.renderables[s].filtered=!Q(t.renderables[s],e);X(t,L.current,0,a.current),p((function(e){return Object(l.a)(Object(l.a)({},e),{},{tics:n})})),c.current.redraw()},toggleProjection:U,toggleNames:M,toggleModel:k,toggleBg:I,toggleOv:function(e){var t=-1;e=null===e?(y.current+1)%zt.length:e%zt.length,y.current=e;for(var r=0;r<c.current.layers.length;r++)"overlay"===c.current.layers[r].type&&c.current.layers[r].type&&(t+=1,c.current.layers[r].enabled=t===e);c.current.redraw()},toggleDem:G,northUp:function(){var e=c.current,t=e.navigator.heading/-20;setTimeout((function r(){Math.abs(e.navigator.heading)>Math.abs(t)?(e.navigator.heading+=t,setTimeout(r,10)):e.navigator.heading=0,e.redraw()}),10)},setMode:function(e){switch(console.log("set mode"+e),e){case"point":o.current=0,i.current=864e5;break;case"global":default:o.current=864e9,i.current=864e9;break;case"animated":o.current=0,i.current=864e9}},setColor:function(e){A.current=b.a.Color.colorFromHex(e.substring(1)+"99");for(var t=W("Products").renderables,r=0;r<t.length;r++)t[r].highlightAttributes.interiorColor=A.current;c.current.redraw()}}}var Ht=r(17),qt=r(11),Kt=r(22);r(66);var Yt=Object(n.memo)((function(e){var t=e.world,r=e.onSimpleClick,i=Object(n.useRef)(),a=Object(n.useRef)(),o=Object(n.useRef)(),c=Object(n.useRef)(),u=Object(n.useRef)(),d=(Object(n.useRef)(),Object(n.useRef)()),h=Object(n.useRef)(),f=Object(n.useRef)(!0),p=Object(n.useRef)(!1),m=Object(n.useRef)("undefined"),_=(Object(n.useRef)(),Object(n.useState)([])),v=Object(s.a)(_,2),y=v[0],E=(v[1],Object(qt.useSpring)((function(){return{x:0,y:0}}))),S=Object(s.a)(E,2),x=S[0],w=x.x,T=x.y,O=S[1],R=Object(Ht.a)((function(e){var t=Object(s.a)(e.offset,2),r=t[0],n=t[1];return O.start({x:r,y:n})}));qt.animated.div,Object(l.a)(Object(l.a)({},R()),{},{style:{x:w,y:T},className:"Debug",children:y}),Object(Ht.b)({onDrag:function(e){var n,i=e.event,s=e.xy,l=e.vxvy,d=e.previous,g=e.first,m=e.down,_=e.initial,v=e.delta,b=e.movement,y=e.offset,E=e.velocity,S=e.direction,x=e.tap,w=e.scrolling,T=e.touches,O=e.pinching;e.origin;switch(g&&(h.current=ce(s[0],s[1]),h.current||(h.current=ce(t.current.canvas.clientWidth/2,t.current.canvas.clientHeight/2)),n=i,c.current=n.button,n.preventDefault(),a.current&&n.timeStamp-a.current<300?o.current=!0:(a.current=n.timeStamp,o.current=!1),o.current&&clearTimeout(u.current)),!0){case!o.current&&x:u.current=setTimeout((function(){console.log("simple click"),function(e){r(e)}(i)}),300);break;case o.current&&x:clearTimeout(u.current),console.log("double click"),function(){var e=t.current.navigator.heading/-20,r=function r(){Math.abs(t.current.navigator.heading)>Math.abs(e)?(t.current.navigator.heading+=e,setTimeout(r,10)):(t.current.navigator.heading=0,p.current=!1),t.current.redraw()};setTimeout(r,10)}();break;case!o.current&&!x&&2!=c.current&&2!=T:if(!f.current)return;ae.stop(),B.stop(),W.stop(),A.stop(),t.current.globe.is2D()?ee(i,_,m,v,y,b,E,S,s,d,g,w):te(i,_,m,v,y,l,E,S,s,d,g,w,T,O);break;case o.current&&!x:ae.stop(),oe(i,_,m,v,y,b,E,S,s,d,g,w);break;case!o.current&&!x&&2==c.current:Q(m,v,!0)}},onDragend:function(){console.log("drag end")},onWheel:function(e){var t=e.event,r=e.xy,n=e.previous,i=e.first,a=e.down,o=e.initial,s=e.delta,l=e.movement,c=e.offset,u=e.velocity,d=e.direction,g=(e.tap,e.wheeling);i&&(h.current=ce(t.clientX,t.clientY)),oe(t,o,a,s,c,l,u,d,r,n,i,g)},onPinchStart:function(e){f.current=!1,$.stop(),ae.stop(),B.stop(),W.stop(),I.stop(),A.stop(),m.current="undefined"},onPinch:function(e){var t=e.event,r=e.da,n=e.vdva,i=e.origin,a=e.pinching,o=e.delta,s=e.first,l=e.initial,c=e.direction,u=e.previous,d=e.elapsedTime,h=e.memo,g=void 0===h?{lastY:0}:h;return C(t,r,n,i,a,o,s,l,c,u,g,d),g.lastY=i[1],g},onPinchEnd:function(){clearTimeout(d.current),d.current=setTimeout((function(){f.current=!0}),300),m.current="undefined"}},{domTarget:i,drag:{useTouch:!0},pinch:{useTouch:!0},eventOptions:{passive:!1}});var C=function(e,t,r,n,i,a,o,s,l,c,u,d){switch("undefined"===m.current&&d>=100&&(Math.abs(n[1]-u.lastY)>4?m.current="tilt":m.current="zoomrotate"),m.current){case"tilt":N(i,a,n,s,u);break;case"zoomrotate":G(i,a,n,r)}},D=Object(qt.useSpring)((function(){return{pinchtiltvalue:[0,0]}})),j=Object(s.a)(D,2),L=j[0].pinchtiltvalue,A=j[1],N=function(e,r,n,i,a){A.start({pinchtiltvalue:Object(Kt.sub)(n,[0,a.lastY]),immediate:e,config:{mass:1,tension:100,friction:40},onChange:function(){e||(m.current="undefined");var r=e?.5:.2;t.current.navigator.tilt-=L.get()[1]*r*1,he(),t.current.redraw()}})},k=Object(qt.useSpring)((function(){return{pinchzoomrotatevalue:[0,0]}})),P=Object(s.a)(k,2),M=P[0].pinchzoomrotatevalue,I=P[1],G=function(e,r,n,i){var a=1,o=1;e||(a=Math.abs(i[0])<.2?0:1,o=Math.abs(i[1])<.2?0:1),I.start({pinchzoomrotatevalue:r,immediate:e,config:qt.config.molasses,onChange:function(){var e=1-M.get()[0]/300*a;se(h.current,e),t.current.navigator.range*=e,t.current.navigator.heading-=M.get()[1]*o,0!==t.current.navigator.heading&&(p.current=!0),he(),t.current.redraw()}})},U=Object(qt.useSpring)((function(){return{pinchzoomvalue:0}})),F=Object(s.a)(U,2),B=(F[0].pinchzoomvalue,F[1]),V=Object(qt.useSpring)((function(){return{pinchrotatevalue:0}})),z=Object(s.a)(V,2),W=(z[0].pinchrotatevalue,z[1]),H=Object(qt.useSpring)((function(){return{tiltvalue:[0,0]}})),q=Object(s.a)(H,2),K=q[0].tiltvalue,Y=q[1],Q=function(e,r,n){Y.start({to:{tiltvalue:r},immediate:e,config:{mass:1,tension:100,friction:40},onChange:function(){var e=-90*K.get()[1]*2/t.current.canvas.clientHeight,r=-90*K.get()[0]*2/t.current.canvas.clientWidth;t.current.navigator.tilt-=e,n&&(t.current.navigator.heading-=r,0!==t.current.navigator.heading&&(p.current=!0)),he(),t.current.redraw()}})},X=Object(qt.useSpring)((function(){return{panvalue:[0,0]}})),Z=Object(s.a)(X,2),J=Z[0].panvalue,$=Z[1],ee=function(e,r,n,i,a,o,s,l,c,u,d,h){var g=1;n||(g=s<.2?0:1);var f="touchmove"===e.type?1:2.5;$.start({panvalue:i,immediate:n,config:{mass:1,tension:150,friction:80},onChange:function(){var e=[t.current.canvas.clientWidth/2,t.current.canvas.clientHeight/2],r=Object(Kt.sub)(e,Object(Kt.scale)(J.get(),f*g)),n=ce(e[0],e[1]);n||console.log("no currentpos !");var i=ce(r[0],r[1]);i||console.log("no nextposition !");var a=new b.a.Vec3(0,0,0),o=new b.a.Vec3(0,0,0);if(t.current.globe.computePointFromPosition(n.latitude,n.longitude,n.altitude,a)&&t.current.globe.computePointFromPosition(i.latitude,i.longitude,i.altitude,o)){var s=b.a.Matrix.fromIdentity();t.current.computeViewingTransform(null,s),s.multiplyByTranslation(a[0]-o[0],a[1]-o[1],a[2]-o[2]);var l=t.current.rayThroughScreenPoint(t.current.canvasCoordinates(c[0],c[1]));s.extractEyePoint(l.origin),s.extractForwardVector(l.direction);var u=new b.a.Vec3(0,0,0);if(t.current.globe.intersectsLine(l,u)){var d=s.extractViewingParameters(u,t.current.navigator.roll,t.current.globe,{});t.current.navigator.lookAtLocation.copy(d.origin),t.current.navigator.range=d.range,t.current.navigator.heading=d.heading,t.current.navigator.tilt=d.tilt,t.current.navigator.roll=d.roll,he(),t.current.redraw()}}},onRest:function(){}})},te=function(e,r,n,i,a,o,s,l,c,u,d,g,f,m){try{d&&(Math.abs(h.current.latitude)>80||t.current.navigator.heading>2)&&(p.current=!0)}catch(y){console.log("Position at start not detected")}var _=1;n||(_=s<.2?0:1);var v="touchmove"===e.type?1:2.5;n||(v*=.5),$.start({panvalue:i,immediate:n,config:{mass:1,tension:100,friction:40},onChange:function(){try{var e=[t.current.canvas.clientWidth/2,t.current.canvas.clientHeight/2],r=Object(Kt.sub)(e,Object(Kt.scale)(J.get(),v*_)),n=le(e[0],e[1]);n||console.log("no currentpos !");var i=le(r[0],r[1]);i||console.log("no nextposition !");var a=new b.a.Vec3(0,0,0),o=new b.a.Vec3(0,0,0);if(!t.current.globe.computePointFromPosition(n.latitude,n.longitude,n.altitude,a))return;if(!t.current.globe.computePointFromPosition(i.latitude,i.longitude,i.altitude,o))return;var s=new b.a.Vec3(0,0,0),l=ue(o,a,s);if(i&&(i.latitude>80||i.latitude<-80)&&!1===p.current)return console.log("out"),void $.stop();de(s,l,o,i),!1===p.current&&(t.current.navigator.heading=0),t.current.redraw()}catch(c){console.log("probl !")}},onRest:function(){}})},re=Object(qt.useSpring)((function(){return{range:[0,0]}})),ne=Object(s.a)(re,2),ie=ne[0].range,ae=ne[1],oe=function(e,r,n,i,a,o,s,l,c,u,d,g){var f=1;n||(f=s<.2?0:.5),ae.start({range:i,immediate:n||g,config:{mass:1,tension:100,friction:40},onChange:function(){var e=0===f?1:1-ie.get()[1]/(g?700:300);se(h.current,e),t.current.navigator.range*=e,he(),t.current.redraw()},onRest:function(){}})},se=function(e,r){if(e&&!(r>=1)){var n,i=t.current.navigator.lookAtLocation,a=t.current.globe.elevationAtLocation(i.latitude,i.longitude),o=new b.a.Position(i.latitude,i.longitude,a);r<1&&(n=b.a.Position.interpolateGreatCircle(r,e,o,new b.a.Position(0,0,0)),i.latitude=n.latitude,i.longitude=n.longitude,i.altitude=n.altitude)}},le=function(e,r){var n=t.current.rayThroughScreenPoint(t.current.canvasCoordinates(e,r)),i=new b.a.Position(0,0,0),a=[0,0,0];return t.current.globe.intersectsLine(n,a)?(t.current.globe.computePositionFromPoint(a[0],a[1],a[2],i),i):null},ce=function(e,r){for(var n=t.current.canvasCoordinates(e,r),i=t.current.pickTerrain(n),a=0;a<i.objects.length;a++){var o=i.objects[a];if(o.isTerrain){var s=o.position;if(s)return new b.a.Position(s.latitude,s.longitude,s.altitude)}}},ue=function(e,t,r){var n=b.a.MeasurerUtils.angleBetweenVectors(e,t)*b.a.Angle.RADIANS_TO_DEGREES;return r.copy(e),r.cross(t),r.normalize(),n},de=function(e,r,n,i){if(!isFinite(r)||!isFinite(e[0])||!isFinite(e[1])||!isFinite(e[2]))return!1;var a=t.current,o=a.navigator,s=b.a.Matrix.fromIdentity(),l=o.lookAtLocation.altitude,c=o.tilt,u=new b.a.Line(new b.a.Vec3(0,0,0),new b.a.Vec3(0,0,0));if(o.tilt=0,a.computeViewingTransform(null,s),s.multiplyByRotation(e[0],e[1],e[2],r),s.extractEyePoint(u.origin),s.extractForwardVector(u.direction),!a.globe.intersectsLine(u,n))return o.tilt=c,!1;var d=s.extractViewingParameters(n,o.roll,a.globe,{});return o.heading=d.heading,o.lookAtLocation.copy(d.origin),o.lookAtLocation.altitude=l,o.tilt=c,!0},he=function(){var e=t.current.navigator;e.camera.applyLimits(),e.range=b.a.WWMath.clamp(e.range,t.current.globe.elevationAtLocation(e.lookAtLocation.latitude,e.lookAtLocation.longitude)+2,1e8),e.tilt=b.a.WWMath.clamp(e.tilt,0,60)};return Object(n.useEffect)((function(){window.addEventListener("contextmenu",(function(e){return e.preventDefault()}))}),[]),Object(g.jsx)("div",{children:Object(g.jsx)("div",{className:"EarthController",ref:i})})})),Qt=(r(67),r(15)),Xt=r(46);var Zt=function(e){var t=e.active;return Object(g.jsx)("div",{className:"LookAtWidget",style:{display:t?"flex":"none"},children:Object(g.jsx)("div",{className:"Mire",children:Object(g.jsx)(Qt.Icon,{icon:Xt.a,width:"30px",height:"40px"})})})},Jt=r(47);r(68);var $t=function(e){var t=e.active,r=i.a.useContext(f),n=Object(s.a)(r,2)[1];return Object(g.jsx)("div",{className:"ViewProductControl",style:{display:t?"flex":"none"},children:Object(g.jsx)(Qt.Icon,{icon:Jt.a,width:"40px",onClick:function(e){e.stopPropagation(),n({type:"gotoclosestitem"})}})})},er=r(48),tr=r(49);r(69);var rr=function(e){var t=e.active,r=i.a.useContext(f),n=Object(s.a)(r,2),a=n[0],o=n[1];return Object(g.jsx)("div",{className:"FilterProductControl",style:{display:t?"flex":"none"},children:Object(g.jsx)(Qt.Icon,{icon:0!==a.filter.length&&a.filter?tr.a:er.a,width:"40px",onClick:function(e){e.stopPropagation(),o({type:"set_filter"})}})})},nr=r(103),ir=function(e){var t=e.id,r=i.a.useContext(f),a=Object(s.a)(r,2),o=a[0],l=a[1],c=Wt({id:t}),u=c.eww,d=c.ewwstate,p=c.initMap,m=c.moveTo,_=c.addGeojson,v=c.removeGeojson,b=c.toggleGeojson,y=c.toggleQuicklooks,E=c.addQuicklook,S=c.removeQuicklooks,x=c.getRenderables,w=c.addQuicklookWMS,T=c.removeQuicklookWMS,O=c.toggleQuicklookWMS,R=c.toggleProjection,C=c.toggleAtmosphere,D=c.toggleStarfield,j=c.toggleBg,L=c.toggleNames,A=c.toggleOv,N=c.toggleModel,k=c.setTime,P=c.setFilter,M=c.toggleDem,I=c.northUp,G=c.setMode,U=c.setColor,F=h(o.closestItem,500);Object(nr.a)(["p"],(function(){return l({type:"toggle_projection"})})),Object(nr.a)(["c"],v),Object(nr.a)(["u"],I),Object(nr.a)(["w"],(function(){return O(null)})),Object(nr.a)(["b"],(function(){return l({type:"toggle_background"})})),Object(nr.a)(["m"],(function(){return l({type:"toggle_satellites"})})),Object(nr.a)(["d"],(function(){return l({type:"toggle_dem"})})),Object(nr.a)(["o"],(function(){return l({type:"toggle_overlay"})})),Object(nr.a)(["a"],(function(){return l({type:"toggle_atmosphere"})})),Object(nr.a)(["s"],(function(){return l({type:"toggle_starfield"})})),Object(nr.a)(["n"],(function(){return l({type:"toggle_names"})})),Object(n.useEffect)((function(){d.altitude&&l({type:"set_altitude",value:d.altitude})}),[d.altitude]),Object(n.useEffect)((function(){l({type:"set_searchPoint",value:d.viewpoint})}),[d.viewpoint]),Object(n.useEffect)((function(){l({type:"set_position",value:{lat:d.latitude,lon:d.longitude}})}),[d.longitude,d.latitude]),Object(n.useEffect)((function(){l({type:"set_tics",value:d.tics})}),[d.tics]),Object(n.useEffect)((function(){k(new Date(o.viewDate))}),[o.viewDate]),Object(n.useEffect)((function(){U(o.appColor)}),[o.appColor]),Object(n.useEffect)((function(){o.productOn&&(b(o.productOn),y(o.productOn),O(!o.productOn))}),[o.productOn]),Object(n.useEffect)((function(){null!==o.geojson&&_(o.geojson,new Date(o.viewDate))}),[o.geojson]),Object(n.useEffect)((function(){null!==o.filter&&P(o.filter)}),[o.filter]),Object(n.useEffect)((function(){v(),S(),T()}),[o.clearResultsTrigger]),Object(n.useEffect)((function(){C(o.mapSettings.atmosphere)}),[o.mapSettings.atmosphere]),Object(n.useEffect)((function(){N(o.mapSettings.satellites)}),[o.mapSettings.satellites]),Object(n.useEffect)((function(){D(o.mapSettings.starfield)}),[o.mapSettings.starfield]),Object(n.useEffect)((function(){L(o.mapSettings.names)}),[o.mapSettings.names]),Object(n.useEffect)((function(){R(o.mapSettings.projection)}),[o.mapSettings.projection]),Object(n.useEffect)((function(){j(o.mapSettings.background)}),[o.mapSettings.background]),Object(n.useEffect)((function(){A(o.mapSettings.overlay)}),[o.mapSettings.overlay]),Object(n.useEffect)((function(){M(o.mapSettings.dem)}),[o.mapSettings.dem]),Object(n.useEffect)((function(){y(o.mapSettings.quicklooks)}),[o.mapSettings.quicklooks]),Object(n.useEffect)((function(){l({type:"set_closestitem",value:d.closestRenderable})}),[d.closestRenderable]),Object(n.useEffect)((function(){o.mapSettings.quicklooks&&console.log("adding QL"),E(F)}),[F]),Object(n.useEffect)((function(){null!=o.closestItem&&null!=o.goToPos&&m(o.goToPos.lat,o.goToPos.lon,o.goToPos.alt)}),[o.goToPos]),Object(n.useEffect)((function(){null!==o.addQuicklookWMSTrigger&&w(o.selectedProduct)}),[o.addQuicklookWMSTrigger]),Object(n.useEffect)((function(){o.animated?G("animated"):G(o.browseMode)}),[o.browseMode,o.animated]),Object(n.useEffect)((function(){console.log("world created / "+o.position.clat+" / "+o.position.clon+" / "+o.altitude),setTimeout((function(){p({clat:o.position.clat,clon:o.position.clon,alt:o.altitude,starfield:o.mapSettings.starfield,atmosphere:o.mapSettings.atmosphere,background:o.mapSettings.background,overlay:o.mapSettings.overlay,satellites:o.mapSettings.satellites,names:o.mapSettings.names,projection:o.mapSettings.projection,dem:o.mapSettings.dem})}),1e3)}),[]);return Object(g.jsxs)("div",{children:[Object(g.jsx)("canvas",{id:t,className:"Earth"}),Object(g.jsx)(Yt,{world:u,onSimpleClick:function(e){var t=x(e.pageX,e.pageY);0!==t.length&&(console.log("items clicked: "+t.length),l({type:"set_selectedProduct",value:t[0]}))}}),Object(g.jsx)(Zt,{active:"point"===o.searchMode}),Object(g.jsx)($t,{active:null!==o.closestItem}),Object(g.jsx)(rr,{active:null!==o.closestItem})]})},ar=(r(70),r(50));var or=function(e){var t=Object(n.useState)(!1),r=Object(s.a)(t,2),a=r[0],o=r[1],c=Object(n.useState)(!1),u=Object(s.a)(c,2),d=u[0],h=u[1],f=i.a.useRef(null),p=Object(qt.useSpring)((function(){return{mr:-300}})),m=Object(s.a)(p,2),_=m[0].mr,v=m[1],b=Object(Ht.b)({onDragStart:function(){return h(!0)},onDrag:function(e){var t=e.down,r=(e.delta,e.vxvy,e.movement);v.start({mr:t?-r[1]:r[1]>100||a?-300:0,immediate:!1,onChange:function(){o(0===_.get())},onRest:function(){t||o(0===_.get())}})},onDragEnd:function(){setTimeout((function(){return h(!1)}),600)}},{drag:{useTouch:!0},pinch:{useTouch:!0}});return Object(g.jsxs)(qt.animated.div,{style:{bottom:_,left:0},className:"ControlPanel",children:[Object(g.jsx)("div",Object(l.a)(Object(l.a)({ref:f},b()),{},{className:"PanelControl shadow",children:Object(g.jsx)(Qt.Icon,{icon:ar.a,width:"100%"})})),Object(g.jsx)("div",{className:"ControlPanelMask",style:{display:d?"block":"none"}}),Object(g.jsx)("div",{className:"ControlPanelBlend",children:e.children})]})};r(71);var sr=function(e){var t=Object(qt.useSpring)((function(){return{x:0,y:0}})),r=Object(s.a)(t,2),n=r[0],i=n.x,a=n.y,o=r[1],c=Object(Ht.a)((function(e){var t=Object(s.a)(e.offset,2),r=t[0],n=t[1];return o.start({x:r,y:n})}));return Object(g.jsx)(qt.animated.div,Object(l.a)(Object(l.a)({},c()),{},{style:{x:i,y:a},className:"Infopanel",children:e.children}))};r(72);var lr=function(){var e=i.a.useContext(f),t=Object(s.a)(e,1)[0],r=Object(n.useState)("\ud83d\ude42"),a=Object(s.a)(r,2),o=a[0],l=a[1],c=Object(n.useState)("\ud83d\ude42"),u=Object(s.a)(c,2),d=u[0],h=u[1];return Object(n.useEffect)((function(){h(t.animated?"\ud83e\udd75":"\ud83d\ude42"),l(t.animated?"\ud83e\udd75":"\ud83d\ude42")}),[t.animated]),Object(n.useEffect)((function(){console.log("searching..."),console.log("searching: "+t.searching),l(t.searching?"\ud83e\uddd0":d)}),[t.searching]),Object(g.jsx)("div",{className:"Mood",children:Object(g.jsx)("div",{className:"offset",children:o})})};r(73);var cr=function(){var e=i.a.useContext(f),t=Object(s.a)(e,2),r=t[0],n=t[1];return Object(nr.a)(["1"],(function(){return n({type:"set_mission",value:"S1"})})),Object(nr.a)(["2"],(function(){return n({type:"set_mission",value:"S2"})})),Object(nr.a)(["3"],(function(){return n({type:"set_mission",value:"S3/SLSTR"})})),Object(nr.a)(["5"],(function(){return n({type:"set_mission",value:"S5P"})})),Object(nr.a)(["6"],(function(){return n({type:"set_mission",value:"ENVISAT"})})),Object(g.jsx)("div",{className:"MissionSelectorContainer",children:Object(g.jsx)("div",{className:"MissionSelector",children:r.collections.map((function(e,t){return Object(g.jsx)("div",{className:r.mission===e.code?"CircleButtonSelected":"CircleButton",children:Object(g.jsx)("img",{className:"MissionIcon",src:e.logo,alt:"",onClick:function(){return n({type:"set_mission",value:e.code})}})},e.code)}))})})};r(74);var ur=function(){var e=i.a.useContext(f),t=Object(s.a)(e,2),r=t[0],n=t[1];return Object(g.jsx)("div",{className:"MapSelectorContainer",children:Object(g.jsxs)("div",{className:"MapSelector",children:[Object(g.jsx)("div",{className:r.mapSettings.atmosphere?"CircleButtonSelected":"CircleButton",children:Object(g.jsx)("img",{className:"MapIcon",draggable:"false",src:"./images/atmosphere.png",alt:"",onClick:function(){return n({type:"toggle_atmosphere"})}})}),Object(g.jsx)("div",{className:r.mapSettings.starfield?"CircleButtonSelected":"CircleButton",children:Object(g.jsx)("img",{className:"MapIcon",draggable:"false",src:"./images/starfield.png",alt:"",onClick:function(){return n({type:"toggle_starfield"})}})}),Object(g.jsx)("div",{className:r.mapSettings.names?"CircleButtonSelected":"CircleButton",children:Object(g.jsx)("img",{className:"MapIcon",draggable:"false",src:"./images/names.png",alt:"",onClick:function(){return n({type:"toggle_names"})}})}),Object(g.jsx)("div",{className:"CircleButton",children:Object(g.jsx)("img",{className:"MapIcon",draggable:"false",src:"./images/names.png",alt:"",onClick:function(){return n({type:"toggle_background"})}})})]})})},dr=(r(75),r(51));var hr=function(){var e=i.a.useContext(f),t=Object(s.a)(e,2),r=t[0],a=t[1];return Object(n.useEffect)((function(){document.documentElement.style.setProperty("--color",r.appColor),document.documentElement.style.setProperty("--colort",r.appColor+"66")}),[r.appColor]),Object(n.useEffect)((function(){document.documentElement.style.setProperty("--color",r.appColor),document.documentElement.style.setProperty("--colort",r.appColor+"66")}),[]),Object(g.jsx)("div",{className:"ColorSelector",children:Object(g.jsx)(dr.a,{color:r.appColor,onChange:function(e){null!==e&&a({type:"set_color",value:e})},style:{height:"150px",width:"140px"}})})},gr=(r(76),r(23)),fr=r.n(gr);var pr=function(){var e=i.a.useContext(f),t=Object(s.a)(e,2),r=t[0],n=t[1];return Object(g.jsx)("div",{className:"DemSelectorContainer",children:Object(g.jsxs)("div",{className:"verticalContainer DemSelector",children:[Object(g.jsxs)("div",{className:"Selector horizontalContainer",children:[Object(g.jsx)(fr.a,{id:"satellites",onChange:function(e){n({type:"toggle_satellites"})},checked:r.mapSettings.satellites}),Object(g.jsx)("span",{className:"Label",children:"Satellites"})]}),Object(g.jsxs)("div",{className:"Selector horizontalContainer",children:[Object(g.jsx)(fr.a,{id:"dem",onChange:function(e){n({type:"set_dem",value:e})},checked:r.mapSettings.dem}),Object(g.jsx)("span",{className:"Label",children:"Copernicus DEM"})]}),Object(g.jsxs)("div",{className:"Selector horizontalContainer",children:[Object(g.jsx)(fr.a,{id:"starfield",onChange:function(e){n({type:"toggle_starfield"})},checked:r.mapSettings.starfield}),Object(g.jsx)("span",{className:"Label",children:"Stars and Planets"})]}),Object(g.jsxs)("div",{className:"Selector horizontalContainer",children:[Object(g.jsx)(fr.a,{id:"atmosphere",onChange:function(e){n({type:"toggle_atmosphere"})},checked:r.mapSettings.atmosphere}),Object(g.jsx)("span",{className:"Label",children:"Sun and Atmosphere"})]}),Object(g.jsxs)("div",{className:"Selector horizontalContainer",children:[Object(g.jsx)(fr.a,{id:"quicklooks",onChange:function(e){n({type:"toggle_quicklooks"})},checked:r.mapSettings.quicklooks}),Object(g.jsx)("span",{className:"Label",children:"Quicklooks"})]}),Object(g.jsx)("div",{height:"200px",flexgrow:"2",children:"\xa0"})]})})};r(78);var mr=function(){var e=i.a.useContext(f),t=Object(s.a)(e,1)[0];return Object(g.jsx)("div",{className:"GenericLabel",children:t.mission})};r(79);var _r=function(){var e=i.a.useContext(f),t=Object(s.a)(e,1)[0];return Object(g.jsx)("div",{className:"GenericLabel",children:(t.altitude,t.altitude>=1e4?Math.floor(t.altitude/1e3)+" Km":Math.floor(t.altitude)+" m")})};r(80);var vr=function(){var e=i.a.useContext(f),t=Object(s.a)(e,1)[0];return Object(g.jsx)("div",{className:"GenericLabel",children:0===t.resultDesc.totalLoaded?"":t.resultDesc.totalLoaded+"/"+t.resultDesc.totalResults})},br=r(24),yr=r.n(br);r(81);var Er=function(e){var t=e.date,r=e.highlight,n=e.handleLabelClick;return Object(g.jsxs)("div",{className:"LabelContainer",children:[Object(g.jsx)("span",{className:"year"===r?"Highlighted":"NotHighlighted",onClick:function(){return n("year")},children:t.getUTCFullYear()}),"-",Object(g.jsx)("span",{className:"month"===r?"Highlighted":"NotHighlighted",onClick:function(){return n("month")},children:yr()(t,"UTC:mmm").toUpperCase()}),"-",Object(g.jsx)("span",{className:"day"===r?"Highlighted":"NotHighlighted",onClick:function(){return n("day")},children:yr()(t,"UTC:dd")}),Object(g.jsx)("span",{children:"\xa0\xa0\xa0"}),Object(g.jsx)("span",{className:"hour"===r?"Highlighted":"NotHighlighted",onClick:function(){return n("hour")},children:yr()(t,"UTC:HH")}),":",Object(g.jsx)("span",{className:"minute"===r?"Highlighted":"NotHighlighted",onClick:function(){return n("minute")},children:yr()(t,"UTC:MM")}),":",Object(g.jsx)("span",{className:"second"===r?"Highlighted":"NotHighlighted",onClick:function(){return n("second")},children:yr()(t,"UTC:ss")}),Object(g.jsx)("span",{children:"\xa0\xa0"})]})};var Sr=r(52),xr=r(53),wr=r(54),Tr=r(55);function Or(e,t){var r=Object(n.useState)(),i=Object(s.a)(r,2),a=i[0],o=i[1],l=Object(n.useRef)();return{handleTap:function(r){r.stopPropagation(),r.preventDefault();var n=Date.now();a&&n-a<300?(clearTimeout(l.current),t()):(o(n),l.current=setTimeout((function(){e()}),300))}}}r(82);var Rr=function(e){var t=e.startdate,r=e.onDateChange,i=e.onStateChange,a=e.animated,o=function(e){var t=e.initdate,r=Object(n.useState)(t),i=Object(s.a)(r,2),a=i[0],o=i[1],l=Object(n.useState)(1),c=Object(s.a)(l,2),u=c[0],d=c[1],h=Object(n.useState)(!1),g=Object(s.a)(h,2),f=g[0],p=g[1],m=Object(n.useRef)(),_=Object(n.useRef)();_.current=200;var v=Object(n.useRef)(),b=Object(n.useRef)(),y=Object(n.useRef)(),E=Object(n.useCallback)((function(){console.log("start clock"),m.current||(m.current=_.current),f||(b.current=setInterval((function(){v.current+=m.current,o(new Date(v.current))}),_.current)),p(!0)}),[]),S=Object(n.useCallback)((function(){console.log("stop clock"),y.current&&clearTimeout(y.current),b.current&&clearInterval(b.current),p(!1)}),[]);return{date:a,speed:u,playing:f,togglePause:function(){f?S():E()},start:E,stop:S,reset:function(){v.current=(new Date).getTime(),o(new Date(v.current))},increaseSpeed:function(){m.current=m.current>0?m.current*=2:m.current/=2,Math.abs(m.current)<_.current&&(m.current=_.current),console.log("step: "+m.current),d(m.current/200)},decreaseSpeed:function(){m.current=m.current>0?m.current/=2:m.current*=2,Math.abs(m.current)<_.current&&(m.current=-1*_.current),console.log("step: "+m.current),d(m.current/200)},forceDate:function(e){v.current=e.getTime(),o(new Date(v.current))}}}({initdate:t}),l=o.date,c=o.speed,u=o.start,d=o.stop,h=o.reset,f=o.increaseSpeed,p=o.decreaseSpeed,m=o.forceDate,_=Object(n.useState)(a),v=Object(s.a)(_,2),b=v[0],y=v[1];Object(nr.a)(["t"],(function(){y((function(e){return!e}))})),Object(nr.a)(["r"],(function(){h()})),Object(nr.a)(["."],(function(){f()})),Object(nr.a)([","],(function(){p()})),Object(n.useEffect)((function(){i(b),!0===b?u():d()}),[b]),Object(n.useEffect)((function(){console.log("animated: "+a)}),[a]),Object(n.useEffect)((function(){r(l)}),[l,r]),Object(n.useEffect)((function(){console.log(" force date: "+t),null!==t&&m(t)}),[t]);var E=Or((function(){y((function(e){return!e}))}),h).handleTap;return Object(g.jsxs)("div",{className:"DateController ",children:[Object(g.jsx)("div",{className:c>0?"":"flipped",children:Object(g.jsx)(Qt.Icon,{icon:b?Tr.a:wr.a,onClick:E,className:"controlbutton shadow"})}),Object(g.jsxs)("div",{className:"speedbar",children:[Object(g.jsx)(Qt.Icon,{icon:xr.a,onClick:p,className:"smallcontrolbutton shadow Backward",style:{display:b?"block":"none"}}),Object(g.jsxs)("span",{className:"Speed",style:{display:b?"block":"none"},children:["x",Math.abs(c)]}),Object(g.jsx)(Qt.Icon,{icon:Sr.a,onClick:f,className:"smallcontrolbutton shadow Forward",style:{display:b?"block":"none"}})]})]})};r(43);var Cr=function(e){var t=e.date,r=e.zoomfactor,i=e.resulttics,a=Object(n.useRef)(0),o=Object(n.useRef)(null),l=Object(n.useState)(""),c=Object(s.a)(l,2),u=c[0],d=c[1],h=Object(n.useRef)(r),f=Object(n.useRef)(t),p=Object(n.useRef)(i),m=function(e,t,r){var n=o.current.getContext("2d");n.font="14px Arial",n.shadowColor="rgba(0,0,0,0.8",n.shadowOffsetX=1,n.shadowOffsetY=1,n.shadowBlur=2,n.fillStyle="red",n.clearRect(0,0,window.innerWidth,window.innerHeight);var i=["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"];function s(e,t){for(var r=""+e;r.length<t;)r="0"+r;return r}for(var l,c,u,d,h=0,f=0,p=0,m=0,_=0,v=0,b=[],y=0,E=0,S=0;S<a.current.offsetHeight;S+=1){var x=new Date((S-a.current.offsetHeight/2)*t+e.getTime());switch(l=x.getUTCDate(),c=x.getUTCMonth(),u=x.getUTCHours(),d=x.getUTCFullYear(),h=x.getUTCMinutes(),!0){case t<3e3:E=6e4,h!==v&&0!==S&&(0!==h||0!==u?b.push({class:"HourTic",pos:S,label:s(u,2)+":"+s(h,2)}):0===h&&0===u&&(b.push({class:"DayTic_h",pos:S,label:s(l,2)}),b.push({class:"MonthTic_h2",pos:S,label:i[c]})));break;case t<5e3:E=12e4,h!==v&&0!==S&&(0===h&&0===u||h%2!==0?0===h&&0===u&&(b.push({class:"DayTic_h",pos:S,label:s(l,2)}),b.push({class:"MonthTic_h2",pos:S,label:i[c]})):b.push({class:"HourTic",pos:S,label:s(u,2)+":"+s(h,2)}));break;case t<3e4:E=6e5,h!==v&&0!==S&&(0===h&&0===u||h%10!==0?0===h&&0===u&&(b.push({class:"DayTic_h",pos:S,label:s(l,2)}),b.push({class:"MonthTic_h2",pos:S,label:i[c]})):b.push({class:"HourTic",pos:S,label:s(u,2)+":"+s(h,2)}));break;case t<6e4:E=12e5,h!==v&&0!==S&&(0===h&&0===u||h%20!==0?0===h&&0===u&&(b.push({class:"DayTic_h",pos:S,label:s(l,2)}),b.push({class:"MonthTic_h2",pos:S,label:i[c]})):b.push({class:"HourTic",pos:S,label:s(u,2)+":"+s(h,2)}));break;case t<18e4:E=36e5,u!==_&&0!==S&&(0!==u?b.push({class:"HourTic",pos:S,label:s(u,2)+":00"}):(b.push({class:"DayTic_h",pos:S,label:s(l,2)}),b.push({class:"MonthTic_h2",pos:S,label:i[c]})));break;case t<42e4:E=108e5,u!==_&&0!==S&&(0!==u&&u%3===0?b.push({class:"HourTic",pos:S,label:s(u,2)+":00"}):0===u&&(b.push({class:"DayTic_h",pos:S,label:s(l,2)}),b.push({class:"MonthTic_h2",pos:S,label:i[c]})));break;case t<12e5:E=216e5,u!==_&&0!==S&&(0!==u&&u%6===0?b.push({class:"HourTic",pos:S,label:s(u,2)+":00"}):0===u&&(b.push({class:"DayTic_h",pos:S,label:s(l,2)}),b.push({class:"MonthTic_h2",pos:S,label:i[c]})));break;case t<18e5:E=864e5,l!==f&&0!==S&&(b.push({class:"DayTic_h",pos:S,label:s(l,2)}),b.push({class:"MonthTic_h2",pos:S,label:i[c]}));break;case t<42e5:E=864e5,l!==f&&0!==S&&(1!==l?b.push({class:"DayTic",pos:S,label:l}):(b.push({class:"MonthTic_h",pos:S,label:i[c]}),0===c&&b.push({class:"YearTic_h2",pos:S,label:d})));break;case t<288e5:E=432e6,l!==f&&0!==S&&(1!==l&&30!==l&&l%5===0?b.push({class:"DayTic",pos:S,label:l}):1===l&&(b.push({class:"MonthTic_h",pos:S,label:i[c]}),0===c&&b.push({class:"YearTic_h2",pos:S,label:d})));break;case t<1728e5:E=24192e5,c!==p&&0!==S&&(0!==c?b.push({class:"MonthTic",pos:S,label:i[c]}):(b.push({class:"MonthTic_h",pos:S,label:i[c]}),b.push({class:"YearTic_h2",pos:S,label:d})));break;case t<3456e5:E=72576e5,c!==p&&0!==S&&(0!==c&&11!==c&&c%3===0?b.push({class:"MonthTic",pos:S,label:i[c]}):0===c&&(b.push({class:"MonthTic_h",pos:S,label:i[c]}),b.push({class:"YearTic_h2",pos:S,label:d})));break;case t<7776e6:E=31104e6,d!==m&&0!==S&&(0!==c?b.push({class:"MonthTic",pos:S,label:i[c]}):b.push({class:"YearTic",pos:S,label:d}))}f=l,m=d,p=c,_=u,v=h,b.length!==y&&(S+=E/t-4),y=b.length}if(r)for(var w=-10,T=r.length;T>=0;T-=1){var O=(r[T]-e.getTime())/t+a.current.offsetHeight/2;O>0&&O<a.current.offsetHeight&&(n.font="30px Arial",O-w>3&&(w=O,n.fillText(".",a.current.offsetWidth-8,O+5)))}return b.map((function(e){return Object(g.jsx)("div",{className:e.class,style:{top:e.pos,opacity:1},children:e.label},e.class+e.pos)}))};return Object(n.useEffect)((function(){h.current=r,d(m(f.current,h.current,p.current))}),[r]),Object(n.useEffect)((function(){f.current=t,d(m(f.current,h.current,p.current))}),[t]),Object(n.useEffect)((function(){p.current=i,d(m(f.current,h.current,p.current))}),[i]),Object(n.useEffect)((function(){var e=function(e){e.preventDefault(),e.stopPropagation(),d(m(f.current,h.current,p.current))};return window.addEventListener("resize",e),function(){window.removeEventListener("resize",e)}}),[]),Object(g.jsxs)("div",{children:[Object(g.jsx)("canvas",{ref:o,className:"DateSelectorCanvas",width:"{window.innerWidth}",height:window.innerHeight}),Object(g.jsx)("div",{ref:a,className:"DateSelectorScale",id:"DateSelectorScale",style:{fontSize:"14px"},children:u})]})};var Dr=function(e){var t=e.startdate,r=(e.resetToStartDateTrigger,e.tics),i=e.gotoscalezoom,a=e.onDateChange,o=e.onFinalDateChange,c=e.onStepChange,u=1296e6,d=1e3,h=36e5,f=Object(n.useRef)(h),p=Object(n.useState)(h),m=Object(s.a)(p,2),_=m[0],v=m[1],b=Object(n.useRef)(),y=Object(n.useState)(t),E=Object(s.a)(y,2),S=E[0],x=E[1],w=Object(n.useRef)(!1),T=Object(n.useState)([6e4]),O=Object(s.a)(T,2),R=O[0],C=O[1],D=Object(n.useState)("hour"),j=Object(s.a)(D,2),L=j[0],A=j[1],N=Object(n.useRef)(),k=Object(n.useRef)(new Date(0)),P=Object(n.useRef)(),M=Object(n.useRef)(),I=Object(n.useRef)(t),G=Object(n.useRef)(t),U=Object(qt.useSpring)((function(){return{posy_wheel:0}})),F=Object(s.a)(U,2),B=F[0].posy_wheel,V=F[1],z=Object(qt.useSpring)((function(){return{zoom:0}})),W=Object(s.a)(z,2),H=W[0].zoom,q=W[1],K=Object(qt.useSpring)((function(){return{test:0}})),Y=Object(s.a)(K,2),Q=Y[0].test,X=Y[1],Z=Object(Ht.b)({onWheel:function(e){e.active;var t=e.delta,r=e.first,n=(e.down,e.direction,e.velocity,e.xy,e.movement,e.wheeling),i=e.ctrlKey,s=e.shiftKey;r&&(X.stop(),G.current=S),i||s?q.start({zoom:t[1],immediate:!0,config:{mass:1,tension:100,friction:25,precision:.1},onChange:function(){var e=f.current+f.current/300*H.get()*-1;e<d&&(e=d),e>u&&(e=u),v(e),f.current=e}}):V.start({posy_wheel:t[1],immediate:!0,config:{mass:1,tension:100,friction:40},onChange:function(){var e;w.current=!0;var t=(B.get()<0?Math.ceil:Math.floor)(B.get()*_/R[0]);0===t&&V.stop(),"month"===L?(e=new Date(G.current.getTime())).setUTCMonth(e.getUTCMonth()-t):e=new Date(G.current.getTime()-t*R[0]),G.current=e,x(e),a(e)},onRest:function(){n||(o(G.current),w.current=!1)}})},onDragStart:function(){w.current=!0},onDrag:function(e){var t=e.event,r=(e.active,e.first),n=e.down,i=(e.touches,e.offset,e.delta),s=(e.initial,e.distance,e.velocity),l=(e.direction,e.shiftKey),c=e.ctrlKey,u=(e.xy,e.movement);e.vxvy,e.wheeling;t.preventDefault(),r&&(V.stop(),function(e){var t=Date.now();M.current=e.button,N.current&&t-N.current<300?P.current=!0:(N.current=t,k.current=S,P.current=!1)}(t),I.current=G.current),s=s<.2?0:s,P.current||l||c||2===M.current?J(i,n,s,!1):X.start({test:n?u[1]:u[1]+u[1]*s*5,immediate:n,config:{mass:1,tension:100,friction:25,precision:.1},onChange:function(){if(w.current=!0,Math.abs(u[1])>5&&(N.current=new Date(0)),"month"===L){var e=Math.ceil(Q.get()*_/R[0]),t=new Date(I.current.getTime());t.setUTCMonth(t.getUTCMonth()-e),G.current=t}else G.current=new Date(I.current.getTime()-Math.ceil(Q.get()*_/R[0])*R[0]);x(G.current),a(G.current)},onRest:function(){n||(o(G.current),w.current=!1)}})},onDragEnd:function(e){o(G.current),w.current=!1}},{drag:{useTouch:!0}}),J=function(e,t,r,n){var i=1;t||(i=r<.2?0:.5),q.start({zoom:e[1],immediate:t,config:{mass:1,tension:100,friction:25,precision:.1},onChange:function(){var e=f.current+f.current/50*H.get()*-1*i;e<d&&(e=d),e>u&&(e=u),v(e),f.current=e}})},$=Object(qt.useSpring)((function(){return{xy2:[0,0]}})),ee=Object(s.a)($,2),te=ee[0].xy2,re=ee[1];return Object(n.useEffect)((function(){w.current||function(e){if(e.getTime()!==G.current.getTime()){var t=G.current.getTime(),r=[0,t-e.getTime()];re.start({from:{xy2:[0,0]},to:{xy2:r},immediate:!1,config:{reset:!0,duration:300},onChange:function(){var e=new Date(t-te.get()[1]);G.current=e,x(e),a(e)}})}}(t)}),[t]),Object(n.useEffect)((function(){switch(i&&v(i),i){case"year":v(1029135270),f.current=1029135270;break;case"month":v(167184283),f.current=167184283;break;case"day":v(17046262),f.current=17046262;break;case"hour":v(735260),f.current=735260;break;case"minute":v(32276),f.current=32276;break;case"second":v(1058),f.current=1058}}),[i]),Object(n.useEffect)((function(){c(L)}),[L,c]),Object(n.useEffect)((function(){switch(console.log(_),!0){case _>120426316:C([26784e5,24192e5,26784e5,2592e6,26784e5,2592e6,26784e5,26784e5,2592e6,26784e5,2592e6,26784e5]),A("month");break;case _>94544702:C([10368e5]),A("cycle");break;case _>14544702:C([864e5]),A("day");break;case _>735259:C([36e5]),A("hour");break;case _>32274:C([6e4]),A("minute");break;default:C([1e3]),A("second")}}),[_]),Object(g.jsx)("div",{children:Object(g.jsxs)("div",{className:"DateSelector",ref:b,children:[Object(g.jsx)("div",Object(l.a)(Object(l.a)({},Z()),{},{className:"touchMask",children:" "})),Object(g.jsxs)("div",{className:"Mask",children:[Object(g.jsx)(Cr,{className:"scale",date:S,zoomfactor:_,resulttics:r}),Object(g.jsx)("div",{className:"TriangleContainer",children:Object(g.jsx)("svg",{height:"40",width:"20",className:"Triangle",children:Object(g.jsx)("polygon",{points:"20,5 20,35 12,20"})})})]})]})})};var jr=function(e){var t=e.onDateChange,r=e.onFinalDateChange,i=e.onStateChange,a=e.animated,o=(e.searching,e.startdate),l=e.resetstartdatetrigger,c=e.tics,u=e.gotoscalezoom,d=Object(n.useState)(o),h=Object(s.a)(d,2),f=h[0],p=h[1],m=Object(n.useState)(o),_=Object(s.a)(m,2),v=_[0],b=_[1],y=Object(n.useState)(u),E=Object(s.a)(y,2),S=E[0],x=E[1],w=Object(n.useState)(1),T=Object(s.a)(w,2),O=T[0],R=T[1],C=Object(n.useCallback)((function(e){b(e),t(e)}),[t]),D=Object(n.useCallback)((function(e){r(e)}),[r]),j=Object(n.useCallback)((function(e){p(e)}),[]),L=Object(n.useCallback)((function(e){console.log("handleSelectorStepChange"+e),R(e)}),[]),A=Object(n.useCallback)((function(e){console.log(e),x(e)}),[]);return Object(n.useEffect)((function(){console.log(c)}),[c]),Object(g.jsxs)("div",{children:[Object(g.jsx)(Rr,{startdate:o,onDateChange:j,onStateChange:i,animated:a}),Object(g.jsx)(Er,{date:v,highlight:O,handleLabelClick:A}),Object(g.jsx)(Dr,{startdate:f,resetToStartDateTrigger:l,tics:c,gotoscalezoom:S,onDateChange:C,onFinalDateChange:D,onStepChange:L})]})};var Lr=function(){var e=i.a.useContext(f),t=Object(s.a)(e,2),r=t[0],a=t[1],o=Object(n.useState)(r.tics),l=Object(s.a)(o,2),c=l[0],u=l[1],d=Object(n.useState)(new Date(r.goToDate)),h=Object(s.a)(d,2),p=h[0],m=h[1];return Object(n.useEffect)((function(){console.log("set tics "),u(r.tics)}),[r.tics]),Object(n.useEffect)((function(){console.log("state.goToDate:"),console.log(new Date(r.goToDate)),m(null===r.goToDate?null:new Date(r.goToDate))}),[r.goToDate]),Object(g.jsx)(jr,{onDateChange:function(e){a({type:"set_viewDate",value:e})},onFinalDateChange:function(e){a({type:"set_searchDate",value:e})},startdate:p,tics:c,gotoscalezoom:r.zoomScale,onStateChange:function(e){a({type:"set_animated",value:e})},animated:r.animated,searching:r.searching})},Ar=(r(83),r(34)),Nr=r.n(Ar);function kr(e){function t(e){for(var t=e.slice(e.indexOf("<gml:coordinates>")+17,e.indexOf("</gml:coordinates>")).replaceAll(","," ").split(" "),r="MULTIPOLYGON(((",n=0;n<t.length;n+=2)r=r+t[n+1]+" "+t[n]+",";return r=r.slice(0,-1),r+=")))"}function r(e){function r(e){for(var t={},r=0;r<e.length;r++)t[e[r].name]=e[r].content;return t}try{var n={};e.date&&Object.assign(n,r(e.date)),e.int&&Object.assign(n,r(e.int)),e.double&&Object.assign(n,r(e.double)),e.str&&Object.assign(n,r(e.str));var i,a=n.size.split(" ");switch(a[1]){case"B":default:i=Math.round(parseFloat(a[0]));break;case"MB":i=Math.round(1024*parseFloat(a[0]));break;case"GB":i=Math.round(1024*parseFloat(a[0])*1024);break;case"TB":i=Math.round(1024*parseFloat(a[0])*1024*1024)}return{id:e.title,geometry:Nr()(t(n.gmlfootprint)),type:"Feature",properties:{updated:new Date(n.ingestiondate),title:e.title,name:e.title,uuid:e.id,date:n.beginposition+"/"+n.endposition,downloadUrl:e.link[0].href,quicklookUrl:e.link.length>=2?e.link[2].href:null,earthObservation:{parentIdentifier:"",status:"ARCHIVED",acquisitionInformation:[{platform:{platformShortName:n.platformname,platformSerialIdentifier:n.platformserialidentifier},sensor:{instrument:n.instrumentshortname,operationalMode:n.sensoroperationalmode},acquisitionParameter:{acquisitionStartTime:new Date(n.beginposition),acquisitionStopTime:new Date(n.endposition),relativePassNumber:parseInt(n.relativeorbitnumber),orbitNumber:parseInt(n.orbitnumber),startTimeFromAscendingNode:null,stopTimeFromAscendingNode:null,orbitDirection:n.orbitdirection}}],productInformation:{productType:n.producttype,tile:n.tileid,size:i}}}}}catch(o){return console.log("error parsing item from dhus: "+o.message),{}}}var n=[];try{n=e.feed.entry?Array.isArray(e.feed.entry)?e.feed.entry.map((function(e){return r(e)})).filter((function(e){return e!=={}})):[r(e.feed.entry)]:[]}catch(i){console.log(e),console.log("Error: "),console.log(i),n=[]}return{type:"FeatureCollection",id:"search",properties:{totalResults:e.feed["opensearch:totalResults"],startIndex:e.feed["opensearch:startIndex"]?e.feed["opensearch:startIndex"]:1,itemsPerPage:e.feed["opensearch:itemsPerPage"],title:"DHuS search response",updated:new Date},features:n}}function Pr(e){var t=[];try{e.features?Array.isArray(e.features)&&(console.log("features is an  array"),t=e.features.map((function(e){return function(e){try{for(var t=null,r=null,n=0;n<e.properties.link.length;n++)"Download"===e.properties.link[n]["@"].title&&(t=e.properties.link[n]["@"].href),"Quicklook"===e.properties.link[n]["@"].title&&(r=e.properties.link[n]["@"].href);return{id:e.id,geometry:e.geometry,type:"Feature",properties:{updated:e.properties.updated,title:e.properties.title,name:e.title,uuid:e.properties.identifier,date:e.properties.date,downloadUrl:t,quicklookUrl:r,earthObservation:{parentIdentifier:e.properties.EarthObservation.metaDataProperty.EarthObservationMetaData.parentIdentifier,status:"ARCHIVED",acquisitionInformation:[{platform:{platformShortName:e.properties.EarthObservation.procedure.EarthObservationEquipment.platform.Platform.shortName,platformSerialIdentifier:null},sensor:{instrument:e.properties.EarthObservation.procedure.EarthObservationEquipment.instrument.Instrument.shortName,operationalMode:e.properties.EarthObservation.procedure.EarthObservationEquipment.sensor.Sensor.operationalMode},acquisitionParameter:{acquisitionStartTime:new Date(e.properties.EarthObservation.phenomenonTime.TimePeriod.beginPosition),acquisitionStopTime:new Date(e.properties.EarthObservation.phenomenonTime.TimePeriod.endPosition),relativePassNumber:null,orbitNumber:e.properties.EarthObservation.procedure.EarthObservationEquipment.acquisitionParameters.Acquisition.orbitNumber,startTimeFromAscendingNode:null,stopTimeFromAscendingNode:null,orbitDirection:e.properties.EarthObservation.procedure.EarthObservationEquipment.acquisitionParameters.Acquisition.orbitDirection}}],productInformation:{productType:e.properties.EarthObservation.metaDataProperty.EarthObservationMetaData.productType,downloadUrl:t,quicklookUrl:r,size:null}}}}}catch(i){return console.log("error parsing item from dhus: "+i.message),{}}}(e)})).filter((function(e){return e!=={}}))):t=[]}catch(r){console.log(e),console.log("Error: "),console.log(r),t=[]}return{type:"FeatureCollection",id:"search",properties:{totalResults:e.properties.totalResults,startIndex:e.properties.startIndex,itemsPerPage:e.properties.itemsPerPage,title:e.properties.title,updated:e.properties.updated},features:t}}function Mr(e,t){var r=[];try{Array.isArray(e.value)?(console.log("first: "),r=e.value.filter((function(e){return null!==e})).map((function(e){return function(e){try{var t={};return null==e.Footprint||"LineString"==(t=e.Footprint).type?null:(delete t.crs,{id:e.Id,geometry:t,type:"Feature",properties:{updated:new Date(e.PublicationDate),title:e.Name,name:e.Name,uuid:e.Id,date:e.ContentDate.Start+"/"+e.ContentDate.End,downloadUrl:null,quicklookUrl:null,earthObservation:{parentIdentifier:"",status:"ARCHIVED",acquisitionInformation:[{platform:{platformShortName:"any",platformSerialIdentifier:"any"},sensor:{instrument:"any",operationalMode:"any"},acquisitionParameter:{acquisitionStartTime:new Date(e.ContentDate.Start),acquisitionStopTime:new Date(e.ContentDate.End),relativePassNumber:0,orbitNumber:0,startTimeFromAscendingNode:null,stopTimeFromAscendingNode:null,orbitDirection:null}}],productInformation:{productType:null,tile:null,size:e.ContentLength}}}})}catch(r){return console.log("error parsing item from PRIP: "+r.message),null}}(e)})).filter((function(e){return null!==e}))):r=[]}catch(n){console.log(e),console.log("Error: "),console.log(n)}return{type:"FeatureCollection",id:"search",properties:{totalResults:e["@odata.count"]-(e.value.length-r.length),startIndex:t,itemsPerPage:e.value.length,title:"PRIP search response",updated:new Date},features:r}}var Ir=r(56),Gr=r.n(Ir);function Ur(){var e=Object(n.useRef)(null),t=Object(n.useState)(null),r=Object(s.a)(t,2),i=r[0],a=r[1],o=Object(n.useState)(!1),l=Object(s.a)(o,2),c=l[0],u=l[1],d=Object(n.useState)(""),h=Object(s.a)(d,2),g=h[0],p=h[1],v=Object(n.useContext)(f),b=Object(s.a)(v,2),y=b[0],E=(b[1],function(e){for(var t=0;t<y.collections.length;t++)if(y.collections[t].code===e)return y.collections[t];return null}),S=function(){var t=Object(_.a)(Object(m.a)().mark((function t(r,n,i,o,s){var l,c,d,h,g,f;return Object(m.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(u(!0),e.current=new AbortController,l=(l=r).replace("{startindex}",n),c={totalresults:0,startindex:0,itemsperpage:0},console.log(i),t.prev=6,"PRIP"!=i){t.next=17;break}return h=new Gr.a({grantType:"password",clientId:"s1pro-user-web-client",userName:o,password:s,clientSecret:"",tokenEndpoint:"https:/iam.platform.ops-csc.com/auth/realms/RS/protocol/openid-connect/token"}),t.next=11,h.fetch(l,{mode:"cors",credentials:"include",signal:e.current.signal});case 11:if(d=t.sent,console.log(d),d.ok){t.next=17;break}throw window.alert("HTTP error! status: ".concat(d.status)),"401"==d.status&&p(l),new Error("HTTP error! status: ".concat(d.status));case 17:if("PRIP"==i){t.next=27;break}return t.next=20,fetch(l,{mode:"cors",credentials:"include",headers:{"Content-Type":"text/plain",Authorization:"Basic "+window.btoa(o+":"+s)},signal:e.current.signal});case 20:if((d=t.sent).ok){t.next=27;break}if(401!=d.status){t.next=26;break}throw new Error("401");case 26:throw new Error("HTTP error! status: ".concat(d.status));case 27:return t.prev=27,t.next=30,d.json();case 30:g=t.sent,t.t0=i,t.next="DHUS"===t.t0?34:"PRIP"===t.t0?37:"EOCAT"===t.t0?40:43;break;case 34:return console.log("DHUS"),f=kr(g),t.abrupt("break",44);case 37:return console.log("PRIP"),f=Mr(g,n),t.abrupt("break",44);case 40:return console.log("EOCAT"),f=Pr(g),t.abrupt("break",44);case 43:u(!1);case 44:c={totalresults:null==f.properties.totalResults?0:Number(f.properties.totalResults),startindex:Number(f.properties.startIndex),itemsperpage:Number(f.properties.itemsPerPage)},console.log(c),c.totalresults>0&&a(f),c.startindex+c.itemsperpage<Math.min(c.totalresults,1e3)?(console.log("There's More..."),S(r,c.startindex+c.itemsperpage,i,o,s)):u(!1),t.next=55;break;case 50:t.prev=50,t.t1=t.catch(27),console.log("Didn't receive a json !"),console.log(t.t1),u(!1);case 55:t.next=63;break;case 57:t.prev=57,t.t2=t.catch(6),console.log("Error contacting server..."),console.log(t.t2.message),("401"===t.t2.message||t.t2.message.indexOf("Invalid user credentials")>0)&&(console.log("detected 401"),p(r)),u(!1);case 63:case"end":return t.stop()}}),t,null,[[6,57],[27,50]])})));return function(e,r,n,i,a){return t.apply(this,arguments)}}();return{geojsonResults:i,loading:c,status:g,search:function(t,r){var n=t.searchdate,i=t.mission,a=t.searchpoint;console.log(" in search"),console.log(n+" / "+i+" / "+a),console.log(r);var o,s="",l=E(i);if(!l)return null;if(c&&e.current.abort(),n){var u=Math.floor(n.getTime()/l.windowSize)*l.windowSize;o=new Date(u).toJSON(),s=new Date(u+l.windowSize-1e3).toJSON()}var d=function(e){var t=e.code,r=e.polygon,n=e.start,i=e.end,a=(e.startindex,E(t));if(!a)return null;var o=a.templateUrl;return o=null!=r?o.replace("{polygon}",r):o.replace(a.areaOff,""),null!=n&&null!=i?(o=o.replace("{start}",n)).replace("{end}",i):o.replace(a.dateOff,"")}({code:i,polygon:a,start:o,end:s}),h=l.type,g=l.startIndexOrigin;S(d,g,h,r.user,r.pass)},abort:function(){e&&e.current&&e.current.abort()}}}var Fr=r(57);var Br=function(e){var t=e.searchdate,r=e.searchpoint,i=e.searchmode,a=e.credentials,o=e.mission,c=e.altitude,u=e.onSearchStart,d=e.onPageSearch,h=e.onSearchComplete,f=e.on401,p=Object(n.useState)(!1),m=Object(s.a)(p,2),_=m[0],v=m[1],b=Object(n.useState)(0),y=Object(s.a)(b,2),E=y[0],S=y[1],x=Object(n.useRef)(new Date(0)),w=Object(n.useRef)(new Date),T=Object(n.useRef)(0),O=Object(n.useRef)(0),R=Object(n.useState)({}),C=Object(s.a)(R,2),D=C[0],j=C[1],L=Ur(),A=L.geojsonResults,N=L.loading,k=L.status,P=L.search,M=L.abort,I=Or((function(){S(Math.random())}),u).handleTap;return Object(nr.a)(["x"],(function(){return S(Math.random())})),Object(n.useEffect)((function(){if(A){console.log(A);var e=new Date(A.features[0].properties.earthObservation.acquisitionInformation[0].acquisitionParameter.acquisitionStartTime);(x.current.getTime()<e.getTime()||null===x.current)&&(x.current=e);var t=new Date(A.features[A.features.length-1].properties.earthObservation.acquisitionInformation[0].acquisitionParameter.acquisitionStartTime);(w.current.getTime()>t.getTime()||null===t.current)&&(w.current=t),O.current+=A.features.length,T.current=Number(A.properties.totalResults);var r={totalResults:T.current,totalLoaded:O.current};d(A,r)}}),[A]),Object(n.useEffect)((function(){v(N),!1===N&&0!==x.current.getTime()&&h({firstResultDate:x.current,lastResultDate:w.current,totalResults:T.current,totalLoaded:O.current})}),[N]),Object(n.useEffect)((function(){console.log("status: "+k),""!==k&&f(k)}),[k]),Object(n.useEffect)((function(){console.log("searchtrigger"),console.log(E),E&&0!=E&&(N?M():(x.current=new Date(0),w.current=new Date,O.current=0,T.current=0,u(),P(D,a)))}),[E]),Object(n.useEffect)((function(){var e=t,n=r;"global"===i?n=null:e=null,j((function(t){return Object(l.a)(Object(l.a)({},t),{},{searchdate:e,mission:o,searchpoint:n})}))}),[t,o,r,c,i]),Object(g.jsx)("div",{children:Object(g.jsx)("div",{className:!0===_?"SearchController Active":"SearchController",onClick:I,children:Object(g.jsx)(Qt.Icon,{icon:Fr.a,width:"50px"})})})},Vr=function(){var e=i.a.useContext(f),t=Object(s.a)(e,2),r=t[0],a=t[1],o=h(r.searchPoint,200),l=h(r.altitude,200),c=Object(n.useCallback)((function(e,t){a({type:"onResultPage",value:{resultdesc:t,results:e}})}),[]),u=Object(n.useCallback)((function(){a({type:"onSearchStart",value:Math.random()})}),[]),d=Object(n.useCallback)((function(e){a({type:"onSearchComplete",value:e})}),[]),p=Object(n.useCallback)((function(e){var t=e.split("/")[2],r=window.prompt("Please enter your username for \n"+t,""),n=window.prompt("Please enter your password for \n"+t,"");a({type:"set_credentials",value:{key:t,user:r,pass:n}})}),[]);return Object(g.jsx)(Br,{searchdate:new Date(r.searchDate),searchpoint:o,searchmode:r.searchMode,mission:r.mission,credentials:r.credentials,altitude:l,onSearchStart:u,onPageSearch:c,onSearchComplete:d,on401:p})},zr=r(102);r(100);var Wr=function(){var e=i.a.useContext(f),t=Object(s.a)(e,1)[0];return Object(g.jsx)("div",{className:"GenericLabel Small",children:t.closestItem?t.closestItem.userProperties.title:""})};var Hr=function(){var e=Object(n.useRef)(),t=Object(zr.a)().toggle;return Object(nr.a)(["f"],(function(){t(e.current)})),Object(g.jsx)(p,{children:Object(g.jsxs)("div",{className:"App",ref:e,id:"container",children:[Object(g.jsx)(ir,{id:"globe"}),Object(g.jsx)(Lr,{}),Object(g.jsx)(lr,{}),Object(g.jsx)(Vr,{}),Object(g.jsx)(or,{active:"false",children:Object(g.jsxs)("div",{className:"horizontalContainer",children:[Object(g.jsx)(cr,{}),Object(g.jsx)(ur,{}),Object(g.jsxs)("div",{className:"horizontalContainer",children:[Object(g.jsx)(hr,{}),Object(g.jsx)(pr,{})]})]})}),Object(g.jsxs)(sr,{children:[Object(g.jsx)(mr,{}),Object(g.jsx)(_r,{}),Object(g.jsx)(vr,{}),Object(g.jsx)(Wr,{})]})]})})};o.a.render(Object(g.jsx)(i.a.StrictMode,{children:Object(g.jsx)(Hr,{})}),document.getElementById("root"))},37:function(e,t,r){},43:function(e,t,r){},62:function(e,t,r){},64:function(e,t,r){},66:function(e,t,r){},67:function(e,t,r){},68:function(e,t,r){},69:function(e,t,r){},70:function(e,t,r){},71:function(e,t,r){},72:function(e,t,r){},73:function(e,t,r){},74:function(e,t,r){},75:function(e,t,r){},76:function(e,t,r){},78:function(e,t,r){},79:function(e,t,r){},80:function(e,t,r){},81:function(e,t,r){},82:function(e,t,r){},83:function(e,t,r){}},[[101,1,2]]]);
//# sourceMappingURL=main.ebfcb797.chunk.js.map